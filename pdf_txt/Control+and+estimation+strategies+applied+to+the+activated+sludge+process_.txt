Uppsala Univ ersit yDepartmen t of Materials ScienceSystems and Con trol GroupCONTR OL AND ESTIMA TIONSTRA TEGIES APPLIED TO THEA CTIV A TED SLUDGE PR OCESSCarl/-F redrik Lindb erg
UPPSALA UNIVERSITY /1/9/9/7Abstract iDissertation for the Degree of Do ctor of Philosoph y in Automatic Con/-trol presen ted at Uppsala Univ ersit y in /1/9/9/7/.ABSTRA CTLindb erg/, C/-F/. /1/9/9/7/. Con trol and Estimation Strategies Applied to theActiv ated Sludge Pro cess/, /2/1/4pp/. Uppsala/. ISBN /9/1/-/5/0/6/-/1/2/0/2/-/6/.Requiremen ts for treated w astew ater are b ecoming increasingly more strin/-gen t/. This/, in com bination with increasing loads/, and limited a v ailabilit yof land/, calls for more e/#0Ecien t pro cedures for w astew ater treatmen t plan ts/.In this thesis/, con trol and estimation strategies are dev elop ed in order toimpro v e the e/#0Eciency of the activ ated sludge pro cess/.F our di/#0Beren t con trollers for con trol of the external carb on /#0Do w rateare ev aluated in a sim ulation study /, and in pilot plan t exp erimen ts/. Allcon trollers utilize feedforw ard from measurable disturbances/.On/-line metho ds for estimating the time/-v arying respiration rate andthe nonlinear o xygen transfer function from measuremen ts of the dissolv edo xygen concen tration and the air/#0Do w rate are presen ted/. The approac hesare successfully applied to real data/.Tw o strategies for designing a DO con troller are dev elop ed and practi/-cally ev aluated/. The basic idea is to explicitly tak e the nonlinear o xygentransfer function in to accoun t in the con troller design/. A sup ervision con/-troller for the DO pro cess is dev elop ed/. Practical exp erimen ts in a pilotplan t sho w that it is p ossible with this con trol strategy to k eep the am/-monium concen tration at a constan t and lo w lev el/, and at the same timereduce the energy consumption and the e/#0Fuen t nitrate concen tration/.Finally /,m ultiv ariable con trollers ha v e b een designed and ev aluated in asim ulation study /. The k ey ob jectiv ei s t o k eep e/#0Fuen t ammonium and ni/-trate at lo w lev els/. The con trollers are based on a linear state/-space mo del/,estimated b y a subspace system iden ti/#0Ccation metho d/. The main adv an/-tage of these con trollers/, compared to SISO con trollers/, is that in teractionsin the pro cess mo del are tak en in to accoun t/.Key/-wor ds/: Activ ated sludge/, dissolv ed o xygen con trol/, estimation/, /#0Clter/-ing/, m ultiv ariable con trol/, nonlinear con trol/, o xygen transfer rate/, recursiv eiden ti/#0Ccation/, respiration rate/, smo othing/, sup ervision con trol/.Carl/-F r e drik Lindb er g/, Systems and Contr ol Gr oup/, Uppsala University/,Box /2/7/, SE/-/7/5/1 /0/3 Uppsala/, Swe denc/#0D Carl/-F redrik Lindb erg /1/9/9/7ISBN /9/1/-/5/0/6/-/1/2/0/2/-/6Prin ted in Sw eden b y Graphic Systems AB/, Sto c kholm /1/9/9/7ii PrefacePrefaceThe thesis consists of sev en c hapters/. In the /#0Crst c hapter an in tro ductionto w astew ater treatmen t and con trol of an activ ated sludge pro cess is giv en/.The second c hapter giv es a description of the pilot plan t in Uppsala/, anda sim ulation mo del of the pilot plan t/. The sim ulation mo del mimics acomplete activ ated sludge pro cess/. Most sim ulation examples in the thesisare based on this mo del/. The /#0Cndings rep orted in the c hapters ha v e eitherb een published or b een accepted to v arious scien ti/#0Cc journals or conferences/.Chapter /2 /, is based onCarlsson/, B/./, S/. Hasselblad/, E/. Plaza/, S/. M /#17 artensson and C/-F/. Lindb erg/#28/1/9/9/7/#29/. Design and op eration of a pilot/-scale activ ated sludge plan t/.V atten /5/3 /#28/1/#29/, /2/7/#7B/3/2/.Carlsson/, B/. and C/-F/. Lindb erg /#28/1/9/9/5/#29/. A con trol and sup ervision sys/-tem for an activ ated sludge pilot plan t/. Nin th F orum for AppliedBiotec hnology /, /2/7/#7B/2/9 Sept/. pp /2/4/9/1/#7B/2/4/9/4/.Carlsson/, B/./, J/. Latomaa and C/-F/. Lindb erg /#28/1/9/9/4 b /#29/. A con trol and su/-p ervision system for an activ ated sludge pro cess /#28ett st yr/- oc h /#7Fov er/-v akningssytem f/#7F or en aktivslampro cess/. Reglerm/#7F ote /'/9/4/, /2/5/#7B/2/6 Oct/./,V/#7F aster /#17 as/, Sw eden /#28in Sw edish/#29/.Chapter /3 /, has partly b een published inHallin/, S/./, C/-F/. Lindb erg/, M/. P ell/, E/. Plaza and B/. Carlsson /#28/1/9/9/6/#29/. Micro/-bial adaptation/, pro cess p erformance and a suggested con trol strategyin a pre/-den trifying system with ethanol dosage/. Water Scienc e andT e chnolo gy /3/4 /#28/1/#7B/2/#29/, /9/1/#7B/9/9/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 a /#29/. Adaptiv e con trol of external car/-bo n /#0Do w rate in an activ ated sludge pro cess/. Water Scienc e andT e chnolo gy /3/4 /#28/3/#7B/4/#29/, /1/7/3/#7B/1/8/0/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 b /#29/. Con trol strategies for the activ atedsludge pro cess /#28st yrstrategier f/#7F or en aktivslam bass/#7F ang i reningsv erk/#29/.Reglerm/#7F ote /'/9/6/, /6/#7B/7 June/, Lule /#17 a/, Sw eden /#28in Sw edish/#29/.Preface iiiChapter /4 /, is partly based on/:Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 d /#29/. Estimation of the respirationrate and o xygen transfer function utilizing a slo w DO sensor/. WaterScienc e and T e chnolo gy /3/3 /#28/1/#29/, /3/2/5/#7B/3/3/3/.Carlsson/, B/./, C/-F/. Lindb erg/, S/. Hasselblad and S/. Xu /#28/1/9/9/4 a /#29/. On/-lineestimation of the respiration rate and the o xygen transfer rate atKungs/#7F angen w astew ater plan t in Uppsala/. Water Scienc e and T e ch/-nolo gy/. /3/0 /#28/4/#29/, /2/5/5/#7B/2/6/3/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/3/#29/. Ev aluation of some metho ds foriden tifying the o xygen transfer rate and the respiration rate in anactiv ated sludge pro cess/. T ec hnical Rep ort UPTEC /9/3/0/3/2R/. Systemsand Con trol Group/, Uppsala Univ ersit y /. Uppsala/, Sw eden/.Chapter /5 /, is partly presen ted in/:Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 b /#29/. Con trol strategies for the activ atedsludge pro cess /#28st yrstrategier f/#7F or en aktivslam bass/#7F ang i reningsv erk/#29/.Reglerm/#7F ote /'/9/6/, /6/#7B/7 June/, Lule /#17 a/, Sw eden /#28in Sw edish/#29/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 c /#29/. E/#0Ecien t con trol of the DO in anactiv ated sludge pro cess/. V atten /5/2 /#28/3/#29/, /2/0/9/#7B/2/1/2/. /#28in Sw edish/#29/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 e /#29/. Nonlinear and set/-p oin t con trol ofthe dissolv ed o xygen dynamic in an activ ated sludge pro cess/. WaterScienc e and T e chnolo gy /3/4 /#28/3/#7B/4/#29/, /1/3/5/#7B/1/4/2/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/4 a /#29/. Nonlinear con trol of the dissolv edo xygen in an activ ated sludge pro cess/. /#28Olinj/#7F ar reglering a v syrehal/-ten i en aktivslam bass/#7F ang/#29/. Reglerm/#7F ote /'/9/4/, /2/5/#7B/2/6 Oct/. V/#7F aster /#17 as/,Sw eden /#28in Sw edish/#29/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/4 b /#29/. Nonlinear con trol of the dissolv edo xygen in an activ ated sludge pro cess/. T ec hnical Rep ort UPTEC/9/4/0/7/6R/. Systems and Con trol Group/, Uppsala Univ ersit y /. Uppsala/,Sw eden/.Chapter /6 /, will partly b e presen ted inLindb erg/, C/-F/. /#28/1/9/9/7/#29/. Multiv ariable mo deling and con trol of an activ atedsludge pro cess/. Accepted for the /7th IA W QW orkshop on Instrumen/-tation/, Con trol /& Automation of W ater /&W astew ater T reatmen t/&T ransp ortation Systems/, Brigh ton UK/, /6/#7B/1/1 July /1/9/9/7/.iv PrefaceChapter /7 /, giv es a conclusion/, and some topics for future researc h/.Sev eral of the results and /#0Cndings in the thesis app ear also in a morepreliminary form inLindb erg/, C/-F/. /#28/1/9/9/5/#29/. Con trol of w astew ater treatmen t plan ts/. Licen ti/-ate thesis/. UPTEC /9/5/0/7/1R/. Systems and Con trol Group/, UppsalaUniv ersit y /,S w edenThis w ork has b een carried out in the ST AMP pro ject/. ST AMP is anabbreviation in Sw edish for con trol of w astew ater treatmen t plan ts/, newmetho ds and new pro cess tec hnology /. The pro ject w as initiated and /#0C/-nanced b y the Sw edish Board for T ec hnical Dev elopmen t/. One of the pur/-p oses of ST AMP is to com bine the di/#0Beren t comp etence in a pro ject onw astew ater treatmen t/. The pro ject is hence in terdisciplinary /. It in v olv esresearc h in automatic con trol/, microbiology /,e n vironmen tal tec hnology /, andw ork science/. The researc h is also organized in four di/#0Beren t consortia/,whic h are lo cated in Uppsala/, Sto c kholm/, Gothen burg and Lund/#2FMalm/#7F o/.During m y studies I ha v e also b een a co/-sup ervisor for the follo wingMaster thesis pro jects/:Latomaa/, J/. /#28/1/9/9/4/#29/. A con trol and sup ervision system for an activ atedsludge pilot plan t/. Master/'s thesis/. Systems and Con trol Group/,Uppsala Univ ersit y /. UPTEC /9/4/0/7/7E/.Luttmer/, J/. /#28/1/9/9/5/#29/. Design of a sim ulator for an activ ated sludge pro cess/.Master/'s thesis/. Systems and Con trol Group/, Uppsala Univ ersit y /.UPTEC /9/5/1/4/9E/.Nak a jima/, S/. /#28/1/9/9/6/#29/. On/-line estimation of the respiration rate and theo xygen transfer function using an extended k alman /#0Clter/. Master/'sthesis/. Departmen t of Signals/, Sensors and Systems/: Ro y al Instituteof T ec hnology /,S w eden/.Ac kno wledgmen t vAc kno wledgmen tIw ould lik et o express m y gratitude to m y sup ervisor/, Asso ciate Prof/.Bengt Carlsson for his encouragemen t/, supp ort and constructiv e criticism ofm y ideas and all w ork/. Iw ould also lik e to thank the head of the group Prof/.T orsten S/#7F oderstr/#7F om/, for pro viding a w ell organized PhD programme and forgiving man yv aluable commen ts on the man uscript/. I thank Asso ciate Prof/.Mik ael Sternad who has b een a v ailable for man y discussions concerningv arious con trol problems/.I w an t to thank all mem b ers of the Systems and Con trol Group/, andthe Signals and Systems Group who ha v e con tributed b y creating pleasan tand stim ulating w orking conditions/. It has also b een a pleasure to be amem b er at the ST AMP researc h consortium in Uppsala and I wish to thankm y colleges of the /#5CST AMP/-group/"/. The supp ort from the p ersonnel atKungs/#7F angsv erk et sew age treatmen t plan t and Uppsala Municipal ServiceDepartmen t is gratefully ac kno wledged/. A sp ecial thank to Jan S/#7F oderlundand Stefan M /#17 artensson for their sp ecial concern of the pilot plan t/.I also w an t to thank follo wing p ersons for reading and impro ving v ar/-ious parts of the man uscript/: Serena Hasselblad/, Claes Tidesta v and Dr/.T orb j/#7F orn Wigren/.I thank Jouk o Latomaa for his programming of the computerized con troland sup ervision system for the pilot plan t and Ov eE w erlid for sharing hisexp ert kno wledge in C/+/+ and Lin ux/.This w ork has b een /#0Cnancially supp orted b y the Sw edish NationalBoard for T ec hnical Dev elopmen t /#28Nutek/#29/, con tract /9/3/-/0/4/1/8/5P /, whic h isgratefully ac kno wledged/. The pilot plan t and its equipmen tw ere /#0Cnancedb y the Public W orks and Real Estate Departmen t/, Uppsala/.The exp erimen t with surface activ e agen ts and their in/#0Duence on theo xygen transfer rate/, presen ted in Section /4/./7/, w as /#0Cnancially supp ortedb y
/#7FOrebro/, Karlstad/, G/#7F avle and Borl/#7F ange w astew ater treatmen t plan t/,Naturv /#17 ardsv erk et/, Cellpa teknik and V A/-ingenj/#7F orerna/.vi Ac kno wledgmen tCon ten ts/1 W astew ater treatmen t /| An in tro duction /1/1/./1 A short historical review of Sw edish w astew ater treatmen t /. /2/1/./2 Aw astew ater treatmen t plan t /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /4/1/./3 The activ ated sludge pro cess /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/1/./3/./1 Basic description /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/1/./3/./2 Biological nitrogen remo v al /. /. /. /. /. /. /. /. /. /. /. /. /. /. /8/1/./3/./3 Mathematical mo dels /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /9/1/./4 Con trol of w astew ater treatmen t plan ts /. /. /. /. /. /. /. /. /. /. /. /1/1/1/./5 Outline of the thesis /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/6/2 Pilot plan t and sim ulation mo del /2/1/2/./1 The pilot plan t /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /2/2/2/./1/./1 General la y out of the pilot plan t /. /. /. /. /. /. /. /. /. /. /. /2/2/2/./1/./2 The con trol and sup ervision system /. /. /. /. /. /. /. /. /. /2/4/2/./1/./3 A sim ulator based on the con trol and sup ervision sys/-tem /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /2/5/2/./2 Conducted exp erimen ts in the pilot plan t /. /. /. /. /. /. /. /. /. /. /2/7/2/./3 The sim ulation mo del /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /2/9/2/./3/./1 Mo del of the pilot plan t /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /2/9/2/./3/./2 The bioreactor mo del /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /3/1/2/./3/./3 Di/#0Beren tial equations and parameter v alues /. /. /. /. /. /3/1/2/./3/./4 The settler mo del /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /3/5/2/./3/./5 Sim ulation to ol /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /3/8/2/./3/./6 Conclusions /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /3/8/3 Con trol of external carb on /#0Do w rate /4/1/3/./1 Mo deling the nitrate pro cess /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /4/3/3/./2 Con trol strategy /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /4/6/3/./3 A PID/-con troller /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /4/8/3/./4 A mo del/-based adaptiv e PI con troller /. /. /. /. /. /. /. /. /. /. /. /. /. /4/9/3/./4/./1 Exten tion of the mo del/-based adaptiv e PI con troller /5/0/3/./5 A direct adaptiv e con troller /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /5/1viii CONTENTS/3/./5/./1 P arameter estimation /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /5/3/3/./6 An indirect adaptiv e con troller /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /5/5/3/./6/./1 Iden ti/#0Ccation of the pro cess /. /. /. /. /. /. /. /. /. /. /. /. /. /. /5/6/3/./6/./2 Observ er p olynomials /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /5/8/3/./6/./3 Calculation of the con troller /. /. /. /. /. /. /. /. /. /. /. /. /. /. /5/9/3/./7 Practical asp ects for the adaptiv e con trollers /. /. /. /. /. /. /. /. /6/1/3/./7/./1 P otter/'s square ro ot algorithm /. /. /. /. /. /. /. /. /. /. /. /. /6/1/3/./7/./2 Choice of initial co v ariance matrix and initial regressor /6/2/3/./7/./3 The forgetting factor /#15 /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/2/3/./7/./4 Estimator windup /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/2/3/./7/./5 Scaling the regressors /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/5/3/./7/./6 Including the reference signal /. /. /. /. /. /. /. /. /. /. /. /. /. /6/5/3/./7/./7 A serv o /#0Clter /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/6/3/./7/./8 Choice of sampling rate /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/6/3/./8 Sim ulations /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/6/3/./8/./1 Sim ulation setup for the activ ated sludge pro cess /. /6/7/3/./8/./2 PI con trol /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/7/3/./8/./3 Direct adaptiv e con trol /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /6/9/3/./8/./4 Indirect adaptiv e con trol /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /7/0/3/./8/./5 Mo del/-based adaptiv e PI con trol /. /. /. /. /. /. /. /. /. /. /. /7/1/3/./8/./6 Extended mo del/-based adaptiv e PI con trol /. /. /. /. /. /7/2/3/./8/./7 Illustration of feedforw ard /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /7/4/3/./9 Ev aluation in the pilot plan t/. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /7/6/3/./9/./1 Conditions on the plan t /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /7/6/3/./9/./2 The con troller /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /7/6/3/./9/./3 Results /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /7/7/3/./1/0 Conclusions /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /7/9/4 Estimation of the DO dynamics /8/1/4/./1 The o xygen transfer function /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /8/3/4/./2 The dissolv ed o xygen dynamics /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /8/4/4/./2/./1 A con tin uous time mo del /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /8/4/4/./2/./2 A discrete/-time mo del /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /8/6/4/./3 The estimator /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /8/7/4/./3/./1 Di/#0Beren t mo dels of the nonlinear KL
a function /. /. /. /8/8/4/./3/./2 Mo deling the time/-v arying respiration rate /. /. /. /. /. /9/1/4/./3/./3 Putting the mo dels together /. /. /. /. /. /. /. /. /. /. /. /. /. /. /9/2/4/./3/./4 The Kalman /#0Clter /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /9/3/4/./3/./5 An alternativ e approac h of estimating KL
a /. /. /. /. /. /9/6/4/./4 Estimation utilizing a slo w DO sensor /. /. /. /. /. /. /. /. /. /. /. /. /9/7/4/./4/./1 Simple illustration of the problem /. /. /. /. /. /. /. /. /. /. /9/7/4/./4/./2 Filtering the DO measuremen ts /. /. /. /. /. /. /. /. /. /. /. /. /9/8CONTENTS ix/4/./4/./3 Determination of A /, B /, k and /#1A /. /. /. /. /. /. /. /. /. /. /. /. /1/0/1/4/./4/./4 An example /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/0/1/4/./5 Sim ulated examples /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/0/3/4/./5/./1 Sim ulation setup /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/0/4/4/./5/./2 Estimation results of the sim ulations /. /. /. /. /. /. /. /. /. /1/0/5/4/./5/./3 Sim ulation with time/-v arying KL
a /. /. /. /. /. /. /. /. /. /. /1/1/1/4/./5/./4 Sim ulation with a slo w DO sensor /. /. /. /. /. /. /. /. /. /. /1/1/2/4/./6 Application to real data /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/1/3/4/./6/./1 Including the v alv ec haracteristics in KL
a /. /. /. /. /. /. /1/1/3/4/./6/./2 A practical exp erimen t/. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/1/4/4/./6/./3 Lab oratory batc h exp erimen ts /. /. /. /. /. /. /. /. /. /. /. /. /1/1/5/4/./7 Exp erimen ts with surface activ e agen ts /. /. /. /. /. /. /. /. /. /. /. /. /1/1/5/4/./7/./1 Lab oratory batc h exp erimen ts /. /. /. /. /. /. /. /. /. /. /. /. /1/2/0/4/./8 Conclusions /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/2/1/5 Con trol of the DO /1/2/3/5/./1 The con trol problem /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/2/5/5/./2 The nonlinear DO con troller /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/2/5/5/./2/./1 P ole/-placemen t with a PI/-con troller /. /. /. /. /. /. /. /. /. /1/2/7/5/./2/./2 Linear quadratic /#28LQ/#29 con trol with feedforw ard /. /. /. /1/2/9/5/./3 Sim ulations /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/3/0/5/./3/./1 Sim ulation setup /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/3/1/5/./3/./2 Examples /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/3/2/5/./4 Practical exp erimen t /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/3/6/5/./5 Con trol of the dissolv ed o xygen set/-p oin t/. /. /. /. /. /. /. /. /. /. /. /1/3/9/5/./5/./1 A practical exp erimen t/. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/4/0/5/./5/./2 T uning of the DO set/-p oin t con troller /. /. /. /. /. /. /. /. /1/4/2/5/./6 Pressure con trol /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/4/5/5/./7 Conclusions /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/4/8/6 Multiv ariable mo deling and con trol /1/4/9/6/./1 Mo deling /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/5/0/6/./1/./1 What to mo del/? /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/5/1/6/./1/./2 Subspace iden ti/#0Ccation /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/5/3/6/./1/./3 Application of subspace iden ti/#0Ccation to the activ atedsludge pro cess /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/5/5/6/./2 Con trol /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/6/1/6/./2/./1 Con troller design /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/6/2/6/./2/./2 Con troller design on di/#0Beren tial form /. /. /. /. /. /. /. /. /. /1/6/3/6/./2/./3 Con troller design with in tegration states /. /. /. /. /. /. /. /1/6/8/6/./2/./4 Comparison b et w een the t w om ultiv ariable con trollers /1/7/1/6/./2/./5 Comparison b et w een SISO and MIMO con trol /. /. /. /1/7/2x CONTENTS/6/./3 Some remarks /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/7/5/6/./4 Conclusions /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/7/5/7 Conclusions and topics for future researc h /1/7/7/7/./1 Conclusions /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/7/7/7/./2 T opics for future researc h /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/7/9/7/./2/./1 Spatial DO con trol /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/7/9/7/./2/./2 F urther studies of the e/#0Bect of surfactan ts /. /. /. /. /. /. /1/7/9/7/./2/./3 Analyzing the information of the carb on dosage /. /. /. /1/7/9/7/./2/./4 Con trol of the sludge blank et and the biomass /. /. /. /1/8/0/7/./2/./5 Plan t/-wide optimization /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/8/0/7/./2/./6 Cost functions /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/8/1/7/./2/./7 Extrem um con trol /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/8/2A The generalized minim um/-v ariance con troller /1/8/5A/./1 Deriv ation of the con troller /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/8/5B LQ/-con trol with feedforw ard /1/8/9B/./1 The LQ problem /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /1/9/0B/./1/./1 Choice of the degrees of the con troller p olynomials /. /1/9/4C Cubic spline /1/9/7C/./1 Deriv ation of the linear regression form /. /. /. /. /. /. /. /. /. /. /. /1/9/8D Estimation using an extended Kalman /#0Clter /2/0/1Bibliograph y /2/0/2Chapter /1W astew ater treatmen t /| Anin tro ductionW ater is something sp ecial/. Ev ery living thing on earth /#7B micro organisms/,plan ts/, animals/, h umans and ev en our brain /#7B consists mostly of w ater/.The earth also con tains a lot of w ater/. More than /7/0/#25 of the earth/'ssurface is co v ered b yw ater/, only a small part of whic h is suitable for eitherh uman consumption or agricultural use /#28appro ximately /0/./5/#25 of all w aterin the w orld/#29/. This small fraction is diminishing as agriculture/, industryand housek eeping p ollute and consume more and more of the drink ablew ater supply /. Natural w ater cycles m ust b e allo w ed to con tin ue and h umanimpact on w ater resources m ust b e limited if disasters is to b e a v oided/.Cen tral to this is prop er treatmen to f w astew ater whereb y the n utrien tstrapp ed in sludge from w astew ater treatmen t pro cesses can b e transferredbac k to soil/.This thesis considers di/#0Beren t applications of con trol and estimationmetho ds that aim to impro v e the op eration of the activ ated sludge pro cessin w astew ater treatmen t plan ts/. The suggested metho ds reduce the e/#0Fu/-en t n utrien t concen trations/, sa v e energy /, and reduce the need for externalc hemicals if suc h are used/. The metho ds are v eri/#0Ced b oth in sim ulationsand in pilot plan t exp erimen ts/.In Section /1/./1 of this c hapter a short historical review of the dev elopmen tof w astew ater treatmen t in Sw eden is presen ted/. Section /1/./2 con tains abrief description of ho wa w astew ater treatmen t plan tw orks/. The activ atedsludge pro cess/, an imp ortan t step in w astew ater treatmen t plan t op erations/,is explained in Section /1/./3/. The di/#0Beren t con trol strategies are applied to/2 W astew ater treatmen t /| An in tro ductionthis pro cess/. Section /1/./4 giv es some ideas on ho w adv anced con trol theorycan b e applied using new on/-line sensors and biological mo dels/. Finally /,a noutline of the other c hapters is giv en in Section /1/./5/./1/./1 A short historical review of Sw edish w aste/-w ater treatmen tMuc h of the material in this section is tak en from Lundgren /#28/1/9/9/4/#29 andFinnson /#28/1/9/9/4/#29/.Up un til the nineteen th cen tury the ma jorit y of the Sw edish p opulationliv ed in the coun tryside/. Cities and to wns w ere small and w ater closets w ererare/. W astew ater p osed only minor problems/. In the end of the /1/8/0/0/'s theurban areas expanded rapidly /, causing a v ariet y of sanitary problems andepidemics/. Suitable drinking w ater b ecame increasingly harder to /#0Cnd whilew aste accum ulated/. The traditional metho d of garbage disp osal/, thro wingit o v er the do orstep b ecame un tenable/.The in tro duction of w ater closets/, in the b eginning of the nineteen thcen tury /, solv ed man y of these problems/. Disease decreased and the ur/-ban p opulation a v oided man y problems asso ciated with latrines/; empt yinglatrine/-barrels /#28see Figure /1/./1/#29 and bad smell/. The w ater closet w as at the/#0Crst sigh t a great tec hnical simpli/#0Ccation /#7B w aste just disapp eared/!
Figure /1/./1/: Latrine carrying in Sto c kholm/, dra wing from /1/8/2/8/#28Komm unf/#7F orbundet /1/9/8/8/#29/.As an in teresting sidenote/, the toilet mak es use of con trol tec hnology /./#28Coury /1/9/9/6/#29/. When y ou /#0Dush/, the v alv e at the b ottom of the tank op ensand remains op en b ecause the v alv e /#0Doats/, but when the tank is empt y itcloses/. Another v alv e then op ens and w ater starts to /#0Cll the tank again/. Asthe w ater lev el rises a /#0Doat is carried up w ard whic h closes the /#0Doat v alv ewhen the tank is full/. This system dep ends on t w o con trol lo ops where thew ater lev el is used for feedbac k/. T oa v oid /#0Do o ding at a failure there is also/1/./1 A short historical review of Sw edish w astew ater treatmen t /3a /#0Dush v alv e tub e inside the tank/.The use of w ater closets/, ho w ev er/, so on started to a/#0Bect the recipien ts
/1/.First to b e detected w ere the visual problems/, caused b yu n treated w astew/-ater/. These w ere partly solv ed b y constructing long pip es to the sea/, whic hin those da ys w as b eliev ed to be capable of absorbing in/#0Cnite amoun ts ofw astew ater/. The risk of p ollution and loss of fertilizer w ere considereda reasonable price to pa y compared to the p ositiv e e/#0Bects/. The p ositiv ee/#0Bects w ere also seen immediately /, while the negativ e consequences to oklonger to detect/. Almost /5/0 y ears w en t b y b efore the asso ciated p ollutionproblems b egan to receiv e serious atten tion in Sw eden/.Sedimen tation tanks w ere in tro duced in the /1/9/3/0/'s to deal with thevisual problems with w astew ater/. By the /1/9/5/0/'s biological treatmen t w asinitiated after problems b egan to sho w up with o xygen depletion in therecipien ts/. Com bined biological/-c hemical treatmen t w as in tro duced in the/1/9/7/0/'s/, due to the eutrophication of lak es from phosphorus and nitrogen inw astew ater/. Dev elopmen ts in w astew ater treatmen t tec hnologies be t w een/1/9/6/5 and /1/9/9/0 in Sw eden are sho wn in Figure /1/./2/.
Figure /1/./2/: The dev elopmen to fw astew ater treatmen t /1/9/6/5/#7B/1/9/9/0 inSw eden /#28Hultman /1/9/9/2/#29/./1The riv er/, lak e or other w atercourse where the treated w astew ater is let out in to/./4 W astew ater treatmen t /| An in tro ductionIn /1/9/9/2 a Europ ean Comm unit y directiv e required all mem be r statesto impro v e their w astew ater treatmen tb y the turn of the cen tury /. Sw edenhas decided to decrease of the nitrogen disc harges b y appro ximately /5/0/#25for larger w astew ater treatmen t plan ts lo cated on the coast from Norw a yt oSto c kholm/. Phosphorus remo v al should also b e increased for these plan ts/.F urther reduction of nitrogen demands more e/#0Ecien t con trol and op erationof the w astew ater treatmen t plan ts/. This is one of the ma jor motiv ationsb ehind this thesis/./1/./2 A w astew ater treatmen t plan tIn a mo dern w astew ater treatmen t plan t the w astew ater is generally pro/-cessed in sev eral steps b efore it is released to the recipien t/. Tc hobanoglousand Sc hro eder /#28/1/9/8/5/#29 and Komm unf/#7F orbundet /#28/1/9/8/8/#29 giv e a surv ey of com/-mon practice/. As c hematic picture of a t ypical plan t is presen ted in Figure/1/./3/. The four blo c ks represen t di/#0Beren t stages of the w astew ater treatmen tpro cesses/.
Chemical treatment
Sludge treatmentPrimary
Sedimentation
Dewatered sludgewater
Sludgethickening StabilizationDewateringBiological treatment
Sand
filterGridActivated sludge
Supernatants + BackwashingEffluentMechanical treatment 3 2 1
4Chemicals
PreciptationFigure /1/./3/: A common la y out of a w astew ater treatmen t plan t/#28Komm unf/#7F orbundet /1/9/8/8/#29/.First me chanic al tr e atment is applied/. Large ob jects lik e rags are /#0Crstcollected on a grid/. Then hea vy particles lik e sand are remo v ed in a sandtrap
/2/. Ligh ter particles are remo v ed in a primary settler/.The second blo c k is often biolo gic al /. In this part of the w astew atertreatmen t plan t micro organisms degrade organic matter and in some con/-/2The sand trap w orks lik e a settler but with a higher w ater /#0Do w/./1/./2 A w astew ater treatmen t plan t /5/#0Cgurations n utrien ts are also remo v ed/. Di/#0Beren t biological pro cesses exist/,but most larger w astew ater treatmen t plan ts mak e use of the activate dsludge pr o c ess /. In its basic con/#0Cguration the activ ated sludge pro cess con/-sists of an aerated tank and a settler/. The microorganisms gro w slo wly inthe aerated tank/. In order to main tain their p opulation sizes/, sludge fromthe settler whic h con tains micro organisms is recirculated bac k to the aer/-ated tank/. Excess sludge is remo v ed to b oth a v oid sludge in e/#0Fuen tw aterand to main tain a reasonable susp ended solids concen tration/. F urther in/-formation is to b e found in Section /1/./3/. Other t yp es of biological treatmen tare also a v ailable/. An oxidation p ond /, for example/, is a p ond where thew astew ater is retained for /2/0/#7B/4/0 da ys/. During this p erio d the w astew ateris treated b y microorganisms/, algae/, and the in/#0Duence of sunligh t/. Thetrickling /#0Clter is another kind of biological treatmen t/. It is a construction/#0Clled with ro c ks or plastic ob jects to whic h the microorganisms attac h andgro w/. The w astew ater b ecomes treated while it tric kles through the /#0Clter/.Air is also blo wn through the /#0Clter to increase the o xygen concen trationand hence impro v e treatmen t/. Wetlands are y et a further biological alter/-nativ e/. In a w etland/, w astew ater is spread out o v er a large area with aw ater depth of around /0/./5 meters/. Plan ts and microorganisms treat thew astew ater/. W etlands are usually used as a /#0Cnal p olishing step and notas a replacemen t for an activ ated sludge pro cess/. In this thesis only theactiv ated sludge pro cess will b e considered/.Phosphorus is often remo v ed from the w astew ater b y chemic al tr e at/-ment as sho wn in the third blo c k of Figure /1/./3/. But it is also common toha v e this step in the b eginning /#7B pre/-precipitation/. A precipitation c hem/-ical is added whic h turns phosphate in to insoluble fractions/. Precipitationc hemicals also stim ulate the creation of /#0Do c ks/. The insoluble phosphates asw ell as organically b ounded phosphate then absorb or adhere to the /#0Do c ks/.The /#0Do c ks are separated b y either sedimen tation or /#0Dotation/. Instead ofusing c hemicals/, enhanced phosphorus remo v al can b e applied in the acti/-v ated sludge pro cess b y biological treatmen t/. A sp ecial con/#0Cguration of theactiv ated sludge pro cess mak es this p ossible/. Henze et al/. /#28/1/9/9/5 b /#29/, Balm /#13 erand Hultman /#28/1/9/8/8/#29 and Isaacs and Henze /#28/1/9/9/5/#29 discuss this further/.As a /#0Cnal step sometimes c hlorination for disinfection and remo v al ofbad smell is included b efore the w ater is released in the recipien t/.Sludge from the di/#0Beren t blo c ks is pro cessed in the sludge tr e atment /.The sludge consists of organic material whic h has to b e stabilized to a v oido dor and reduce the pathogenic con ten t/. The stabilization is commonlydone in anaerobic digesters/. In the digesters organic matter is degraded/,and most pathogenic bacteria and microorganisms die due to the high tem/-/6 W astew ater treatmen t /| An in tro ductionp erature/. Bio/-gas/, methane and carb on dio xide are pro duced during diges/-tion/. Before sludge is transp orted a w a y i ti sd e w atered/, either mec hanicallyb y cen trifuging/, /#0Cltering/, and pressing/, or b y drying/. This is done to reducetransp ortation costs since the sludge con tains ab out /9/5/#25 w ater/. After treat/-men t/, sludge ma y b e dump ed or used as a fertilizer and soil conditioner/. Ifthe con ten t of hea vy metals or other p oisonous matter in the sludge is to ohigh/, it is of course not suitable to use in agricultural practice/. It ma y alsob e used as fuel or in construction materials /#28Bradley et al/. /1/9/9/2/#29/. Lue/-Hinget al/. /#28/1/9/9/2/#29 giv es a more detailed description on m unicipal sew age sludgemanagemen t/. The w aste gathered in the grid and sand /#0Clter/, in the me/-c hanical treatmen t/, is usually not treated/. It is instead directly transp ortedto a garbage dump/./1/./3 The activ ated sludge pro cessA basic description of the activ ated sludge pro cess is presen ted/. Ho w theactiv ated sludge pro cess can be extended for nitrogen remo v al is also ex/-plained/. Finally /, a simple mathematical mo del is giv en/./1/./3/./1 Basic descriptionIn Figure /1/./4 the basic la y out of an activ ated sludge pro cess is sho wn/. The
Recirculated sludge Excess sludgeEffluent water waterInfluent Settler Aerated tankFigure /1/./4/: An activ ated sludge pro cess with an aerated tank and asedimen tation tank/.activ ated sludge pro cess is a biological pro cess in whic h microorganisms o x/-idize and mineralize organic matter/. All microorganisms en ter the systemwith the in/#0Duen tw astew ater/. The comp osition of the sp ecies dep ends notonly on the in/#0Duen tw astew ater but also on the design and op eration of thew astew ater treatmen t plan t/. Micro organisms are k ept susp ended either b yblo wing air in to the tank or b y the use of agitators/. Oxygen is used b y themicroorganisms to o xidize organic matter/. T o main tain the microbiologi/-cal p opulation/, sludge from the settler is recirculated to the aerated tank/./1/./3 The activ ated sludge pro cess /7The gro wth of the microorganisms and in/#0Duen t particulate inert matter isremo v ed from the pro cess as exc ess sludge /. Micro organism concen trationis con trolled b y the excess sludge /#0Do w rate/.A basic mo del of the biological renew al pro cess in an activ ated sludgepro cess is illustrated in Figure /1/./5/. Organic matter en ters the plan t insev eral di/#0Beren t forms and is con v erted to other forms b y biological pro/-cesses/. Hydr olysis transforms larger organic molecules in the initial fractionSlo wly degradable materialReadily degradable materialBiomassInert material
Deca y
Biological gro wth
Hydrolysis/?/?/?
/-Figure /1/./5/: The biological renew al pro cess /#28Henze et al/. /1/9/9/5 a /#29/.of slo wly degradable matter in to smaller/, more easily accessible molecules/#28readily degradable matter/#29/. The sp eed of h ydrolysis ma y b e a constrain tin a w astew ater treatmen t plan t if the in/#0Duen tw astew ater mainly consistsof slo wly bio degradable matter/, since the h ydrolysis pro cess is relativ elyslo w er than the gro wth rate of the microorganisms /#28biomass/#29/. The biomassgro wth rate dep ends on man y v ariables suc h as the amoun t of biomass/,the substrate/, temp erature/, pH/, and the presence of to xins/. During biore/-duction /#28deca y of micro organisms/#29/, biologically inert /#28non/-bio degradable/#29matter is pro duced/. Incoming w astew ater will con tain some inert matteras w ell/. This matter /#0Do ws una/#0Bected through the pro cess and is collectedand remo v ed in the settler/./8 W astew ater treatmen t /| An in tro duction/1/./3/./2 Biological nitrogen remo v alNitrogen is presen t in sev eral forms in w astew ater/, e/.g/. as ammonium/#28NH
/+/4
/#29/, nitrate /#28NO
/,/3
/#29/, nitrite /#28NO
/,/2
/#29 and as organic comp ounds/. Nitro/-gen is an essen tial n utrien t for biological gro wth and is one of the mainconstituen ts in all living organisms/. The presence of nitrogen in e/#0Fuen tw astew ater/, ho w ev er/, presen ts man y problems /#28Barnes and Bliss /1/9/8/3/#29/./#0F Ammonia /#28NH/3
/#29 is to xic to aquatic organisms/, esp ecially for higherlife forms suc h as /#0Csh/./#0F When ammonium is o xidized to nitrate/, a signi/#0Ccan to xygen demandin the receiving w ater ma y giv e rise to a sev ere depletion of the dis/-solv ed o xygen concen tration/./#0F Nitrite in drinking w ater is to xic/, esp ecially for h uman infan ts/./#0F Nitrogen is a n utrien t stim ulating gro wth of aquatic plan ts/. Whenthe plan ts die/, o xygen is consumed b y organisms degrading the litter/./#0F The presence of ammonium in the drinking w ater supply requires anincreased c hlorine dosages/.When un treated w astew ater arriv es to the w astew ater treatmen t plan t mostnitrogen is presen t in the form of ammonium/. Nitrogen can b e remo v ed b ya t w o/-step pro cedure/. In the /#0Crst step/, ammonium is o xidized to nitratein aerated zones/. This pro cess is called nitri/#0Cc ation and can basically bedescrib ed b y the follo wing t w oc hemical form ulas/:NH
/+/4
/+/1 /: /5 O/2
/! NO
/,/2
/+ H/2
O /+/2 H
/+NO
/,/2
/+/0 /: /5 O/2
/! NO
/,/3As seen ab o v e ammonium is not directly o xidized to nitrate/. It m ust be/#0Crst o xidized to nitrite and then to nitrate/.In the second step/, the nitrate pro duced under aerobic conditions istransformed to nitrogen gas b y a pro cess called denitri/#0Cc ation /. The deni/-tri/#0Ccation reaction tak es place in an anaerobic en vironmen t where the bac/-teria resp onsible for denitri/#0Ccation respire with nitrate instead of o xygen/.This en vironmen t is called ano xic/. The pro cess can b e summarized b y thefollo wing c hemical form ula/:/4 NO
/,/3
/+/5 /#5C CH/2
O /"/+ /4 H
/+/! /2 N/2
/+/5 CO/2
/+/7 H/2
Owhere /#5C CH/2
O /" stands for div erse the organic matter/./1/./3 The activ ated sludge pro cess /9By using these t w o bacterial pro cesses/, nitri/#0Ccation and denitri/#0Ccation/,nitrogen is remo v ed from w astew ater biologically /. Ano xic zones in the acti/-v ated sludge pro cess are necessary for denitri/#0Ccation/. Ano xic zones can b eplaced either in the b eginning of the tank /#28pre/-denitri/#0Ccation/#29/, see Figure/1/./6/, or in the end of the tank /#28p ost/-denitri/#0Ccation/#29/. In a pre/-denitrifying
Anoxic Anoxic Aerobic AerobicFigure /1/./6/: An activ ated sludge pro cess with pre/-denitri/#0Ccation/.system/, an extra recirculation /#0Do w is usually in tro duced to transp ort the ni/-trate ric hw ater bac k to the ano xic zone/. Recirculated /#0Do w rate is t ypicallyhigher than the in/#0Duen t /#0Do w rate/. The presence of o xygen in the ano xiczone mak es denitri/#0Ccation less e/#0Ecien t/, and th us more carb on is required/.T o reduce the o xygen concen tration caused b y the recirculated w ater/, anadditional ano xic zone in the end of the bioreactor can b e included/.E/#0Ecien t biological nitrogen remo v al in activ ated sludge pro cesses de/-p ends on su/#0Ecien t supplies of carb on for the denitrifying bacterial p opu/-lation/. If the in/#0Duen t w astew ater lac ks su/#0Ecien t energy to supp ort deni/-tri/#0Ccation/, an external carb on source can be added to mak e b etter use ofthe total nitrogen remo v al capacit y /, see also Chapter /3/. Methanol/, ethanol/,acetate/, primary sludge and v arious industrial w aste pro ducts are p ossi/-ble carb on sources/. The carb on con ten t in the in/#0Duen tw astew ater is usedfor denitri/#0Ccation if the ano xic zones are placed at the b eginning of theactiv ated sludge pro cess /#28pre/-denitri/#0Ccation/#29/. When the ano xic zones areplaced after the aerobic zones /#28p ost/-denitri/#0Ccation/#29/, a supplemen tal carb onsource ha v e to b e added/./1/./3/./3 Mathematical mo delsThere are sev eral mo dels of the biological pro cesses in an activ ated sludgepro cess/. Of these/, the most widely used is IA W Q/'s
/3Activ ated Sludge Mo delNo/. /1 /#28Henze et al/. /1/9/8/7/#29/. That mo del describ es the three follo wing biolog/-ical pro cesses/: remo v al of organic matter/, nitri/#0Ccation/, and denitri/#0Ccation/.T o illustrate a biological pro cess the follo wing example from Henze et al/./3In ternational Asso ciation for W ater Qualit y /. This asso ciation w as formerly calledIn ternational Asso ciation on W ater P ollution Researc h and Con trol /#28IA WPR C/#29/./1/0 W astew ater treatmen t /| An in tro duction/#28/1/9/8/7/#29 is giv en/. The pro cess is a completely mixed bioreactor with thethree comp onen ts/. In Figure /1/./7 the bioreactor is illustrated/.
Volume VQQX  S  SSBOin out
X     S     SB,in S,in X   S   SSO O,in BFigure /1/./7/: A completely mixed bioreactor/.T o /#0Cnd the di/#0Beren tial equations for eac h comp onen t in the pro cess/, thefollo wing basic balance equation can alw a ys b e used/.A c cumulation /= Input /#7B Output /+R e actionThe reaction rate ma y /, ho w ev er/, be more di/#0Ecult to determine/, but thefollo wing di/#0Beren tial equations are prop oseddXBdt
/=
QinV
XB /;in
/,
QoutV
XB
/+
/#16SSKS
/+ SS
XB
/, bXBdSSdt
/=
QinV
SS/;in
/,
QoutV
SS
/,
/1Y
/#16SSKS
/+ SS
XBdSOdt
/=
QinV
SO /;in
/,
QoutV
SS
/,
/1 /, YY
/#16SSKS
/+ SS
XB
/, bXBwhere XB
is biomass/, SS
soluble substrate and SO
dissolv ed o xygen/. XB /;in
/,SS/;in
and SO /;in
are the in/#0Duen t concen trations of biomass/, soluble substrateand dissolv ed o xygen/. The tank v olume is denoted V /, and the in/#0Duen t andthe e/#0Fuen t/#0D o ws are Qin
and Qout
/, resp ectiv ely /. The gro wth yield is Y /, /#16is the maxim um sp eci/#0Cc gro wth rate/, KS
is the half/-v elo cit y constan t andb is the deca y rate/. Note that the di/#0Beren tial equations are coupled in acomplicated nonlinear w a y /.W e see that accum ulation of the di/#0Beren t comp onen ts dep ends on sev/-eral things/: the /#0Do w rates/, in/#0Duen t concen trations/, parameter v alues/, andthe actual concen tration of the di/#0Beren t comp onen ts/. Nonlinear functionsare also in v olv ed/. If/, for example/, the soluble substrate concen tration be /-comes v ery high/, the gro wth rate of the biomass is still limited to less thanthe maxim um sp eci/#0Cc gro wth rate /#16 /. A description of the complete IA W Qmo del is giv en in Section /2/./3/./1/./4 Con trol of w astew ater treatmen t plan ts /1/1/1/./4 Con trol of w astew ater treatmen t plan tsThe allo w ed lev els of p ollutan ts in treated w astew ater ha v e b ecome in/-creasingly stringen t with time/. T aking in to accoun t curren te n vironmen talproblems/, it is not unrealistic to b eliev e that the this trend will con tin ue/. A tthe same time loads on existing plan ts plan ts are exp ected to increase dueto gro wth of urban areas/. This situation demands more e/#0Ecien t treatmen tpro cedures for w astew ater/.One w a y to impro v e e/#0Eciency could be to construct new and largerbasins/, but this is exp ensiv e and often imp ossible since the land requiredis just not a v ailable/. Another w a y w ould be the in tro duction of more ad/-v anced con trol and op erating systems/. This is exp ected to reduce the needfor larger v olumes/, impro v e the e/#0Fuen t w ater qualit y /, decrease the use ofc hemicals/, and sa v e energy and op erational costs/. Sustainable solutionsto the problems of w astew ater treatmen t will require the dev elopmen t ofadequate information systems for con trol and sup ervision of the pro cess/.T od a y man yw astew ater treatmen t plan ts use v ery simple con trol tec h/-nologies or no automatic con trol at all/. Con trol tec hniques in curren t use in/-clude simple PLC/-tec hniques/, time con trol/, man ual con trol/, rules of th um b/,or simple prop ortional con trol/. Adv anced mo dels of the pro cesses in aw astew ater plan t suc ha s the IA W Q/'s Activ ated Sludge Mo del No/. /1h a v eb een dev elop ed o v er the y ears/, but ha v e not b een used to an y exten t forpractical con trol design/. It is di/#0Ecult to design a sensible con troller basedon the IA W Q mo del/, whic h is nev ertheless a v ery useful mo del to ev aluatedi/#0Beren t con trol strategies/. Sev eral adv anced con trol strategies ha v e pre/-viously b een suggested/, see e/.g/. Bastin and Do c hain /#28/1/9/9/0/#29/, V an Imp e etal/. /#28/1/9/9/2/#29/, Do c hain and P errier /#28/1/9/9/3/#29/, Nielsen and Lynggaard /#28/1/9/9/3/#29/, andY oussef et al/. /#28/1/9/9/5/#29/.The follo wing reasons ma y explain wh y adv anced con trol ha v e not b eenextensiv ely used/. /#28See Olsson /#28/1/9/9/3 a /#29 for a more throughly treatmen t ofthe sub ject/./#29/#0F The e/#0Fuen t standards ha v e not b een tigh t enough/. Economic p enal/-ties for exceeding the regulations along with stricter e/#0Fuen t regula/-tions whic h are not based solely on long a v erage v alues could encour/-age implemen tation of b etter con trol/./#0F W astew ater treatmen t is often considered as a non/-pro ductiv e pro/-cess/. Since con trol systems are exp ensiv e it ma y be di/#0Ecult to con/-vince a manager to in tro duce a more adv anced system/, esp eciallywhen pro/#0Ct can not b e guaran teed/./1/2 W astew ater treatmen t /| An in tro duction/#0F On/-line sensors ha v e b een unreliable and require a lot of main tenance/./#0F Man y pumps/, v alv es/, and other actuators are not con trollable/; oftenthey can only b e switc hed on or o/#0B/./#0F The pro cess is v ery complex and it is not ob vious ho wt oc o n trol andoptimize the plan t/./#0F F ew con trol engineers ha v e dev oted their atten tion to w astew atertreatmen t plan ts/.In terest for applying more sophisticated con trol is/, ho w ev er/, gro wing/.The reasons for this are most economical/:/#0F Cost e/#0Bectiv e solutions are b ecoming more and more imp ortan t/. Asthe loads on existing plan ts increase/, con trol and optimization ma yb e able to handle the increasing loads with the same v olumes/./#0F Sti/#0Ber requiremen ts on treated w astew ater/./#0F F ees and taxes related to the e/#0Fuen tw ater qualit y are making it moreexp ensiv e to release p ollutions/./#0F The general public/'s a w areness of en vironmen tal issues is increasingand more and more fo cused on issues of sustainabilit y and energyconsumption/./#0F Impro v ed on/-line sensors and actuators are b eing con tin uously dev el/-op ed/./#0F More complex pro cess alternativ es/, whic h are di/#0Ecult to con trol man/-ually /.Application of mo dern con trol theory in com bination with new on/-linesensors and the appropriate parts of adv anced mo dels has great p oten tialto impro v e the e/#0Fuen tw ater qualit y /, decrease the use of c hemicals and tosa v e energy and money /, see V an Imp e et al/. /#28/1/9/9/2/#29/, Carlsson /#28/1/9/9/5/#29/, andCarlsson /#28/1/9/9/7/#29 for more discussions/. Nielsen and
/#7FOnnerth /#28/1/9/9/5/#29 suggestan exp ert system whic h use on/-line sensors to con trol and optimize the plan tp erformance/. They also giv e a short o v erview of the dev elopmen t of on/-linesensors o v er the last /2/5 y ears/. The use of on/-line sensors has increasedrapidly in the last y ears/, see Figure /1/./8/. This trend is exp ected to con tin uedue to the large p oten tial for reducing costs when used in com binationwith automatic con trol/. V anrolleghem and V erstraete /#28/1/9/9/3/#29 surv ey ed new/1/./4 Con trol of w astew ater treatmen t plan ts /1/3
Figure /1/./8/: Use of sensors in full/-scale con trol in Denmark /#28Nielsenand
/#7FOnnerth /1/9/9/5/#29/.and existing tec hnologies for monitoring w astew ater treatmen t plan ts/. Theimp ortance of in tegrating con trol and pro cess design to obtain b est o v erallp erformance has b een illustrated b y Andrews /#28/1/9/9/4/#29/. Cause/-e/#0Bects forrelationships in an activ ated sludge plan th a v e b een established b y Olssonand Jeppson /#28/1/9/9/4/#29/. These can be of help when designing con trollers fornew purp oses/, e/.g/. con trolling the v arious /#0Do ws/.The follo wing are some examples of automatic con trol applied to theactiv ated sludge pro cess/./#0F Con trol of the dissolv ed o xygen concen tration /#28DO/#29 has b een prac/-ticed for man yy ears/. This is due to/:/#7B The energy consumption can b e reduced b y con trolling DO/, sinceit requires m uc h energy to blo w air to sev eral meter deep basins/./#7B The e/#0Fuen tw ater qualit y dep ends to a great exten t on a su/#0E/-cien tly high DO/./#7B On/-line sensors for DO measuremen ts ha v e b een a v ailable forsev eral y ears/, see also Figure /1/./8/.See also Chapter /5 for DO con trol and DO set/-p oin t con trol/./#0F Pressure drop o v er the air v alv es can b e minimized/. A common strat/-egy is to con trol the air pressure so that the most op ened v alv e isalmost completely op ened/, see Rundqwist /#28/1/9/8/6/#29/./1/4 W astew ater treatmen t /| An in tro duction/#0F The nitrate concen tration can b e k ept lo wb y adding an external car/-b on source/. Using on/-line measuremen ts of the nitrate concen tration/,a prop er /#0Do w rate of the external carb on source can be giv en/, seeHellstr/#7F om and Bosander /#28/1/9/9/0/#29/, and Isaacs et al/. /#28/1/9/9/3/#29/. By usingfeedforw ard con trol from in/#0Duen t total organic carb on /#28TOC/#29 andrecirculated nitrate/, disturbances in in/#0Duen tw ater can b e b etter re/-jected/, Chapter /3 discuss this/./#0F It is imp ortan t to con trol the c hemical dosage in a w astew ater plan t/.Phosphorus/, for example/, is remo v ed b y c hemical precipitation/. Acom bination of feedbac k and feedforw ard con trol from on/-line sensors/,/#0Do w rates and an exp erience data base ma y be useful to main tainappropriate c hemical dosages/./#0F The ammonium concen tration can b e con trolled b y the DO set/-p oin tand/#2For the n um b er of aerated zones/. This is an alternativ e to using a/#0Cxed DO set/-p oin t/, see Nielsen and Lynggaard /#28/1/9/9/3/#29/, and Chapter/3/./#0F Optimizing the di/#0Beren t/#0D o w rates in the plan ti sa n i n teresting /#0Celdof researc h/, see e/.g/. Nielsen and Lynggaard /#28/1/9/9/3/#29/, and V anrolleghem/#28/1/9/9/4/#29/. Some of the /#0Do ws determine the amoun t of biomass in the sys/-tem/. Main taining a high concen tration of biomass is a tempting strat/-egy to impro v e plan t p erformance/, since a large biomass can degrademore organic material/. Unfortunately /, the sedimen tation prop ertiescan be a/#0Bected detrimen tally and foam can also be created/. Otherforms of microorganisms ma y also adapt to the high concen tration ofbiomass/, whic h in turn mak es the activ ated sludge pro cess less e/#0E/-cien t/. A t presen t it is/, ho w ev er/, di/#0Ecult to predict ho w an increasedsludge concen tration will in/#0Duence sludge sedimen tation prop erties/./#0F In/#0Duen t /#0Do w can to some exten t be con trolled b y constructing ad/-ditional tanks or using the large w astew ater tunnels as reserv oirs/.The large v ariations in the in/#0Duen tw astew ater /#0Do w can then b e sig/-ni/#0Ccan tly reduced/. V ariations in in/#0Duen t /#0Do w are mainly caused b yrain w ater leaking in to the pip es/, or b y drainage w ater/. This t yp eof v ariation forces plan ts to w ork with higher /#0Do ws during short p e/-rio ds whic h is less e/#0Ecien t compared to a constan t /#0Do w/. Sometimesone also has to do b y/-pass actions to a v oid sludge loss from the sec/-ondary clari/#0Cer/. There ha v e b een exp erimen ts in G/#7F oteb org where thew astew ater tunnels w ere used as reserv oirs /#28Gustafsson et al/. /1/9/9/3/#29/.Also/, outside Malm/#7F o /#28Nyb erg et al/. /1/9/9/6/#29 and in Denmark /#28Nielsenet al/. /1/9/9/6/#29/, similar trials ha v e b een done to a v oid problems duringhigh in/#0Duen t/#0D o w rates/./1/./4 Con trol of w astew ater treatmen t plan ts /1/5/#0F The clari/#0Cer has the dual task of clarifying and thic k ening the sludge/.Its function is crucial to the op eration of the activ ated sludge pro cess/.Hence mo deling/, diagnostics/, and con trol of the sedimen tation pro cessare also imp ortan t topics/, see e/.g/. Jeppsson /#28/1/9/9/6/#29/, and Bergh /#28/1/9/9/6/#29/./#0F The activ ated sludge pro cess is a m ultiv ariable pro cess/, i/.e/. it hassev eral inputs /#28con trol handles/#29 and sev eral outputs/. There are alsoman y cross couplings/. If/, for example/, the DO set/-p oin t is c hanged/,b oth the ammonium and nitrate concen trations are a/#0Bected/. If thein ternal recirculation is v aried/, this a/#0Bects sev eral parameters in thepro cess/. Hence a m ultiv ariable con troller whic h can use cross cou/-plings e/#0Ecien tly /, ma y be useful to optimize the plan t p erformance/.Do c hain and P errier /#28/1/9/9/3/#29/, and Chapter /6 tak e this up/./#0F A k ey goal in w astew ater treatmen t is to main tain e/#0Fuen t qualit ystandards at a minim um cost/. Ob viously /, it is not enough to ha v ean e/#0Bectiv e con trol of v arious subpro cesses/. One m ust also considerv arious t yp es of sup ervision con trol based on some cost function/. Suc hstrategies ha v e b een discussed b yV anrolleghem et al/. /#28/1/9/9/6/#29/./#0F Con trol theories ma y also b e used to design soft w are sensors for esti/-mating the respiration rate from measuremen ts of the dissolv ed o xy/-gen concen tration and air/#0Do w rate/, see Chapter /4/.The ab o v e list of con trol strategies for w astew ater treatmen ti s b y no meanscomplete/. More ideas/, examples and motiv ations can/, for instance/, b e foundin the IA W Q pro ceedings of the w orkshops in Instrumen tation/, Con troland Automation of W ater and W astew ater T reatmen t and T ransp ortationSystems/.New con trol strategies ma yi n v olv e the use of simpli/#0Ced biological/#2Fph ysicalmo dels/, feedforw ard con trol from measurable disturbances/, simple estima/-tion mo dels/, sup ervision con trol/, and real/-time estimation/.F or a con trol engineer the activ ated sludge pro cess in a w astew atertreatmen t plan ti s a c hallenging topic for sev eral reasons/./#0F The pro cess is time/-v arying/. It is a biological pro cess where temp er/-ature/, comp osition of in/#0Duen t w ater/, amoun t of biomass/, /#0Do ws/, etc/,v ary in time/./#0F The pro cess is non/-linear and time/-v arying/. Sev eral things mak e thepro cess /#28mo del/#29 nonlinear/, e/.g/. the Mono d functions /#28
/#16SSKS
/+ SS
/#29/, and/1/6 W astew ater treatmen t /| An in tro ductionm ultiplication of states /#28bilinearit y/#29/. The pump /#0Do ws/, whic h v ariesin time/, mak e the dynamic time/-v arying/./#0F The pro cess has sti/#0B dynamics/. It has time constan ts whic h rangefrom seconds to mon ths/. This ma y not ha v e to be a ma jor problemsince cascade con trol ma y b e applied/. Cascade con trol means that afast con troller con trols a fast sub/-pro cess and a slo w er con trols theset/-p oin t of the fast con troller/./#0F The pro cess is m ultiv ariable/. The pro cess has sev eral inputs andoutputs/. What should be considered as inputs and outputs are notob vious/. An input could/, for example/, be a set/-p oin t for a fast con/-troller/, and an output do es not necessarily ha v e to b e a concen trationin the e/#0Fuen t/, it could b e a concen tration in a zone/. There are alsolarge cross/-couplings/, e/.g/. if a /#0Do w is c hanged/, man y other v ariablesare a/#0Bected/./#0F Man y sensors are still not reliable/. Muc h progress has b een made insensor dev elopmen t in recen t y ears/. Common problems are that thesensors are fairly noisy /, ha v e long resp onse times/, require frequen tmain tenance/, and that they drift/./#0F Large disturbances a/#0Bect the pro cess/. Esp ecially in/#0Duen t /#0Do w andin/#0Duen t concen trations are sub ject to large v ariation/./1/./5 Outline of the thesisIn this section a brief summary of the main con tributions in the thesis ispresen ted/. Note that eac hc hapter con tains a review of previous researc h/.In c hapter /2 the pilot plan t is presen ted/. The pilot plan tw as designedto study new metho ds for e/#0Ecien tn utrien t remo v al using adv anced pro cesstec hnology /, applied microbiology and automatic con trol/. It is con trolled b yan adv anced con trol and sup ervision system /#28CSS/#29/, where the user can viaa graphical in terface op erate the plan t/, con trol data acquisition/, sa v e andplot data/, resp ond to alarms and tune con trollers/. The CSS w as dev elop edas a Masters pro ject /#28Latomaa /1/9/9/4/#29/, where I ha v e b een co/-sup ervisor/.A sim ulator based on the con trol and sup ervision system has b een thesub ject of another Masters pro ject /#28Luttmer /1/9/9/5/#29/, where I also ha v e b eenco/-sup ervisor/. The sim ulator/'s main function is to run sim ulations on anactiv ated sludge pro cess/. As suc h/, the sim ulator is an e/#0Bectiv e teac hingaid/./1/./5 Outline of the thesis /1/7A sim ulation mo del is also presen ted in Chapter /2/. This mo del is usedin most sim ulations in this thesis/. It is an appro ximation of the pilot plan t/,and the same v olumes and /#0Do ws are also used/. The parameters in the mo delare/, ho w ev er/, not calibrated to the real pro cess/. Prior exp erimen ts with thepilot plan t/, sim ulations are v ery useful to ev aluate con trol strategies/, or testdi/#0Beren t con trollers/.An external carb on source can increase the denitri/#0Ccation rate and com/-p ensate for de/#0Cciencies in the in/#0Duen t carb on/#2Fnitrogen ratio/. In Chapter /3the problem of con trolling the /#0Do w rate of an external carb on source is con/-sidered/. The con trol strategy for the carb on dosage is based on k eeping thenitrate lev el in the ano xic zone at a constan t and lo w lev el/. T o b etter rejectdisturbances/, feedforw ard from the mass /#0Do w of in/#0Duen t TOC and recircu/-lated nitrate are used/. F our di/#0Beren t t yp es of feedforw ard con trollers areev aluated/: a PID/-con troller/, a direct adaptiv e con troller/, an indirect adap/-tiv e con troller/, and a mo del/-based adaptiv e PID con troller/. The con trollersare compared in a sim ulation study /, and the direct adaptiv e con troller isfurther tested in the pilot plan t/. Additionally a n um be r of problems andtheir solutions concerning adaptiv e con trol are discussed in this c hapter/.In Chapter /4/, metho ds for estimating t w o essen tial parameters whic hc haracterize the dissolv ed o xygen concen tration /#28DO/#29 dynamics in an acti/-v ated sludge pro cess are presen ted/. The t w o v ariables are the respirationrate R /#28 t /#29/, and the o xygen transfer function KL
a /. The respiration rate is ak ey v ariable that c haracterizes the DO pro cess and the asso ciated remo v aland degradation of bio degradable matter/. The o xygen transfer functionKL
a describ es the rate with whic h o xygen is transferred to the activ atedsludge b y the aeration system/. The KL
a function is exp ected to b e a non/-linear function of the air/#0Do w rate/. The estimation algorithm is based ona Kalman /#0Clter whic h uses measuremen ts of the dissolv ed o xygen concen/-tration and air/#0Do w rate/. T o impro v e estimation/, di/#0Beren t mo dels of thetime/-v arying respiration rate and nonlinear o xygen transfer function ha v eb een dev elop ed/, and ev aluated in a sim ulation study and on real data/. Ifthe DO sensor has dynamic/, this m ust be tak en in to accoun t/, otherwisethe estimates will b e biased/. A /#0Clter whic h comp ensates for the DO sensordynamic has b een designed/. This /#0Clter is not only useful for DO measure/-men ts/, it can b e applied to an y sensor where there is need for comp ensationof the sensor dynamic/. In a Masters pro ject /#28Nak a jima /1/9/9/6/#29/, where I ha v eb een a co/-sup ervisor/, an extended Kalman /#0Clter w as utilized/, instead ofthe suggested /#0Clter to comp ensate for the sensor dynamic/. Surfactan tsma y reduce the o xygen transfer function KL
a /. The suggested estimationalgorithm has b een used to study the e/#0Bect surfactan ts has on KL
a /. BothKL
a and the respiration rate w ere found to be reduced b y the addition/1/8 W astew ater treatmen t /| An in tro ductionof a surfactan t/. An impro v emen t o v er previous metho ds/, this estimationalgorithm is capable of b oth estimating a nonlinear KL
a function and atime/-v arying respiration rate/. F urther/, the /#0Clter whic h comp ensates forthe sensor dynamics has tuning knobs for b oth smo othing lag and noisesensitivit y /.The estimated nonlinear o xygen transfer function is used to design anonlinear con troller of the dissolv ed o xygen concen tration in Chapter /5/.The DO in the aerobic part of an activ ated sludge pro cess should b e suf/-/#0Ccien tly high in order for micro organisms to degrade organic matter andcon v ert ammonium to nitrate/. On the other hand/, an excessiv ely high DO/,whic h requires a high air/#0Do w rate/, results in high energy consumption andma y ev en deteriorate sludge qualit y /. Con trol of the DO is therefore im/-p ortan t/. Since the KL
a function is nonlinear/, the gain of the pro cess willv ary with v arying air/#0Do w rate/. By designing a nonlinear con troller/, a com/-p ensation for the nonlinearit y can be made and high con trol p erformancema y be obtained under all op erating conditions/. Sim ulations and practi/-cal exp erimen ts con/#0Crm these results/. An outline for DO set/-p oin t con trolare giv en/. Its purp ose is to con trol the ammonium concen tration in theaerated zone b y the DO set/-p oin t/. An exp erimen t in the pilot plan t withthe set/-p oin t con troller sho w ed that it w as not only p ossible to sa v e energydue to a lo w er DO set/-p oin t/, the e/#0Fuen t nitrate concen tration w as alsosigni/#0Ccan tly reduced/. P ossible disadv an tages ma y be that sludge prop er/-ties deteriorate due to the lo w DO/, and nitrous o xide /#28N/2
O/#29 can b e formedwhen the DO is lo w/. These problems should/, ho w ev er/, b e compared to theac hiev ed impro v emen ts/. Spatial DO set/-p oin t con trol ma y also reduce thisproblem b y switc hing o/#0B aeration in some zones when the DO set/-p oin tb ecomes to o lo w/. The DO set/-p oin t can then b e increased in the remainingzones/. A pressure con troller is /#0Cnally presen ted in this c hapter/. The idea/,whic h is w ell kno wn/, is to con trol air pressure so that the most op en airv alv e b ecomes almost completely op en/. This w as later con/#0Crmed in thepilot plan t/.Multiv ariable linear quadratic /#28LQ/#29 con trollers are designed in Chapter/6/. The con trollers are based on a linear state/-space mo del estimated b yasubspace system iden ti/#0Ccation metho d/. The main adv an tage of these con/-trollers/, compared to SISO con trollers/, are that they tak e all in teractions inthe pro cess mo del in to accoun t/. This allo ws for a sensible trade o/#0B b et w eenthe di/#0Beren t con trol handles and outputs/. The follo wing inputs are used/:external carb on/, in ternal recirculation rate/, and DO set/-p oin t/. Ammoniumand nitrate in the last aerated zone are used as outputs/. The con trollersoutlined also use feedforw ard from the measurable disturbances/: in/#0Duen t/#0Do w rate/, in/#0Duen t ammonium and in/#0Duen t carb on/. The t w o di/#0Beren tm ul/-/1/./5 Outline of the thesis /1/9tiv ariable con trollers ha v e b een ev aluated in a sim ulation study /. One of thecon trollers is based on di/#0Beren tiating the states/, and the other has addi/-tional in tegration states/. Both con trollers ha v e sho wn go o d p erformance insim ulations/. It w as/, ho w ev er/, found that the mo deling part w as crucial forthe con trol p erformance/.Conclusions and some topics for future researc h are summarized inChapter /7/. Means of optimizing the activ ated sludge pro cess using eco/-nomic cost functions discussed are discussed/. By setting prices on thee/#0Fuen t disc harges/, and on the con trol v ariables/, i/.e/. blo wing air/, dosing ex/-ternal carb on/, running pumps/, etc/./, the most economically w a y to run theplan t can b e determined/. P arts of this strategy could also b e implemen tedin an extrem um con troller/. F urther discussions in v olv es ho w w astew atertreatmen t plan ts can b e divided in di/#0Beren t sub/-pro cesses/, where eac h sub/-pro cess then are optimized separately /./2/0 W astew ater treatmen t /| An in tro ductionChapter /2Pilot plan t and sim ulationmo delThis c hapter describ es the pilot/-scale activ ated sludge plan t at the mainm unicipal w astew ater treatmen t plan t in Uppsala/, Sw eden/, and a sim ula/-tion mo del of the pilot plan t/.The pilot plan t consists of t w o separate lines for pre/-denitri/#0Ccation/.The main purp ose of the plan t has b een to study new metho ds for e/#0Ecien tn utrien t remo v al using adv anced pro cess tec hnology /, applied microbiologyand automatic con trol/. Both lines are extensiv ely monitored b y on/-line in/-strumen ts and sampling programs/. The plan t is con trolled b y an adv ancedcon trol and sup ervision system/, where the user can via a graphical in terfaceop erate the plan t/, con trol data acquisition/, sa v e and plot data/, resp ond toalarms and tune con trollers/.T on umerically ev aluate di/#0Beren t con trollers and con trol strategies it isimp ortan t to use a mo del whic h realistically sim ulates a true plan t/. A sim/-ulation mo del of the pilot plan t has therefore b een designed/. The IA W Q/'sActiv ated Sludge Mo del No/. /1/. /#28Henze et al/. /1/9/8/7/#29 has b een used to mo deleac h zone of the bioreactor and the clari/#0Ccation/-thic k ening mo del in T ak/#13 acset al/. /#28/1/9/9/1/#29 has b een used to mo del the settler/.This c hapter is organized as follo ws/. In the next section/, a generaldescription of the pilot plan t and its instrumen tation is giv en/. The plan tis con trolled b y a con trol and sup ervision system whic h is presen ted inSection /2/./1/./2/. A sim ulator/, based on the con trol and sup ervision systemhas b een designed/, and is outlined in Section /2/./1/./3/. The di/#0Beren t conductedexp erimen t are presen ted in Section /2/./2/. A mo del of the pilot plan t is/2/2 Pilot plan t and sim ulation mo delpresen ted in Section /2/./3/./1/, and the bioreactor mo del of eac h zone in the pilotplan t is giv en in Section /2/./3/./2/. The di/#0Beren tial equations and parameterv alues for the activ ated sludge pro cess are presen ted in Section /2/./3/./3/. Thesettler mo del/, sim ulation to ol/, and conclusions are giv en in Sections /2/./3/./4/,/2/./3/./5 and /2/./3/./6/, resp ectiv ely /./2/./1 The pilot plan t/2/./1/./1 General la y out of the pilot plan tThe design and construction of the activ ated sludge pilot plan t w as initi/-ated in /1/9/9/3 and in June /1/9/9/4 the plan t w as tak en in to op eration/. Thebasic pro cess design including c hoice of instrumen tation w as dev elop ed b yresearc hers from the Uppsala ST AMP consortium and p ersonnel from Up/-psala Public W orks O/#0Ece/. The tanks and sedimen tation units w ere builtb y p ersonnel from the w astew ater plan t in Uppsala/. The tanks are made instainless steel/. The pilot plan t whic h consists of t w o separate lines is placedindo ors in an existing building at the Uppsala w astew ater treatmen t plan t/.Line P/1 is equipp ed with more on/-line instrumen ts than line P/2/, whic hmainly is used as a reference line/. Both lines are primarily designed fornitrogen remo v al using pre/-denitri/#0Ccation with the p ossibilit y to add anexternal carb on source/. A sc hematic la y out of line P/1 is sho wn in Figure/2/./1/. Eac h line consists of an aeration tank /#28/2/./3/5 m
/3/#29 with a v ariable ano xic
DO ORP DO TSS NOORP NH4 3
300-1000 l/h 100-350 l/h
100-350 l/h6-60 l/hPHDO NH4NO3Carbon sourceFigure /2/./1/: La y out of line P/1 in the pilot/-scale activ ated sludge plan t/.to aerobic ratio and a settling tank /#28/0/./5/5 m
/3/#29/. The con/#0Cguration of theaeration tank is giv en in T able /2/./1/./2/./1 The pilot plan t /2/3Cell no/. V olume of cell /#28m
/3/#29 Op eration/1 /0/./4/6 Ano xic/2 /0/./6/3 Aerated/3 /0/./4/4 Aerated/4 /0/./4/4 Aerated/5 /0/./3/8 Non/-aeratedT able /2/./1/: The aeration tank consists of /5 cells/, cell /1 and /5 ha v emixers /#28/#0Cxed/, horizon tal/#29 and cells /2/-/4 are aerated/.Pre/-precipitated and pre/-sedimen ted w astew ater from the full/-scale plan tis used as in/#0Duen t w ater to the pilot plan t/. A small equalization tank isinstalled b efore the pilot plan t/, see Figure /2/./1/. P eristaltic pumps are c hosenin order to ac hiev ew ell de/#0Cned /#0Do w rates/. The capacities of the pumps aregiv en in T able /2/./2/.Pump /#28n um b er of pumps/#29 Capacit y /#5Bl/#2Fh/#5DIn/#0Duen t /#28/2/#29 /1/0/0/-/5/0/0Excess sludge /#28/2/#29 /5/-/6/0Return sludge /#28/2/#29 /1/0/0/-/3/5/0In ternal recirculation /#28/2/#29 /3/0/0/-/1/0/0/0T able /2/./2/: Pumps in the pilot plan t/, line P/1 and P/2/. All pumpslisted in the table are p eristaltic pumps/, man ufactured b y Bredel anddeliv ered b y AKA pump/. The pumps are con trolled b y the con trolsystem via frequency con v erters/.Excess sludge is remo v ed from the aeration tank instead of from thesedimen tation unit/. This giv es a higher /#0Do w rate whic h is easier to go v ern/.The plan t is equipp ed with on/-line sensors for nitrate/, ammonium/, dissolv edo xygen concen tration/, pH/, redo x/, susp ended solids and temp erature/, seeT able /2/./3/.Three v acuum samplers are used to collect w ater samples for lab oratoryanalysis/. The samplers tak ew ater from the in/#0Duen t /#28same to b oth plan ts/#29and the e/#0Fuen t from P/1 and P/2/, resp ectiv ely /.Mem brane b ottom aerators /#28T relleb orgs gummi/#29 are used in the aeratedzones/. The air /#0Do w rate is con trolled b y electro/-pneumatic v alv es /#28PMW/2/4 Pilot plan t and sim ulation mo delSensor /#28No/. of sensors/#29 Principle Lo cationDO /#28/6/#29 Cell /2/-/4 in P/1 and P/2Ammonium /#28/1/#29 Ion selectiv e E/#0Fuen t or in/#0Duen tNitrate /#28/2/#29 Ion selectiv e Cell /1 in P/1 and e/#0Fuen tof P/1 and P/2Susp/. solids /#28/2/#29 IR/-ligh t Cell /3 in P/1 and P/2PH /#28/2/#29 Cell /1 and /4 in P/1Redo x /#28/4/#29 Cell /1 and /2 in P/1 and P/2T emp /#28/1/#29 Cell /5 in P/1T able /2/./3/: On/-line sensors used in the pilot plan t/. All sensors areman ufactured b y Con tronic/, except for the susp ended solids sensorswhic h are man ufactured b y Cerlic/.P almstiernas/#29/. The air to the tanks is pro vided b yt w o side c hannel blo w ers/#28V en tur/#29 with a maxim um capacit y o f/3 /9m
/3/#2Fh/.An imp ortan t use of the pilot plan t has b een to ev aluate di/#0Beren t exp er/-imen ts with external carb on sources/. External carb on can b e added to b othP/1 and P/2/. The /#0Do w rate of external carb on is con trolled b y mem branepumps /#28LMI Milton Ro y/#29 with a maxim um capacit y of /8 l/#2Fh/./2/./1/./2 The con trol and sup ervision systemAn o v el con trol and sup ervision system /#28CSS/#29 for the pilot scale plan tw asdesigned/. The CSS consists of a PC equipp ed with measuremen t cards/.The comm unication with the pro cess is made via a switc h cabinet/. Theswitc h cabinet/, designed b y Huddinge El/, con tains frequency con v erters/,po w er supplies/, rela ys and ampli/#0Cers/. It also con tains devices for runningthe plan t man ually /. The follo wing hardw are is used for the CSS/:/#0F A standard PC /#28/4/8/6D X/-/6/6MHz with /1/6 Mb RAM/#29/#0F Tw o /1/6 c hannels /4/-/2/0 mA D/#2FA cards/, /1/2 bits resolution /#28ComputerBoards/#29/#0F One /2/4 c hannels /4/-/2/0 mA A/#2FD card/, /1/2 bits resolution /#28ComputerBoards/#29/#0F Tw o/4 /8c hannels binary cards /#28Computer Boards/#29/2/./1 The pilot plan t /2/5Lin ux/, a public domain UNIX dialect w as c hosen as op erating system/. Mostof the programming w as made as a Master thesis w ork/, see Latomaa /#28/1/9/9/4/#29/.The CSS w as implemen ted in C/+/+ and separated in to t w o di/#0Beren t pro/-cesses whic h comm unicate through a common memory area/. One pro cesshandles the actual con trol of the plan t/, i/.e/. start and stop of pumps/, cal/-culation of con trol signals/, collection of data/, c hec king alarms/, etc/. Theother pro cess manages the graphical user in terface /#28GUI/#29/. The GUI w asprogrammed b y using Motif/. Sp ecial atten tion w as made to create a user/-friendly in terface whic h should b e easy to in terpret and e/#0Bectiv ely presen tthe status of the plan t/, see Carlsson and Lindb erg /#28/1/9/9/5/#29 and Carlssonet al/. /#28/1/9/9/4 b /#29/. The user can via the GUI op erate the plan t and p erformother tasks suc h as con trol data acquisition/, plot data/, resp ond to alarms/,tune con trollers/, etc/. Data from the on/-line sensors are stored ev ery /1/0thmin ute /#28a v eraged v alues are computed if the pro cess is sampled faster than/1/0 min/#29/.The plan ti ss c hematically dra wn in the GUI/, see Figure /2/./2/. The /#0Do wrate of a pump is c hanged b y clic king on the pump sym b ol and then en teringthe /#0Do w rate/. The pump sym b ol also indicates if the pump is switc hed o/#0B/,is in auto or man ual mo de/, or if there is a pump failure/. The DO iscon trolled b y v arying the p osition of the air v alv es/. The v alv e op ening isusually con trolled b y PID con trollers/, but more adv anced con trol sc hemesw ere ev aluated in the exp erimen ts/.One in teresting feature in the GUI is that the width of the pip es in thedra wing is prop ortional to the actual /#0Do w rate in the plan t/, see also Olsson/#28/1/9/9/3 b /#29/. T o further impro v e the presen tation of the status of the plan t/,staples/, /#5Cpie/-c harts/" and color co ding are used/.F or more information ab out the pilot plan t/, see Carlsson et al/. /#28/1/9/9/7/#29/./2/./1/./3 A sim ulator based on the con trol and sup ervision sys/-temA sim ulator for an activ ated sludge pro cess has b een designed/. What issp ecial with this sim ulator compared to other sim ulators/, is that the pre/-vious outlined con trol and sup ervision system is used/. This means thatthe same user friendly GUI is used/. It is hence v ery easy to/, for example/,c hange pump /#0Do w rates/, DO set/-p oin ts or carb on dosage/. It is also easy toplot the di/#0Beren t concen trations and v ary the comp osition of the in/#0Duen tw astew ater/. The only di/#0Berence to the GUI in the CSS is that a sim ulatedpro cess is con trolled instead of the pilot scale plan t/, and the sim ulationruns of course m uc h faster than the pro cesses in the pilot scale plan t/./2/6 Pilot plan t and sim ulation mo del
Figure /2/./2/: The main men u of the graphical user in terface in thecon trol and sup ervision system/.A sim ulator can/, for example/, b e used for/:/#0F Pro cess understanding/. Using the sim ulator b etter understanding ofthe complex activ ated sludge pro cess can b e gained/./#0F Education/. This sim ulator has already b een used in one course inw astew ater treatmen t at Uppsala Univ ersit y and b y p ersonnel at them unicipal w astew ater treatmen t plan t in Uppsala/./#0F Pro cess con trol/. E/#0Ecien t con trol strategies are often mo del based/.Also a go o d dynamic mo del can b e used to test and ev aluate di/#0Beren tcon trol strategies/./#0F F orecasting/. Mo dels can b e used to predict future plan t p erformance/.Eac h zone of the sim ulated activ ated sludge pro cess is based on theIA W Q mo del/. The Euler/, the Heun and the Runge/-Kutta metho ds areimplemen ted in order to solv e the di/#0Beren tial equations n umerically /. A/2/./2 Conducted exp erimen ts in the pilot plan t /2/7n um be r of parameters can be v aried in the sim ulator mo del during run/-time/, for example/, in/#0Duen t w astew ater comp osition/, zone v olumes/, /#0Do ws/,con troller parameters/, etc/./, but the n um b er of zones is /#0Cxed/, as w ell as thesensor con/#0Cguration and placemen t of pumps/. The programming w ork w asmade as a Master thesis w ork/, see Luttmer /#28/1/9/9/5/#29/. F or more informationab out the sim ulator see Carlsson and Hasselblad /#28/1/9/9/6/#29/, and Carlsson andLindb erg /#28/1/9/9/5/#29/./2/./2 Conducted exp erimen ts in the pilot plan tA pilot plan t has b een constructed/. It is lo cated at the main m unicipalw astew ater treatmen t plan t in Uppsala/, Sw eden/. The main purp ose of theplan t has b een to study new metho ds for e/#0Ecien t n utrien t remo v al usingadv anced pro cess tec hnology /, applied microbiology and automatic con trol/.During the p erio d June /1/9/9/4 to July /1/9/9/6 a n um b er of exp erimen ts ha v eb een conducted in the pilot plan t/. Man y of the results ha v e b een publishedin leading journals and conference pro ceedings/. F or a quic k reference/, ashort summary of all the exp erimen ts are giv en b elo w/. Detailed descrip/-tions can b e found in the cited references/. The con trol related exp erimen tsdiscussed in this thesis are/: /2/, /4/, /5/, /6/, and /8/, see also Section /1/./5/./1/. Impro v ed sedimen tation b y addition of w eigh ting agen ts w as studiedb y Andersson and Lundb erg /#28/1/9/9/5/#29/. Exp erimen ts in the pilot plan tw ere p erformed to ev aluate the role of w eigh ting agen ts on the limit/-ing solids /#0Dux/. It w as found that the addition of calcium carb onateincreased the limiting solids /#0Dux from b y a factor of /2 and calculatedon the v olatile susp ended solids b y a factor of /1/./5/./2/. Addition of an external carb on source ma y b e needed to impro v e thedenitri/#0Ccation in an activ ated sludge pro cess/. Pro cess p erformanceand microbial adaption with ethanol in pre/-denitrifying system w erestudied in Behse /#28/1/9/9/5/#29 and Hallin et al/. /#28/1/9/9/6/#29/. It w as found thatdespite a rapid /#28/3/0/-/4/0 h/#29 resp onse to ethanol on the nitrogen re/-mo v al e/#0Eciency /, it to ok around /1/2 da ys b efore the bacteria w erefully adapted/. Denitri/#0Ccation rate measured as mg N/2
O/-N/#2FgVSSh w as ab out /5 times higher in the ethanol line /#28P/1/#29 than in refer/-ence line /#28P/2/#29 after the adaptation p erio d w as completed/. It w asfound that ethanol addition causes enzyme induction rather than al/-
terations in sp ecies comp osition/. Moreo v er/, a con trol strategy for acarb on source dosage/, based on measuremen ts of nitrate/-nitrogen w asprop osed/. The ob jectiv ew as to con trol the /#0Do w rate of external car/-/2/8 Pilot plan t and sim ulation mo delbo n s o that the nitrate lev el in the last ano xic zone is k ept at a lo wv alue despite load c hanges/. Practical tests sho w ed that the con trolstrategy w ork ed w ell despite a rather noisy nitrate sensor/, see furtherLindb erg and Carlsson /#28/1/9/9/6 a /#29 and Chapter /3/./3/. A study ho wi n termitten t addition of ethanol to a pre/-denitri/#0Ccationsystem a/#0Bects the pro cess p erformance and biological denitrifying ca/-
pacit y is rep orted in Hasselblad and Hallin /#28/1/9/9/6/#29/. The studied pro/-cedure mimics a p ossible op eration strategy with addition of ethanolonly at certain p erio ds/, e/.g/. w eek ends/. The results sho w that in orderto main tain pro cess stabilit y with in termitten t dosage/, the denitrify/-ing bacteria ha v e to sustain at a high capacit y at eac h in termission/.The rapid resp onse to ethanol allo ws the use of adv anced regulationstrategies/./4/. A nonlinear dissolv ed o xygen concen tration /#28DO/#29 con troller has b eenimplemen ted in the con trol and sup ervision system/. The con trolleruses an estimate of the nonlinear o xygen transfer rate /#28see Carlssonet al/. /#28/1/9/9/4 a /#29/#29 in order to linearize the DO pro cess/. By practicalexp erimen ts in the pilot plan ti tw as sho wn that this nonlinear con/-troller outp erform a standard linear con troller/, see further Lindb ergand Carlsson /#28/1/9/9/6 d /#29 and Chapter /5/./5/. A sup ervision DO con troller has b een suggested and ev aluated inthe pilot plan t/, see Lindb erg and Carlsson /#28/1/9/9/6 d /#29/, Lindb erg andCarlsson /#28/1/9/9/6 b /#29 and Chapter /5/. The main idea is to determine theDO so that a lo w e/#0Fuen t ammonium concen tration is obtained/. Adesired ammonium lev el is compared with the actual lev el/. If thee/#0Fuen t ammonium is to o high the DO is increased and vice v ersa/.This can lead to signi/#0Ccan t energy sa vings/. In the exp erimen t the air/#0Do w rate could be lo w ered considerable but also the nitrate lev el inthe e/#0Fuen t decreased /./6/. The problem to estimate the respiration rate and o xygen transfer ratefrom measuremen ts of the DO and air /#0Do w rate /#28or v alv e p ositioning/#29has b een studied in the pilot plan t/. The estimated respiration rate w asclose to v alues obtained from batc h samples analysis/. The estimatedo xygen transfer function w as nonlinear with resp ect to the air v alv ep osition/. The estimation metho ds and result ev aluation are rep ortedin Lindb erg and Carlsson /#28/1/9/9/6 c /#29/, Carlsson et al/. /#28/1/9/9/4 a /#29 and Chapter/4/./7/. Seeding tec hnology w as studied to impro v e the nitri/#0Ccation pro cessin order to obtain a high e/#0Eciency of the nitrogen remo v al during/2/./3 The sim ulation mo del /2/9win ter time at lo w temp eratures/, and to decrease the v olume needs/,see Hultman et al/. /#28/1/9/9/7/#29/. In this op erational mo de/, excess activ atedsludge with high fraction of nitrifying bacteria /#28line P/2/#29 is seeded in tothe other activ ated sludge tank /#28line P/1/#29 to facilitate the nitri/#0Ccationpro cess there/. Line P/1 w as op erated as a non/-nitrifying system dur/-ing the seeding test and with pre/-sedimen ted w astew ater as in/#0Duen t/,while line P/2 w as op erated with sup ernatan t w ater /#28w ater from thesludge dew atering/#29 as in/#0Duen t/. The exp erimen ts indicated that theseeding e/#0Bect of nitri/#0Cers gro wn in activ ated sludge tank/, allo ws ni/-tri/#0Ccation at sludge ages that w ould otherwise preclude nitri/#0Ccation/#28tests w ere p erformed with aerobic sludge ages of /2/./6/, /1/./4 and /0/./9da ys/, resp ectiv ely/#29/. The seeding w as supplied with primary settledw astew ater/, and reject w ater whic h pass in to the activ ated sludgetank/. The maxim um v alue of the gro wth rate for nitri/#0Ccation bacte/-ria in the sup ernatan tw as ab out /0/./2/4 da ys
/, /1/. The dev elop ed mo delfor seeding e/#0Bects to an activ ated sludge pro cess could reasonably w ellpredict the obtained exp erimen t data for the w astew ater treatmen tline/./8/. The pilot plan t has b een used in to ev aluate ho w surfactan ts/, whic hare imp ortan t ingredien ts in mo dern w ashing agen ts/, a/#0Bect the o xygentransfer rate/. External surfactan ts w ere added to the in/#0Duen tw aterin the pilot plan t and KL
a /#28o xygen transfer function/#29 w as b oth mea/-sured in lab oratory batc h exp erimen ts and estimated b y the metho dsuggested in Chapter /4/. It w as found that the external surfactan tclearly reduced the KL
a /. Principal in v estigator w as /#5CInstitutet f/#7F orv atten/- o c h luftv /#17 ardsforskning/" /#28IVL/#29/./2/./3 The sim ulation mo delT oe v aluate di/#0Beren t con trollers and con trol strategies it is imp ortan t to usea mo del whic h realistically sim ulates a true plan t/. Here IA W Q/'s Activ atedSludge Mo del No/. /1 /#28from no w on only referred as the IA W Q mo del/#29 b yHenze et al/. /#28/1/9/8/7/#29 has b een used to mo del eac h zone of the bioreactor/, andthe clari/#0Ccation/-thic k ening mo del b yT ak/#13 acs et al/. /#28/1/9/9/1/#29 has b een used tomo del the settler/./2/./3/./1 Mo del of the pilot plan tThe practical exp erimen ts are p erformed in the pilot plan t/. Hence/, it ma ybe a g ood idea to design a sim ulation mo del whic h appro ximately mo dels/3/0 Pilot plan t and sim ulation mo delthe pilot plan t for a prior ev aluation of the con trollers and con trol strategies/.All v olumes and /#0Do ws are appro ximately the same in the sim ulationmo del and in the pilot plan t/. The bioreactor and settler mo del are/, ho w/-ev er/, not calibrated to the real plan t/. Instead default v alues for the mo delsare used/. The reason for not calibrating the mo dels is that the suggestedcon trollers and con trol strategies should be p ossible to apply to a largev ariet yo f plan t con/#0Cgurations/. The particular v alues of the con troller pa/-rameters are not imp ortan t/. What is in teresting is to study if a con trollermanages to con trol suc h a complex pro cess as the activ ated sludge pro cess/.F urther/, it is also di/#0Ecult/, and time consuming to calibrate the ph ysicalmo dels/.The pilot plan t has the la y out as presen ted in Figure /2/./3/, and zonefractions as giv en in T able /2/./4/. The total v olume of the bioreactor is /2/./3/5m
/3/.
AER1 AER2 AER3AN ZSQ
Q
Q Qin
int
slwFigure /2/./3/: La y out of the the pilot plan t/.Zone AN AER/1 AER/2 AER/3 Z ST yp e Ano xic Aerated Aerated Aerated Non/-aerated SettlerV olume /#5Bl/#5D /4/6/0 /6/3/0 /4/4/0 /4/4/0 /3/8/0 /5/5/0V olume /#5B/#25/#5D /1/9 /2/7 /1/9 /1/9 /1/6T able /2/./4/: V olume of di/#0Beren t parts of the pilot plan tThe default /#0Do ws in the sim ulation mo del are giv en in T able /2/./5/.Flo w Qin
Qint
Qsl
Qw/#5Bl/#2Fh/#5D /2/0/0 /6/0/0 /2/0/0 /4T able /2/./5/: Default /#0Do ws in the sim ulation mo del/2/./3 The sim ulation mo del /3/1/2/./3/./2 The bioreactor mo delThe bioreactor mo del describ es remo v al of organic matter/, nitri/#0Ccation/,and denitri/#0Ccation/. The bioreactor mo del is sim ulated with IA W Q mo delpresen ted b y Henze et al/. /#28/1/9/8/7/#29 with the follo wing exceptions/:/#0F SI
/#28inert soluble organic matter/#29 and SALK
/#28total alk alinit y/#29 are notincluded/, since they are not needed in this study /./#0F The inert /#28 XI/; IA W Q
/#29 and particulate /#28 XP/; I A W Q
/#29 matter are com binedin to one v ariable since their di/#0Beren t fractions are not in teresting inthis study /. Hence let XI
/= XI/; IA W Q
/+ XP/; I A W Q
/./#0F A term to describ e the o xygen transfer has b een added in the equationfor the dissolv ed o xygen /#28 SO
/#29/. It is KL
a /#28 u /#29/#28 SO /;sat
/, SO
/#29/, where KL
ais the o xygen transfer function/, u is the air/#0Do w rate/, and SO /;sat
is thesaturated dissolv ed o xygen concen tration/.This is the same mo del as is implemen ted in Simnon /#28Elmqvist et al/./1/9/8/6/#29 b y Wikstr/#7F om /#28/1/9/9/3/#29/, but is sligh tly mo di/#0Ced for the use in R e gsim/#28Gustafsson /1/9/8/8/#29/. Another settler mo del is also implemen ted/, see Section/2/./3/./4/./2/./3/./3 Di/#0Beren tial equations and parameter v aluesThe reaction rates for the states are in T able /2/./6 are presen ted here/.SNH
/#28 t /#29 soluble ammonium nitrogenSNO
/#28 t /#29 soluble nitrate nitrogenSND
/#28 t /#29 soluble bio degradable organic nitrogenSO
/#28 t /#29 dissolv ed o xygenSS
/#28 t /#29 soluble substrateXB/; A
/#28 t /#29 autotrophic biomassXB/; H
/#28 t /#29 heterotrophic biomassXND
/#28 t /#29 particulate bio degradable organic nitrogenXS
/#28 t /#29 slo wly bio degradable substrateXI
/#28 t /#29 particulate matter /& pro ductsT able /2/./6/: States included in the mo del/.The states starting with an X are particulate and the ones with a S aresoluble/./3/2 Pilot plan t and sim ulation mo delThe default in/#0Duen t concen trations in the sim ulation mo del are giv enin T able /2/./7/.State SS
XI
XS
XB/; H
XB/; A
SO
SNO
SNH
SND
XND/#5Bmg/#2Fl/#5D /6/0 /5/0 /1/0/0 /2/5 /0 /0 /1 /2/5 /2 /6T able /2/./7/: Default in/#0Duen t concen trations in the sim ulation mo delAccording to the IA W Q mo del/, except for the o xygen transfer KL
a /#28 SO /;sat
/,SO
/#29/, the reaction rates for the states are/:dSSdt
/= /,
/1YH
/^ /#16H
/#28
SSKS
/+ SS
/#29/#28
SOKO/; H
/+ SO
/#29 XB/; H/,
/1YH
/^ /#16H
/#28
SSKS
/+ SS
/#29/#28
KO/; HKO/; H
/+ SO
/#29/#28
SNOKNO
/+ SNO
/#29 /#11g
XB/; H/+ kh
XSXB/; HKX
/+
XSXB/; H
/#12/#28
SOKO/; H
/+ SO
/#29/+ /#11h
/#28
KO/; HKO/; H
/+ SO
/#29/#28
SNOKNO
/+ SNO
/#29
/#13XB/; HdXIdt
/= fP
/#28 bH
XB/; H
/+ bA
XB/; A
/#29dXSdt
/= /#28/1 /, fP
/#29/#28 bH
XB/; H
/+ bA
XB/; A
/#29/, kh
XSXB/; HKX
/+
XSXB/; H
/#12/#28
SOKO/; H
/+ SO
/#29/+ /#11h
/#28
KO/; HKO/; H
/+ SO
/#29/#28
SNOKNO
/+ SNO
/#29
/#13XB/; HdXB/; Hdt
/= /^ /#16H
/#28
SSKS
/+ SS
/#29/#28
SOKO/; H
/+ SO
/#29 XB/; H/+ /^ /#16H
/#28
SSKS
/+ SS
/#29/#28
KO/; HKO/; H
/+ SO
/#29/#28
SNOKNO
/+ SNO
/#29 /#11g
XB/; H
/, bH
XB/; HdXB/; Adt
/= /^ /#16A
/#28
SNHKNH
/+ SNH
/#29/#28
SOKO/; A
/+ SO
/#29 XB/; A
/, bA
XB/; AdSOdt
/= /,
/1 /, YHYH
/^ /#16H
/#28
SSKS
/+ SS
/#29/#28
SOKO/; H
/+ SO
/#29 XB/; H/,
/4 /: /5/7 /, YAYA
/^ /#16A
/#28
SNHKNH
/+ SNH
/#29/#28
SOKO/; A
/+ SO
/#29 XB/; A
/+ KL
a /#28 SO /;sat
/, SO
/#29dSNOdt
/= /,
/1 /, YH/2 /: /8/6 YH
/^ /#16H
/#28
SSKS
/+ SS
/#29/#28
KO/; HKO/; H
/+ SO
/#29/#28
SNOKNO
/+ SNO
/#29 /#11g
XB/; H/+
/1YA
/^ /#16A
/#28
SNHKNH
/+ SNH
/#29/#28
SOKO/; A
/+ SO
/#29 XB/; AdSNHdt
/= /, iXB
/^ /#16H
/#28
SSKS
/+ SS
/#29/#28
SOKO/; H
/+ SO
/#29 XB/; H/, iXB
/^ /#16H
/#28
SSKS
/+ SS
/#29/#28
KO/; HKO/; H
/+ SO
/#29/#28
SNOKNO
/+ SNO
/#29 /#11g
XB/; H/, /#28 iXB
/+
/1YA
/#29/^ /#16A
/#28
SNHKNH
/+ SNH
/#29/#28
SOKO/; A
/+ SO
/#29 XB/; A
/+ ka
SND
XB/; HdSNDdt
/= /, ka
SND
XB/; H/2/./3 The sim ulation mo del /3/3/+
XNDXS
kh
XSXB/; HKX
/+
XSXB/; H
/#12/#28
SOKO/; H
/+ SO
/#29/+ /#11h
/#28
KO/; HKO/; H
/+ SO
/#29/#28
SNOKNO
/+ SNO
/#29
/#13XB/; HdXNDdt
/= /#28 iXB
/, fP
iXP
/#29/#28 bH
XB/; H
/+ bA
XB/; A
/#29/,
XNDXS
kh
XSXB/; HKX
/+
XSXB/; H
/#12/#28
SOKO/; H
/+ SO
/#29/+ /#11h
/#28
KO/; HKO/; H
/+ SO
/#29/#28
SNOKNO
/+ SNO
/#29
/#13XB/; Hwhere the parameter v alues are giv en in T able /2/./8/, whic h are the defaultv alues rep orted in Henze et al/. /#28/1/9/8/7/#29 for a temp erature of /2/0
oC/. Some ofthese parameters sho w little v ariation from w astew ater to w astew ater andma y be considered as constan ts/, but others ha v e larger v ariations/. Thev alues giv en in T able /2/./8 are considered t ypical for neutral pH and domesticw astew ater/, but man y param ters are strongly in/#0Duenced b ye n vironmen talconditions/, see Henze et al/. /#28/1/9/8/7/#29/.T o obtain the complete di/#0Beren tial equations for the di/#0Beren t states/, thepreviously giv en reaction rates ha v e to b e complemen ted with the terms forthe mass balance/:D /#28 t /#29 Zin
/, D /#28 t /#29 Zwhere Zin
/#28 t /#29 is the in/#0Duen t concen tration/, Z /#28 t /#29 is the e/#0Fuen t concen trationwhic h is equal to the concen tration in the zone if the zone is completelymixed/, D /#28 t /#29 is the dilution rate /#28/#0Do w/#2Fv olume/#29/.T o giv e more understanding of the di/#0Beren t di/#0Beren tial equations whic hdescrib es the reaction rates for the states/, some commen ts for a couple ofthe equations are giv en /#28tak en from Jeppsson /#28/1/9/9/6/#29/#29/./#0F The c hange in heterotrophic biomass /#28 XB/; H
/#29 dep ends on three pro/-cesses/: Aerobic gro wth /#28the term whic hi sm ultiplied b y SO
/#29/, ano xicgro wth /#28the term whic hi s m ultiplied b y SNO
/#29/, and deca y /./#0F The c hange in autotrophic biomass /#28 XB/; A
/#29 is similar to the c hangein XB/; H
/, but there is no gro wth in an ano xic en vironmen t/./#0F The soluble substrate /#28 SS
/#29 concen tration is reduced b y the gro wth ofheterotrophic bacteria /#28 XB/; H
/#29 and increased b yh ydrolysis/./#0F The ammonium concen tration /#28 SNH
/#29 is a/#0Bected b y the gro wth ofb oth XB/; H
and XB/; A
/, since ammonium is used as a nitrogen sourcein the cell mass/. The nitri/#0Ccation pro cess also reduce the ammoniumconcen tration/./3/4 Pilot plan t and sim ulation mo delSym bo l V alue ExplanationYA
/0/./2/4 yield for autotrophic biomassYH
/0/./6/7 yield for heterotrophic biomassiXB
/0/./0/8/6 g N/#28g COD/#29
/, /1mass of nitrogen pe r mass of CODin biomassiXP
/0/./0/6 g N/#28g COD/#29
/, /1mass of nitrogen pe r mass of CODin pro ducts from biomass in endoge/-
nous massfP
/0/./0/8 fraction of biomass yielding partic/-ulate pro ducts/^ /#16A
/0/./8 da y
/, /1maxim um sp eci/#0Cc gro wth rate forautotrophic biomass/^ /#16H
/6d a y
/, /1maxim um sp eci/#0Cc gro wth rate forheterotrophic biomassKS
/2/0 g COD m
/, /3half saturation co e/#0Ecien t for het/-erotrophic biomassKO/; H
/0 /. /2gO/2
m
/, /3o xygen half saturation co e/#0Ecien t forheterotrophic biomassKNO
/0 /. /5gN O/3
/, Nm
/, /3nitrate half saturation co e/#0Ecien t fordenitrifying heterotrophic biomassKNH
/1 /. /0gN H/3
/,
Nm
/, /3ammonium half saturation co e/#0E/-cien t for autotrophic biomassKO/; A
/0 /. /4gO/2
m
/, /3o xygen half saturation co e/#0Ecien t forautotrophic biomassbA
/0/./2 da y
/, /1deca y rate co e/#0Ecien t for au/-totrophic biomass/.bH
/0/./6/2 da y
/, /1deca y rate co e/#0Ecien t for het/-erotrophic biomass/#11g
/0/./8 correction factor for /#16H
underano xic conditions/#11h
/0/./4 correction factor for h ydrolysis un/-der ano xic conditionska
/0/./0/8 m
/3COD /#28g da y/#29
/, /1ammoni/#0Ccation ratekh
/3/./0 g COD /#28g COD da y/#29
/, /1maxim um sp eci/#0Cc h ydrolysis rateKX
/0/./0/3 g COD /#28g COD/#29
/, /1half saturation co e/#0Ecien t for h y/-drolysis of slo wly bio degradablesubstrateKL
a o xygen transfer function/, see Chap/-ter /4SO /;sat
/1/0 mg/#2Fl saturated o xygen concen trationT able /2/./8/: The parameter v alues for the IA W Q mo del at a /2/0
oC/./2/./3 The sim ulation mo del /3/5/#0F The nitrate concen tration /#28 SNO
/#29 is increased b y nitri/#0Ccation/, anddecreased b y denitri/#0Ccation/./2/./3/./4 The settler mo delThe settler is an imp ortan t part of the activ ated sludge pro cess/. It is usedfor t w o purp oses/: clari/#0Ccation and thic k ening/. In a settler/, particulatematter in the w ater from the bioreactor sink to the b ottom of the settler/#28thic k ening/#29/, and clear w ater is pro duced /#28clari/#0Ccation/#29 and remo v ed inthe top of the settler/. The particulate matter at the b ottom of the settler/#28the activ ated sludge/#29 con tains necessary microorganisms for the biologicalreactions/. The sludge is recirculated to the bioreactor to main tain a desiredsolids lev el/.There exist man y di/#0Beren t settler mo dels in the literature/. Grijsp eerdtet al/. /#28/1/9/9/5/#29 ha v e/, ho w ev er/, made a comparativ e study where they foundthat the mo del b yT ak/#13 acs et al/. /#28/1/9/9/1/#29 ga v e the most reliable results/.Jeppsson /#28/1/9/9/6/#29 p oin ts out that in the traditional la y er mo dels/, the/#0Duxes are de/#0Cned b y empirical reasoning and sometimes con tain ad ho cassumptions/. The solution will then dep end on the n um be r of la y ers andthere is no guaran tee that the mo del pro duces ph ysically relev an t solutionssatisfying the con tin uit y equation/. Despite the imp ortan t fact as Jeppsson/#28/1/9/9/6/#29 p oin ts out/, the mo del b y T ak/#13 acs et al/. /#28/1/9/9/1/#29 will b e used since itstill pro vides a go o d description of the real b eha vior/.The settler mo del b yT ak/#13 acs et al/. /#28/1/9/9/1/#29 is used with t w o extensions/:/#0F Soluble matters are included/, and describ ed b y the follo wing mo del/:dSdt
/=
QV
/#28 Sin
/, S /#29where S represen ta n y soluble state in T able /2/./6/./#0F The comp osition of the susp ended material is considered/, and ishence not treated as a whole ML VSS /#28mixed liquor v olatile susp endedsolids/#29/. That is/, XI
/, XS
/, XBA
/, XBH
/, and XND
are calculated in eac hla y er/. Example/: XI
is calculated in the b ottom la y er according todXI/; ndt
/=
/1h
/#12/#28 Qs
/+ Qw
/#29A
/#28 XI/; n /, /1
/, XI/; n
/#29 /+ min /#28 vs/;n /, /1
XI/; n /, /1
/;vs/;n
XI/; n
/#29
/#13The settler is mo deled as a tank with sev eral horizon tal la y ers whereeac hl a y er is assumed to b e completely mixed/, see Figure /2/./4/./3/6 Pilot plan t and sim ulation mo del/?
/-/#1B /-
/6/?
/?
/#02/#02/#0D
BBN
Qin
/, QwQw
Qs
Qin
/+ QsT op la y erF eed la y erBottomla y er
hFigure /2/./4/: La y ered settler mo del/, where the di/#0Beren t/#0D o ws are de/-/#0Cned in Figure /2/./3/.The settler mo del is based on the solids mass balance around eac hl a y er/.In Figure /2/./5 this is sho wn across the settler la y ers/. The solids /#0Dux is calledJ and dep ends on settling v elo cit y vs
and sludge concen tration X accordingtoJ /= vs
/#28 X /#29 X /#28/2/./1/#29The concen tration in a la y er is then found fromdXdt
/=
/1h
/#01 J /#28/2/./2/#29where /#01 J is the di/#0Berence in /#0Dux in the la y er/. Studying Figure /2/./5 thedi/#0Berence in /#0Dux in eac h la y er is obtained/. Then using /#28/2/./2/#29 the follo wingequations for the sludge concen tration where h is the heigh t of eac h la y er/2/./3 The sim ulation mo del /3/7Gra vit y settling Bulk mo v emen t/1/#28 T op la y er/#29/2m /#28F eed la y er/#29m /+/1n /#28Bottom la y er/#29
/6/?/? /?/? /?/? /?
/6
/6
/-/?
/?/?/-
if X/2
/#14 Xt
then Js/; /1
/= vs/; /1
X/1else Js/; /1
/=min/#28 vs/; /1
X/1
/;vs/; /2
X/2
/#29if X/3
/#14 Xt
then Js/; /2
/= vs/; /2
X/2else Js/; /2
/=min/#28 vs/; /2
X/2
/;vs/; /3
X/3
/#29if Xm
/#14 Xt
then Js/;m /, /1
/= vs/;m /, /1
Xm /, /1else Js/;m /, /1
/=min/#28 vs/;m /, /1
Xm /, /1
/;vs/;m
Xm
/#29Js/;m
/=min/#28 vs/;m
Xm
/;vs/;m /+/1
Xm /+/1
/#29Js/;m /+/1
/=min/#28 vs/;m /+/1
Xm /+/1
/;vs/;m /+/2
Xm /+/2
/#29Js/;n /, /1
/=min/#28 vs/;n /, /1
Xn /, /1
/;vs/;n
Xn
/#29
Jup/; /2
/=
/#28 Qin
/, Qw
/#29 X/2AJup/; /3
/=
/#28 Qin
/, Qw
/#29 X/3AJup/;m
/=
/#28 Qin
/, Qw
/#29 XmAJdn/;m
/=
/#28 Qs
/+ Qw
/#29 XmAJdn/;m /+/1
/=
/#28 Qs
/+ Qw
/#29 Xm /+/1AJdn/;n /, /1
/=
/#28 Qs
/+ Qw
/#29 Xn /, /1A
/+/+/+/+/+ /+
/+ /+
/,
/,/,/,/, /,/, /,/,
/,
Jup/; /1
/=
/#28 Qin
/, Qw
/#29 X/1A/#28 Qin
/+ Qs
/#29 XinAJdn/;n
/=
/#28 Qs
/+ Qw
/#29 XnAFigure /2/./5/: Solids balance across settler la y ers /#28T ak/#13 acs et al/. /1/9/9/1/#29/.is found/.dX/1dt
/=
/1h
/#28 Jup/; /2
/, Jup/; /1
/, Js/; /1
/#29dXidt
/=
/1h
/#28 Jup/;i /+/1
/, Jup/;i
/+ Js/;i /, /1
/, Js/;i
/#29 /2 /#14 i/#3C mdXmdt
/=
/1h
/#28
/#28 Qin
/+ Qs
/#29 XinA
/, Jup/;m
/, Jdn/;m
/+ Js/;m /, /1
/, Js/;m
/#29dXjdt
/=
/1h
/#28 Jdn/;j /, /1
/, Jdn/;j
/+ Js/;j /, /1
/, Js/;j
/#29 m /+/1 /#14 j/#3C ndXndt
/=
/1h
/#28 Jdn/;n /, /1
/, Jdn/;n
/+ Js/;n /, /1
/#29The settling v elo cit y from T ak/#13 acs et al/. /#28/1/9/9/1/#29 is giv en b yvs/;i
/= v/0
e
/, rh
/#28 Xi
/, Xmin
/#29/, v/0
e
/, rp
/#28 Xi
/, Xmin
/#29/1 /#14 i /#14 n/0 /#14 vs/;i
/#14 v
/0/0/3/8 Pilot plan t and sim ulation mo delThis giv es a v elo cit y pro/#0Cle as in Figure /2/./6/.
0 2000 4000 60000100200300400
Concentration (X)Settling velocity (vs)Settling velocity modelFigure /2/./6/: Settling v elo cit y mo del/.The parameters in the settler mo del are c hosen as in T able /2/./9/. Theparameters in T able /2/./9 whic h are connected with the settling v elo cit y arec hosen equal to the parameters for the pilot plan ti n T ak/#13 acs et al/. /#28/1/9/9/1/#29/.R emark/: When referring to X this means X /= XI
/+ XS
/+ XBA
/+ XBH
/+XND
/#28/=ML VSS/#29/./2/./3/./5 Sim ulation to olT o sim ulate the previous describ ed pro cess a sim ulation program calledR e gsim /, see Gustafsson /#28/1/9/8/8/#29/, has b een used/. The basic implemen tationof the computer co de for the IA W Q mo del has b een written b y Wikstr/#7F om/#28/1/9/9/3/#29 and Wikstr/#7F om /#28/1/9/9/4/#29 for b oth Simnon /, see Elmqvist et al/. /#28/1/9/8/6/#29and Simulink /, see MathW orks /#28/1/9/9/2/#29/. Minor c hanges of the computer co defor the IA W Q mo del has b een done to be able to run it in Regsim/. Theoriginal sim ulation co de has also b een extended b y some additional zonesand v arious con trollers/. The main programming w ork of the settler mo del/#28for Sim ulink/#29 has b een done b y Dr/. Zhiguo Y uan at Departmen t of Ap/-plied Mathematics/, Biometrics and Pro cess Con trol/, Univ ersit y of Gen t/,Belgium/. The basic reasons for using Regsim/, instead of Sim ulink/, in thesim ulations are that it is faster and it is easier to implemen t mo dels andcon trollers than in Sim ulink/./2/./3/./6 ConclusionsThe pilot plan t has b een a v ery fruitful to ol in studying v arious asp ectsof the activ ated sludge pro cess/, ranging from inno v ativ e op erating mo des/,/2/./3 The sim ulation mo del /3/9Sym bo l V alue Explanationv/0
/7/1/2 m/#2Fd maxim um theoretical settling v elo cit y /.v
/0/0
/3/4/0 m/#2Fd maxim um practical settling v elo cit y /.rh
/4/./2/6 /1/0
/, /4m
/3/#2Fg settling parameter asso ciated with the hin/-dered settling comp onen t of settling v elo cit yequation/.rp
/5/./0 /1/0
/, /3m
/3/#2Fg settling parameter asso ciated with the lo wconcen tration and slo wly settling comp onen tof the susp ension/.fns
/5/./0 /1/0
/, /4non/-settleable fraction of the in/#0Duen t sus/-p ended solids/.A /0/./5/5 m
/2surface area of clari/#0Cer/.Xmin
fns
Xin
g/#2Fm
/3minim um attainable susp ended solids conc/.in the e/#0Fuen t/.Xt
/3/0/0/0 g/#2Fm
/3threshold susp ended solids concen tration/.n /1/0 n um be r o f l a y ers/.m /7 the feedla y er/.h /0/./1 m heigh t of eac hl a y er/.T able /2/./9/: The parameters in the settler mo del/.microbiological studies to adv anced con trol and estimation sc hemes/. Newmetho ds ha v e b een easy and inexp ensiv e to test/. It is/, ho w ev er/, imp ortan tto observ e that the op eration of a pilot plan t with an extensiv e instrumen/-tation is quite demanding in terms of main tenance/.The results from the pilot plan t studies ha v e giv en imp ortan t guidelinesfor full scale plan t design and op eration/. One example is the seeding strat/-egy whic h will b e considered when the main w astew ater treatmen t plan ti nUppsala will b e expanded/. Also the dev elop ed con trol strategies sho w thatan increased automation can lead to energy sa vings and reduced consump/-tion of c hemicals/. Microbiological studies ha v e giv en imp ortan t insigh ts forthe c hoice of external carb on source/.The dev elop ed CSS has b een an imp ortan t part in the the op eration ofthe pilot plan t/. F urther/, adv anced con trol and estimation algorithms ha v eb een easy to implemen t/.The sim ulation mo del has b een a v ery useful to ol for ev aluation of allthe di/#0Beren t con trollers and con trol strategies/. Muc h time and w ork ha v eb een sa v ed b y /#0Crst doing sim ulations prior to practical tests in the pilotplan t/./4/0 Pilot plan t and sim ulation mo delChapter /3Con trol of external carb on/#0Do w rate in apre/-denitrifying activ atedsludge pro cessBiological nitrogen remo v al in activ ated sludge pro cesses is dep enden t onsu/#0Ecien t supplies of easily metab olized carb on comp ounds for the denitrify/-ing bacterial p opulation/. An external carb on source can increase denitri/#0C/-cation rates and comp ensate for de/#0Cciencies in the in/#0Duen t carb on/#2Fnitrogenratio/. This w orks/, ho w ev er/, only if the denitri/#0Ccation pro cess is carb onconstrained/. P ossible carb on sources include methanol/, ethanol/, acetate/,primary sludge and v arious industrial w aste pro ducts/. In this c hapter somedi/#0Beren t con trollers and con trol strategies for the external carb on sourcedosage in a pre/-denitrifying activ ated sludge pro cess are suggested/.It is imp ortan t to con trol the /#0Do w rate of the external carb on source/.A to o lo w dosage will lea v e the denitri/#0Ccation pro cess carb on constrainedand the full capacit y for nitrogen remo v al is not used/. A to o high carb ondosage is exp ensiv e/, ma y cause carb on spill and increases the sludge pro/-duction whic h a/#0Bects the nitri/#0Ccation capacit y /, see Asp egren et al/. /#28/1/9/9/2/#29and Hellstr/#7F om and Bosander /#28/1/9/9/0/#29/. Another problem with o v erdosing/,discussed in Hallin and P ell /#28/1/9/9/6/#29/, is that the microorganisms ma y losetheir capacit y to use natural existing carb on sources/.When adding an external carb on source one should be a w are that av ery selected microbial system ma y b e induced/, and it ma y tak ew eeks for/4/2 Con trol of external carb on /#0Do w ratethe micro organisms to adapt to the external carb on/. It has b een arguedb y Nyb erg et al/. /#28/1/9/9/3/#29 and Andersson et al/. /#28/1/9/9/5/#29 that the /#0Do w rateof external carb on source should not be con trolled automatically /, due tothe obtained sensitiv e microbial system/, reliabilit y problems with on/-linesensors/, and b ecause the e/#0Fuen t standard of nitrate is based on a v eragev alues/. T o sustain the adapted microbial system/, whic h can metab olizeexternal carb on/, the external carb on /#0Do w rate should nev er be switc hedo/#0B/. It is easy to design a con troller whic h nev er giv e a carb on /#0Do w rateb elo w a pre/-sp eci/#0Ced minim um /#0Do w rate/. Note also that it is p ossible toswitc h o/#0B some carb on sources for sev eral da ys /#28e/.g/. ethanol/#29 without losingdenitri/#0Ccation capacit y /, see Hasselblad and Hallin /#28/1/9/9/6/#29/. F urther/, thereliabilit y problems with the on/-line sensors can b e reduced b y main tainingthese frequen tly /. It is also lik ely that on/-line nitrate sensors will b e morereliable in the future/. According to e/.g/. Lynggaard/-Jensen et al/. /#28/1/9/9/6/#29reliable sensors already exist/.A constan t /#0Do w rate of carb on is only adv an tageous when the in/#0Duen tv ariations of the carb on/#2Fnitrogen ratio are small/. When the v ariations arelarge/, a constan t carb on dosage will b e to o lo w during some hours and to ohigh during other p erio ds/. The a v erage nitrate concen tration will then notbe reduced as m uc h with a constan t dosage as it w ould with a con trolleddosage/. In a t ypical plan t the load often v aries b y a factor of /6 or more/,see V an Imp e et al/. /#28/1/9/9/2/#29/. If external carb on is added in the last step of aw astew ater treatmen t plan t/, it is v ery imp ortan tt o giv e a correct dosage/,since there are no later steps in the plan t where an excessiv e dosage canb e degraded/. An example is con trol of the nitrate concen tration in a sand/#0Clter/, see Hultman et al/. /#28/1/9/9/4/#29/.A reasonable con trol strategy for the carb on dosage is to k eep the nitratelev el in the ano xic zone /#28just b efore the aerobic zone in a pre/-denitrifyingplan t/#29 at a constan t lo w lev el/. That strategy has b een discussed in Hell/-str/#7F om and Bosander /#28/1/9/9/0/#29/. An approac h where the con troller design isbased on the IA W Q mo del has b een done b yY uan et al/. /#28/1/9/9/6/#29/. Anotherstrategy where the carb on dosage is based on presence or no presence ofnitrate in the e/#0Fuen t has b een suggested b y V anrolleghem et al/. /#28/1/9/9/3/#29/.The carb on dosage has b een con trolled b y considering the o xygen demandin Linde /#28/1/9/9/3/#29/. Brenner /#28/1/9/9/1/#29 presen ted a sim ulation study with anexternal carb on source and found that the aerobic v olume fraction andrecirculation rate should b e increased when carb on is added/, but the aero/-
bic v olume fraction could b e decreased if the biomass instead is increased/.Londong /#28/1/9/9/2/#29 has also con trolled the nitrate lev el/, but the in terest w asmainly fo cused on the recirculation rate instead of the carb on dosage/. Therecirculation rate has also b een considered in Andersson et al/. /#28/1/9/9/5/#29/. The/3/./1 Mo deling the nitrate pro cess /4/3carb on dosage con trol in an alternating nitri/#0Ccation/-denitri/#0Ccation pro cessis di/#0Beren t compared to the con tin uous activ ated sludge plan t/. In thatpro cess/, the nitrate lev el is not used for con trol/. Instead a mo del of thedenitri/#0Ccation rate is estimated/, whic h is then used to determine the carb ondosage/, so that the denitri/#0Ccation is completed within the curren t op erationcycle/, see e/.g/. Isaacs et al/. /#28/1/9/9/3/#29/.The carb on dosage con trollers presen ted here can all use feedforw ardfrom in/#0Duen t mass /#0Do wo f T otal Organic Carb on /#28TOC/#29 and mass /#0Do wo fnitrate in recirculated w ater/. Instead of using feedforw ard from recirculatednitrate/, in/#0Duen t ammonium ma y b e used/, but the recirculated nitrate moredirectly in/#0Duences the nitrate lev el in the ano xic zone/. Flo w c hanges inthe in ternal recirculation will also mak e that feedforw ard more unreliable/,hence feedforw ard from the nitrate concen tration is preferred/.The outline of the c hapter is as follo ws/. In Section /3/./1 the mo del of thenitrate pro cess is discussed/. The di/#0Beren tial equation for the nitrate con/-cen tration is studied further and an ARX appro ximation is presen ted/. Thecon trol strategy is outlined in Section /3/./2/. Signals suitable for feedforw ard/,and di/#0Beren tt yp es of con trollers are also discussed/. The follo wing four dif/-feren t con trollers are ev aluated/: a PID/-con troller with /#0Cxed parameters inSection /3/./3/, a mo del/-based adaptiv e PID con troller in Section /3/./4/, a directadaptiv e con troller in Section /3/./5/, and an indirect adaptiv e con troller inSection /3/./6/. Some practical asp ect for adaptiv e con trol are considered inSection /3/./7/. Sim ulations using the four di/#0Beren t con trollers are presen tedin Section /3/./8/. The direct adaptiv e con troller is also ev aluated at the pilotplan t/; the exp erimen t is presen ted in Section /3/./9/. Finally /, conclusions aregiv en in Section /3/./1/0/./3/./1 Mo deling the nitrate pro cessT o design a con troller with high p erformance/, some kind of pro cess mo delis usually needed/. The IA W Q mo del is rather complex/, since it in v olv es /1/3nonlinear coupled di/#0Beren tial equations/, and sev eral more or less unkno wnparameters/, whic h are di/#0Ecult to estimate on/-line/, see e/.g/./, Jeppsson /#28/1/9/9/3/#29/.The complete IA W Q mo del is not suitable for con troller design/, parts of itma y /, ho w ev er/, b e useful/. This has b een used in the design b y Y uan et al/./#28/1/9/9/6/#29 together with the assumption that there are only small v ariationsin the parameters of the IA W Q/. T o illustrate some of the problems in thedynamics of the nitrate concen tration/, its di/#0Beren tial equation based on theIA W Q mo del is studied/. Assuming zero dissolv ed o xygen concen tration/,whic h is reasonable for an ano xic zone/, the follo wing di/#0Beren tial equation/4/4 Con trol of external carb on /#0Do w ratefor the soluble nitrate SNO
/#28 t /#29 is obtained/.dSNOdt
/= Din
SNO i n
/, Dout
SNO
/,
/1 /, YH/2 /: /8/6 YH
/^ /#16H
/#28
SSKS
/+ SS
/#29/#28
SNOKNO
/+ SNO
/#29 /#11g
XB/; H/#28/3/./1/#29whereSNO
/#28 t /#29 is the soluble nitrateSNO i n
/#28 t /#29 is the in/#0Duen t soluble nitrateSS
/#28 t /#29 is the soluble substrate/. The external carb on is included in SSXB/; H
/#28 t /#29 is the heterotrophic biomassDin
/#28 t /#29 is the in/#0Duen t dilution rate /#28/#0Do w/#2Fv olume/#29Dout
/#28 t /#29 is the e/#0Fuen t dilution rateYH
is the yield for heterotrophic biomass /= /0/./6/7/^ /#16H
is the maxim um sp eci/#0Cc gro wth rate for heterotrophic biomass/= /0/./2/5 /#28/=/6/#2F/2/4/#29 h
/, /1at /2/0
oCKS
is the half saturation co e/#0Ecien t for heterotrophic biomass/= /2/0 g COD m
/, /3KNO
is the nitrate half saturation co e/#0Ecien t for denitrifyingheterotrophic biomass /= /0/./5 g NO/3
/,
Nm
/, /3/#11g
is the correction factor for /#16H
under ano xic conditions /= /0/./8The parameters in /#28/3/./1/#29 are not constan t/. They v ary with/, e/.g/./, w aste/-w ater comp osition/, temp erature/, and heterotrophic biomass whic h usuallyis not measurable/. The v alues giv en ab o v e are the default v alues at /2/0
oCin Henze et al/. /#28/1/9/8/7/#29/.As can b e seen in equation /#28/3/./1/#29 the gain of the pro cess v aries with theSS
/, SNO
/, and XB/; H
/. It also dep ends on time v arying parameters as KSand KNO
/, and /#0Do w rates/. Since there are so man y uncertain ties in thepro cess/, w e prefer to estimate an ARX mo del/, whic hi s easier to estimatethan all the mo del parameters in /#28/3/./1/#29/. An ARX mo del is also easier touse in a con troller design/. An approac h to estimate a mo del where some ofthe ph ysical kno wlegde in /#28/3/./1/#29 is used will/, ho w ev er/, also b e utilized/. Byusing real/-time estimation /#28estimation for time/-v arying systems/#29 the linearmo del can b e adapted to time/-v arying op erating p oin ts/. If the parameterv ariations in the estimated linear mo del are large it ma y b e suitable to usean adaptiv e con troller/, but if the estimated mo del is almost time/-in v arian tit is b etter to use a non/-adaptiv e con troller/.The follo wing ARX mo del will b e used to mo del the nitrate pro cessA /#28 q
/, /1/#29 y /#28 t /#29/= B /#28 q
/, /1/#29 q
/, ku /#28 t /#29/+ D/1
/#28 q
/, /1/#29 q
/, d/1w/1
/#28 t /#29/+ D/2
/#28 q
/, /1/#29 q
/, d/2w/2
/#28 t /#29/+ n /#28 t /#29/#28/3/./2/#29/3/./1 Mo deling the nitrate pro cess /4/5This mo del is used for design of the indirect adaptiv e con troller as w ell asthe PID con troller/. In the direct adaptiv e con troller/, the con troller param/-eters are estimated directly /, but the underlying mo del is assumed to b e ofthe same t yp e as /#28/3/./2/#29/. In /#28/3/./2/#29/, k /, d/1
/, and d/2
are time dela ys/, and A /#28 q
/, /1/#29/,B /#28 q
/, /1/#29/, D/1
/#28 q
/, /1/#29/, and D/2
/#28 q
/, /1/#29 are p olynomials in the bac kw ard shift op er/-ator q
/, /1/. The nitrate concen tration in the ano xic zone is denoted b y y /#28 t /#29/,and the external carb on /#0Do w rate b y u /#28 t /#29/. The signal w/1
/#28 t /#29 is in/#0Duen t mass/#0Do w of the TOC /#28or soluble substrate/#29 and w/2
/#28 t /#29 is recirculated mass /#0Do wof nitrate /#28 Qint
SN O /;int
/+ Qsl
SN O /;sl
/#29/, where the indexint
stands for in ter/-nal recirculation /#0Do w/, andsl
for sludge return /#0Do w/. A drifting disturbancen /#28 t /#29 has also b een included to mo del unmeasurable load disturbances/. Itis giv en b yn /#28 t /#29/=
/1/#01/#28 q
/, /1/#29
e /#28 t /#29 /#28/3/./3/#29where e /#28 t /#29 is zero mean white noise and /#01/#28 q
/, /1/#29/= /1 /, q
/, /1/.The carb on/#2Fnitrogen /#28 w/1
/=w/2
/#29 ratio can b e used instead of the t w o sep/-arate signals if the /#0Do w rates /#28 Qint
/, Qsl
and Qin
/#29 are constan t/, see Lindb erg/#28/1/9/9/5/#29/. This is adv an tageous since less parameters then ha v e to be esti/-mated/. Sim ulations ha v e also sho wn that separating the carb on and nitratesignals do es not impro v e the mo del /#28and con trol/#29/. F or the direct adaptiv econ troller the p erformance has ev en impro v ed when the w/1
/=w/2
ratio w asused in the sim ulations/. Note though/, that this is only v alid when the /#0Do wrates are constan t/. If the /#0Do w rates are time/-v arying it could p erhaps beexp ected that the ratio be t w een the mass /#0Do w rates w ould w ork equallyw ell/, but is do es not/. This ma y dep end on that the c hanges in /#0Do w ratesha v e large impact of the time constan ts in the pro cess/.An alternativ e to the unstructured estimation of the parameters in theARX mo del is to use some of the mo del structure in /#28/3/./1/#29/. The follo wingappro ximationSNO
/#28 t /+/1 /#29 /, SNO
/#28 t /#29h
/=
Qint
/#28 t /#29 SN O int
/#28 t /#29/+ Qsl
/#28 t /#29 SNO s l
/#28 t /#29V/,
Qin
/#28 t /#29/+ Qint
/#28 t /#29/+ Qsl
/#28 t /#29V
SNO
/#28 t /#29/, Kext
/#28 t /#29
SS/;extV
u /#28 t /#29 /, KSS
/#28 t /#29
Qin
/#28 t /#29V
TO Cin
/#28 t /#29 /#28/3/./4/#29could b e reasonable when the in/#0Duen t nitrate concen tration /#28to the biore/-actor/#29 is lo w/, the nitrate concen tration /#28 SNO
/#28 t /#29/#29 is con trolled at a constan tv alue/, and the substrate concen tration /#28 SS
/#28 t /#29/#29 do es not v ary to o m uc h/. IfSNO
and SS
are constan t the nonlinearities related to these concen trationsin /#28/3/./1/#29 do not ha v e to b e considered/. In /#28/3/./4/#29 only the parameters Kext
/#28 t /#29/4/6 Con trol of external carb on /#0Do w rateand KSS
/#28 t /#29h a v e to b e estimated/. The other parameters are either kno wnor measured/. The parameter SS/;ext
is the substrate concen tration of the ex/-ternal carb on source whic h is added with the /#0Do w rate u /#28 t /#29/, and TO Cin
/#28 t /#29is in/#0Duen t total organic carb on/./3/./2 Con trol strategyThe main con trol ob jectiv ei s t oc o n trol the external carb on dosage so thatthe nitrate concen tration in the ano xic zone is k ept at constan t and lo wlev el/. F eedforw ard is used from the in/#0Duen t TOC and the in ternally recir/-culated nitrate concen tration/, see Figure /3/./1/. F eedforw ard is useful whenthere is a p ossibilit yt o measure disturbances b efore or at the same timeas they a/#0Bect the pro cess/. A measurable disturbance can then b e rejectedsim ultaneously as it en ters the pro cess/. In some cases it can b e completelyrejected/, i/.e/. its e/#0Bect is not detected at the output/. A non/-measurabledisturbance can not be rejected un til the disturbance is detected on theoutput/, at this time the con troller can start to comp ensate b y feedbac k/.
Estimator
Controllercontroller par.Calculation of
NO3Carbon
Q  NO3,slslQ TOC
Q  NO3,intintinFigure /3/./1/: Description of the con trol strategy with an indirect adap/-tiv e con troller/. The nitrate concen tration in the ano xic zone of the ac/-tiv ated sludge pro cess is con trolled b y the external carb on /#0Do w rate/.T o b etter reject disturbances/, feedforw ard from the mass /#0Do w of in/#0Du/-en t TOC and mass /#0Do w of recirculated nitrate is included/./3/./2 Con trol strategy /4/7In the con troller design/, it is assumed that the measured TOC lev elin the in/#0Duen tw ater is correlated with the in/#0Duen t soluble substrate /#28 SS
/#29/.The external carb on source is also treated as soluble substrate/. Note thatthis assumption mak es the mo del v alid only for a pro cess where the sludgehas adapted to the external carb on source/. When using a carb on sourcewhere the microorganisms need long time to adapt/, e/.g/. methanol/, it isprobably necessary to extend the IA W Q mo del with an extra substratestate to b e able to mo del the slo w adaptation phase of the external carb onto the pro cess/. This is a topic for future researc h/.When no sensors for feedforw ard measuremen ts are a v ailable/, one couldconsider the p ossibilit y to mo del the daily v ariations in in/#0Duen t concen tra/-tions and use the predicted disturbances in a feedforw ard con troller/. Thist yp e of feedforw ard from a kno wledge database is also a topic for futureresearc h/.F our di/#0Beren t carb on dosage con trollers will be presen ted/. A PID/-con troller/, a direct adaptiv e/, an indirect adaptiv e con troller/, and a mo del/-based adaptiv e PID con troller are studied/. In the direct adaptiv e con trollerthe con troller parameters are estimated directly /, the blo c k c alculation ofc ontr ol ler p ar ameters in Figure /3/./1 is hence not needed for this con troller/.The indirect adaptiv e con troller is based on a recursiv ely estimated pro/-cess mo del/, whic h is used for con troller design/, see Figure /3/./1/. The fourcon trollers are ev aluated on the sim ulation mo del of the activ ated sludgepro cess whic hw as presen ted in Section /2/./3/. The direct adaptiv e con trollerhas also b een tested at the pilot plan t at Kungs/#7F angsv erk et/, Uppsala/.The con/#0Cguration of the activ ated sludge pro cess and sensor placemen tused in all sim ulations is sho wn in Figure /3/./1/. The activ ated sludge pro cesshence consists of /#0Cv e zones and a settler/. The external carb on is added inthe /#0Crst zone/, whic h is ano xic/. The nitrate concen tration is also measuredin that zone/. The follo wing three zones are aerobic/, where the dissolv edo xygen is con trolled at a certain presp eci/#0Ced lev el/. The last zone is non/-aerated/, in order to reduce the dissolv ed o xygen /#28DO/#29 concen tration in therecirculated w ater to impro v e denitri/#0Ccation/. In all the recirculated w ater/#28in ternal rec/. and sludge rec/./#29 the nitrate concen tration is measured/. Thenitrate concen tration in the in/#0Duen t w ater is so small that it is no p oin tto use feedforw ard from that /#0Do w/. The TOC concen tration in the in/#0Duen tw astew ater is/, ho w ev er/, measured/. If the mass /#0Do wv ariations of nitrate inthe recirculated sludge are small/, feedforw ard from this v ariation do es notgiv ea n y p erformance impro v emen t/, and this sensor is hence not necessary /./4/8 Con trol of external carb on /#0Do w rate/3/./3 A PID/-con trollerThe PID con troller is probably the most widely used con troller/. W ell tunedit can giv e reasonable p erformance for man y pro cesses/. It is/, ho w ev er/, di/#0E/-cult to tune a PID con troller man ually /, esp ecially if the pro cess dynamics isslo w/. There exist di/#0Beren tw a ys to tune a PID con troller/. F or example/, theclassical Ziegler/-Nic hols rules can b e used/, but they giv e fairly lo w damping/.Often/, a b etter c hoice is auto/-tuning whic h is based on the rela y metho d/,see
/#17Astr/#7F om and H/#7F agglund /#28/1/9/8/4/#29/. Auto/-tuning w orks as follo ws/, the con/-troller is disconnected and replaced b y a rela y /, whic h induces a limit cycleoscillation/. The p erio d and the amplitude of the oscillations giv e a p oin ton the Nyquist curv e/, whic h is used to c ho ose the con troller parameters/.This metho d of tuning can also be applied to other con troller structuresthan PID/-con trollers/.Another w a y to obtain the con troller parameters is to iden tify a mo delof the system using a system iden ti/#0Ccation algorithm/, for example/, a leastsquares metho d or a prediction error metho d/, see e/.g/. S/#7F oderstr/#7F om and Sto/-ica /#28/1/9/8/9/#29/. The iden ti/#0Ced mo del is then used to deriv e the con troller pa/-rameters for a desired closed lo op resp onse/. A problem with this metho dis that the closed lo op p oles can only b e c hosen arbitrary for a limited setof mo del structures/.An approac h to deriv e the feedforw ard is to estimate a mo del of thepro cess and use it together with the feedbac k /#28the PID/-con troller/#29 to deriv ean optimal /#28in LQ sense/#29 feedforw ard/. Another simpler approac h is just toapply a static gain from the feedforw ard measuremen ts/. In the sim ulationsin Section /3/./8 suc h an approac h is used/.The PID/-con troller with feedforw ard has the follo wing structure/./#01 u /#28 t /#29 /= K /#5B/#28 e /#28 t /#29 /, e /#28 t /, /1/#29/#29 /+
hTi
e /#28 t /#29 /,
TDh
/#28 yf
/#28 t /#29 /, /2 yf
/#28 t /, /1/#29 /+ yf
/#28 t /, /2/#29/#29/#5D/+ Kf /1
/#01 w/1
/#28 t /#29/+ Kf /2
/#01 w/2
/#28 t /#29 /#28/3/./5/#29u /#28 t /#29 /= u /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 /#28/3/./6/#29e /#28 t /#29 /= yre f
/#28 t /#29 /, y /#28 t /#29 /#28/3/./7/#29yf
/#28 t /#29 /= pyf
/#28 t /, /1/#29 /+ /#28/1 /, p /#29 y /#28 t /#29 /#28/3/./8/#29where K /, Ti
TD
are the usual PID parameters/, h is the sampling in terv al/,Kf /1
and Kf /2
are the feedforw ard gains/, yf
/#28 t /#29 is y /#28 t /#29l o w/-pass /#0Cltered and/#01 w/1
/#28 t /#29 and /#01 w/2
/#28 t /#29 are the di/#0Beren tiated /#28/#01 w/1
/#28 t /#29 /= w/1
/#28 t /#29 /, w/1
/#28 t /, /1/#29/#29feedforw ard signals/, i/.e/. in/#0Duen t mass /#0Do w of the TOC/, and recirculatedmass /#0Do w of nitrate/. In /#28/3/./5/#29/, the deriv ativ e of the error e /#28 t /#29 is not used/,instead only the deriv ativ e of yf
/#28 t /#29 is used to a v oid large c hanges in the/3/./4 A mo del/-based adaptiv e PI con troller /4/9con trol signal when there is a step c hange in the reference signal yre f
/#28 t /#29/.Using the lo w/-pass /#0Cltered output yf
/#28 t /#29 also mak e the con troller less noisesensitiv e/. The lo w/-pass /#0Clter parameter p should b e c hosen faster than thedominan t dynamics/.Here a least squares metho d is used to iden tify a mo del with the fol/-lo wing structure/#28/1 /+ aq
/, /1/#29 y /#28 t /#29/= bu /#28 t /, /1/#29 /+ d/1
w/1
/#28 t /, /1/#29 /+ d/2
w/2
/#28 t /, /1/#29 /#28/3/./9/#29AP Ic o n troller is then su/#0Ecien t to place the p oles arbitrary /. Applying thePI con troller to the mo del /#28/3/./9/#29 and placing the closed lo op p oles at p /#28adouble p ole/#29 giv es the con troller parametersK /= /,
a /+ p
/2b
/#28/3/./1/0/#29Ti
/=
bK h/1 /, a /, bK /, /2 p
/#28/3/./1/1/#29F or a more detailed description of ho w the PI parameters w ere obtained/, seealso Section /5/./2/./1/. The feedforw ard parameters are not so di/#0Ecult to c hoseb y hand/. Here they are c hosen to Kf /1
/=/0 /: /0/5 and Kf /2
/=/0 /: /7/. Alternativ ely/#28/3/./9/#29 could be used to determine the feedforw ard gains/. The deadb eatfeedforw ard is giv en b yKf /1
/= /,
d/1b
Kf /2
/= /,
d/2b
/#28/3/./1/2/#29If a deadb eat feedforw ard is not desirable one could scale the feedforw ardgain to mak e it smaller/.R emark/: The mo del structure /#28/3/./9/#29 is not the same as used in the indi/-rect adaptiv e con troller/, where the B /#28 q
/, /1/#29 p olynomial has t w o co e/#0Ecien ts/.The di/#0Beren t structure dep ends on that a PID con troller can not place theclosed lo op p oles arbitrary for suc h a mo del/. Using only one co e/#0Ecien tin the B /#28 q
/, /1/#29 p olynomial w orks also reasonable w ell when the con trollerop erates in the range where it w as tuned/./3/./4 A mo del/-based adaptiv e PI con trollerUsing the mo del /#28/3/./4/#29/, i/.e/.SNO
/#28 t /+/1 /#29 /, SNO
/#28 t /#29h
/=
Qint
/#28 t /#29 SN O int
/#28 t /#29/+ Qsl
/#28 t /#29 SNO s l
/#28 t /#29V/, DSNO
/#28 t /#29 /, Kext
/#28 t /#29
SS/;extV
u /#28 t /#29 /, KSS
/#28 t /#29
Qin
/#28 t /#29V
TO Cin
/#28 t /#29 /#28/3/./1/3/#29/5/0 Con trol of external carb on /#0Do w ratea mo del/-based adaptiv e PI con troller can be designed/. In /#28/3/./1/3/#29/, D /=/#28 Qint
/+ Qsl
/+ Qin
/#29 /=V /, u /#28 t /#29 is the external carb on /#0Do w rate/, and Kext
andKSS
are recursiv ely estimated parameters/. Using /#28/3/./1/3/#29 the parameters forthe PI con troller are giv en b yK /=
p
/2/+ Dh /, /1hKext
SS /;extV
/#28/3/./1/4/#29Ti
/=
h/2 p /, /2/+ DhhKext
SS /;extV
K
/, /1
/#28/3/./1/5/#29for a double p ole at z /= p /.The parameters Kext
and KSS
can be estimated with/, for example/, arecursiv e least squares metho d/. A predictor for an RLS metho d is giv en b y/^ y /#28 t /+/1 j t /#29 /= y /#28 t /#29/+ h /#5B
Qint
/#28 t /#29 SN O int
/#28 t /#29/+ Qsl
/#28 t /#29 SNO s l
/#28 t /#29V
/, Dy /#28 t /#29 /, /'
T/#28 t /#29 /#12 /#28 t /#29/#5D/'
T/#28 t /#29 /= /#5B
SS /;ext
u /#28 t /#29V
TO Cin
/#28 t /#29 Qin
/#28 t /#29V
/#5D /#28/3/./1/6/#29/#12
T/#28 t /#29 /= /#5B Kext
/#28 t /#29 KSS
/#28 t /#29 /#5D /#28/3/./1/7/#29The parameter estimates are then up dated b y using /#28/3/./5/7/#29/./3/./4/./1 Exten tion of the mo del/-based adaptiv e PI con trollerInstead of using /#28/3/./1/3/#29/, more ph ysical kno wledge could b e included b y con/-sidering the SS
concen tration and tak e the nonlinear mono d relation for SSin to accoun t/. The follo wing mo dels are then usedSNO
/#28 t /+/1 /#29 /, SNO
/#28 t /#29h
/=
Qint
/#28 t /#29 SN O int
/#28 t /#29/+ Qsl
/#28 t /#29 SNO s l
/#28 t /#29V/, DSNO
/#28 t /#29 /, K /#28 t /#29
SS
/#28 t /#29KS
/+ SS
/#28 t /#29
/#28/3/./1/8/#29SS
/#28 t /+/1 /#29 /, SS
/#28 t /#29h
/=
Qin
/#28 t /#29 SS/;in
/#28 t /#29V
/, DSS
/#28 t /#29/+
SS/;extV
u /#28 t /#29 /#28/3/./1/9/#29where K /#28 t /#29 is estimated and it is assumed that KS
is kno wn and SS
ismeasurable/. Since the SS
concen tration needs to b e measured in the ano xiczone/, a p ossibilit y to reduce the n um be r of sensors could be to mo v e theTOC sensor/, whic h measure in the in/#0Duen tw ater/, to the ano xic zone/. Thefeedforw ard of SS
is then lost/, but since the SS
concen tration is measuredin the ano xic zone instead/, not so m uc h p erformace is lost an yw a y /. If TOCis measured instead of SS
/, the parameter KS
probably ha v e to b e up dated/./3/./5 A direct adaptiv e con troller /5/1The PI con troller designed here uses the temp oral con trol signal x /#28 t /#29/,instead of the /#0Do w rate u /#28 t /#29/. The signal x /#28 t /#29 is de/#0Cned b yx /#28 t /#29/=
SS
/#28 t /#29KS
/+ SS
/#28 t /#29
/#28/3/./2/0/#29The /#0Do w rate u /#28 t /#29 is determined from /#28/3/./1/9/#29 and b ecomesu /#28 t /#29/=
VSS/;ext
/#14SS
/#28 t /+/1 /#29 /, SS
/#28 t /#29h
/,
Qin
/#28 t /#29 SS/;in
/#28 t /#29V
/+ DSS
/#28 t /#29
/#15/#28/3/./2/1/#29where SS
is measured/, SS/;in
is either measured or neglected if no feedfor/-w ard sensor is a v ailable/, and SS
/#28 t /+ /1/#29 is the future desired SS
concen tration/,whic h is computed from x /#28 t /#29 in /#28/3/./2/0/#29 asSS
/#28 t /+/1 /#29 /=
x /#28 t /#29/1 /, x /#28 t /#29
KS
/#28/3/./2/2/#29The con troller design is similar to the adaptiv e mo del/-based PI con/-troller/, K and Ti
are giv en b y /#28/3/./1/4/#29 and /#28/3/./1/5/#29 with the di/#0Berence Kext
isreplaced b y K /#28 t /#29/.The same estimator as for the adaptiv e mo del/-based PI con troller isused/, except that /' /#28 t /#29 in /#28/3/./1/6/#29 is c hanged to /' /#28 t /#29/= x /#28 t /#29 and /#12 /#28 t /#29 in /#28/3/./1/7/#29is c hanged to /#12 /#28 t /#29/= K /#28 t /#29/./3/./5 A direct adaptiv e con trollerA direct adaptiv e con trol strategy is app ealing since the con troller param/-eters are estimated directly from data/, whic h among other things mak esthe con troller easy to implemen t/. The resulting con troller has also of/-ten sho wn to be robust/, see e/.g/.
/#17Astr/#7F om and Wittenmark /#28/1/9/8/9/#29/. Prob/-lems ma y /, ho w ev er/, arise if the true system is non/-minim um phase/, anda minim um/-v ariance or generalized minim um/-v ariance con troller is used/,see e/.g/.
/#17Astr/#7F om and Wittenmark /#28/1/9/8/9/#29/. There exist other con trollers thato v ercome this problem/, for example/, the MUSMAR /#28MultiStep Multiv ari/-able Adaptiv e Regulator/#29 metho d/, see Mosca et al/. /#28/1/9/8/4/#29/.Here/, only the gener alize d minimum/-varianc e /#28GMV/#29 con troller/, in tro/-duced b y Clark e and Ga wthrop /#28/1/9/7/5/#29 is considered/. The reason is thatthe GMV con troller w orks w ell in b oth the sim ulation studies and in thepilot plan t/, and that it is also less complex/./5/2 Con trol of external carb on /#0Do w rateThe generalized minim um/-v ariance /#28or Clark e/-Ga wthrop/#29 con troller isderiv ed from input output data Yt
/, and designed to minimize the k /-stepahead sliding horizon criterionJ /=
/1/2
E/#5B y
/2/#28 t /+ k /#29/+ /#1A /#28/#01 u /#28 t /#29/#29
/2j Yt
/#5D /#28/3/./2/3/#29In the deriv ation of the con troller/, y /#28 t /+ k /#29 is found from the k step predictorof /#28/3/./2/#29/. The predictor is determined b y using the iden tit yC /=/#01 A
RB
/+ q
/, kS /#28/3/./2/4/#29The con troller is then found b y setting the deriv ativ e of J with resp ectto /#01 u to zero/. This giv es the con trol la w whic h minimizes /#28/3/./2/3/#29 for thesystem /#28/3/./2/#29/. Implemen ted as an in tegrating con troller with feedforw ardthe con trol la w b ecomes/#28 R /#28 q
/, /1/#29/+
/#1Ar/0
C /#28 q
/, /1/#29/#29/#01 u /#28 t /#29/= /, S /#28 q
/, /1/#29 y /#28 t /#29 /, Q/1
/#28 q
/, /1/#29/#01 w/1
/#28 t /#29 /, Q/2
/#28 q
/, /1/#29/#01 w/2
/#28 t /#29/#28/3/./2/5/#29u /#28 t /#29/= u /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 /#28/3/./2/6/#29where R /#28 q
/, /1/#29/, S /#28 q
/, /1/#29/, Q/1
/#28 q
/, /1/#29 and Q/2
/#28 q
/, /1/#29 are the con troller p olynomials/,and C /#28 q
/, /1/#29 could be considered as an observ er p olynomial and used as aused parameter/. The deriv ation of /#28/3/./2/5/#29 is w ell kno wn/, see e/.g/.
/#17Astr/#7F om andWittenmark /#28/1/9/9/0/#29/, but for completeness a deriv ation is giv en in App endixA/. In the deriv ation/, the prediction horizon k in the con troller is set equalto the time dela y in the pro cess k /. The time dela ys of the measurabledisturbances are also set equal to k /.T o mak e the con troller robust to lo w/-frequency mo deling errors andto mak e it p ossible to remo v e drifting disturbances and disturbances ofrandom step t yp e/, in tegration /#28/#01 u /#29 has b een included/. By deriving theincremen tal con trol signal /#28/#01 u /#29 in /#28/3/./2/5/#29 and then calculate u /#28 t /#29 as in/#28/3/./2/6/#29/, in tegration is obtained/.The closed/-lo op p oles of the generalized minim um/-v ariance con trollerare giv en b y the ro ots of/#28 B /+
/#1Aro
A /#01/#29 C /=/0 /#28/3/./2/7/#29The p oles will hence mo v e be t w een the ro ots of B and the ro ots of A /#01dep ending on /#1A /. This explains wh y there are problems when the op en/-lo op system is unstable and/#2For non/-minim um phase/. It can b e di/#0Ecult /#28orimp ossible/#29 to /#0Cnd a suitable input p enalt y /#1A if the op en lo op system is ofthis t yp e/./3/./5 A direct adaptiv e con troller /5/3The generalized minim um/-v ariance con troller is usually easy to tune/. Ifthe observ er p olynomial/, the degree of the con troller p olynomials and thesampling rate are /#0Cxed/, then there is only one tuning parameter /#28 /#1A /#29/. Thetuning parameter /#1A trades o/#0B output v ariance to input v ariance/. A small/#1A mak es the con troller faster but also more sensitiv e to noise and mo delingerrors/. The b est c hoice of /#1A has to b e tried out/. Usually /#1A has to b e c hangedb y a factor of ten to get a signi/#0Ccan tc hange in the con trolled system/.When determining the degree of the con troller p olynomials/, it is a go o didea to try to k eep the n um b er of estimated parameters as lo w as p ossible/.It is often reasonable to start with few con troller parameters and then in/-crease the n um b er of estimated parameters un til the con troller giv es accept/-able p erformance/. If the n um be r of estimated parameters is to o high theparameters ma y start to drift/, although the real pro cess has not c hanged/.Here the follo wing con troller structure has b een selected/#28 r/0
/+
/#1Ar/0
/#29/#01 u /#28 t /#29/= t/0
yre f
/#28 t /#29 /, /#28 s/0
/+ s/1
q
/, /1/#29 y /#28 t /#29/+ q/1
/#01 w/1
/#28 t /#29/+ q/2
/#01 w/2
/#28 t /#29 /#28/3/./2/8/#29where the con troller parameters r/0
/, s/0
/, s/1
/, q/1
and q/2
are estimated/. TheC /#28 q
/, /1/#29 p olynomial in /#28/3/./2/5/#29 is/, as seen in /#28/3/./2/8/#29/, c hosen toC /#28 q
/, /1/#29/=/1 /#28/3/./2/9/#29whic h is the same c hoice as in Clark e and Ga wthrop /#28/1/9/7/5/#29/.The reference signal yre f
/#28 t /#29 is also included in /#28/3/./2/8/#29/. T o get the staticgain equal to /1/, yre f
/#28 t /#29i s m ultiplied b y t/0
/, whic h should b e c hosen tot/0
/= S /#28/1/#29 /= /1 /#28/3/./3/0/#29F or a further explanation of the c hoice of T /-p olynomial see Section /3/./7/./6/./3/./5/./1 P arameter estimationThe con troller parameters in /#28/3/./2/8/#29 can b e estimated directly b y /, for exam/-ple/, a RLS algorithm/, see e/.g/. Ljung and S/#7F oderstr/#7F om /#28/1/9/8/3/#29/.In App endix A/, a predictor for the system /#28/3/./2/#29 is deriv ed/. The pre/-dictor/, for directly estimating the con troller parameters in /#28/3/./2/5/#29 is giv enb y/^ y /#28 t /+ k j t /#29 /= R
/#01 u /#28 t /#29Ao
/+ S
y /#28 t /#29Ao
/+ Q/1
/#01 w/1
/#28 t /#29Ao
/+ Q/2
/#01 w/2
/#28 t /#29Ao/= R /#01 uf
/#28 t /#29/+ Syf
/#28 t /#29/+ Q/1
/#01 wf /1
/#28 t /#29/+ Q/2
/#01 wf /2
/#28 t /#29 /#28/3/./3/1/#29/5/4 Con trol of external carb on /#0Do w ratewhere the /#0Cltered signals uf
/#28 t /#29/, yf
/#28 t /#29 and /#01 uf
/#28 t /#29 are de/#0Cned b yuf
/#28 t /#29 /=
/1Ao
u /#28 t /#29 /#01 wf /1
/#28 t /#29/=
/1Ao
/#01 w/1
/#28 t /#29 /#28/3/./3/2/#29yf
/#28 t /#29 /=
/1Ao
y /#28 t /#29 /#01 wf /2
/#28 t /#29/=
/1Ao
/#01 w/2
/#28 t /#29 /#28/3/./3/3/#29In the deriv ation in App endix A/, Ao
should b e equal to the true C p olyno/-mial/, where C /#28 q
/, /1/#29 is the color of the unmeasurable noise/. It is/, ho w ev er/,not necessary that Ao
/= C to obtain consisten t estimates b ecause the con/-troller parameters surprisingly con v erg to consisten t estimates also whenthe Ao
/-p olynomial di/#0Bers from the true one/, see
/#17Astr/#7F om and Wittenmark/#28/1/9/8/9/#29/. This is not v alid for all adaptiv e con trollers/, but it applies for theadaptiv e /#28generalized/#29 minim um/-v ariance con troller/. The Ao
p olynomialcan hence b e considered as a /#0Clter c hosen b y the designer/. T o impro v e theestimates one should c ho ose /1 /= Ao
a sal o w/-pass /#0Clter/, to remo v e undesiredhigh frequency dynamics/. Here Ao
is c hosen asAo
/=/1 /, /0 /: /7 q
/, /1/#28/3/./3/4/#29The predictor in /#28/3/./3/1/#29 can b e rewritten to/^ y /#28 t j t /, /1/#29 /= /'
T/#28 t /, /1/#29 /#12 /#28/3/./3/5/#29where/'
T/#28 t /, /1/#29 /=
/#5B/#01 uf
/#28 t /, /1/#29 yf
/#28 t /, /1/#29 yf
/#28 t /, /2/#29 /#01 wf /1
/#28 t /, /1/#29 /#01 wf /2
/#28 t /, /1/#29/#5D/#12 /=
/#5B r/0
s/0
s/1
q/1
q/2
/#5D
TThe parameter v ector /#12 is up dated b y/^/#12 /#28 t /#29/=
/^/#12 /#28 t /, /1/#29 /+ P /#28 t /#29 /' /#28 t /#29 /" /#28 t /#29 /#28/3/./3/6/#29In /#28/3/./3/6/#29/,
/^/#12 /#28 t /#29 denotes the estimated parameter v ector/, P /#28 t /#29 is the co v ari/-ance matrix whic h is up dated recursiv ely /, see /#28/3/./5/1/#29 /#7B /#28/3/./5/6/#29 for a n umeri/-cally sound w a y of calculating P /#28 t /#29/, /' /#28 t /#29 is the regression v ector and/" /#28 t /#29/= y /#28 t /#29 /, /^ y /#28 t j t /, /1/#29 /#28/3/./3/7/#29is the prediction error/.Numerical problems ma y o ccur when estimating man y parameters/. Onew a y to obtain b etter estimates is to /#0Cx r/0
/, for example/, at r/0
/= /, /1/. Thisw orks when b/0
is in the appro ximate range /, /3 /#3C b/0
/#3C /, /0 /: /3/. Anotherp ossibilit y is to estimate r/0
only during an initial p erio d of high excitationand k eep it /#0Cxed after the high excitation/. Note that setting r/0
to a /#0Cxedv alue do es not constrain the con troller to time in v arian t systems/, since theother con troller parameters ma y still b e able to comp ensate for a /#0Cxed r/0
/./3/./6 An indirect adaptiv e con troller /5/5/3/./6 An indirect adaptiv e con trollerIn an indir e ct adaptiv e con troller/, the con troller design is based on a re/-cursiv ely estimated mo del of the system/. The adv an tage of this designmetho d compared to a direct adaptiv e con troller/, is that a m uc h widerrange of con troller design metho ds can be applied/. Non/-minim um phasesystems/, for example/, will not cause an y particular problems/. Some p ossibledra wbac ks with the indirect metho d are that it requires more computationsthan a direct adaptiv e con troller/, and that the deriv ed con troller also ma ybe less robust than a direct adaptiv e con troller/, see
/#17Astr/#7F om and Witten/-mark /#28/1/9/8/9/#29/.The mo del /#28/3/./2/#29 used for con troller design can/, for example/, be esti/-mated b y a recursiv e least squares metho d/, see e/.g/. S/#7F oderstr/#7F om and Stoica/#28/1/9/8/9/#29/.The selected con troller is an LQ con troller with feedforw ard/. A fre/-quen tly used criterion in LQ design/, see e/.g/.
/#17Astr/#7F om and Wittenmark/#28/1/9/9/0/#29/, is the follo wingJ /= limN /!/1
/1N
NXt /=/0
/#5BE y
/2/#28 t /#29/+ /#1A E u
/2/#28 t /#29/#5D /#28/3/./3/8/#29In Lindb erg /#28/1/9/9/5/#29/, an extended v ersion w as deriv ed where it is p ossible topartition the con trol signal in to t w o separate parts/, one whic h originatesfrom the feedforw ard and one from the feedbac k/. These parts can then b ep enalized di/#0Beren tly /. In App endix B the con trol algorithm is giv en/. Thecriterion for this LQ con troller isJ /= limN /!/1
/1N
NXt /=/0
E y
/2/#28 t /#29/+ E /#28
p/#1Ae
/#01 ue
/#28 t /#29/+
p/#1Av
/#01 uv
/#28 t /#29/#29
/2/#28/3/./3/9/#29where ue
is the con trol signal whic h originates from the unmeasurable dis/-turbance and uv
is the con trol signal whic h is computed from the measur/-able disturbance/.The adv an tage of using separate p enalties is that slo w /#28robust/#29 feed/-bac k can be used in com bination with fast feedforw ard whic h rejects themeasurable disturbances quic kly /. The con troller structure whic h minimizes/#28/3/./3/9/#29 and where a reference signal also is included isR /#28 q
/, /1/#29/#01 u /#28 t /#29/= T /#28 q
/, /1/#29 yre f
/#28 t /#29 /, S /#28 q
/, /1/#29 y /#28 t /#29 /,
Q/1
/#28 q
/, /1/#29P/1
/#28 q
/, /1/#29
w/1
/#28 t /#29 /,
Q/2
/#28 q
/, /1/#29P/2
/#28 q
/, /1/#29
w/2
/#28 t /#29/#28/3/./4/0/#29/5/6 Con trol of external carb on /#0Do w rateA blo c k diagram of the con trol strategy in /#28/3/./4/0/#29 is presen ted in Figure/3/./2/, but with only one measurable disturbance/. The LQ con troller usesall a v ailable information to /#0Cnd the optimal con troller/. If a mo del of themeasureable disturbance exist /#28 w /#28 t /#29 /=
GH
v /#28 t /#29/#29 this information is used toimpro v e the con trol/.m m
QP/1R /#01
q
/, k
BA
/?/-/6
/- /- /- /-/#1BS
q
/, d
DA
CA
/1/#01
GH/#08/#08/#08/#19
HHHj
/?
/#1B/?
/? /?/,
/,/+
n /#28 t /#29
e /#28 t /#29 v /#28 t /#29y /#28 t /#29u /#28 t /#29
w /#28 t /#29Tyre f
/#28 t /#29Figure /3/./2/: The pro cess with the con troller/. F eedforw ard is utilizedfrom the measurable disturbance w /#28 t /#29/, whic h is mo delled as /#0Clteredwhite noise /#28
GH
v /#28 t /#29/#29/.R emark/: The optimal LQ fe e dforwar d dep ends on the feedbac k/, but theoptimal LQ fe e db ack do es not dep end on the feedforw ard/, see Kw ak ernaakand Siv an /#28/1/9/7/2/#29/./3/./6/./1 Iden ti/#0Ccation of the pro cessThe follo wing ARX mo del is iden ti/#0CedA /#28 q
/, /1/#29 y /#28 t /#29 /= B /#28 q
/, /1/#29 q
/, ku /#28 t /#29/+ D/1
/#28 q
/, /1/#29 q
/, d/1w/1
/#28 t /#29/+ D/2
/#28 q
/, /1/#29 q
/, d/2w/2
/#28 t /#29/+ n /#28 t /#29 /#28/3/./4/1/#29/3/./6 An indirect adaptiv e con troller /5/7whic h is the same mo del as /#28/3/./2/#29/. The G and H p olynomials/, see Figure/3/./2/, are used to mo del the measurable disturbance and are not estimated/.Instead G/=H /=/1 /= /#01 is set to a random w alk pro cess in the con troller design/.Kno wledge of G/=H w ould mak e it p ossible to b etter reject measurabledisturbances/. The C p olynomial/, see Figure /3/./2/, can be considered as aobserv er p olynomial and b e used as a design parameter/.T o determine the mo del structure/, data w as generated b y exciting thecarb on /#0Do w rate in the sim ulated activ ated sludge pro cess with a PRBS/#28Pseudo Random Binary Sequence/#29 con trol signal in /3/0 hours/. The meanv alues of the signals w ere remo v ed b efore use in the iden ti/#0Ccation/. The de/-grees of the p olynomials could b e c hosen b yA k aik e/'s information criterion/,see Ak aik e /#28/1/9/8/1/#29/, whic h p enalizes high/-order mo dels/. Here the degrees ofthe p olynomials w ere c hosen as lo w as p ossible/, but still with a reasonable/#0Ct be t w een the sim ulated output of the iden ti/#0Ced mo del and the /#5Creal/"output/. The selected structure is/#28/1 /+ aq
/, /1/#29 y /#28 t /#29/= /#28 b/1
/+ b/2
q
/, /1/#29 q
/, /1u /#28 t /#29/+ d/1
q
/, /1w/1
/#28 t /#29/+ d/2
q
/, /1w/2
/#28 t /#29 /#28/3/./4/2/#29The predictor in the algorithm for estimating the parameters in /#28/3/./4/2/#29 canb e written as/^ y /#28 t j t /, /1/#29 /= /'
T/#28 t /, /1/#29 /#12 /#28/3/./4/3/#29where/' /#28 t /, /1/#29 /= /#5B /, yf
/#28 t /, /1/#29 uf
/#28 t /, /1/#29 uf
/#28 t /, /2/#29 wf /1
/#28 t /, /1/#29 wf /2
/#28 t /, /1/#29/#5D
T/#12 /= /#5B a b/1
b/2
d/1
d/2
/#5D
Tandyf
/#28 t /#29 /= F /#28 q
/, /1/#29 y /#28 t /#29 uf
/#28 t /#29/= F /#28 q
/, /1/#29 u /#28 t /#29wf /1
/#28 t /#29 /= F /#28 q
/, /1/#29 w/1
/#28 t /#29 wf /2
/#28 t /#29/= F /#28 q
/, /1/#29 w/2
/#28 t /#29In /#28/3/./4/4/#29 the signals in the regressor v ector /' /#28 t /#29 ha v e b een /#0Cltered b yF /#28 q
/, /1/#29/, b ecause the mean v alue of the signals are not zero/. T o iden tifya system with non/-zero mean/, one can/, for example/, remo v e the a v eragev alue of the signals b efore they are used in the estimator to obtain a cor/-rect mo del/. In recursiv e metho ds it is/, di/#0Ecult to remo v e a v erage v alues/.An approac h whic hw orks for signals with non/-zero mean and drifting sig/-nals/, is to di/#0Beren tiate the signals i/.e/. m ultiply the regressor with /#01/. Asdi/#0Beren tiated signals are quite noisy /, it is a g ood idea to lo w/-pass /#0Clterthe di/#0Beren tiated signals/. Lo w/-pass /#0Cltering also remo v e undesired highfrequency dynamics/. A suitable /#0Clter is thenF /#28 q
/, /1/#29/=
/#01/#28/1 /, f /#29/#28 z /, f /#29
/#28/3/./4/4/#29/5/8 Con trol of external carb on /#0Do w rateSuc h a /#0Clter has b een used in the sim ulations in Section /3/./8 with the /#0Clterp ole in f /=/0 /: /7/. Another p ossible /#0Clter suggested in
/#17Astr/#7F om and Witten/-mark /#28/1/9/8/9/#29 isF /#28 q
/, /1/#29/=
/#01/#28/1 /, f /#29
/2/#28 z /, f /#29
/2
/#28/3/./4/5/#29where f also is a /#0Clter p ole/, c hosen b y the designer/. It could/, ho w ev er/, bedi/#0Ecult to c ho ose the p ole for the lo w pass /#0Clter/. A to o slo w /#0Clter remo v esin teresting dynamics and a to o fast /#0Clter do es not remo v e the undesiredhigh frequency dynamics/. An appropriate /#0Clter c hoice for the regressor/,has b een giv en b y
/#17Astr/#7F om and Nilsson /#28/1/9/9/4/#29/, whic h is esp ecially suitablefor estimation in closed/-lo op and is related to the sensitivit y function of theclosed/-lo op system/. Their suggested /#0Clter isF /#28 q
/, /1/#29/=
/#01 RA /#01 R /+ z
/, kBS
/#28/3/./4/6/#29where A /#28 q
/, /1/#29 and B /#28 q
/, /1/#29 are the system p olynomials/, and R /#28 q
/, /1/#29 andS /#28 q
/, /1/#29 are the con troller p olynomials/./3/./6/./2 Observ er p olynomialsThe previous LQ design implies p ole placemen t at the zeros of/#0B /#28 q
/, /1/#29/= /#0Ce
/#28 q
/, /1/#29 C /#28 q
/, /1/#29 /#28/3/./4/7/#29where /#0Ce
/#28 q
/, /1/#29 is de/#0Cned b y the sp ectral factorizationre
/#0Ce
/#0C
/#03e
/= BB
/#03/+ /#1Ae
A /#01/#01
/#03A
/#03/#28/3/./4/8/#29The C /-p olynomial is usually not kno wn/, and ma y be hard to estimate/.T o con trol the sensitivit y to measuremen t noise in the feedbac k lo op/, theC /#28 q
/, /1/#29 p olynomial could be selected freely and considered as an observ erp olynomial/, see Sternad /#28/1/9/9/1/#29/. An appropriate c hoice of C /#28 q
/, /1/#29 will re/-duce the high frequency gain of the con troller/. Preferably C is c hosen sothat /1 /=C b ecomes a lo w pass /#0Clter/. The b est v alue dep ends/, for example/,on the actual noise lev el and sampling p erio d/.The G p olynomial/, whic h is included in the mo del of the measurabledisturbance w /#28 t /#29 /=
GH
v /#28 t /#29/, ma y be considered as a design v ariable in thesame w a ya st h e C p olynomial/. Hence/, when the feedforw ard measuremen tsare corrupted b y noise it ma y b e adv an tageous to select /1 /=G a sal o w/-pass/#0Clter/./3/./6 An indirect adaptiv e con troller /5/9There exists an optimal solution when measuremen t noise a/#0Bects thefeedforw ard measuremen ts/, see Sternad /#28/1/9/8/9/#29/. The idea is to use a sp ec/-tral factorization whic h gradually /#5Cswitc hes o/#0B /" the feedforw ard when thev ariance of the measuremen t noise increases/. A v ery similar e/#0Bect can beobtained b y increasing the p enalt y /#1Av
/./3/./6/./3 Calculation of the con trollerF rom /#28/3/./4/2/#29 w eh a v e a system with the follo wing parametersA /=/1 /+ aq
/, /1B /= b/1
/+ b/2
q
/, /1D /= d/0
k /=/1 d /=/1The pro cedure for deriving the feedforw ard comp ensation is iden tical forthe t w o di/#0Beren t measurable disturbances/, b ecause D/1
and D/2
are assumedto ha v e the same structure/. F or simplicit y /, a case with only one measurabledisturbance is studied/.Since no mo del of the measurable disturbances are assumed/, a randomw alk ma y b e an appropriate c hoice/.G /=/1 H /=/#01 C /=/1 /+ cq
/, /1The C p olynomial is considered as a user parameter where /1 /=C is c hosenas a lo w/-pass /#0Clter/. The c hoice of C is discussed in Section /3/./6/./2/.The degrees of the con troller p olynomials are giv en in App endix B/./1/./1R /=/1 /+ r/1
q
/, /1S /= s/0
/+ s/1
q
/, /1P /= G/#0CvQ /=/#01 Q/1
Q/1
/= k/0
/+ k/1
q
/, /1/+ k/2
q
/, /2L /= l/0
/+ l/1
q
/, /1Note that as H /=/#01 /, /#28B/./2/3/#29 then ha v e to be used instead of /#28B/./1/5/#29/. TheL /-p olynomial is not a con troller p olynomial/. It is only an auxiliary p oly/-nomial/.Solving the sp ectral factorization /#28/3/./4/8/#29 giv es the co e/#0Ecien ts in /#0Ce
/=/1/+ /#0Ce /1
q
/, /1/+ /#0Ce /2
q
/, /2/. Then the feedbac k p olynomials R and S are found b yusing equation /#28B/./1/1/#29/, whic h giv es/1 /+ q
/, /1/#28 r/1
/, /1/+ a /+ b/1
s/0
/#29/+ q
/, /2/#28 /, r/1
/+ ar/1
/, a /+ b/1
s/1
/+ b/2
s/0
/#29/+ q
/, /3/#28 b/2
s/1
/, ar/1
/#29 /#11 /1/+ q
/, /1/#28 c /+ /#0Ce /1
/#29/+ q
/, /2/#28 /#0Ce /1
c /+ /#0Ce /2
/#29/+ /#0Ce /2
cq
/, /3Considering the terms with equal po w ers in q
/, /1giv es a linear system ofequations/:/2/6/4
/1 b/1
/0a /, /1 b/2
b/1/, a /0 b/2
/3/7/5
/2/6/4
r/1s/0s/1
/3/7/5
/=
/2/6/4
/1 /, a /+ c /+ /#0Ce /1a /+ c/#0Ce /1
/+ /#0Ce /2c/#0Ce /2
/3/7/5/6/0 Con trol of external carb on /#0Do w rateThe feedforw ard /#0Clter denominator P is determined from /#28B/./1/3/#29 i/.e/.P /= G/#0Cv
/#28/3/./4/9/#29and the feedforw ard n umerator Q is obtained b y solving /#28B/./2/3/#29/, since w /#28 t /#29is a drifting disturbance/. En tering the p olynomials in to /#28B/./2/3/#29 giv es/, q
/, /2d/0
g/0
/#1Av
s/1
/+ q
/, /1d/0
g/0
/#28 b/1
r/1
/+ /#1Av
/#28 s/1
/, s/0
/, as/1
/#29/#29/+ d/0
g/0
/#28 b/1
/+ r/1
b/2
/+ /#1Av
/#28 s/0
/+ as/1
/, as/0
/#29/#29 /+ qd/0
g/0
/#28 /#1Av
as/0
/+ b/2
/#29/= q
/, /2/#28 rv
k/2
/+ l/0
/#0B/3
/#29/+ q
/, /1/#28 rv
k/1
/+ rv
/#0Cv /1
k/2
/+ l/0
/#0B/2
/+ l/1
/#0B/3
/#29/+ rv
k/0/+ rv
/#0Cv /1
k/1
/+ rv
/#0Cv /2
k/2
/+ l/0
/#0B/1
/+ l/1
/#0B/2
/+ q /#28 rv
/#0Cv /1
k/0
/+ rv
/#0Cv /2
k/1
/+ l/0
/+ l/1
/#0B/1
/#29/+ q
/2/#28 rv
/#0Cv /2
k/0
/+ l/1
/#29whic h in matrix form can b e written as/2/6/6/6/6/4
/0 /0 rv
/#0B/3
/0/0 rv
rv
/#0Cv /1
/#0B/2
/#0B/3rv
rv
/#0Cv /1
rv
/#0Cv /2
/#0B/1
/#0B/2rv
/#0Cv /1
rv
/#0Cv /2
/0 /1 /#0B/1rv
/#0Cv /2
/0 /0 /0 /1
/3/7/7/7/7/5
/2/6/6/6/6/4
k/0k/1k/2l/0l/1
/3/7/7/7/7/5
/=
/2/6/6/6/6/4
/, d/0
g/0
/#1Av
s/1d/0
g/0
/#28 b/1
r/1
/+ /#1Av
/#28 s/1
/, s/0
/, as/1
/#29/#29d/0
g/0
/#28 b/1
/+ r/1
b/2
/+ /#1Av
/#28 s/0
/+ as/1
/, as/0
/#29/#29d/0
g/0
/#28 /#1Av
as/0
/+ b/2
/#29/0
/3/7/7/7/7/5where rv
and /#0Cv
/=/1 /+ /#0Cv /1
q
/, /1/+ /#0Cv /2
q
/, /2are found b y solving the sp ectralfactorization /#28B/./1/4/#29/.F or sp ectral factorizations of order t w o/, lik e in this example/, there ex/-ists an explicit solution/, see P eterk a /#28/1/9/8/4/#29/. The solution is based on theequation for the ro ots of a third order p olynomial/, and is presen ted b elo w/.Setm/2
q
/2/+ m/1
q /+ m/0
/+ m/1
q
/, /1/+ m/2
q
/, /2/= r /#28/1 /+ /#0C/1
q
/, /1/+ /#0C/2
q
/, /2/#29/#28/1 /+ /#0C/1
q /+ /#0C/2
q
/2/#29/#28/3/./5/0/#29and de/#0Cne/#15 /=
m/0/2
/, m/2
/+
r/#28
m/0/2
/+ m/2
/#29
/2/, m
/2/1thenr /=
/#15 /+
q/#15
/2/, /4 m
/2/2/2/#0C/1
/=
m/1r /+ m/2/#0C/2
/=
m/2rSp ectral factorizations of orders higher than t w o ha v e to b e solv ed b yn u/-merical metho ds/, for whic h there exist e/#0Ecien t metho ds/, see e/.g/. Je /#14 zek andKu /#14 cera /#28/1/9/8/5/#29/./3/./7 Practical asp ects for the adaptiv e con trollers /6/1R emark/: When deriving the con trol signal/, one ma y instead of m ulti/-plying Q/1
with /#01 and then obtaining /#28 Q/1
/#01/#29 w /#28 t /#29 /= Qw /#28 t /#29/, di/#0Beren tiatew /#28 t /#29 and then let Q/1
op erate on /#01 w /#28 t /#29/./3/./7 Practical asp ects for the adaptiv e con trollersSome imp ortan t problems in adaptiv e con trol and their /#28p ossible/#29 solutionswill considered in this section/./3/./7/./1 P otter/'s square ro ot algorithmWhen up dating the parameters in a recursiv e algorithm/, the co v ariance ma/-trix P /#28 t /#29 is used/. T oa v oid n umerical problems with accum ulating roundingerrors and whic h leads to P /#28 t /#29 b ecoming inde/#0Cnite/, P otter/'s square ro ot al/-gorithm can b e used/, see e/.g/. Ljung and S/#7F oderstr/#7F om /#28/1/9/8/3/#29/.De/#0Cne the matrix S /#28 t /#29 throughP /#28 t /#29/= S /#28 t /#29 S
T/#28 t /#29 /#28/3/./5/1/#29and up date S /#28 t /#29 instead of P /#28 t /#29a sf /#28 t /#29 /= S
T/#28 t /, /1/#29 /' /#28 t /#29 /#28/3/./5/2/#29/#0C /#28 t /#29 /= /#15 /+ f
T/#28 t /#29 f /#28 t /#29 /#28/3/./5/3/#29/#0B /#28 t /#29 /=
/1/#0C /#28 t /#29/+
p/#0C /#28 t /#29 /#15
/#28/3/./5/4/#29L /#28 t /#29 /= S /#28 t /, /1/#29 f /#28 t /#29 /#28/3/./5/5/#29S /#28 t /#29 /=
S /#28 t /, /1/#29 /, /#0B /#28 t /#29 L /#28 t /#29 f
T/#28 t /#29p/#15
/#28/3/./5/6/#29The parameter estimates are then up dated as/^/#12 /#28 t /#29/=
/^/#12 /#28 t /, /1/#29 /+ L /#28 t /#29
/" /#28 t /#29/#0C /#28 t /#29
/#28/3/./5/7/#29Note that there will b e less computations in /#28/3/./5/7/#29 if /" /#28 t /#29 is divided b y /#0C /#28 t /#29b efore it is m ultiplied b y L /#28 t /#29/.If P otter/'s algorithm is not used/, the diagonal elemen ts of P /#28 t /#29 couldbe c hec k ed instead/. The matrix P /#28 t /#29 should alw a ys be p ositiv e de/#0Cnite/,whic h means that all diagonal elemen ts of P /#28 t /#29 alw a ys m ust b e larger thanzero/. If they are not/, P /#28 t /#29 can be set to an iden tit y matrix times a smallconstan t/. Note that p ositiv e diagonal elemen ts do es not guaran tee thatP /#28 t /#29 is p ositiv e de/#0Cnite/, but this test is at least b etter than no c hec king atall/./6/2 Con trol of external carb on /#0Do w rate/3/./7/./2 Choice of initial co v ariance matrix and initial regres/-sorThe initial co v ariance matrix P /#28/0/#29 should re/#0Dect the uncertain t y of theparameter v ector/. Usually the uncertain t y is large and P /#28/0/#29 could b e c hosenas P /#28/0/#29 /= /#1B
/2I /, where /#1B is a large v alue whic h in is related to the v arianceof the elemen ts in the /' v ector/, and the parameter v ector is set to
/^/#12 /#28/0/#29 /= /0/.Note that the regressor /' /#28 t /#29 has to b e /#0Clled with /#5Creal signal v alues/" b eforethe estimation algorithm can be started/. Otherwise the parameters tak eh uge steps in wrong directions/, and it ma y then b e hard or imp ossible forthe parameters to reco v er to reasonable v alues/.It is also a go o d idea to disconnect the con troller and replace the con trolsignal with a PRBS signal/, for example/, and then only run the estimatorduring the /#0Crst /3/0/-/5/0 samples/. This giv es the system a high excitation andthe parameters can b etter con v erge/. Note that this is only p ossible if theop en lo op system is stable/./3/./7/./3 The forgetting factor /#15The forgetting factor /#15 should re/#0Dect the parameter v ariations in the realpro cess/. T o determine /#15 one could use the relation for the memory length/,whic h is appro ximately equal to /2 /= /#28/1 /, /#15 /#29/. Av alue of /#15 be t w een /0/./9/5 and/0/./9/9/8 is often suitable/. When there is little noise and few parameters areestimated a smaller /#15 can be selected/. In the sim ulations /#15 /= /0 /: /9/5 w asused/./3/./7/./4 Estimator windupA common problem when using a forgetting factor /#15 /#3C /1 is estimatorwindup/, whic h mak es the co v ariance matrix P /#28 t /#29 gro w exp onen tially duringp erio ds with lo w excitation/. An example of estimator windup is sho wn inFigure /3/./3/. It is the indirect adaptiv e con troller with feedforw ard/, appliedto con trol the nitrate concen tration/. Note that the scale in Figure /3/./3 forthe trace of the co v ariance matrix is logarithmic/. As seen/, the trace ofP /#28 t /#29 gro ws exp onen tially /, during lo w excitation/, and when the system isexcited again the estimated parameters tak e at o o large step/. The systemcon trolled b y this con troller /#28not sho wn/#29 has v ery bad p erformance/.There exist di/#0Beren t metho ds to a v oid estimator windup/. One feasi/-ble strategy to reduce the problem/, whic h is used here/, is a com binationof the algorithm suggested in Ahl /#13 en and Sternad /#28/1/9/8/8/#29 and
/#17Astr/#7F om and/3/./7 Practical asp ects for the adaptiv e con trollers /6/3
05101520253035404550100102104Trace of covariance matrix
0510152025303540455000.050.1Low pass filtered |prediction error|
05101520253035404550−2−101Estimated parameters
time [h]Figure /3/./3/: Illustration of estimator windup/.Wittenmark /#28/1/9/8/9/#29/. This strategy is as follo ws/:/#0F Lo w/-pass /#0Clter the absolute v alue of the prediction error i/.e/.m /#28 t /#29/=/0 /: /8 m /#28 t /, /1/#29 /+ /0 /: /2 j /" /#28 t /#29 j /#28/3/./5/8/#29/#0F IF m /#28 t /#29 /#3E/#0E THEN up date
/^/#12 /#28 t /#29 ELSE
/^/#12 /#28 t /#29/=
/^/#12 /#28 t /, /1/#29/#0F IF m /#28 t /#29 /#3E/#0E AND trace/#28 P /#28 t /#29/#29 /#3C /, THEN up date P /#28 t /#29 ELSE P /#28 t /#29/=P /#28 t /, /1/#29The adaptation is hence switc hed o/#0B when the absolute v alue of the pre/-diction error j /" /#28 t /#29 j is small/. It is switc hed on again when it is larger than/#0E /. T o prev en t the P /#28 t /#29 to gro w to o m uc h/, its trace is also c hec k ed/. If thetrace of P /#28 t /#29 is to o large it is not up dated/, ev en if the prediction error islarge/./6/4 Con trol of external carb on /#0Do w rateThe b oundaries /#0E and /, in the algorithm ha v e to be tested out forb est p erformance/. /#0E should be c hosen so that m /#28 t /#29 most of the time issmaller than /#0E /, and /, can be c hosen to a rather large v alue/, for example/,trace/#28 P /#28/0/#29/#29 or a bit smaller/.This metho d to a v oid estimator windup is applied to the same pro cessand con troller as in Figure /3/./3/. The result is giv en in Figure /3/./4/. Comparingthe result with previous one in Figure /3/./3 w e note that the co v ariance matrixsta ys small and the estimated parameters ha v em uc h smo other mo v emen ts/.The lo w/-pass /#0Cltered prediction error also sta ys smaller/.
05101520253035404550100102104Trace of covariance matrix
0510152025303540455000.050.10.15Low pass filtered |prediction error|
05101520253035404550−1−0.500.5Estimated parameters
time [h]Figure /3/./4/: Illustration of no estimator windup/. The same sim ulationas in Figure /3/./3 is used/, except for that the algorithm in Section /3/./7/./4
is applied to a v oid windup/./3/./7 Practical asp ects for the adaptiv e con trollers /6/5/3/./7/./5 Scaling the regressorsIf the estimated parameters di/#0Bers m uc h in size/, e/.g/. more than a factor /1/0/,then the signal in the regressor can b e scaled/. This impro v es the n umericalprop erties and the estimates/, see also
/#17Astr/#7F om and Wittenmark /#28/1/9/8/9/#29/./3/./7/./6 Including the reference signalThe direct adaptiv e con troller is extended with a reference signal yre f
/#28 t /#29i nthe follo wing w a y/#28 R /#28 q
/, /1/#29/+
/#1Ar/0
C /#28 q
/, /1/#29/#29/#01 u /#28 t /#29/= T /#28 q
/, /1/#29 yre f
/#28 t /#29 /, S /#28 q
/, /1/#29 y /#28 t /#29 /, Q /#28 q
/, /1/#29/#01 w /#28 t /#29/#28/3/./5/9/#29and the indirect adaptiv e con troller in this w a yR /#28 q
/, /1/#29/#01 u /#28 t /#29/= T /#28 q
/, /1/#29 yre f
/#28 t /#29 /, S /#28 q
/, /1/#29 y /#28 t /#29 /,
Q /#28 q
/, /1/#29P /#28 q
/, /1/#29
w /#28 t /#29 /#28/3/./6/0/#29The T /#28 q
/, /1/#29 p olynomial /#0Clters the reference signal and ma yb e c hosen toT /#28 q
/, /1/#29/= mC /#28 q
/, /1/#29 /#28/3/./6/1/#29where m is a constan t whic h is selected to obtain the static gain equal toone/. This is obtained b yc ho osingm /=
/#0Ce
/#28/1/#29B /#28/1/#29
/=
S /#28/1/#29C /#28/1/#29
/#28/3/./6/2/#29where /#0Ce
is de/#0Cned in the sp ectral factorization /#28/3/./4/8/#29/. This c hoice of m isfound b y deriving the closed lo op system from yre f
/#28 t /#29t o y /#28 t /#29/, whic hi sy /#28 t /#29/=
q
/, kBTAR /#01/+ q
/, kBS
yre f
/#28 t /#29 /#28/3/./6/3/#29and b y using AR /#01/+ q
/, kBS /= /#0Ce
C /, together with /#01/#28/1/#29 /= /0/.F or the direct con troller/, the iden tit y /#28/3/./2/4/#29 can b e used to determine theclosed lo op denominator AR /#01/+ q
/, kBS /, whic h then b ecomes BC /. Hence/,if C /#28 q
/, /1/#29 /=/1 then T /= S /#28/1/#29 /= C /#28/1/#29 /=/1 /. It ma y /, ho w ev er/, happ en thatS /#28/1/#29 /6/=/1 /. It is then b etter to use T /= S /#28/1/#29/, b ecause this mak es the staticgain more safer equal to one/./6/6 Con trol of external carb on /#0Do w rate/3/./7/./7 A serv o /#0ClterIf a faster serv o resp onse than pro vided b y /#28/3/./6/1/#29 is desired/, there existt w o p ossibilities/. One option is to decrease the feedbac k p enalt y /#1Ae
/. Alter/-nativ ely /, a serv o /#0Clter can be included/. The serv o /#0Clter is often to prefer/,since decreasing /#1Ae
will mak e the con troller more sensitiv e to measuremen tnoise/.The serv o /#0Clter in /#28/3/./6/1/#29 cancelles the observ er p oles/. The p oles placedin the zeros of /#0Ce
are/, ho w ev er/, not cancelled/. This can be obtained b yreplacing the T /#28 q
/, /1/#29 p olynomial in /#28/3/./6/1/#29 b y the follo wing rational transferfunctionT /#28 q
/, /1/#29 /#0Ce
/#28 q
/, /1/#29 N /#28/1/#29/#0Ce
/#28/1/#29 N /#28 q
/, /1/#29
/#28/3/./6/4/#29where T /#28 q
/, /1/#29 is de/#0Cned in /#28/3/./6/1/#29/, and /#0Ce
/#28 q
/, /1/#29 con tains the closed lo op p oleswhic h are not included in C /#28 q
/, /1/#29/. The p olynomial /#0Ce
/#28 q
/, /1/#29 is canceled b ythe serv o /#0Clter/, and replaced b y the new /#28faster/#29 dynamic/, giv en b y N /#28 q
/, /1/#29whic h is c hosen b y the user/. The factors /#0Ce
/#28/1/#29 and N /#28/1/#29 are included toobtain unit static gain of the transfer function from the reference signal to
the output/. The N /#28 q
/, /1/#29 p olynomial ma y e/.g/. be c hosen as a second orderp olynomial with w ell damp ed complex conjugated ro ots/.Note that high pass /#0Cltering of the reference signal ma y require a largecon trol signal/, whic h ma y not be p ossible to ac hiev e in a real plan t/. Thep erformance robustness ma y also decrease with an increasing high pass/#0Cltering/.R emark/: It is not necessary to cancel the complete /#0Ce
p olynomial/. Al/-ternativ ely only parts of /#0Ce
could b e canceled/./3/./7/./8 Choice of sampling rateIn a real system it is not alw a ys p ossible to select the sampling rate/. If itis p ossible to c ho ose it is suitable to sample around /1/0 times during a risetime of the closed/-lo op system/, see also
/#17Astr/#7F om and Wittenmark /#28/1/9/9/0/#29/./3/./8 Sim ulationsThe previously outlined con trollers are here ev aluated in a sim ulation study /.The aim of the con trol is to k eep the nitrate concen tration as close asp ossible to a desired set/-p oin t /#28here /1mg/#2Fl/#29 b y adding an external carb onsource/./3/./8 Sim ulations /6/7/3/./8/./1 Sim ulation setup for the activ ated sludge pro cessIn all sim ulations/, the true pro cess is sim ulated b y the mo del presen ted inChapter /2/./3 with the follo wing exceptions/:/#0F Me asur ement noise /: Zero mean white noise with standard deviation/0/./1 is added to the nitrate measuremen ts/./#0F Flows and c onc entr ations /: The /#0Do ws and concen trations presen ted inFigure /3/./5 are used/, all other /#0Do ws and concen trations are the defaultones in Section /2/./3/.
0 5 10 15 20 25 30 35 4000.20.40.60.8
time [h]m^3/hInfluent flow (−) and internal recirculation (−−)
0 5 10 15 20 25 30 35 4010203040506070
time [h]mg/lInfluent substrate (−) and influent ammonium (−−)Figure /3/./5/: V ariations in in/#0Duen t/#0D o w/, in ternal recirculation/, in/#0Duen tsoluble substrate and in/#0Duen t ammonium during the sim ulation/./3/./8/./2 PI con trolA PI/-con troller with feedforw ard is used here to con trol the nitrate lev el inthe ano xic zone/. The PI con troller is tuned based on p ole placemen t/, usingan estimated linear pro cess mo del/#28/1 /+ aq
/, /1/#29 y /#28 t /#29/= bu /#28 t /, /1/#29 /#28/3/./6/5/#29/6/8 Con trol of external carb on /#0Do w rateThe parameters /#28 a and b /#29 are only estimated during the /#0Crst /7 hours/. Theparameters could be con tin uously estimated lik e in the indirect adaptiv econ troller/, but they are not/. Instead it is illustrated ho w a w ell tunedcon troller at one op erating p oin t w orks at man y op erating p oin ts/. Thefeedforw ard gains are c hosen b y man ual tuning/. The calculation of the PIparameters w as outlined in Section /3/./3/.A sim ulation using the PI con troller is presen ted in Figure /3/./6/. Thesim ulation indicates that a PI con troller with feedforw ard can con trol thecarb on dosage w ell at man y op erating p oin ts/, but at some op erating p oin tsthe con trolled system b ecomes rather oscillativ e/. It should/, ho w ev er/, be
0 5 10 15 20 25 30 35 40012345
time [h]Nitrate conc. and external carbon flow rateFigure /3/./6/: PID/-con trol with feedforw ard/. The con trolled nitrateconcen tration in the ano xic zone /#28grey line/#29/, the set/-p oin t /#28dashed/#29 andthe corresp onding external carb on /#0Do w rate /#28blac k line/#29 are sho wn/.men tioned that it is p ossible to /#0Cnd a tuning whic hw orks reasonably w ellat all op erating p oin ts in this sim ulation/. In a real pro cess there are/,ho w ev er/, more parameters whic hv ary /, than what ha v e b een c hanged here/.Sev eral tunings ma y hence be necessary when/, for example/, temp eratureand biomass c hange to mak e the PI con troller w ork reasonably w ell/. F or/3/./8 Sim ulations /6/9an adaptiv e con troller this is not necessary /./3/./8/./3 Direct adaptiv e con trolA generalized minim um/-v ariance con troller will no w b e used to con trol theactiv ated sludge pro cess/. The pro cess is not con trolled during the /#0Crst /5hours/. Instead a PRBS con trol signal is used to excite the pro cess to giv ea b etter estimated mo del/. The con troller parameter r/0
is not estimatedit is /#0Cxed/. The forgetting factor is c hosen to /#15 /=/0 /: /9/5 and the p enalt y isc hosen to /#1A /= /2/0/0/0/. The initial parameter is /#12 /#28/0/#29 /= /#5B /, /1 /0 /0 /0 /0 /#5D
Tand initial co v ariance matrix is P /#28/0/#29 /= S /#28/0/#29 S
T/#28/0/#29 /=/9 /0
/2I /, except for theP/#28/1/,/1/#29 elemen t whic h is set to zero to mak e r/0
/#0Cxed/. The con trol signalu is here divided b y /1/0/0/0 /#28the /#0Do w is in the unit m
/3/#2Fh instead of litre/#2Fh/#29b ecause the r/0
parameter will then ha v e ab out the same size as the otherestimated parameters/. The result of the sim ulation with the direct adaptiv e
0 5 10 15 20 25 30 35 40012345
time [h]Nitrate conc. and external carbon flow rateFigure /3/./7/: Direct adaptiv e con trol with feedforw ard/. The con/-trolled nitrate concen tration in the ano xic zone /#28grey line/#29/, the set/-p oin t /#28dashed/#29 and the corresp onding external carb on /#0Do w rate /#28blac kline/#29 are sho wn/./7/0 Con trol of external carb on /#0Do w ratecon troller is illustrated in Figure /3/./7/. F rom the sim ulations it is seen thatthe con troller manages to main tain the nitrate concen tration quite w elldespite the disturbances/./3/./8/./4 Indirect adaptiv e con trolNext/, the indirect adaptiv e con troller presen ted in Section /3/./6 is ev aluated/.In the con troller design the C /-p olynomial is c hosen to C /#28 q
/, /1/#29/= /1 /, /0 /: /9 q
/, /1/,and the t w o p enalties are c hosen to /#1Ae
/= /0 /: /0/5 and /#1Av
/= /0 /: /0/1/. Theforgetting factor is set to /#15 /= /0 /: /9/5/. The initial parameter is /#12 /#28/0/#29 /=/1/0
/, /3/#5B /1 /1 /1 /1 /1 /#5D
Tand initial co v ariance matrix is P /#28/0/#29 /= /3/0
/2I /. Theideas in Section /3/./7 to impro v e the estimation are applied/.In the sim ulation sho wn in Figure /3/./8 it is seen that this t yp e of con/-troller also w orks v ery w ell/.
0 5 10 15 20 25 30 35 40012345
time [h]Nitrate conc. and external carbon flow rateFigure /3/./8/: Indirect adaptiv e con trol with feedforw ard/. The con/-trolled nitrate concen tration in the ano xic zone /#28grey line/#29/, the set/-p oin t /#28dashed/#29 and the corresp onding external carb on /#0Do w rate /#28blac kline/#29 are sho wn/./3/./8 Sim ulations /7/1/3/./8/./5 Mo del/-based adaptiv e PI con trolThis con troller uses ph ysical information of the pro cess whic h reduce then um be r of parameters to be estimated/. The ph ysical kno wledge is usedin the con troller design/. An adv an tage is when a /#0Do w rates/, for example/,are c hanged/, then the con troller parameters are immediately up dated/. Inan adaptiv e /#28blac k/-b o x/#29 con troller it tak es some time b efore the con trollerparameters adapts to the new /#0Do w rates/.In the con troller design the closed lo op p oles are set to a double p olein z /=/0 /: /8/. The forgetting factor is set to /#15 /=/0 /: /9/5/. The initial parameterv ector is set to /#12 /#28/0/#29 /= /#5B /1 /1 /#5D
Tand the initial co v ariance matrix is setto P /#28/0/#29 /=/3 /0
/2I /. The feedforw ard gains are /#0Cxed/, and tuned man ually toKf /1
/= /0 /: /0/5 and Kf /2
/= /0 /: /7/. A sim ulation of the con troller is sho wn inFigure /3/./9/.
0 5 10 15 20 25 30 35 40012345
time [h]Nitrate conc. and external carbon flow rateFigure /3/./9/: Mo del/-based adaptiv eP Ic o n trol with feedforw ard/. Thecon trolled nitrate concen tration in the ano xic zone /#28grey line/#29/, the set/-p oin t /#28dashed line/#29 and the corresp onding external carb on /#0Do w rate/#28blac k line/#29 are sho wn/./7/2 Con trol of external carb on /#0Do w rateR emark /1/: Using the same mo del/, an LQ con troller with feedforw ardcould b e also b e designed/, but this has not b een considered here/.R emark /2/: One idea to main tain the dynamic for the nitrate concen tra/-tion mo del could b e to v ary the sampling rate when the /#0Do w rates c hanges/.F or a system with the follo wing dynamicy /#28 t /+/1 /#29 /= y /#28 t /#29/+
QhV
/#28 u /#28 t /#29 /, y /#28 t /#29/#29the discrete/-time transfer function is constan t/, if the v ariations in Q arecomp ensated with v ariations in the sampling in terv al h /, i/.e/. Qh is k eptconstan t/. A problem with this approac h on the carb on dosage dynamics/,is that a c hange in the sampling rate a/#0Bects man y parameters/. It hence isnot ob vious if this approac h could in tro duce a simpli/#0Ccation/./3/./8/./6 Extended mo del/-based adaptiv e PI con trolThis con troller uses some extensions compared to the mo del/-based adaptiv ePI con trol/, and it w as describ ed in Section /3/./4/./1/.In the con troller design the closed lo op p oles are set to a double p olein z /=/0 /: /8/. The forgetting factor is set to /#15 /=/0 /: /9/5/. The initial parameteris set to /#12 /#28/0/#29 /= /0 /: /1 and the initial co v ariance matrix is set to P /#28/0/#29 /= /3/0
/2/.The feedforw ard gain is /#0Cxed and tuned man ually to Kf /1
/=/0 /: /0/7The p erformance is similar to the mo del/-based adaptiv e PI con troller/,but since this con troller tak e the nonlinearit y of the SS
concen tration in toaccoun t/, the v ariations in the con trol signal b ecomes larger during distur/-bances in the /#0Do w rate/, as seen in Figure /3/./1/0/. The higest p eaks are notsho wn in this /#0Cgure/, but in Figure /3/./1/1 it is sho wn that the maxim umamplitude of the con trol signal is around /1/0 l/#2Fh/.This or the mo del/-based adaptiv e PI con troller has probably the b estp erformance/./3/./8 Sim ulations /7/3
0 5 10 15 20 25 30 35 40012345
time [t]Nitrate concentration and external carbon flow rateFigure /3/./1/0/: Extended mo del/-based adaptiv e PI con trol with feed/-forw ard/. The con trolled nitrate concen tration in the ano xic zone /#28greyline/#29/, the set/-p oin t /#28dashed line/#29 and the corresp onding external car/-bo n /#0D o w rate /#28blac k line/#29 are sho wn/./7/4 Con trol of external carb on /#0Do w rate/3/./8/./7 Illustration of feedforw ardTw o comparisons with and without feedforw ard are sim ulated here/. Inthe /#0Crst comparison the mo del/-based PI con troller with and without feed/-forw ard is studied/. In the second comparison an indirect adaptiv e LQcon troller is studied/.The con trollers use the same initialization as in Section /3/./8/./6 and Section/3/./8/./4/, but measuremen t noise is set to zero to mak e the di/#0Berence b et w eenthe t w o strategies easier to see/. Another di/#0Berence is that the mo del/-basedPI con troller is tuned slo w er/, the closed lo op p oles in /0/./8/5 instead of /0/./8/.In Figure /3/./1/1 a sim ulation with the mo del/-based PI con troller is sho wn/.
0 5 10 15 20 25 30 35 40012
time [t]mg/lNitrate concentration
0 5 10 15 20 25 30 35 400246810
time [t]l/hExternal carbon flow rateFigure /3/./1/1/: Illustration of a con troller with and without feedforw ardfor the mo del/-based PI con troller/. The solid lines corresp ond to thecon troller with feedforw ard/, and the dashed lines to the con trollerwithout feedforw ard/. The set/-p oin t line is dotted/.The con troller rejects/, as exp ected/, the disturbances faster with feedfor/-w ard/. The /#0Do w rate disturbances seem/, ho w ev er/, v ery hard to reject/. De/-spite large v ariations /#28notc hes/#29 in con trol signal/, these disturbances are not/3/./8 Sim ulations /7/5completely rejected/. The con troller is tuned to b e quite slo w/, this explainswh y the con troller error tak es time to eliminate/.A sim ulation with the indirect adaptiv e LQ con troller is sho wn in Figure
0 5 10 15 20 25 30 35 4000.511.52
time [h]mg/lNitrate concentration
0 5 10 15 20 25 30 35 40012345
time [h]lit./hExternal carbon flow rateFigure /3/./1/2/: Illustration of a con troller with and without feedforw ardfor an indirect adaptiv e LQ con troller/. The blac k lines corresp ond tothe con troller without feedforw ard/, and the grey lines to the con trollerwith feedforw ard/. The set/-p oin t line is dashed/./3/./1/2/. This con troller is tuned to be faster than the con troller in Figure/3/./1/1/. F eedforw ard do es not seem to impro v e the p erformance so m uc hhere/. Hence/, if the nitrate sensor is reliable and not noisy /, feedforw ard ma ynot impro v e the con trol in a large exten t/. A reason for this is that c hangesin the nitrate concen tration/, caused b yv ariations in the /#0Do w rates are v erydi/#0Ecult to comp ensate for b y an external carb on source/. If the nitratesensor is less reliable a slo w er con troller/, as in Figure /3/./1/1/, ma y be used/,and then feedforw ard is more useful/./7/6 Con trol of external carb on /#0Do w rate/3/./9 Ev aluation in the pilot plan tThe direct adaptiv e con troller has also b een ev aluated in the pilot plan t/./3/./9/./1 Conditions on the plan tThe line P/1 w as used during the exp erimen t/, whic hw as op erated as a singlesludge system with pre/-denitri/#0Ccation and with ethanol as external carb on
source with a concen tration of /2/2/0/0/0 mg COD/#2Fl/. The in/#0Duen t /#0Do w w as/2/2/0 l/#2Fh and the return sludge /#0Do ww as /2/6/0 l/#2Fh/. In ternal recirculation w as/3/0/0 l/#2Fh/. The excess sludge pump rate w as zero due to lo w mixed liquorsusp ended solids /#28MLSS/#29/. The temp erature w as /1/3/./5
oC and the a v erageMLSS w as /3/2/0/0 mg/#2Fl/./3/./9/./2 The con trollerThe direct adaptiv e con troller w as used/, but without feedforw ard/, sincethe pilot plan t lac ks sensors for measuremen ts of nitrate and TOC/. Thecon troller has the follo wing stucture/:/#01 u /#28 t /#29 /= /#5B/#28 /^ s/0
/+/^ s/1
/#29 yre f
/#28 t /#29 /, /#28/^ s/0
y /#28 t /#29/+ /^ s/1
y /#28 t /, /1/#29/#29/#5D /= /#28 r/0
/+ /#1A/=r/0
/#29 /#28/3/./6/6/#29where /#1A /= /1 and r/0
w as /#0Cxed to r/0
/= /0 /: /1 during the whole exp erimen t/.Hence only s/0
and s/1
w ere estimated/. The con trol signal w as constrainedand giv en b yu /#28 t /#29 /=
/8/#3E/#3C/#3E/:
umin
if u /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 /#3Cuminu /#28 t /#29 if umin
/#3Cu /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 /#3Cumaxumax
if u /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 /#3Eumax
/#28/3/./6/7/#29The parameters w ere estimated b y the algorithm giv en in Section /3/./5/./1with/#12 /= /#5B s/0
s/1
/#5D
T/' /#28 t /#29 /= /#5B yf
/#28 t /#29 yf
/#28 t /, /1/#29/#5D
Twhere yf
/#28 t /#29w a sal o w/-pass /#0Cltered v ersion of y /#28 t /#29 where the lo w/-pass /#0Clter/1 /= Ao
has the p ole in /0/./8/0/. The parameter v ector w as initialized with /#12 /#28/0/#29 /=/#5B/0 /0/#5D
T/, and the co v ariance matrix P /#28/0/#29 /= /1/0 I /. The forgetting factor w as/#15 /=/0 /: /9/5/, and the sampling in terv al w as /2/0 min utes/. The ideas in Section/3/./7 to impro v e the estimation w ere applied/. The carb on /#0Do w rate w as notcon trolled during the /#0Crst /2/0 samples/. Instead the con trol signal w as giv enb y a PRBS in order to ac hiev e go o d initial con trol parameters/./3/./9 Ev aluation in the pilot plan t /7/7/3/./9/./3 ResultsThe exp erimen t with the adaptiv e con troller is presen ted in Figure /3/./1/3/.The di/#0Beren t ev en ts whic h o ccured during the test p erio d /#28/1/8 /#7B /2/6 Jan/1/9/9/6/#29 is describ ed in T able /3/./1/.
012345678902468
time [days][mg/l]Nitrate conc. in anoxic zone and effluent
012345678900.511.522.5
time [days][l/h]Carbon dosageFigure /3/./1/3/: Upp er plot/: Nitrate concen tration in the ano xic zone/#28solid line/#29 and in e/#0Fuen tw ater /#28dotted line/#29/. L ower plot/: The carb on/#0Do w rate/. The carb on source has the conc/. /2/2/0/0/0 mg COD/#2Fl/.Due to a malfunction/, starting around da y /5/, in the real plan t/, the CODconcen tration in the in/#0Duen tw ater to the pilot/-scale plan t increased fromappro ximately /2/0/0 mg COD/#2Fl to /6/0/0 mg COD/#2Fl/. This ma y explain thedecreased carb on /#0Do w rate at the end of the exp erimen t/. This problemma y also ha v e mask ed the e/#0Bect of the c hanges made in the in/#0Do w rate/, seeT able /3/./1/.The con troller p erformed quite w ell despite the rather noisy nitratesensor/, and it also rejected disturbances w ell/. The latter can be seen b ythe b eha vior when the sensor is calibrated /#28the sensor output then go esabruptly do wn/#29/. It is also in teresting to study the v ariations of carb on /#0Do w/7/8 Con trol of external carb on /#0Do w rateTime Ev en t Commen t/0/./3 Cleaning of sensor The con trol exp erimen t is started/. After ashort transien t the nitrate conc/. is k eptclose to the reference v alue /= /2 mg/#2Fl/./1/./5 Calibration The calibration giv es a smalldecrease in the nitrate conc/./1/./5 Changed ref/. v alue The reference v alue is increased from /2to /4 mg/#2Fl/. When the set/-p oin ti s c hanged/,the con troller decreases the carb on /#0Do w rateand the nitrate conc/. quic kly comes closeto the new v alue at the set/-p oin t/./4/./5 Calibration This giv es a decrease in the measured nitrateconc/. whic h the con troller comp ensates for/./5/./5 Increased in/#0Do w from /2/2/0 to /3/0/0 l/#2Fh/, no visible e/#0Bect/6/./5 Decreased in/#0Do w from /3/0/0 to /1/0/0 l/#2Fh/, no visible e/#0Bect/7/./5 Increased in/#0Do w from /1/0/0 to /2/2/0 l/#2Fh/, no visible e/#0BectT able /3/./1/: Ev en ts during the exp erimen tal p erio d/.rate where one can see that a constan t /#0Do w rate w ould not be optimal/.F urther/, it could also b e di/#0Ecult to /#0Cnd a suitable lev el of a constan t/#0D o wrate/./3/./1/0 Conclusions /7/9/3/./1/0 ConclusionsIn this c hapter four di/#0Beren t t yp es of con trollers for the external carb on/#0Do w rate ha v e b een ev aluated b y means of sim ulation studies/. One of thecon trollers w as also tested in a practical exp erimen t/.The ev aluated con trollers w ere a PID/-con troller/, a generalized minim um/-v ariance /#28direct adaptiv e/#29 con troller/, an indirect adaptiv e con troller/, anda mo del/-based PI con troller/. All con trollers used feedforw ard from therecirculated nitrate mass /#0Do w and in/#0Duen t TOC mass /#0Do w/. The con trolstrategy w as based on k eeping the nitrate concen tration in the ano xic zoneat a constan t and lo w lev el/.It can be concluded that all four con trollers ha v e similar p erformancefor con trol of the nitrate concen tration/. An y of them ma y hence b e a usefulto ol for a more p ertinen t con trol of the activ ated sludge pro cess/.Some individual commen ts ab out the con trollers could/, ho w ev er/, begiv en/:/#0F The PID/-con troller ga v e reasonably g ood con trol/. It w as easy toimplemen t but it ma y be di/#0Ecult to tune/. It ma y also giv e poo rcon trol when the pro cess is time/-v arying and ma y then ev en b ecomeunstable/./#0F The direct adaptiv e con troller ga v e reasonably go o d p erformance andadapts w ell to c hanges in the pro cess/./#0F The indirect adaptiv e con troller also ga v e reasonably g ood p erfor/-mance and adapted w ell to c hanges in the pro cess/. The estimatedpro cess mo del can b e b e used for a wide range of con troller designs/.This means that unstable and non/-minim um phase systems are of noparticular problem/. A dra wbac k is that the suggested LQ con trolleris more complex and requires more computations than the other con/-
trollers/./#0F The mo del/-based adaptiv e PI con troller has high con trol p erformance/.It used m uc hp h ysical information ab out the pro cess and few param/-eters needed to be estimated/. By using ph ysical kno wledge of thepro cess in the con troller design/, the con troller could/, for example/,immediately up date the con troller parameters when there is a c hangein a /#0Do w rate/.The adaptiv e con trollers requires a safet y net to w ork prop erly /. The safet y/8/0 Con trol of external carb on /#0Do w ratenet w as describ ed and sim ulations ha v e sho wn that the adaptiv e con trollersw ork w ell/.A practical exp erimen t with the direct adaptiv e con troller has also b eenp erformed/. It sho w ed that the direct adaptiv e con troller managed w ell tocon trol the nitrate concen tration in the ano xic zone/.A p ossible extension could b e to con trol the reference v alue of the nitrateconcen tration in the ano xic zone so that the e/#0Fuen t nitrate could b e k eptat a constan t and lo w lev el/.Chapter /4Estimation of the dissolv edo xygen concen trationdynamicsIn this c hapter metho ds for estimating t w o essen tial parameters whic hc har/-acterize the dissolv ed o xygen concen tration /#28DO/#29 dynamics in an activ atedsludge pro cess are presen ted/. The t w o v ariables are the respiration rateR /#28 t /#29/, and the o xygen transfer function KL
a /. The name o xygen transferfunction is c hosen to stress that it dep ends on sev eral v ariables/. Othercommon names in the literature are e/.g/. o xygen transfer rate and masstransfer co e/#0Ecien t/. Kno wledge of these t w o v ariables are of in terest inb oth pro cess diagnosis/, Olsson and Andrews /#28/1/9/7/8/#29/, and pro cess con trolincluding dissolv ed o xygen con trol/, see/, e/.g/./, Spanjers /#28/1/9/9/3/#29/, Klap wijk etal/. /#28/1/9/9/3/#29/, Spanjers et al/. /#28/1/9/9/6/#29 and Lindb erg and Carlsson /#28/1/9/9/6 d /#29/.The respiration rate is the k ey v ariable that c haracterizes the DO pro/-cess and the asso ciated remo v al and degradation of bio degradable matter/.It is the only true indicator of biologically degradable load/, Holm b erg et al/./#28/1/9/8/9/#29/. If to xic matter en ters the plan t/, for example/, this can b e detectedas a decrease in the respiration rate/, since the microorganisms slo w do wntheir activit y or some of them die/. A rapid decrease in the respiration ratema y hence b e used as a w arning that to xic matter has en tered the plan t andab y/-pass action ma y b e tak en to sa v e the micro organisms/. The respirationrate can also be used for impro v ed DO con trol/, see Chapter /5/. F or morecon trol applications using the respiration rate/, see Spanjers et al/. /#28/1/9/9/6/#29/.The o xygen transfer function KL
a /#28actually it is KL
a /#28 u /#29/#28 yset /, y
/#29/#29 de/-/8/2 Estimation of the DO dynamicsscrib es the rate with whic h o xygen is transferred to the activ ated sludgeb y the aeration system/. The KL
a function can be exp ected to be nonlin/-ear and it dep ends on sev eral factors/. Here/, only its main time/-v aryingdep endence is considered/, namely the air/#0Do w rate/.T o /#0Cnd the respiration rate and the KL
a function one could e/.g/. do batc htests/, use a respirometer /#28the respirometer do not measure KL
a /#29 or applyan estimation algorithm /#28soft w are sensor/#29/. The latter metho d is used here/.The estimation algorithm is based on measuremen ts of the dissolv ed o xygenconcen tration and the air/#0Do w rate whic h are used as inputs to a Kalman/#0Clter/. Sev eral estimation approac hes ha v e b een suggested e/.g/. b y Holm b erg/#28/1/9/8/1/#29/, Ko et al/. /#28/1/9/8/2/#29/, Holm b erg and Olsson /#28/1/9/8/5/#29/, Holm b erg et al/./#28/1/9/8/9/#29/, Bo c k en et al/. /#28/1/9/8/9/#29/, Co ok and Jo witt /#28/1/9/8/5/#29/, Carlsson and Wigren/#28/1/9/9/3/#29/, Carlsson et al/. /#28/1/9/9/4 a /#29 and Luk asse et al/. /#28/1/9/9/6/#29/. Man y of theseapproac hes ha v e used simpli/#0Ced assumptions/. F or example/, the respirationrate is assumed to be time in v arian t/, or the o xygen transfer function is alinear function or a linear trend of the air/#0Do w rate/. In Holm b erg /#28/1/9/9/0/#29it w as argued that a linear trend mo del of KL
a leads to iden ti/#0Cabilit yproblems/. Here a metho d is suggested whic h ma y a v oid these problems/.The simpli/#0Ced assumptions are not used/, and also/, the DO sensor dynamics
is considered/.In the suggested estimation sc heme/, t w o mo dels of the nonlinear KL
afunction are suggested/, an exp onen tial function and a cubic spline function/.F or other p ossible parameterizations of KL
a /, see Lindb erg and Carlsson/#28/1/9/9/3/#29/. Di/#0Beren t mo dels of the time/-v arying respiration rate are studied/.In particular/, a /#0Cltered random w alk mo del is considered/, including t w osp ecial cases/: a random w alk mo del and an in tegrated random w alk mo del/.These cases are obtained b y sp eci/#0Cc c hoices of the /#0Clter p ole in the mo delfor describing the time v ariation/. The KL
a function and the respiration rateare trac k ed b y a Kalman /#0Clter b y using the measuremen ts of air/#0Do w rateand DO/, see also Holm b erg and Olsson /#28/1/9/8/5/#29 and Ljung and S/#7F oderstr/#7F om/#28/1/9/8/3/#29/.When estimating the respiration rate and o xygen transfer function frommeasuremen ts of DO and air/#0Do w rates/, it is necessary that a high excitationin the air/#0Do w rate/, b oth in frequency and amplitude/, is used/. A high excita/-tion of the air/#0Do w rate/, implies rapid c hanges in DO/. If the DO sensor is notfast/, the estimates will b e biased/. A /#0Cltering pro cedure dev elop ed b y Ahl /#13 enand Sternad /#28/1/9/8/9/#29 is applied to reduce the in/#0Duence of the DO sensor dy/-
namics/. The /#0Cltered DO measuremen ts can then b e used for estimating therespiration rate and the o xygen transfer function/. The suggested metho d issuccessfully illustrated b oth in sim ulations and on real data from the pilot/4/./1 The o xygen transfer function /8/3plan t/.F urthermore/, the e/#0Bect of surface activ e agen ts is ev aluated in the pilotplan t/. The suggested estimation approac ht o/#0C n d KL
a and the respirationrate w as applied/. The results sho w that b oth KL
a and the respiration rateare signi/#0Ccan tly decreased b y addition of surfactan ts
/1/.The outline of this c hapter is as follo ws/. The o xygen transfer functionKL
a and the de/#0Cnition of the /#0B and /#0C parameters are discussed in Section/4/./1/. In Section /4/./2 the mo del of the DO dynamics is outlined/, and a discretetime mo del of the DO dynamics is deriv ed/. The estimator whic h is basedon a Kalman /#0Clter is presen ted in Section /4/./3/. Tw o mo dels of the nonlinearKL
a function and three mo dels of the time v arying respiration rate arealso presen ted/. A slo w DO sensor in/#0Duences the estimates of KL
a andrespiration rate/. In Section /4/./4 a /#0Clter is deriv ed whic h comp ensates forthe slo w sensor/. The di/#0Beren t approac hes to mo del KL
a and the respirationrate are ev aluated in a sim ulation study in Section /4/./5/. In Section /4/./6/, thealgorithm is applied to real data from the pilot plan t/. The in/#0Duence ofsurfactan ts on KL
a is studied in Section /4/./7/. Conclusions are giv en inSection /4/./8/./4/./1 The o xygen transfer functionWhen air is blo wn in to the w astew ater of an activ ated sludge pro cess/, o xy/-gen is transferred to the w ater/. The function whic h describ es the o xygentransfer to the w astew ater b y the aeration system is called the KL
a func/-tion/. The most common w a y to describ e the rate of c hange in DO/, due tothat air is blo wn in to w ater/, is b y the follo wing expressiondydt
/= KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 ysat
/#3Ey /#28 t /#29 /#28/4/./1/#29where y /#28 t /#29 is the DO/, ysat
is the saturated DO and u /#28 t /#29 is the air/#0Do w rate/.In /#28/4/./1/#29/, KL
a dep ends only on the air/#0Do w rate u /#28 t /#29/. The o xygen transferfunction in a real plan t dep ends/, ho w ev er/, on sev eral other factors/, forexample/, t yp e of di/#0Busers/, w astew ater comp osition/, temp erature/, design ofaeration tank/, tank depth/, placemen t of di/#0Busers/, etc/, but the main time/-varying dep endence is the air/#0Do w rate/.The o xygen transfer function KL
a can b e considered to consist of t w oparts/, KL
and a /. The KL
part can be seen as an absorption co e/#0Ecien tand the a part as an ar ea/=v ol ume ratio/. The area and v olume are easy to/1Surfactan ts are imp ortan t ingredien ts in e/.g/. mo dern w ashing agen ts/./8/4 Estimation of the DO dynamicsunderstand for an op en tank without aeration devices/. The v olume is thenthe tank v olume and the area is the con tact area be t w een w ater and air/.When using aeration devices/, the area dep ends on the bubble size whic his a/#0Bected b y the aeration device and the air/#0Do w rate/. The con tact timebe t w een the bubbles and the w astew ater is also imp ortan t/. Small bubblesare preferred/, since they rise more slo wly and ha v e hence longer con tacttime/. Man y small bubbles are also b etter than a few large bubbles b ecausethe con tact area with the w astew ater b ecomes larger/. Both KL
and a are/,ho w ev er/, usually unkno wn so they are lump ed in to one parameter denotedKL
a /.When discussing KL
a at least t w o other parameters should be men/-tioned/, the /#0B and /#0C parameters/. They describ e the relation b et w een cleanw ater and w astew ater/, see e/.g/. EP A /#28/1/9/8/9/#29 and Harremo /#7F es et al/. /#28/1/9/9/4/#29/.KL
a for w astew ater is found b ym ultiplying KL
a for clean w ater /#28 KL
aCW
/#29b y the constan t /#0B /, i/.e/. the constan t /#0B is de/#0Cned as/#0B /=
KL
aKL
aCW
/#28/4/./2/#29In a similar w a y /#0C comp ensates for the di/#0Berence in saturated dissolv edo xygen concen tration b et w een w astew ater ysat
and clean w ater ysatC W/#0C /=
ysatysatC W
/#28/4/./3/#29There exist further extensions of /#28/4/./1/#29/, see e/.g/. Harremo /#7F es et al/. /#28/1/9/9/4/#29 andEP A /#28/1/9/8/9/#29/, but these are not considered/. The extensions are also hard tomak e use of since they con tain man y unkno wn parameters/./4/./2 The dissolv ed o xygen dynamicsIn this section the dissolv ed o xygen dynamics will be outlined/. Both acon tin uous/-time mo del and its corresp onding discrete/-time mo del is treated/./4/./2/./1 A con tin uous time mo delIn an activ ated sludge pro cess/, bio degradable matter is degraded b y micro/-organisms whic h consume o xygen/. Studying a completely mixed tank giv esthe follo wing dissolv ed o xygen mass balance/, see e/.g/. Bastin and Do c hain/#28/1/9/9/0/#29dy /#28 t /#29dt
/=
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29 /+ KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 /, R /#28 t /#29 /#28/4/./4/#29where/4/./2 The dissolv ed o xygen dynamics /8/5y /#28 t /#29 is the DO in the zoneyin
/#28 t /#29 is the DO of the input /#0Do wysat
is the saturated v alue of the DOQ /#28 t /#29 is the w astew ater /#0Do w rateV is the v olume of the w astew aterKL
a /#28 u /#29 is the o xygen transfer function/, see also Figure /4/./2u /#28 t /#29 is the air/#0Do w rate in to the zone from the air pro duction systemR /#28 t /#29 is the respiration rateIn general/, it is assumed that y /#28 t /#29/, yin
/#28 t /#29/, u /#28 t /#29 and Q /#28 t /#29 are measured andthat ysat
and V are kno wn constan ts/.Equation /#28/4/./4/#29 describ es the rate of c hange in the dissolv ed o xygenconcen tration/. The /#0Crst term of the righ t hand side in /#28/4/./4/#29 is a pure massbalance/, in/#0Duen t o xygen /#7B e/#0Fuen t o xygen times the dilution rate Q/=V /.The next term/, KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29/, caused b y aeration is the additionof o xygen/, and the last term R /#28 t /#29 describ es the o xygen consumption/. Figure/4/./1 illustrates the DO pro cess/.
Q(t), y(t)
VQ(t), yin(t)
u(t)y(t)Figure /4/./1/: A completely mixed aerated tank/.The respiration rate R /#28 t /#29 dep ends on the biomass concen tration anddescrib es the o xygen consumption b y the micro organisms/. It is usually re/-garded as consisting of t w o terms/, o xygen needed for gro wth and o xygenneeded for main tenance energy /. The respiration rate is time/-v arying/. T yp/-ically /, it has a daily v ariation around a nonzero mean v alue/, but it ma yc hange abruptly due to disturbances/. The o xygen transfer function KL
a isassumed to dep end nonlinearly on the air/#0Do w rate/. At ypical KL
a functionis sho wn in Figure /4/./2/. Note that the slop e of KL
a /#28the gain/#29 c hanges whenthe air/#0Do w rate c hanges/./8/6 Estimation of the DO dynamics
0123456
020406080100120140160180 200
Airflow rate [m^3/h]KLa [1/h]Figure /4/./2/: T ypical shap e of the o xygen transfer function /#28 KL
a /#28 u /#29/#29as a function of the air/#0Do w rate /#28 u /#29/./4/./2/./2 A discrete/-time mo delThere exist sev eral w a ys to obtain a discrete/-time mo del from a con tin uous/-time mo del lik e /#28/4/./4/#29/. One w a y is to use zero/-order/-hold sampling/. Thisalternativ e is used here/. Zero/-order/-hold sampling assumes that all signalsexcept y /#28 t /#29 are constan t during the sampling in terv al/. When that is truethe discrete/-time mo del describ es exactly the con tin uous/-time mo del at thesampling instan ts/. This appro ximation is reasonable for su/#0Ecien tly fastsampling/.Zero/-order/-hold sampling of the DO dynamics has previously b een madeb y Holm b erg /#28/1/9/9/0/#29 and Co ok and Jo witt /#28/1/9/8/5/#29/. F or completeness/, thederiv ation is rep eated here/. Rewrite /#28/4/./4/#29 tody /#28 t /#29dt
/= A /#28 t /#29 y /#28 t /#29/+ B /#28 t /#29 /#28/4/./5/#29whereA /#28 t /#29 /= /, /#28 KL
a /#28 u /#28 t /#29/#29 /+
Q /#28 t /#29V
/#29/4/./3 The estimator /8/7B /#28 t /#29 /= /, R /#28 t /#29/+
Q /#28 t /#29V
yin
/#28 t /#29/+ KL
a /#28 u /#28 t /#29/#29 ysatAssuming that A /#28 t /#29 and B /#28 t /#29 are constan t within eac h sampling p erio d/,mo del /#28/4/./5/#29 is sampled b y using theory in/, for example/,
/#17Astr/#7F om and Wit/-tenmark /#28/1/9/9/0/#29 whic h giv esy /#28 kh /+ h /#29/#29 /= e
A /#28 kh /#29 hy /#28 kh /#29/+
B /#28 kh /#29A /#28 kh /#29
/#28 e
A /#28 kh /#29 h/, /1/#29 /#28/4/./6/#29where h is the sampling in terv al and k is the discrete time/. No w seth
/#03/=
/1A /#28 kh /#29
/#28 e
A /#28 kh /#29 h/, /1/#29 /#28/4/./7/#29and the sampled mo del b ecomesy /#28 kh /+ h /#29/#29 /, y /#28 kh /#29h
/#03
/= A /#28 kh /#29 y /#28 kh /#29/+ B /#28 kh /#29 /#28/4/./8/#29In the follo wing w e will for notational simplicit y replace kh with t /. Thisgiv es together with A and B inserted in /#28/4/./8/#29y /#28 t /+/1 /#29 /= y /#28 t /#29/+ h
/#03/#5B
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29 /+ KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 /, R /#28 t /#29/#5D /+ w /#28 t /#29/#28/4/./9/#29In /#28/4/./9/#29/, a term w /#28 t /#29 has b een added to describ e measuremen t noise andmo del mis/#0Ct/./4/./3 The estimatorWhat mak es it non trivial to iden tify the dissolv ed o xygen dynamics is that/#0F The respiration rate R /#28 t /#29 is time/-v arying/./#0F The o xygen transfer function KL
a is nonlinear/./#0F The absolute lev els of the respiration rate and KL
a are hard touniquely determine/./#0F The DO sensor ma yh a v e a signi/#0Ccan t dynamics/.A p ossible remedy to the ab o v e problems is/#0F Use a Kalman /#0Clter approac h to trac k the time/-v arying respirationrate/./8/8 Estimation of the DO dynamics/#0F Use the three follo wing assumptions regarding the KL
a function/:A/1 The o xygen transfer function KL
a can be su/#0Ecien tly w ell de/-scrib ed b y a static nonlinearit y of the air/#0Do w rate u /#28 t /#29/.A/2 The parameters in the KL
a mo del c hange slo wly in comparisonwith the respiration rate/.A/3 The o xygen transfer function is zero when the air/#0Do w rate is zero/,i/.e/. KL
a /#28/0/#29 /= /0 /, see Carlsson and Wigren /#28/1/9/9/3/#29 and Carlssonet al/. /#28/1/9/9/4 a /#29/./#0F Pre/-/#0Cltering ma y reduce the in/#0Duence of the DO sensor dynamics/, seeSection /4/./4/.Assumption A/1 is reasonable in cases where not very fast sampling is usedso that the dynamics of the air pip es etc/. can be neglected/. AssumptionA/2 ma y not b e v alid for all w astew ater plan ts but preliminary exp erimen tsfrom the m unicipal treatmen t plan t in Uppsala do not indicate an y fastc hanges in the KL
a parameters apart from c hanges due to v ariations inthe air/#0Do w rate/. A more detailed ev aluation of this p oin t is/, ho w ev er/, anin teresting topic for further in v estigations/. Assumption A/3 holds if theo xygen transfer function from the surrounding air is neglected/. This is areasonable appro ximation if KL
a is small for zero air/#0Do w rate as comparedto the a v erage air/#0Do w rates/. Assumption A/3 means that a /#5Cbias free/" mo delstructure can b e used whic h impro v es the accuracy of the estimates/.R emark/: Instead of estimating the respiration rate/, other metho ds ma yb e used/. F or example/, the respiration rate can b e measured b y a respirom/-eter/, see e/.g/. Spanjers /#28/1/9/9/3/#29/. In a respirometer/, w ater from the activ atedsludge pro cess is pump ed in to a v essel/, where the deca y in o xygen con/-cen tration is used to determine the respiration rate/. An o/#0B/-gas metho d isanother alternativ e to measure the respiration rate/. It is based on mea/-suremen ts of O/2
/, the air/#0Do w rate/, and CO/2
in the exhaust air/. A problemwith this metho d is to collect all the exhaust air/. A third alternativ e toobtain the respiration rate/, is to switc h the aeration on and o/#0B/, see Ryc k/-aert et al/. /#28/1/9/9/5/#29/. When the aeration is switc hed o/#0B/, the deca y in o xygenconcen tration is used to estimate the respiration rate/. When the aerationis switc hed on again a /#0Cxed v alue of KL
a ma y b e estimated/./4/./3/./1 Di/#0Beren t mo dels of the nonlinear KL
a functionThat KL
a not is linear has b een discussed in e/.g/. Bennett /#28/1/9/8/0/#29 whopresen ts v arious ph ysical mo dels of KL
a /, Holm b erg /#28/1/9/8/1/#29 and Holm b erg/4/./3 The estimator /8/9/#28/1/9/9/0/#29 appro ximate KL
a with a linear trend mo del/, Holm b erg et al/. /#28/1/9/8/9/#29used a linear mo del/, but concluded that KL
a /= /#0B
pu could be a b etterappro ximation/. Similarly Luk asse et al/. /#28/1/9/9/6/#29 used the follo wing KL
amo del KL
a /= /#0Bu /+ /#0C
pu /+ /#0D /. In Lindb erg and Carlsson /#28/1/9/9/3/#29 sev eraldi/#0Beren t KL
a mo dels ha v e b een ev aluated/, for example/, piece wise linearmo dels/, p olynomial/, exp onen tial and spline mo dels/.T o mak e it p ossible to use a nonlinear KL
a in the Kalman /#0Clter/, it hasto be parameterized/. In this section t w o di/#0Beren t nonlinear mo dels of theKL
a function and their parameterization are presen ted/.An exp onen tial mo del of KL
aAn exp onen tial KL
a mo del ma y b e a suitable c hoice/, b ecause it can b e giv ena similar shap e of the KL
a function as in Figure /4/./2/, whic h is natural in aph ysical sense /#28the o xygen transfer deteriorates for high air/#0Do ws/#29/. F urther/,only t w o parameters are necessary to estimate/, and it is also easy to in v ertthis KL
a function/. In v erting is useful in design of a nonlinear con troller/.The exp onen tial KL
a mo del isKL
a /#28 u /#28 t /#29/#29 /= k/1
/#28/1 /, e
/, k/2
u /#28 t /#29/#29 /#28/4/./1/0/#29The gradien to ft h e KL
a mo del/, whic h is needed in the estimation algorithmin Section /4/./3/./4/, is found b y taking the partial deriv ativ e of KL
a withresp ect to the unkno wn parameter v ector /#12KL
a
/=/#5B k/1
k/2
/#5D
T/#20
TKL
a
/#28 t/; /#12KL
a
/#29/=
/@KL
a/@/#12KL
a
/#28/4/./1/1/#29The gradien t can b e appro ximated b y/#20
TKL
a
/#28 t/; /#12 /#29/=/#5B/1 /, e
/,
/^k/2
u /#28 t /#29/^k/1
u /#28 t /#29 e
/,
/^k/2
u /#28 t /#29/#5D /#28/4/./1/2/#29where
/^k/1
and
/^k/2
are the estimated v alues of k/1
and k/2
/, this common ap/-proac h when the true v alues not are kno wn/, see also Ljung and S/#7F oderstr/#7F om/#28/1/9/8/3/#29/.A cubic spline mo del of KL
aAn alternativ e to the exp onen tial mo del or the piecewise linear appro xima/-tion in Carlsson and Wigren /#28/1/9/9/3/#29 and Carlsson et al/. /#28/1/9/9/4 a /#29/, is a cubicspline/. Suc h a mo del ma y giv e a go o d appro ximation of the nonlinear KL
afunction/. It has an inheren t smo othness whic h is natural from a ph ysical/9/0 Estimation of the DO dynamics
uu u1 2 3u13
2
xxx12 3L
u0K  a
θ
θ
θFigure /4/./3/: A spline appro ximation of KL
a /.p oin t of view/. In Figure /4/./3 a cubic spline is sho wn/, together with some ofthe parameter de/#0Cnitions/.F rom Dahlquist et al/. /#28/1/9/7/4/#29 it follo ws that a cubic spline p olynomialcan b e written in the follo wing form where u is in the in terv al ui /, /1
/#14 u/#3C uiKL
a /#28 u /#29i
/= mi
/#12i
/+/#28 /1 /, mi
/#29 /#12i /, /1/+ xi
mi
/#28/1 /, mi
/#29/#5B/#28 ki /, /1
/, di
/#29/#28/1 /, mi
/#29 /, /#28 ki
/, di
/#29 mi
/#5D /#28/4/./1/3/#29where /#12i
is de/#0Cned in Figure /4/./3 andxi
/= ui
/, ui /, /1di
/=
/#12i
/, /#12i /, /1ximi
/=
u /, ui /, /1xi
/; u /2 /#5B ui /, /1
/;ui
/#5Di /= /1 /; /2 /;/:/:/: /;n n /=n um be r o f grid p oin ts /, /1The v ariables k/0
/;k/1
/; /:/:/:/; kn
are the deriv ativ es of the spline in the grid p oin ts/.Note that KL
a /#28 ui
/#29i
/= /#12i
/.The linear regression form for the spline mo del isKL
a /#28 u /#28 t /#29/#29 /= /#20
TKL
a
/#28 t /#29 /#12KL
a
/#28/4/./1/4/#29/#12KL
a
/= /#5B /#12/0
/:/:/: /#12n
/#5D
T/#28/4/./1/5/#29The deriv ation and de/#0Cnition of /#20
TKL
a
/#28 t /#29 is giv en in App endix C/./4/./3 The estimator /9/1Note that /#12/0
should not b e estimated since w e assumed in assumptionA/3 that KL
a /#28/0/#29 /= /0/. It is/, ho w ev er/, included here for generalit y /. Thisimplies in the algorithm that /#12/0
is set to /0 and the term whic h corresp ondsto /#12/0
in the co v ariance matrix /#28/4/./3/5/#29 is set to zero/./4/./3/./2 Mo deling the time/-v arying respiration rateHere some approac hes for mo deling the respiration rate are suggested/. Arandom w alk mo del/, a /#0Cltered random w alk mo del and an in tegrated ran/-dom w alk mo del are considered/.A random w alk mo del is giv en b yR /#28 t /#29/=
/1/1 /, q
/, /1
erw
/#28 t /#29 /#28/4/./1/6/#29where erw
/#28 t /#29 is zero mean white noise/.An /#0Cltered random w alk mo del is giv en b yR /#28 t /#29/=
/1/#28/1 /, fq
/, /1/#29/#28/1 /, q
/, /1/#29
erw
/#28 t /#29 /#28/4/./1/7/#29where f is the /#0Clter p ole/. As a sp ecial case/, the random w alk mo del is ob/-tained b y setting f /= /0/, and as another sp ecial case the in tegrated randomw alk mo del is found b y setting f /=/1 /.Equation /#28/4/./1/7/#29 can b e rewritten asR /#28 t /#29 /= /#28/1 /+ f /#29 R /#28 t /, /1/#29 /, fR /#28 t /, /2/#29 /+ erw
/#28 t /#29 /#28/4/./1/8/#29and then in to a state space form/, whic h is useful in the Kalman /#0Clter/.Z /#28 t /+/1 /#29 /= AZ /#28 t /#29/+ Berw
/#28 t /#29 /#28/4/./1/9/#29R /#28 t /#29 /= CZ /#28 t /#29 /#28/4/./2/0/#29whereZ /#28 t /#29 /=
/"R /#28 t /#29R /#28 t /, /1/#29
/#23A /=
/"/1/+ f /, f/1 /0
/#23/#28/4/./2/1/#29B /=
/"/1/0
/#23C /=/#5B /1 /0 /#5D /#28/4/./2/2/#29The random w alk mo del /#28/4/./1/6/#29 can also b e written in the state space form/#28/4/./1/9/#29 and /#28/4/./2/0/#29 withA /= B /= C /=/1 /#28/4/./2/3/#29/9/2 Estimation of the DO dynamicsA /#0Cltered random w alk mo del giv es g ood trac king of the respiration rate/,b etter than/, for example/, a random w alk mo del/, see also Lindb om /#28/1/9/9/5/#29and Ljung and Gunnarsson /#28/1/9/9/0/#29 for a treatmen t of general trac king prob/-lems/. Note that bad trac king of the respiration rate also deteriorates theestimated KL
a function/./4/./3/./3 Putting the mo dels togetherIn Section /4/./3/./1/, t w o di/#0Beren t KL
a mo dels w ere giv en and in Section /4/./3/./2three respiration rate mo dels w ere presen ted/. These mo dels are no w puttogether in to one mo del whic h will be used in a Kalman /#0Clter in Section/4/./3/./4/.If the KL
a function v aries in time/, it ma y also be suitable to describ eits v ariations b y a random w alk mo del/#12KL
a
/#28 t /#29/= /#12KL
a
/#28 t /, /1/#29 /+ eKL
a
/#28 t /#29 /#28/4/./2/4/#29where eKL
a
is zero mean white noise/. Normally /, when KL
a is assumed timein v arian t/, eKL
a
/=/0 /. The respiration rate is mo deled b y /#28/4/./1/9/#29 and /#28/4/./2/0/#29/.Collecting all parameters in one v ector giv es/#12 /=
/"/#12KL
aZ
/#23/#28/4/./2/5/#29/#12 /#28 t /+/1 /#29 /= F/#12 /#28 t /#29/+ e/#12
/#28 t /#29 /#28/4/./2/6/#29whereF /=
/"I /0/0 A
/#23e/#12
/#28 t /#29/=
/"eKL
a
/#28 t /#29Berw
/#28 t /#29
/#23/#28/4/./2/7/#29and I is the iden tit y matrix/.Deriv ation of the regressorSince the exp onen tial KL
a mo del is not linear in its parameters/, the regres/-sor /#20
TKL
a
is deriv ed from the gradien t of the prediction error/, as/#20
T/#28 t/; /#12 /#29/= /,
/#12/@/" /#28 t/; /#12 /#29/@/#12
/#13/#28/4/./2/8/#29where the prediction error /" /#28 t/; /#12 /#29 is determined b y/" /#28 t /#29/= y /#28 t /#29 /, /^ y /#28 t j t /, /1/#29 /#28/4/./2/9/#29/4/./3 The estimator /9/3Inserting the predictor /^ y /#28 t j t /, /1/#29/, whic h is based on equation /#28/4/./9/#29 giv es/" /#28 t /#29 /= y /#28 t /#29 /,
/#20y /#28 t /, /1/#29 /+ h
/#03/#5B
Q /#28 t /, /1/#29V
/#28 yin
/#28 t /, /1/#29 /, y /#28 t /, /1/#29/#29/+
dKL
a /#28 u /#28 t /, /1/#29/#29/#28 ysat
/, y /#28 t /, /1/#29/#29 /,
/^R /#28 t /, /1/#29/#5D
/!/#28/4/./3/0/#29Applying /#28/4/./2/8/#29 with the prediction error in /#28/4/./3/0/#29 giv es/#20
T/#28 t/; /#12 /#29/=h
/#03/#5B/#28 ysat
/, y /#28 t /#29/#29
/@
dKL
a/@/#12
/,
/@
/^R/@/#12
/#5D /#28/4/./3/1/#29whic h can b e written as/#20
T/#28 t/; /#12 /#29/=
h
/#03/#5B/#28 ysat
/, y /#28 t /#29/#29 /#20
TKL
a
/#28 t /#29 /, C/#5D /#28/4/./3/2/#29where /#20
TKL
a
is giv en b y /#28/4/./1/1/#29 for the exp onen tial mo del and /#28C/./2/1/#29 for thespline mo del/. The C /-v ector is either giv en b y /#28/4/./2/2/#29 or /#28/4/./2/3/#29 dep endingon the mo del of the respiration rate/./4/./3/./4 The Kalman /#0ClterA Kalman /#0Clter in terpretation is used to estimate the time/-v arying respi/-ration rate and the nonlinear o xygen transfer function/. This approac h usesmeasuremen ts of DO and air/#0Do w rate to estimate the o xygen transfer func/-tion KL
a and the respiration rate b y a Kalman /#0Clter/. A sc hematic /#0Cgureof the estimator is sho wn in Figure /4/./4/./'/&
/$/#25
Kalman /#0Clter/" /#28 t /#29/= y /#28 t /#29 /,
by /#28 t /#29/^/#12 /#28 t /#29/= F
/^/#12 /#28 t /, /1/#29 /+ K /#28 t /#29 /" /#28 t /#29
/-
y /#28 t /#29/-
u /#28 t /#29
/-
dKL
a /#28 u /#29/-
/^R /#28 t /#29Figure /4/./4/: The estimator where KL
a and R /#28 t /#29 are estimated frommeasuremen ts of DO and air/#0Do w rate/, see also Carlsson et al/. /#28/1/9/9/4 a /#29/.The Kalman /#0Clter equations can/, for example/, be found in Ljung andS/#7F oderstr/#7F om /#28/1/9/8/3/#29/. These equations together with the parameter mo delingfrom Section /4/./3/./3 giv e/^/#12 /#28 t /#29 /= F
/^/#12 /#28 t /, /1/#29 /+ K /#28 t /#29 /" /#28 t /#29 /#28/4/./3/3/#29/9/4 Estimation of the DO dynamicsK /#28 t /#29 /=
FP /#28 t /, /1/#29 /#20 /#28 t /#29r/2
/+ /#20
T/#28 t /#29 P /#28 t /, /1/#29 /#20 /#28 t /#29
/#28/4/./3/4/#29P /#28 t /#29 /= FP /#28 t /, /1/#29 F
T/,
FP /#28 t /, /1/#29 /#20 /#28 t /#29 /#20
T/#28 t /#29 P /#28 t /, /1/#29 F
Tr/2
/+ /#20
T/#28 t /#29 P /#28 t /, /1/#29 /#20 /#28 t /#29
/+ R/1
/#28/4/./3/5/#29where /" /#28 t /#29 is de/#0Cned in /#28/4/./2/9/#29/, /#12 in /#28/4/./2/5/#29/, /#20 /#28 t /#29 in /#28/4/./3/2/#29/, and the c hoice ofR/1
in /#28/4/./3/7/#29 for a random w alk and /#28/4/./3/8/#29 for a /#0Cltered random w alk/, andr/2
/=/1 /.In the predictor/, the parameters y /#28 t /#29/, yin
/#28 t /#29/, u /#28 t /#29 and Q /#28 t /#29 are mea/-sured/, V and ysat
are assumed kno wn and R /#28 t /#29 and /#12KL
a
are estimated/.The parameter h
/#03is deriv ed according to /#28/4/./7/#29 with an estimated v alue ofKL
a /#28 u /#29/.Choice of R/1
and r/2The co v ariance matrix R/1
is giv en b yR/1
/=E e/#12
/#28 t /#29 e/#12
/#28 t /#29
T/=
/"E e
/2KL
a
/0/0 BB
TE e
/2rw
/#23/#28/4/./3/6/#29and describ es ho w fast the di/#0Beren t comp onen ts in /#12 are exp ected to v ary /.Usually E e
/2KL
a
and E e
/2rw
are not kno wn/. The v ariance of the measuremen tnoise w /#28 t /#29 is denoted b y r/2
/. It is p ossible to rewrite /#28/4/./3/5/#29 so that R/1
isreplaced b y R/1
/=r/2
and r/2
b y/1 /. Then only R/1
is used as a design parameter/.This is reasonable/, since in most cases neither R/1
nor r/2
are kno wn/.Setting R/1
/=/0 implies no trac king capabilit y /, since K /#28 t /#29 then go es tozero when t /! /1 /. Hence to be able to trac k time/-v arying parameters itis necessary to set R/1
/#3E /0/. The magnitude of R/1
should re/#0Dect the truev ariations of the time v arying parameters and has in general to be triedout/.In the dissolv ed o xygen dynamics/, the respiration rate is time/-v aryingand the KL
a function is assumed to be a v ery slo wly c hanging /#28or time/-in v arian t/#29 nonlinearit y of the air/#0Do w rate/. The co v ariance matrix R/1
thenb ecomesR/1
/=
/2/6/4
/#0D/1
/0 /0/0 /#0D/1
/0/0 /0 /#0D/2
/3/7/5
/#28/4/./3/7/#29/4/./3 The estimator /9/5for the random w alk case/, andR/1
/=
/2/6/6/6/4
/#0D/1
/0 /0 /0/0 /#0D/1
/0 /0/0 /0 /#0D/2
/0/0 /0 /0 /0
/3/7/7/7/5
/#28/4/./3/8/#29for the /#0Cltered random w alk case/. The parameter /#0D/1
should be a smalln um b er whic h re/#0Dects the slo wv ariation in the KL
a parameters/. The m uc hfaster v ariation in the respiration rate is re/#0Dected in a larger /#0D/2
/. The c hoiceof /#0D/2
also dep ends on the /#0Clter p ole in the /#0Cltered random w alk mo del/. Thecloser f is to /1/, the smaller /#0D/2
should b e selected/.The co v ariance matrix R/1
should ha v e appropriate v alues/. A to o smallv alue of /#0D/2
ma y giv e /#28a larger/#29 bias in the estimate/, since the Kalman /#0Clterwill not be able to the follo w the v ariations in the true respiration rate/.On the other hand/, a to o large v alue of /#0D/2
results in unnecessary largev ariations /#28due to measuremen t noise/#29 of the estimated respiration rate/.R emark /1/: In /#28/4/./3/7/#29 and /#28/4/./3/8/#29 only t w o KL
a parameters are assumedto be estimated/. The size of R/1
has to be c hanged if another n um be r ofparameters are estimated/.R emark /2/: If KL
a is assumed to be non time/-v arying/, the estimationpro cedure can be divided in to t w o steps/. In the /#0Crst step KL
a and therespiration rate are estimated during high excitation of the air/#0Do w rate/. Inthe second step/, whic h o ccurs when the estimated parameters in the KL
afunction has settled/, the high excitation of the air/#0Do w rate can b e switc hedo/#0B/. Normal op eration of the DO can then again b e applied/. The respirationrate is then estimated b y setting all elemen ts in the co v ariance matrix /#28 P /#29to zero/, except for the elemen ts whic h are only related to the respirationrate/, see Carlsson /#28/1/9/9/3/#29Choice of initial v alues to the Kalman /#0ClterThe Kalman /#0Clter needs initial v alues of
/^/#12 /#28/0/#29 and P /#28/0/#29/. The c hoice of P /#28/0/#29should re/#0Dect the uncertain t y in the a priori guess of
/^/#12 /#28/0/#29/. The relev an tc hoice is/, see Ljung and S/#7F oderstr/#7F om /#28/1/9/8/3/#29/,P /#28/0/#29 /=
co v/#28
/^/#12 /#28/0/#29/#29E jj /' /#28 t /#29 jj
/2
/#28/4/./3/9/#29Often only a crude guess ab out co v/#28
/^/#12 /#28/0/#29/#29 is a v ailable/. A t ypical c hoice isthen to set/^/#12
T/#28/0/#29 /= /#5B/0 /:/:/: /0/#5D and P /#28/0/#29 /= /#1B
/2I /#28/4/./4/0/#29/9/6 Estimation of the DO dynamicswhere I is the iden tit y matrix/, and /#1B
/2should b e c hosen large/.R emark/: A very imp ortan t practical issue when using an y kind of re/-cursiv e algorithm is the initialization/. If one uses a large /#1B at t /= /0 and theregressor is /#0Clled with zeros/, it is v ery lik ely that the parameters tak e somelarge steps in a wrong direction whic h they often nev er reco v er from/. Aremedy is to w ait with the up dating un til the regressor is /#0Clled with data/./4/./3/./5 An alternativ e approac h of estimating KL
aA p ossible alternativ e approac h to the Kalman /#0Clter approac h discussedab o v e is to /#0Crst di/#0Beren tiate the mo del and treat the di/#0Beren tiated res/-piration rate as white noise/. Di/#0Beren tiating is a w ell kno wn metho d insystem iden ti/#0Ccation to be applied to systems with non/-zero means/, see/,e/.g/./, S/#7F oderstr/#7F om and Stoica /#28/1/9/8/9/#29/.Since the di/#0Beren tiated respiration rate is treated as a white noise/, few erparameters ha v e to be estimated than in the previously men tioned ap/-proac hes where the respiration rate also w as estimated/. Estimating few erparameters usually implies higher accuracy of the remaining parameters/.The v alue of the respiration rate is not lost b y the use of this approac h/, itcan still b e determined b y using equation /#28/4/./9/#29 together with the estimatedKL
a /.Using /#28/4/./9/#29 /#28neglecting the noise w /#28 t /#29/#29 and calculating y /#28 t /+/1 /#29 /, y /#28 t /#29giv esy /#28 t /+/1 /#29 /, y /#28 t /#29/= y /#28 t /#29 /, y /#28 t /, /1/#29 /+ h
/#03/#5B
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29/,
Q /#28 t /, /1/#29V
/#28 yin
/#28 t /, /1/#29 /, y /#28 t /, /1/#29/#29 /+ KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29/, KL
a /#28 u /#28 t /, /1/#29/#29/#28 ysat
/, y /#28 t /, /1/#29/#29 /, /#28 R /#28 t /#29 /, R /#28 t /, /1/#29/#29/#5D /#28/4/./4/1/#29Assuming that the respiration rate can b e mo deled b yR /#28 t /#29/=
/1/1 /, q
/, /1
erw
/#28 t /#29 /#28/4/./4/2/#29where the noise erw
is assumed to b e zero mean white noise/, giv esR /#28 t /#29 /, R /#28 t /, /1/#29 /= erw
/#28 t /#29 /#28/4/./4/3/#29Inserting /#28/4/./4/3/#29 in /#28/4/./4/1/#29 giv es the predictor/^ y /#28 t /+/1 j t /#29 /= /2 y /#28 t /#29 /, y /#28 t /, /1/#29 /+ h
/#03/#5B
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29/4/./4 Estimation utilizing a slo w DO sensor /9/7/,
Q /#28 t /, /1/#29V
/#28 yin
/#28 t /, /1/#29 /, y /#28 t /, /1/#29/#29 /+ KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /, /1/#29/#29/, KL
a /#28 u /#28 t /, /1/#29/#29/#28 ysat
/, y /#28 t /, /1/#29/#29/#5D /#28/4/./4/4/#29The gradien t of /#28/4/./4/4/#29 b ecomes/#20
T/#28 t /#29/= h /#5B/#28 ysat
/, y /#28 t /, /1/#29/#29 /#20
TKL
a
/#28 t /, /1/#29 /, /#28 ysat
/, y /#28 t /, /2/#29/#29 /#20
TKL
a
/#28 t /, /2/#29/#5D /#28/4/./4/5/#29where /#20
TKL
a
/#28 t /#29 is de/#0Cned in /#28/4/./1/1/#29/. Note that this predictor is di/#0Beren ta scompared to the previous one/.This metho d w orks v ery w ell when no measuremen t noise exists/, ev enb etter than the other metho ds/. Its p erformance deteriorates/, ho w ev er/,fast /#28faster than it do es for the other metho ds/#29 when measuremen t noiseis added/. A p ossible explaination could be that di/#0Beren tiation ampli/#0Cesnoise/./4/./4 Estimation utilizing a slo w DO sensorWhen estimating the respiration rate and o xygen transfer function frommeasuremen ts of DO and air/#0Do w rates/, it is necessary that a high excitationin the air/#0Do w rate is used/. A high excitation in air/#0Do w rate implies rapidc hanges in DO/. If the DO sensor is not fast/, the estimates will b e biased/. Inthis section a /#0Cltering pro cedure/, dev elop ed b y Ahl /#13 en and Sternad /#28/1/9/8/9/#29/,is applied to reduce the in/#0Duence of the DO sensor dynamics/. The /#0ClteredDO measuremen ts are then used for estimating the respiration rate and theo xygen transfer function/./4/./4/./1 Simple illustration of the problemAssume for simplicit y that Q /#28 t /#29 /= u /#28 t /#29 /= /0/. Inserting this in /#28/4/./4/#29 giv esthe respiration rateR /#28 t /#29/= /,
dydt
/#28/4/./4/6/#29The respiration rate can hence be estimated from the slop e of the sensoroutput/. If the DO sensor is slo w/, ho w will then the estimated respira/-tion rate be a/#0Bected/, when using /#28/4/./4/6/#29/? An example will illustrate thisquestion/.Let the DO sensor ha v e a step resp onse as sho wn in Figure /4/./5/. Thetrue DO is c hanged from zero to one mg/#2Fl at time t /=/0 /.If the DO is /2 mg/#2Fl at t /= /0/, applying the respiration rate in the lo w erplot of Figure /4/./6 then giv es the DO sho wn in the upp er plot in the same/9/8 Estimation of the DO dynamics
02040608010012014016018020000.20.40.60.81
time [s]mg/lStep response of a DO sensorFigure /4/./5/: Step resp onse of a DO sensor/./#0Cgure/. W e can see that DO sensor output is slo w er than the true DO/. Usingthe deriv ativ e of the sensor output as an estimate of the respiration rate willhence not giv e a correct estimate/. It tak es time b efore a reliable estimate ofthe respiration rate is ac hiev ed/. If there is a step c hange in the respirationrate/, the settling/-time to obtain a correct estimate will then b e as long asthe settling/-time for the DO sensor/. The estimate of the respiration rate is/#0Cltered b y the sensor dynamics/.When the air/#0Do w rate is highly excited/, whic h it should b e to giv e g oodestimates of the respiration rate and KL
a /, the DO sensor output will notfollo w the true DO and the estimates will b e biased/./4/./4/./2 Filtering the DO measuremen tsAssume that the DO is measured b y a sensor/. Ob viously /, what is a v ailablefor data pro cessing is the output from the sensor /#28denoted ys
/#28 t /#29 b elo w/#29/.By /#0Cltering the DO measuremen ts it is p ossible to reduce in/#0Duence of thesensor dynamics/. This is utilized b y using a /#0Cxed lag smo other/. A blo c kdiagram of the sensor/, the input mo del and the /#0Clter is sho wn in Figure/4/./7/.W ew ould lik e to /#0Cnd a /#0Clter/, whic h based on the measuremen ts of thesensor output /#28 ys
/#28 t /#29/#29 giv es the actual DO in the activ ated sludge pro cess/.The problem is to /#0Cnd a /#0Clter whic h minimizes the mean square errorbe t w een the true DO and the /#0Cltered DO/, i/.e/. w ew an t to minimizeE/#28 y /#28 t /#29 /, /^ y /#28 t j t /, m /#29/#29
/2/#28/4/./4/7/#29where /^ y /#28 t j t /, m /#29 denotes a prediction of y /#28 t /#29 based on data up to timet /, m /. The user c hoice m determines whether w eh a v e a predictor /#28 m/#3E /0/#29/,/4/./4 Estimation utilizing a slo w DO sensor /9/9
0 50 100 150 200 250 3001.41.61.82True and measured DO
time [s]mg/l
0 50 100 150 200 250 3000246810True and estimated respiration rate
time [s]mg/l/hFigure /4/./6/: Upp er plot/: T rue /#28dashed/#29 and measured DO /#28solid/#29/.Lo w er plot/: T rue /#28dashed/#29 and estimated respiration rate /#28solid/#29/./#0Clter /#28 m /= /0/#29/, or smo other /#28 m/#3C /0/#29/. It is advisable to use m/#3C /0 since itgiv es a smaller error /#28 y /#28 t /#29 /, /^ y /#28 t j t /, m /#29/#29/. The more negativ e m is c hosen/, thesmaller the error will b e/. No signi/#0Ccan t impro v emen ts is/, ho w ev er/, foundafter some v alue of m /. Note that c ho osing m/#3C /0 giv es a dela yb e t w een theactual DO and the /#0Cltered DO/.F or an optimal solution of the /#0Clter/, a sensor mo del and an input mo delis required/. A simple input mo del whic h generates a drifting signal isy /#28 t /#29/=
/1/#01/#28 q
/, /1/#29
e /#28 t /#29 /#28/4/./4/8/#29where e /#28 t /#29 is zero mean white noise/, and /#01/#28 q
/, /1/#29/= /1 /, q
/, /1is a p olynomialin the bac kw ard shift op erator q
/, /1/.The sensor is mo deled b yys
/#28 t /#29/= q
/, k
B /#28 q
/, /1/#29A /#28 q
/, /1/#29
y /#28 t /#29/+ w /#28 t /#29 /#28/4/./4/9/#29/1/0/0 Estimation of the DO dynamics/#12/#11
/#13/#10/1/#01
q
/, k
BA
q
/, m
QR
/- /- /- /- /-
/?
Sensor
DO/#06/+
/+
Inputmo del
Filtere /#28 t /#29 y /#28 t /#29 ys
/#28 t /#29 /^ y /#28 t j t /, m /#29
w /#28 t /#29Figure /4/./7/: Blo c k diagram of the input signal/, the sensor mo del andthe /#0Clter/.In /#28/4/./4/9/#29 k is a time dela y /, A /#28 q
/, /1/#29 and B /#28 q
/, /1/#29 are p olynomials and w /#28 t /#29i szero mean white measuremen t noise/.The problem of minimizing /#28/4/./4/7/#29 is an LQ problem/, whic h either couldb e solv ed b y a Kalman /#0Clter approac h or b ya p olynomial approac h/. Thelatter metho d is applied here/.The /#0Clter whic h minimizes /#28/4/./4/7/#29 is giv en b y/^ y /#28 t j t /, m /#29/= q
/, m
Q /#28 q
/, /1/#29R /#28 q
/, /1/#29
ys
/#28 t /#29 /#28/4/./5/0/#29where the Q /#28 q
/, /1/#29 and R /#28 q
/, /1/#29 p olynomials are found b y solving the follo w/-ing design equations/, see Ahl /#13 en and Sternad /#28/1/9/8/9/#29r/#0C /#0C/#03
/= BB/#03
/+ /#1AA /#01 A/#03
/#01/#03
/#28/4/./5/1/#29z
m /+ kB/#03
/= r/#0C/#03
Q/1
/+ z /#01 L/#03
/#28/4/./5/2/#29Q /= Q/1
A /#28/4/./5/3/#29R /= /#0C /#28/4/./5/4/#29In /#28/4/./5/1/#29 /#7B /#28/4/./5/4/#29 and in the follo wing the argumen t /#28 q
/, /1/#29 is left out forsimplicit y /. Conjugate p olynomials /#28denoted b y/#03
/#29 are used in /#28/4/./5/1/#29 and/#28/4/./5/2/#29/. A conjugate p olynomial is de/#0Cned as follo ws/. Consider a generalp olynomial P /= p/0
/+ p/1
q
/, /1/+ /#01/#01/#01 /+ pnP
q
/, nP/. The conjugate p olynomialis then de/#0Cned b y P/#03
/= p/0
/+ p/1
q /+ /#01/#01/#01 /+ pnP
q
nP/. The p olynomial /#0C isa stable /#28the ro ots of /#0C are inside the unit circle/#29 and monic /#28the /#0Crstco e/#0Ecien t in the p olynomial is /1/#29 p olynomial/. The p olynomial L is anauxiliary p olynomial/, and /#1A /=E w
/2/= E e
/2is the noise to signal ratio/, whic his normally used as user design parameter/./4/./4 Estimation utilizing a slo w DO sensor /1/0/1The degrees of the p olynomials in the design equations /#28/4/./5/1/#29/#7B/#28/4/./5/4/#29are giv en b y/:n/#0C /=
/#28nB if /#1A /=/0max f nB /; nA /+/1 g if /#1A/#3E /0
/#28/4/./5/5/#29nQ/1
/= max f/, m /, k/; /0 g /#28/4/./5/6/#29nL /= max f nB /+ m /+ k/; n /#0C g/, /1 /#28/4/./5/7/#29where nB denotes the degree of the B p olynomial/, etc/.R emark /1/: The presen ted approac hm a y /, for example/, also b e of in terestfor DO sensors used in respirometers/, see e/.g/. Spanjers and Olsson /#28/1/9/9/2/#29/.R emark /2/: E/#0Ecien t n umerical metho ds exist for solving the sp ectralfactorization /#28/4/./5/1/#29/, whic h can only b e solv ed analytically for degrees of /#0Cless than /3/.R emark /3/: It is p ossible to deriv e a /#0Clter for a more general case wherethe measuremen t noise w /#28 t /#29 is colored and the input mo del is more general/,see further Ahl /#13 en and Sternad /#28/1/9/8/9/#29/./4/./4/./3 Determination of A /, B /, k and /#1AThe sensor mo del/, i/.e/. the A and B p olynomials and time dela y k /, can b edetermined b y a least squares metho d/, where suitable p olynomial degreesand time dela yh a v e to b e tried out/, see e/.g/. S/#7F oderstr/#7F om and Stoica /#28/1/9/8/9/#29/.Necessary data for estimating the sensor dynamics can b e ac hiev ed b ym o v/-ing the the DO sensor be t w een w aters with di/#0Beren t DO and register thesensor resp onse/.The parameter /#1A is probably easiest to /#0Cnd b y trial and error/. A small/#1A giv es a noisy result and a large /#1A giv es a slo w resp onse to c hanges inDO/. When estimating the respiration rate from the DO measuremen ts/,sim ulations ha v e indicated that it is b etter to c ho ose a to o small than ato o large /#1A /./4/./4/./4 An exampleT o illustrate the pro cedure outlined ab o v e/, an example is giv en/. The dy/-namics of the sensor in this example corresp onds to the mo del obtainedfor the DO sensor at the pilot plan t in Uppsala/. F or a sampling in terv alof /1/0s the follo wing parameters w ere iden ti/#0Ced from the data giv en in theexp erimen t sho wn in Figure /4/./8 using a least squares metho d /#28ARX mo del/1/0/2 Estimation of the DO dynamicsstructure/#29A /=/1 /, /0 /: /4/5 q
/, /1B /=/0 /: /5/5 k /=/2 /#28/4/./5/8/#29In Figure /4/./8 the DO sensor is mo v ed be t w een di/#0Beren t zones/. The trueDO is obtained b y considering the DO constan t in eac h zone and using thesteady/-state v alue from the DO sensor as the constan t v alue/. The time ofmo ving the DO sensor is logged/.
0 2 4 6 8 10 12 14 160.511.52
time [min]mg/lDissolved oxygen concentrationFigure /4/./8/: Exp erimen t in the pilot plan t for iden tifying the dynam/-ics of the DO sensor/. T rue DO /#28dotted line/#29/, measured DO /#28solid line/#29and true DO /#0Cltered b y /#28/4/./5/8/#29 /#28dashed line/#29/.Using the p olynomials /#28/4/./5/8/#29 in the design equations /#28/4/./5/1/#29 /#7B /#28/4/./5/4/#29 witha smo othing lag m /= /, /3/, and /#1A /=/0 /: /1/, giv es the Q/1
and R p olynomials/:Q/1
/=/0 /: /3/5/5/3 /+ /0 /: /9/7/8/7 q
/, /1R /=/1 /, /0 /: /3/4/6/4 q
/, /1/+/0 /: /0/8/0/1 q
/, /2/#28/4/./5/9/#29The /#0Clter then b ecomes/:/^ y /#28 t j t /+/3 /#29 /= q
/3
/#28/0 /: /3/5/5/3 /+ /0 /: /9/7/8/7 q
/, /1/#29/#28/1 /, /0 /: /4/5/0/0 q
/, /1/#29/1 /, /0 /: /3/4/6/4 q
/, /1/+/0 /: /0/8/0/1 q
/, /2
ys
/#28 t /#29 /#28/4/./6/0/#29/4/./5 Sim ulated examples /1/0/3In Figure /4/./9 the /#0Cltering is illustrated for di/#0Beren t /#1A /, and m /, with andwithout measuremen t noise/. As seen/, when k/#3E /, m there will b e a dela yi nthe /#0Cltered signal compared to the the true DO/. A small /#1A giv es in the noisefree case a smaller error b et w een true and /#0Cltered DO/, but for measuremen tnoise a large /#1A ma y b e preferable/.
05010015020000.51y, ys & y_hat, m=−4
time [s]mg/l
05010015020000.51y, ys & y_hat, m=−4
time [s]mg/l
05010015020000.51y, ys & y_hat, m=−1
time [s]mg/l
05010015020000.51y, ys & y_hat, m=−1
time [s]mg/lFigure /4/./9/: Example of smo othing/. The sho wn signals are y /#28 t /#29 /#28dot/-ted line/#29/, ys
/#28 t /#29 /#28solid line/#29/, /^ y /#28 t /#29 with /#1A /=/0 /: /0/0/1 /#28dashed line/#29/, and /^ y /#28 t /#29with /#1A /= /1 /#28dash/-dotted line/#29/. L eft c olumn/: No measuremen t noise/#28 w /#28 t /#29 /= /0/#29/. R ight c olumn/: Measuremen t noise with E w /#28 t /#29
/2/=/0 /: /0/5
/2/.When the DO signal is /#0Cltered /#28here the /#0Cltered DO is denoted yf
/#28 t /#29/=/^ y /#28 t j t /, m /#29/#29 the previously presen ted estimation algorithm can b e used/./4/./5 Sim ulated examplesIn this section some sim ulations are p erformed to illustrate ho w w ell therespiration rate and the KL
a function can be estimated using di/#0Beren trespiration rate and KL
a mo dels/./1/0/4 Estimation of the DO dynamics/4/./5/./1 Sim ulation setupIn the sim ulations/, a setup is used whic h appro ximately corresp onds to the/#0Crst aerobic zone in the pilot plan t at Kungs/#7F angsv erk et/. In the pilot plan tthe air/#0Do w rate can not b e measured/. Instead the v alv e op ening is used/, seeSection /4/./6/./1 for more details/. If the air/#0Do w rate or v alv e op ening is useddo es not c hange the estimation algorithm/, the general idea is the same/.The system used for generating the data is sim ulated b yy /#28 t /+/1 /#29 /= y /#28 t /#29/+ h
/#03/#5B
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29 /+ KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 /, R /#28 t /#29/#5D /#28/4/./6/1/#29where/#0F The w astew ater /#0Do w/, Q /= /1/0/0/0 l/#2Fh/#0F The v olume of the zone/, V /= /6/3/0 l/#0F The saturated DO/, ysat
/= /1/0 mg/#2Fl/#0F The in/#0Duen t DO/, yin
/#28 t /#29 /= /0 mg/#2Fl/#0F The o xygen transfer function KL
a /#28 u /#29 /= /5 arctan/#28
/2/0 u/1/0/0/0
/#29h
/, /1/#0F The respiration rate R /#28 t /#29 /= /2/0 /+ /1/5 sin/#28/6 t /#29 mg/#2Fl/#2Fh/./#0F h
/#03/#28 t /#29/=
/1A /#28 t /#29
/#28 e
A /#28 t /#29 h/, /1/#29/, A /#28 t /#29/= /, /#28 KL
a /#28 u /#28 t /#29/#29 /+
Q /#28 t /#29V
/#29/#0F The sampling p erio d/, h /=/1 /= /3/6/0 h/, /#28/1/0s/#29/#0F Zero mean white measuremen t noise with standard deviation /0/./1 hasb een added to the output/.In the estimation algorithm the follo wing setup is used/:/#0F Correct v alues w ere used for Q/=V /, yin
/#28 t /#29 and ysat
/./#0F In the co v ariance matrix R/1
/, /#0D/1
is set to /0/, and /#0D/2
is giv en b y/:/* /#0D/2
/= /1/0/0 for the random w alk mo del/./* /#0D/2
/=/0 /: /0/5 for the in tegrated random w alk mo del/./* /#0D/2
/=/0 /: /2 for the /#0Cltered random w alk mo del where f /=/0 /: /9/7/./4/./5 Sim ulated examples /1/0/5/#0F The air/#0Do w u /#28 t /#29 /#28v alv e op ening/#29 is divided b y /1/0/0/0 in the estima/-tion algorithm/. This scaling mak es the estimated KL
a parameters tobe in the same range/. This is esp ecially imp ortan t when using theexp onen tial mo del since it impro v es the n umerical prop erties/./#0F
/^/#12 /#28/0/#29 /= /#5B/1/0 /1/0 /1/0 /1/0/#5D
T/. F or the random w alk mo del there is oneelemen t less in the /#12 /-v ector/./#0F Note/, the regressor /#0Crst has to b e /#0Clled with /#28real/#29 data b efore
/^/#12 canbe up dated/. Here the /#0Crst /8 samples are used to /#0Cll the regressorwith real data/. The initial co v ariance matrix is then selected to/:/* P /#28/0/#29 /= /1/0
/4I for the random w alk mo del/./* P /#28/0/#29 /=diag/#28/1/0
/4/; /1/0
/4/; /1/0 /; /1/0/#29 for the in tegrated random w alk mo del/./* P /#28/0/#29 /=diag/#28/1/0
/4/; /1/0
/4/; /1/0
/2/; /1/0
/2/#29 for the /#0Cltered random w alk mo delwhere f /=/0 /: /9/7/./* P /#28/0/#29 /=diag/#28/0 /; /1/0
/5/; /1/0
/5/; /1/0
/5/; /1/0
/2/; /1/0
/2/#29 for the /#0Cltered random w alkmo del where f /=/0 /: /9/7 and the spline appro ximation is used/./#0F The grid p oin ts for the spline appro ximation of KL
a are equallyspaced/, i/.e/. u/1
/=/3 /3 /: /3/, u/2
/=/6 /6 /: /7/, and u/3
/= /1/0/0/.It is very imp ortant that the input signal is su/#0Ecien tly exciting/, b oth inamplitude and in frequency to obtain g ood estimation result/, esp eciallywhen the data are corrupted b y measuremen t noise/, as it alw a ys is in a realplan t/.The estimates ma y be impro v ed b y running the estimation algorithmt wice/. The /#0Cnal estimates of the KL
a parameters and the corresp ondingelemen ts in the co v ariance matrix from the /#0Crst run are then used as ini/-tial parameters in the second run/. This approac h has/, ho w ev er/, not b eenapplied here/, since the estimates w ere su/#0Ecien tly go o d/.The highly excited air/#0Do w rate used for the iden ti/#0Ccation is sho wn inFigure /4/./1/0/, where the corresp onding dissolv ed o xygen concen tration alsois displa y ed/./4/./5/./2 Estimation results of the sim ulationsThe di/#0Beren t respiration rate mo dels and KL
a appro ximations are sim u/-lated in this section with the previously giv en parameters/.First an exp onen tial KL
a mo del com bined with a random w alk mo delof the respiration rate is sim ulated/. The result is giv en in Figure /4/./1/1/./1/0/6 Estimation of the DO dynamics
0 0.5 1 1.5 2 2.5 3 3.5 40123456
time [h]mg/lDissolved oxygen concentration
0 0.5 1 1.5 2 2.5 3 3.5 4020406080100
time [h]%Valve openingFigure /4/./1/0/: Data used in the estimation trials/. Upp er plot/: Thedissolv ed o xygen concen tration /#28 y /#29 Lo w er plot/: The v alv e op ening/.The DO is sim ulated from the input u /#28 t /#29/.As can be seen/, b oth the estimated KL
a and the estimated time/-v aryingrespiration rate is quite close to their true v alues/.An exp onen tial KL
a mo del and in tegrated random w alk mo del is ap/-plied in Figure /4/./1/2/. This metho d trac ks the respiration rate sligh tly b etterduring some p erio ds/, but sligh tly w orse during other p erio ds/. It seems lik ethe estimated respiration rate has problems to c hange to an up w ard direc/-tion/.The exp onen tial KL
a mo del and /#0Cltered random w alk seem to giv e theb est result/, whic h can be seen in Figure /4/./1/3/. The estimated respirationrate has just a small time lag and the estimated KL
a is v ery close to thetrue function/.Applying the cubic spline KL
a mo del and /#0Cltered random w alk to thesame data giv es the result in Figure /4/./1/4/, whic h is v ery similar to to theexp onen tial KL
a mo del with the /#0Cltered random w alk mo del/./4/./5 Sim ulated examples /1/0/7
0123405101520Estimated Kla−parameters
time [h]0 50 10001234561/hTrue & estimated Kla function
Valve opening [%]
0 0.5 1 1.5 2 2.5 3 3.5 4010203040True and estimated respiration rate
time [h]mg/l/hFigure /4/./1/1/: A sim ulation with an exp onen tial KL
a mo del and a ran/-dom w alk mo del of the respiration rate/. Upp er left plot/: The settlingof the parameters in the exp onen tial KL
a mo del/. Upp er righ t plot/:T rue KL
a /#28solid line/#29 and estimated KL
a /#28dashed line/#29 at the /#0Cnaltime/. Lo w er plot/: T rue /#28smo oth line/#29 and and estimated respirationrate/.As a conclusion one can sa y that the di/#0Beren t suggested metho ds do notsho wa n y large di/#0Berences/. What is most imp ortan t is the initialization ofthe co v ariance matrix P and c hoice of the R/1
matrix/. A /#0Cltered randomw alk mo del seems/, ho w ev er/, to b e to prefer/. A spline or exp onen tial mo delgiv e almost iden tical results/. Since the exp onen tial mo del is simpler w emigh ta s w ell use that one/./1/0/8 Estimation of the DO dynamics
0123405101520Estimated Kla−parameters
time [h]0 50 10001234561/hTrue & estimated Kla function
Valve opening [%]
0 0.5 1 1.5 2 2.5 3 3.5 4010203040True and estimated respiration rate
time [h]mg/l/hFigure /4/./1/2/: A sim ulation with an exp onen tial KL
a mo del and anin tegrated random w alk mo del of the respiration rate/. Upp er leftplot/: The settling of the parameters in the exp onen tial KL
a mo del/.Upp er righ t plot/: T rue KL
a /#28solid line/#29 and estimated KL
a /#28dashedline/#29 at /#0Cnal time/. Lo w er plot/: T rue /#28smo oth line/#29 and and estimatedrespiration rate/./4/./5 Sim ulated examples /1/0/9
0123405101520Estimated Kla−parameters
time [h]0 50 10001234561/hTrue & estimated Kla function
Valve opening [%]
0 0.5 1 1.5 2 2.5 3 3.5 4010203040True and estimated respiration rate
time [h]mg/l/hFigure /4/./1/3/: A sim ulation with an exp onen tial KL
a mo del and an/#0Cltered random w alk mo del of the respiration rate/. Upp er left plot/:The settling of the parameters in the exp onen tial KL
a mo del/. Upp errigh t plot/: T rue KL
a /#28solid line/#29 and estimated KL
a /#28dashed line/#29at /#0Cnal time/. Lo w er plot/: T rue /#28smo oth line/#29 and and estimatedrespiration rate/./1/1/0 Estimation of the DO dynamics
01234−20246810Estimated Kla−parameters
time [h]0 50 10001234561/hTrue & estimated Kla function
Valve opening [%]
0 0.5 1 1.5 2 2.5 3 3.5 4010203040True and estimated respiration rate
time [h]mg/l/hFigure /4/./1/4/: A sim ulation with a cubic spline KL
a appro ximationand a /#0Cltered random w alk mo del of the respiration rate/. Upp er leftplot/: The settling of the parameters in the spline KL
a mo del/. Upp errigh t plot/: T rue KL
a /#28solid line/#29 and estimated KL
a /#28dashed line/#29at /#0Cnal time/. Lo w er plot/: T rue /#28smo oth line/#29 and and estimatedrespiration rate/./4/./5 Sim ulated examples /1/1/1/4/./5/./3 Sim ulation with time/-v arying KL
aA sim ulation has b een made to study the e/#0Bect of a time/-v arying KL
afunction/. The same setup is used as b efore/, but at t /= /1 /: /5h the trueKL
a function is increased b y a factor /2/. The parameter /#0D/1
/= /1 duringthe whole sim ulation/, this to allo w v ariations in KL
a /. The result of theestimation exp erimen t is sho wn in Figure /4/./1/5/, and the corresp onding DOconcen tration is sho wn in Figure /4/./1/6/. The air/#0Do w rate is the same asb efore/.
0123405101520Estimated Kla−parameters
time [h]0 50 100024681012
Valve opening [%]1/hTrue & estimated Kla function
0 1 2 3 4010203040
time [h]mg/l/hTrue and estimated respiration rateFigure /4/./1/5/: Sim ulation exp erimen t with a time/-v arying KL
a /. A tt /=/1 /: /5h the true KL
a function is m ultiplied b y/2 /. An exp onen tial KL
afunction and a /#0Cltered random w alk mo del of the respiration rate isused/. Upp er righ t plot/: T rue KL
a /#28solid line/#29 and estimated KL
a/#28dashed line/#29 at /1/./5h /#28lo w er curv es/#29 and at /#0Cnal time /#28upp er curv es/#29/.Lo w er plot/: T rue /#28smo oth line/#29 and and estimated respiration rate/.It is in teresting to see ho w fast the estimation algorithm reco v ers afterthe c hange in KL
a /. Studying the estimated respiration rate w e /#0Cnd thatone hour after the c hange in KL
a /, it is bac k on reasonable v alues again/./1/1/2 Estimation of the DO dynamics
0 1 2 3 402468
time [h]mg/lDissolved oxygen concentrationFigure /4/./1/6/: DO concen tration for the sim ulation with time/-v aryingKL
a /./4/./5/./4 Sim ulation with a slo w DO sensorThe in/#0Duence of the sensor dynamics will here b e illustrated b y comparingt w o estimation exp erimen ts/, one where the sensor dynamics has b een tak enin to accoun t and one where it has not/.The estimation result is presen ted in Figure /4/./1/7 where estimates ofKL
a and respiration rate are compared with and without /#0Cltering of theDO measuremen ts/. The /#0Clter whic h /#0Clters the DO sensor signal is giv en in/#28/4/./6/0/#29/, and the sensor dynamics are giv en b y /#28/4/./5/8/#29/. Note that the estimatesbased on no /#0Cltering of the DO sensor signal b ecomes more biased than the
estimates obtained when the suggested /#0Cltering pro cedure is used/.R emark/: The bias in the estimates b ecomes larger if the excitation /#28infrequency/#29 of the air/#0Do w rate is increased/, and smaller if the excitation isdecreased/. Note/, ho w ev er/, that a high excitation is necessary for trac kingof fast time v ariations of the respiration rate/. A p erhaps in tuitiv ew a y tounderstand wh y there will b e a bias in the estimates when using a highlyexcited air/#0Do w rate is the follo wing/. The DO sensor lo w pass /#0Clters theDO measuremen ts/. These measuremen ts do then app ear less excited thanwhat they actually are/. If u is highly excited/, and y is not/, the estimatorgiv es a smaller v alue of the estimated KL
a function than the true v alue/,b ecause a DO pro cess with a smaller v alue of KL
a giv es the same e/#0Bect ony /#28 t /#29/, as a slo w DO sensor do/. Since the expression KL
a /#28 u /#29/#28 ysat
/, y /#29 /, Ris used in the estimator/, a smaller KL
a also giv es a smaller estimate of therespiration rate/./4/./6 Application to real data /1/1/3
01234051015
time [h]Estimated Kla−parameters
0 1 2 3 4−10010203040
time [h]mg/l/hTrue and estimated respiration rate0 50 1000123456
Valveopening [%]1/hTrue and estimated Kla functionFigure /4/./1/7/: Comparison b et w een t w o estimation exp erimen ts/, onewhere the sensor dynamics has b een tak en in to accoun t and one whereit has not/. In all plots/, dashed lines corresp ond to true v alues/, greylines to estimates with /#0Cltered DO measuremen ts and blac k lines toestimates where no /#0Cltering has b een applied/./4/./6 Application to real dataIn this section the exp onen tial KL
a mo del and /#0Cltered random w alk mo delare used in the estimation algorithm/. Lab oratory batc h exp erimen ts ofthe respiration rate ha v e for comparison also b een measured/. Ho w thenonlinear v alv ec haracteristics is included in KL
a is also considered/./4/./6/./1 Including the v alv e c haracteristics in KL
aIn the pilot plan t/, as w ell as in man y other plan ts/, no measuremen ts ofthe air/#0Do w rates are a v ailable/. A reasonable approac h /#28for not v ery fastsampling/#29 is then to neglect the v alv e dynamics and regard the v alv e as anonlinear static function/, i/.e/.u /#28 t /#29/= g /#28 /' /#28 t /#29/#29 /#28/4/./6/2/#29/1/1/4 Estimation of the DO dynamicswhere u /#28 t /#29 is the air/#0Do w rate/, g is a static function and /' /#28 t /#29 is the v alv eop ening whic h is measurable/.Including /#28/4/./6/2/#29 in the KL
a mo del giv esy /#28 t /+/1 /#29 /= y /#28 t /#29/+ h /#5B
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29 /+ KL
a
g/#28 /' /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 /, R /#28 t /#29/#5D /+ w /#28 t /#29/#28/4/./6/3/#29whereKL
a
g/#28 /' /#28 t /#29/#29 /= KL
a /#28 g /#28 /' /#28 t /#29/#29/#29 /#28/4/./6/4/#29The approac h presen ted in Section /4/./3 can no w be applied b y replacingKL
a with KL
a
g/./4/./6/./2 A practical exp erimen tSev eral exp erimen ts ha v e b een p erformed to estimate KL
a and the respira/-tion rate/, b oth in the pilot plan t and in the full scale plan t/, see e/.g/. Carlssonand Wigren /#28/1/9/9/3/#29/, Carlsson /#28/1/9/9/3/#29/, Carlsson et al/. /#28/1/9/9/4 a /#29 and Lindb ergand Carlsson /#28/1/9/9/6 c /#29/. Here/, one of the exp erimen t in the pilot plan t atUppsala w astew ater treatmen t plan t is presen ted/.In the exp erimen t /#0Cltering of the DO measuremen t is applied/. Thesetup of the DO /#0Clter and the estimator is iden tical to the setup used inthe sim ulation study presen ted in Section /4/./5/./4/. The respiration rate hasfor comparison also b een measured in lab oratory batc h exp erimen ts/, seeSection /4/./6/./3 for a further explanation/.In Figure /4/./1/8 the estimated and measured respiration rate are pre/-sen ted/. Note that the di/#0Beren t metho ds almost obtain the same v alues ofthe respiration rate/.R emark /1/: If the DO measuremen t is not /#0Cltered/, the estimated respi/-ration rate b ecame lo w er/, here /#19 /3 mg/#2Fl/#2Fh/.R emark /2/: Practical exp erimen t ha v e sho wn that the estimated res/-piration rate dep ends on the air/#0Do w rate and/#2For DO/. This w as detectedin sequen tial exp erimen ts with iden tical excitation sequences where a cor/-relation be t w een the estimated respiration rates w as detected/. The truerespiration rate probably dep ends on the DO since/, for example/, DO/=/0giv es R /#28 t /#29 /#19 /0/./4/./7 Exp erimen ts with surface activ e agen ts /1/1/5
0 2 4 610121416182022
time [h]Estimated Kla−parameters
0 50 100051015
Valve opening [%]1/hEstimated Kla
0 1 2 3 4 5 61020304050
time [h]mg/l/hEstimated and measured respiration rateFigure /4/./1/8/: Estimation result from measuremen ts of the dissolv edo xygen concen tration in the pilot plan t/. Measured respiration rate ismark ed b yx /./4/./6/./3 Lab oratory batc h exp erimen tsThe lab oratory batc h exp erimen ts w ere done in the follo wing manner/. Asample from the sludge in the activ ated sludge pro cess w as tak en when theDO w as high/. Immediately after the sample w as tak en a fast o xygen sensorw as put in to the sample for registering the deca y of the DO/. The respirationrate w as then considered to b e equiv alen t to the mean deriv ativ e of the DOslop e during the /#0Crst /1/0/0 s/. The slop e of the DO is time/-v arying/. In theb eginning the deriv ativ e is large and in the end it is small/. During the /#0Crst/1/0/0 s it is still quite large/./4/./7 Exp erimen ts with surface activ e agen tsThe surfactan ts whic h are imp ortan t ingredien ts in mo dern w ashing agen tsha v e b een susp ected to lo w er the KL
a v alues at the WWTP /.I n v estigationsin W agner and P/#7F op el /#28/1/9/9/6/#29 ha v e sho wn that surfactan ts do a/#0Bect KL
a /./1/1/6 Estimation of the DO dynamicsThree di/#0Beren tt yp es of surfactan ts exists/, nonionic/, anionic/, and k ationic/.The nonionic surfactan ts reduce the o xygen transfer more than the others/,see W agner and P/#7F op el /#28/1/9/9/6/#29/. A problem with a lo w KL
a v alue is that it isharder to main tain a desired DO set/-p oin t and that it requires more energyto do so/. The DO set/-p oin t is di/#0Ecult to reac h due to the fact that littleo xygen is transfered to the w astew ater/.T o mak e further ev aluation some exp erimen ts ha v e b een conducted inthe pilot plan t in co op eration with Jonas R/#7F ottorp at IVL who w as princi/-pal in v estigator/. An external nonionic surfactan t /#28alcohol etho xylate/#29 w asadded to the in/#0Duen tw ater to the pilot plan t/. The /#0Do ws and concen trationsw ere v aried during the exp erimen t in the follo wing manner/:/1/. Surfactan t concen tration /1/0 mg/#2Fl/, in/#0Duen t /#0Do w /2/0/0 l/#2Fh/, in ternal re/-circulation /4/0/0 l/#2Fh and return sludge /#0Do w /2/0/0 l/#2Fh/./2/. The same surfactan t concen tration/, but in/#0Duen t/#0D o w /4/0/0 l/#2Fh/, in ternalrecirculation /8/0/0 l/#2Fh and return sludge /#0Do w /3/5/0 l/#2Fh/./3/. Surfactan t concen tration lo w ered to /5 mg/#2Fl/, and the same /#0Do w rates/./4/. Surfactan t dosing switc hed o/#0B/, and the same /#0Do w rates/.In the /#0Crst phase of the exp erimen t/, when the /#0Do ws w ere lo w/, no in/#0Duence ofthe surfactan tw as detected/. Therefore the /#0Do w rates w ere increased/. Thesurfactan t dosing w as also increased to main tain the same concen tration inthe in/#0Duen t/#0D o w/. A signi/#0Ccan t decrease in the estimated KL
a could thenb e seen/, and it w as not p ossible to main tain the desired DO/, ev en thoughthe airv alv ew as completely op en/. In the end of the exp erimen t the dosagew as lo w ered to /5 mg/#2Fl/, but the KL
a v alue w as still at the same lo w lev el/.When the external dosage of surfactan ts w as switc hed o/#0B/, the estimatedKL
a increased again/. The DO w as bac k at normal lev els after a few da ys/.The respiration rate and KL
a w as estimated with the previously outlinedmetho d/.A t the pilot plan t/, where the exp erimen t w as conducted/, one line w asused as a reference line and the other w as used for the exp erimen ts/. InFigures /4/./1/9/, /4/./2/0 and /4/./2/1 some t ypical estimation results from the ex/-p erimen ts are presen ted/. Due to a mistak e no data w ere sa v ed from theexp erimen tal line b efore the exp erimen t w as conducted/, so a comparisonb efore and during dosage can not be made/. The lines at the pilot plan tw ere/, ho w ev er/, not iden tical when the exp erimen t started/. Among otherthings the susp ended solids concen tration di/#0Bered/, but when comparing thedi/#0Beren t /#0Cgures one can still see that/4/./7 Exp erimen ts with surface activ e agen ts /1/1/7
0 1 2 3 4 5 6012
time [h]DO concentration (mg/l) and valveopening [%/100]
0 2 4 601020Estimated Kla−parameters
time [h]0 50 1000246Estimated Kla
Valveopening [%]1/h
0 1 2 3 4 5 602040Estimated respiration rate
time [h]Figure /4/./1/9/: Estimation in the reference line/. In the upp er plot/, isthe DO the blac k line and the grey line is the v alv e op ening/#2F/1/0/0/./#0F KL
a and the respiration rate is signi/#0Ccan tly higher in the referenceline/. Note that from the de/#0Cnition in /#28/4/./2/#29/, KL
a /= /#0BKL
aCW
/. Hencethe c hange of KL
a is due to c hanges in the factor /#0B /./#0F KL
a and the respiration rate increases when the surfactan t dosage isswitc hed o/#0B/./#0F Both KL
a and the respiration rate are a/#0Bected b y the surfactan tdosage/./#0F Normally the DO v aries quite m uc h when the air/#0Do w rate is c hanged/,but in Figure /4/./2/0 where the surfactan t is added/, almost nothinghapp ens in the DO /#28whic h also is v ery lo w/#29/. The reason is that b othKL
a and the respiration rate ha v e b ecome v ery lo w/.The susp ended solids concen tration decreased from ab out /3 g/#2Fl to /1 g/#2Fl/1/1/8 Estimation of the DO dynamics
0 1 2 3 4 5 6012
time [h]DO concentration (mg/l) and valveopening [%/100]
0 2 4 601020Estimated Kla−parameters
time [h]0 50 1000246Estimated Kla
Valveopening [%]1/h
0 1 2 3 4 5 602040Estimated respiration rate
time [h]Figure /4/./2/0/: Estimation in the exp erimen tal line during surfactan tdosage/. In the upp er plot is the DO the blac k line and the v alv eop ening/#2F/1/0/0 is the grey line/.during the exp erimen t in the exp erimen tal line/. The susp ended solids con/-cen tration w as reasonable constan t around /2/./5 g/#2Fl in the reference line/. Theexcess sludge pumping w as switc hed o/#0B in b oth lines/. Th us/, the decrease ofthe sludge concen tration in the exp erimen tal line is caused b y bad settlingprop erties/. The results of the exp erimen ts therefore also indicates that thesurfactan t ma y ha v e a bad e/#0Bect on the settling prop erties/. A lo w er sus/-p ended solids concen tration also a/#0Bect the estimated respiration rate whic hb ecomes lo w er/, due to less biomass/./4/./7 Exp erimen ts with surface activ e agen ts /1/1/9
0 1 2 3 4 5 6012
time [h]DO concentration (mg/l) and valveopening [%/100]
0 2 4 601020Estimated Kla−parameters
time [h]0 50 1000246Estimated Kla
Valveopening [%]1/h
0 1 2 3 4 5 602040Estimated respiration rate
time [h]Figure /4/./2/1/: Estimation in the exp erimen tal line after surfactan tdosage/. In the upp er plot is the DO the blac k line and the v alv eop ening/#2F/1/0/0 is the grey line/./1/2/0 Estimation of the DO dynamics/4/./7/./1 Lab oratory batc h exp erimen tsLab oratory batc h exp erimen ts for measuring KL
a /#28for a /#0Cxed air/#0Do w rate/,whic h also giv es a /#0Cxed KL
a /#29 w as made during the exp erimen ts/. Themetho d is based on studying an increase in DO as illustrated in Figure/4/./2/2/. Assuming Q /#28 t /#29/= R /#28 t /#29 /= /0 and inserting this in /#28/4/./4/#29 giv es
satyDO
TimeFigure /4/./2/2/: Example of an increase in DO during aeration in abatc h exp erimen t/.dy /#28 t /#29dt
/= KL
a /#28 ysat
/, y /#28 t /#29/#29 /#28/4/./6/5/#29It is reasonable to assume R /#28 t /#29 /= /0/, since sedimen ted w astew ater has b eenused/. The solution of /#28/4/./6/5/#29 isy /#28 t /#29/= ysat
/, Ke
/, KL
at/#28/4/./6/6/#29where K is an arbitrary constan t and t is the time/. Reordering and loga/-rithming /#28/4/./6/6/#29 giv eslog /#28 ysat
/, y /#28 t /#29/#29 /= log /#28 K /#29 /, KL
at /#28/4/./6/7/#29KL
a /#28for a /#0Cxed air/#0Do w rate/#29 is hence found as the slop e of a curv e generatedb y log /#28 ysat
/, y /#28 t /#29/#29 but with opp osite sign/. The v alue of ysat
is found assteady/-state v alue from the aeration/. This KL
a v alue is/, ho w ev er/, notcomparable with the one obtained in the estimation algorithm/.This metho d did/, ho w ev er/, not detect an yc hange in KL
a /, but the sug/-gested estimation metho d in this c hapter did/. Since the pro cess requiredmore o xygen during the exp erimen t/, it is lik ely that the suggested metho din this c hapter giv es a more correct answ er/./4/./8 Conclusions /1/2/1/4/./8 ConclusionsIden ti/#0Ccation algorithms for estimating the time/-v arying respiration rateand the nonlinear KL
a function ha v e b een presen ted/. The estimation isbased on measuremen ts of the dissolv ed o xygen concen tration and the air/-/#0Do w rate/. Tw o di/#0Beren t mo dels of the nonlinear KL
a function ha v e b eensuggested/: an exp onen tial mo del and a cubic spline mo del/. Three mo d/-els for mo deling the respiration rate ha v e also b een considered/: a randomw alk mo del/, a /#0Cltered random w alk mo del/, and an in tegrated random w alkmo del/. The exp onen tial mo del and a cubic spline mo del w ere appro xi/-mately equally go o d/. The /#0Cltered random w alk mo del w as the b est one ofthe di/#0Beren t respiration rate mo dels/.In order to trac k the time v arying respiration rate and the nonlinearKL
a function/, a Kalman /#0Clter w as used/. T o illustrate the estimation pro/-cedure sim ulation studies ha v e b een p erformed with g ood results/. Theresults from the sim ulations w ere also con/#0Crmed on real data from a pilotactiv ated sludge plan t/, where the estimated respiration rate w as comparedwith batc h lab oratory measuremen ts/. Also/, a nonlinear mo del of the o xy/-gen transfer function w as ac hiev ed/.When the DO sensor has dynamics it should not b e neglected/. By /#0Cl/-tering the output from the DO sensor/, the in/#0Duence of the sensor dynamics
can b e reduced/. The /#0Cltering pro cedure ma y also b e useful in other appli/-cations where there is need for comp ensating the sensor dynamics/, e/.g/. inrespirometers/.An exp erimen t with surface activ e agen ts w as p erformed and the sug/-gested estimation metho d w as applied to detect c hanges in KL
a and therespiration rate/. Signi/#0Ccan t c hanges w ere detected in b oth KL
a and therespiration rate whic h decreased to almost zero/. An in teresting observ ationis that when the DO is a/#0Bected b y surfactan ts/, the DO is almost constan t/.The DO will not b ecome lo w er due to the respiration rate is almost zero/,and the DO will not increase b y increased air/#0Do w rate due to KL
a is almostzero/./1/2/2 Estimation of the DO dynamicsChapter /5Con trol of the dissolv edo xygen concen trationThe dissolv ed o xygen concen tration /#28DO/#29 in the aerobic part of an acti/-v ated sludge pro cess should be su/#0Ecien tly high to supply enough o xygento the micro organisms in the sludge/, so organic matter is degraded andammonium is con v erted to nitrate/. On the other hand/, an excessiv ely highDO/, whic h requires a high air/#0Do w rate/, leads to a high energy consumptionand ma y also deteriorate the sludge qualit y /. A high DO in the in ternallyrecirculated w ater also mak es the denitri/#0Ccation less e/#0Ecien t/, see Olssonand Jeppson /#28/1/9/9/4/#29/. Hence/, b oth for economical and pro cess reasons/, it isof in terest to con trol the DO/. Sev eral con trol strategies for the DO ha v eb een suggested in the past/. Flanagan et al/. /#28/1/9/7/7/#29 presen ted a linear PIcon troller with feedforw ard from the respiration rate and the /#0Do w rate/. InW ells /#28/1/9/7/9/#29 di/#0Beren t con trol strategies for the activ ated sludge pro cessw ere applied/, among others DO con trol/. A dead/-b eat con troller/, based ona recursiv ely estimated mo del with a linear KL
a w as designed in Ko et al/./#28/1/9/8/2/#29/. Holm b erg et al/. /#28/1/9/8/9/#29 and Bo c k en et al/. /#28/1/9/8/9/#29 also base their de/-sign on a recursiv ely estimated mo del with a linear KL
a /, but the excitationof the pro cess w as impro v ed b y in v oking a rela y whic h increases the exci/-tation/. P ole placemen tw as then used to design the con troller/. Rundqwist/#28/1/9/8/6/#29 designed a self/-tuning con troller/, and Carlsson et al/. /#28/1/9/9/4 a /#29 ha v eapplied auto/-tuning/.One problem with con trolling the DO is that the pro cess dynamicsare nonlinear/. This means that high con trol p erformance for all op eratingconditions ma y b e hard to ac hiev e with a linear con troller/. The ob jectiv eo fthe w ork presen ted here is a design metho d whic h giv es a high p erformance/1/2/4 Con trol of the DOcon troller for all op erating conditions/. The k ey idea is to explicitly tak e thenonlinear c haracteristics of the o xygen transfer function KL
a in to accoun tin the con trol design/. The design metho d consists of t w o separate parts/: anestimation part describ ed in Chapter /4 and a con troller design part whic his presen ted here/.The con troller design is based on a linearization of the DO pro cess/, ob/-tained b y using the in v erse of the estimated KL
a /#28 u /#29/. Tw o di/#0Beren t con troldesign approac hes are suggested for the linearized DO pro cess/:/#0F A p ole/-placemen t design with a PI con troller/#0F A linear quadratic /#28LQ/#29 con troller whic h uses feedforw ard from therespiration rate upstream/.An adv an tage compared to auto/-tuning of PID/-regulators/, see
/#17Astr/#7F om andH/#7F agglund /#28/1/9/8/4/#29 or
/#17Astr/#7F om and Wittenmark /#28/1/9/8/9/#29/, is that the suggestednonlinear con troller requires only one single tuning /#28estimation/#29 ev en t/,while auto/-tuning of a gain sc heduling regulator ma y require sev eral tuningsfor this t yp e of nonlinear pro cess/.An imp ortan t issue is the c hoice of set/-p oin t for the DO con troller/. Inpractice the DO set/-p oin t often is k ept at some /#0Cxed lev el/. A DO set/-p oin tcon troller is suggested/, where the set/-p oin t is selected so that a presp eci/-/#0Ced ammonium concen tration in the last aerated zone is obtained/, see alsoNielsen and Lynggaard /#28/1/9/9/3/#29/. Using the set/-p oin t con troller in the pilotplan t made it not only p ossible to sa v e energy due to a lo w er DO set/-p oin t/, the e/#0Fuen t nitrate concen tration w as also reduced signi/#0Ccan tly /. Thenitrate reduction probably dep ends on that the lo w er DO lev els made den/-itri/#0Ccation in the aerated zones p ossible/. The naturally existing carb on inthe aerated zones is then in a larger exten t used for denitri/#0Ccation insteadof b eing o xidized/. Less o xygen is also recirculated when using a lo w DOset/-p oin t/, whic h impro v es denitri/#0Ccation in the ano xic zone/. P ossible disad/-v an tages ma y b e that the sludge prop erties deteriorate due to the lo w DO/,and that nitrous o xide /#28N/2
O/#29 can be formed when the DO is lo w/. Theseproblems should/, ho w ev er/, b e compared to the ac hiev ed impro v emen ts/.T o sa v e energy the air pressure in the aeration system can be con/-trolled/. A strategy suggested in/, for example Rundqwist /#28/1/9/8/6/#29 and Robin/-son /#28/1/9/9/0/#29 has b een ev aluated in the pilot plan t with p ositiv e result/.The outline of the c hapter is as follo ws/. The con trol problem is pre/-sen ted in Section /5/./1/, where problems using linear con trol of a nonlinearpro cess are discussed/. The con troller design of a nonlinear PI/-con troller/5/./1 The con trol problem /1/2/5and a nonlinear LQ/-con troller with feedforw ard are is giv en in Section /5/./2/.The di/#0Beren t con trol strategies are compared in some sim ulation studies inSection /5/./3/. The prop osed con trollers are compared at the pilot plan t inSection /5/./4/. Section /5/./5 presen ts a con troller for con trolling the set/-p oin tof the dissolv ed o xygen/. It is based on con trol of the ammonium concen/-tration/. A practical exp erimen t with the DO set/-p oin t con troller has b eenmade in the pilot plan t/. Section /5/./6 giv es a short review of a common pres/-sure con troller whic h minimizes the pressure drop o v er the throttle v alv es/.Finally /, the conclusions are giv en in Section /5/./7/./5/./1 The con trol problemThe gain of the DO pro cess v aries with resp ect to the air/#0Do w rate due to thenonlinear KL
a function/, see Figure /4/./2 and Olsson and Piani /#28/1/9/9/2/#29/. TheDO pro cess also has a bilinear term /#28 KL
a /#28 u /#29 y /#29/, see further /#28/5/./1/#29/. This ma ycause problems when using a linear con troller/. In Figure /5/./1 suc h a problemis illustrated/, where a linear PI/-con troller is tuned for high p erformanceduring a high air/#0Do w rate but used for a lo w air/#0Do w rate/. More examplesare giv en in Section /5/./3/. A high air/#0Do w rate corresp onds here to /8/0/#25 op env alv e/. When the load to the plan t decreases/, the pro cess gain /#28the deriv ativ eof KL
a /#29 increases/, and an oscillating system is obtained/.If the linear con troller instead w as tuned for high p erformance during alo w load/, a slo w closed lo op resp onse w ould b e obtained for a high load/. Afair step resp onse for all loads is ho w ev er p ossible b y taking the nonlinearKL
a in to accoun t/. This is utilized in the follo wing sections/./5/./2 The nonlinear DO con trollerIn the past there has b een an extensiv e researc h in con troller design forlinear systems/, and man y high p erformance con trollers for linear systemsexist/. The DO pro cess is/, ho w ev er/, not a linear system/. F rom Chapter/4/, the follo wing discrete/-time mo del of the dissolv ed o xygen dynamics w asgiv en/.y /#28 t /+/1 /#29 /= y /#28 t /#29/+ h
/#03/#5B
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29 /+ KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 /, R /#28 t /#29/#5D /#28/5/./1/#29The DO dynamics in /#28/5/./1/#29 can b e linearized b yi n tro ducing a v ariable x /#28 t /#29/,de/#0Cned asx /#28 t /#29/= KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 /#28/5/./2/#29/1/2/6 Con trol of the DO
0 1 2 3 4 5 6 722.052.1Dissolved oxygen concentration
time [min]mg/l
0 1 2 3 4 5 6 70102030Valve opening (Airflow rate)
time [min][%]Figure /5/./1/: The DO and air/#0Do w rate for a step disturbance in the res/-piration rate during a lo w load /#28lo w respiration rate /#29 when con trolledb y a linear PI/-regulator whic h is tuned for a high load/.The con trol signal u /#28 t /#29 is calculated b y using the in v erse of an estimatedKL
a function/. This approac h is sometimes referred to as exact line arization /,see Khalil /#28/1/9/9/6/#29/. The linearization requires that the estimated KL
a mo delis in v ertible/. An exp onen tial mo del can be a suitable c hoice/. See furtherChapter /4 for ho w an estimated KL
a function can b e obtained/. The con trolsignal u /#28 t /#29 is determined b y replacing KL
a with its estimate/, and using /#28/5/./2/#29u /#28 t /#29/=
dKL
a
/, /1/#28
x /#28 t /#29ysat
/, y /#28 t /#29
/#29 /#28/5/./3/#29This pro cedure extends the idea used in Holm b erg et al/. /#28/1/9/8/9/#29/, where alinear KL
a mo del w as used/.F or the case when an exp onen tial mo del of KL
a is used /#28 KL
a /#28 u /#29 /=k/1
/#28/1 /, e
/, k/2
u/#29/#29/, see /#28/4/./1/0/#29 u /#28 t /#29 is giv en b yu /#28 t /#29/= /,
/1/^k/2
ln
/#20/1 /,
x /#28 t /#29/^k/1
/#28 ysat
/, y /#28 t /#29/#29
/!/#28/5/./4/#29/5/./2 The nonlinear DO con troller /1/2/7/-
yre f/#12/#11
/#13/#10/#06
/+/#7B
/-
eCon troller
/-
xdKL
a
/, /1/#28
xysat
/, y
/#29
/-
uPro cess
/-
y/6/6Figure /5/./2/: The basic idea with the nonlinear con troller/.A blo c k diagram of the linearized pro cess is sho wn in Figure /5/./2/.If the deriv ativ e of the estimated KL
a is di/#0Beren t from the deriv ativ eo fthe true KL
a function/, the gain of the pro cess mo del /#28the deriv ativ eo f KL
a /#29will also b e di/#0Beren t/. This ma y deteriorate the con troller p erformance/. Ifthe estimated KL
a is smaller than the true/, the con troller gain will belarger than exp ected/. A to o large con troller gain ma y result in a noiseand mo deling error sensitiv e con troller/. If the estimated KL
a b ecomeslarger than the true KL
a the resulting con troller will instead be slo w erthan exp ected/.Inserting /#28/5/./3/#29 in the pro cess mo del /#28/5/./1/#29 and assuming a correctlyestimated KL
a giv es the linearized pro cess mo del/#28 q /, /1/+
QV
h
/#03/#29 y /#28 t /#29/= h
/#03x /#28 t /#29/+ h
/#03
QV
yin
/#28 t /#29 /, h
/#03R /#28 t /#29 /#28/5/./5/#29Note that the /#0Do w/#28 Q /#29 usually is time/-v arying/. When using /#28/5/./5/#29 for con/-troller design the con troller parameters will then also b e time/-v arying/.R emark/: In the ab o v e discussions w eh a v e neglected the v alv ec haracter/-istics/. If the v alv ec haracteristic is nonlinear/, t w o approac hes are p ossible/./#0F Use cascade con trol/, where a lo cal con troller con trols the air/#0Do w rate/,see Rundqwist /#28/1/9/8/6/#29 and Robinson /#28/1/9/9/0/#29/. Ob viously this approac hrequires the air/#0Do w rate to b e measured/./#0F Use a mo del to comp ensate for the nonlinear v alv e c haracteristics/.This can easily b e incorp orated in the KL
a mo del/, see further Section/4/./6/./1/./5/./2/./1 P ole/-placemen t with a PI/-con trollerP ole/-placemen t will here be used to c ho ose suitable parameters of a PI/-regulator/. The con troller design is p erformed in t w o steps/. First the closed/1/2/8 Con trol of the DOlo op transfer function is deriv ed/, then the con troller parameters are deter/-mined from a user sp eci/#0Ced p ole/-placemen t/, e/.g/. a double p ole/.The transfer function for a con tin uous/-time PI/-regulator isX /#28 s /#29/= K /#28/1 /+
/1TI
s
/#29 E /#28 s /#29 /#28/5/./6/#29where X /#28 s /#29 and E /#28 s /#29 are the Laplace transforms of the con troller outputand error signal/, K is the prop ortional gain and TI
is the in tegration time/.The error signal is de/#0Cned ase /#28 t /#29/= yre f
/#28 t /#29 /, y /#28 t /#29 /#28/5/./7/#29Sampling the PI con troller /#28/5/./6/#29 with an Euler /#28bac kw ard di/#0Berence/#29 ap/-pro ximation giv esx /#28 t /#29/= K /#28/1 /+
qhTI
/#28 q /, /1/#29
/#29 e /#28 t /#29 /#28/5/./8/#29where h is the sampling p erio d/. By com bing the transfer function from x /#28 t /#29to y /#28 t /#29 in /#28/5/./5/#29 with the con troller /#28/5/./8/#29/, the closed lo op transfer functionfrom yre f
/#28 t /#29t o y /#28 t /#29 is found to b eHCL
/#28 z /#29/=
Kh
/#03/#28/#28/1 /+
hTI
/#29 z /, /1/#29z
/2/+ z /#28 h
/#03/#28
QV
/+ K /+
KhTI
/#29 /, /2/#29 /+ /1 /, h
/#03/#28
QV
/+ K /#29
/#28/5/./9/#29T o calculate suitable parameter v alues for K and TI
/, the closed lo opp oles are selected to b e a double p ole in z /= p /. Complex conjugated p olesw ould of course also be p ossible/, but will not be considered/. Comparingthe p oles of /#28/5/./9/#29 with the desired p ole lo cation/#28 z /, p /#29
/2/= z
/2/, /2 zp /+ p
/2/#28/5/./1/0/#29giv es t w o equations/, where K and TI
are found to b eK /=
/1 /, p
/2h
/#03
/,
QV
/#28/5/./1/1/#29TI
/=
h/1K
/#28
/2 /, /2 ph
/#03
/,
QV
/#29 /, /1
/#28/5/./1/2/#29This metho d is an easy w a y of tuning a PI/-con troller/. The user has only toc ho ose one parameter/, the p ole lo cation p /. The p ole lo cation appro ximatelytrades o/#0B con trol energy and sp eed/. A double p ole close to /1 giv es a slo wcon troller whic h is less sensitiv e to noise and mo deling errors/, while a p olelo cation close to the origin giv es a fast closed lo op system that/, ho w ev er/, issensitiv e system to noise and mo deling errors/./5/./2 The nonlinear DO con troller /1/2/9R emark /1/: T o calculate the con troller parameters K and TI
/, the param/-eter h
/#03is needed/, see /#28/4/./7/#29/. Since it in v olv es KL
a /#28 u /#29/, whic h is not kno wn/,this migh t b e di/#0Ecult/. Reasonable c hoices are to appro ximate KL
a /#28 u /#29i n hwith a /#0Cxed v alue of KL
a /#28 u /#29/, for example KL
a /#28 umax
/#29 /= /2/, or to iterate t wiceto /#0Cnd a reasonable u /#28 t /#29 whic h determines KL
a /#28 u /#29/.R emark /2/: F eedforw ard from yin
/#28 t /#29 ma y be used in com bination witha PI/-regulator/. The feedforw ard can be deriv ed from /#28B/./2/3/#29/, where thePI/-con troller has to be expressed in the form of R /#28 q
/, /1/#29 and S /#28 q
/, /1/#29 p oly/-nomials/. An alternativ e is to use a static feedforw ard comp ensator/.R emark /3/: The zeros can not be con trolled with this structure of thePI con troller/. Zeros slo w er than the p oles ma y cause o v ersho ot in the stepresp onse despite real v alued p oles/. Unstable zeros cause a non/-minim umphase system/, where the step resp onse /#0Crst ma y go in the wrong direction/.The zeros can b e mo v ed b y scaling the reference signal/.R emark /4/: The PI con troller /#28/5/./8/#29 can be implemen ted in di/#0Beren tialform/, i/.e/./#01 x /#28 t /#29 /= K /#28/#01 e /#28 t /#29/+
hTI
e /#28 t /#29/#29 /#28/5/./1/3/#29x /#28 t /#29 /= x /#28 t /, /1/#29 /+ /#01 x /#28 t /#29 /#28/5/./1/4/#29whic h mak es it easy to constrain the con trol signal when it has reac hed itslimit/./5/./2/./2 Linear quadratic /#28LQ/#29 con trol with feedforw ardAn LQ con troller with feedforw ard can be applied to the linearized DOpro cess /#28/5/./5/#29/. The con troller design is started b y rewriting the linearizedDO pro cess mo del /#28/5/./5/#29 in to q
/, /1notation/#28/1 /+ q
/, /1/#28
QV
h
/#03/, /1/#29/#29 y /#28 t /#29/= q
/, /1h
/#03x /#28 t /#29/+ q
/, /1h
/#03
QV
yin
/#28 t /#29 /, q
/, /1h
/#03R /#28 t /#29 /#28/5/./1/5/#29Assume that the respiration rate and the DO of the input /#0Do w can bemo deled as random w alks/, i/.e/.yin
/#28 t /#29/=
/1/#01
v/1
/#28 t /#29 R /#28 t /#29/=
/1/#01
v/2
/#28 t /#29 /#28/5/./1/6/#29Adding a term C /#28 q
/, /1/#29
/1/#01
e /#28 t /#29 to describ e unmo delled disturbances/, the mo del/#28/5/./1/5/#29 can b e written asA /#28 q
/, /1/#29 y /#28 t /#29 /= q
/, kB /#28 q
/, /1/#29 x /#28 t /#29/+ q
/, d/1D/1
/#28 q
/, /1/#29
/1/#01
v/1
/#28 t /#29/+ q
/, d/2D/2
/#28 q
/, /1/#29
/1/#01
v/2
/#28 t /#29/+ C /#28 q
/, /1/#29
/1/#01
e /#28 t /#29 /#28/5/./1/7/#29/1/3/0 Con trol of the DOwhere the noise sequences v/1
/#28 t /#29/, v/2
/#28 t /#29 and e /#28 t /#29 are all zero mean white noise/,and the p olynomials and parameters in are giv en b yA /#28 q
/, /1/#29/= /1 /+ q
/, /1/#28
QV
h
/#03/, /1/#29 D/1
/#28 q
/, /1/#29/= h
/#03
QVB /#28 q
/, /1/#29/= h
/#03D/2
/#28 q
/, /1/#29/= h
/#03C /#28 q
/, /1/#29/= /1 /+ cq
/, /1k /=/1 d/1
/=/1 d/2
/=/1The C /#28 q
/, /1/#29 p olynomial can b e considered as a user parameter and is c hosenso that /1 /=C b ecomes lo w/-pass/, as suggested in Section /3/./6/./2/. This c hoicemak es the con troller less noise sensitiv e since the high frequency gain isreduced/.The LQ/-con troller to b e used has the follo wing structureR /#28 q
/, /1/#29/#01 u /#28 t /#29/= T /#28 q
/, /1/#29 yre f
/#28 t /#29 /, S /#28 q
/, /1/#29 y /#28 t /#29 /,
Q/1
/#28 q
/, /1/#29P/1
/#28 q
/, /1/#29
yin
/#28 t /#29 /,
Q/2
/#28 q
/, /1/#29P/2
/#28 q
/, /1/#29
R /#28 t /#29/#28/5/./1/8/#29The deriv ation of the con troller p olynomials in /#28/5/./1/8/#29 are iden tical to thecalculations in Section /3/./6/./3 with b/2
/=/0 /. The T /#28 q
/, /1/#29 p olynomial is giv enb y /#28/3/./6/1/#29 in Section /3/./7/./6/.This con troller uses feedforw ard from b oth in/#0Duen t DO and in/#0Duen trespiration rate/. If all aerated zones are con trolled/, the in/#0Duen t DO to azone can then b e exp ected to ha v e small v ariations/. Not m uc h can then b egained b y using feedforw ard from in/#0Duen tw ater/.The respiration rate can either be measured b y a respirometer or es/-timated b y the algorithm outlined in Chapter /4/. Note that it is p ossibleto /#0Cx KL
a and only estimate the respiration rate b y setting all elemen tsin the co v ariance matrix to zero/, except for the ones corresp onding to therespiration rate/. It is then not necessary to use a high excitation in theair/#0Do w rate to estimate the respiration rate/.R emark/: F or the DO pro cess/, it is p ossible to calculate the PI/-con trollerparameters K and TI
from the p ole lo cation in /#0C /, see /#28B/./1/2/#29/. The PI/-con troller will/, ho w ev er/, not be iden tical to the LQ/-con troller/, since thePI/-con troller mo v es the closed lo op zeros/, whic h the LQ/-con troller do esnot/./5/./3 Sim ulationsIn Section /5/./1 a sim ulation example w as giv en where the nonlinear KL
a w asnot tak en in to accoun t in the con troller design/. This resulted in oscillativ econ trol/. Some additional examples are giv en here/, where the adv an tage of/5/./3 Sim ulations /1/3/1nonlinear con trol is illustrated/. An example where feedforw ard from therespiration rate is applied/, is also sho wn/./5/./3/./1 Sim ulation setupIn the sim ulations in this section the follo wing setup has b een used/, whic hto some exten t corresp onds to the /#0Crst aerated zone in the pilot plan t atKungs/#7F angsv erk et/, see Section /2/./1/.The true system has b een sim ulated b y /#28/5/./1/#29/, i/.e/.y /#28 t /+/1 /#29 /= y /#28 t /#29/+ h
/#03/#5B
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29 /+ KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 /, R /#28 t /#29/#5D /#28/5/./1/9/#29where/#0F The /#0Do w through the zone/, Q /= /1/0/0/0 l/#2Fh/#0F The v olume of zone/, V /= /6/3/0 l/#0F The saturated DO/, ysat
/= /1/0 mg/#2Fl/#0F The in/#0Duen t DO/, yin
/#28 t /#29 /= /0 mg/#2Fl/#0F The o xygen transfer function/, KL
a /#28 u /#29 /= /1/5/#28/1 /, e
/, /1/5
u /#28 t /#29/1/0/0/0/#29h
/, /1/#0F Tw o cases for v ariations of the respiration rate R /#28 t /#29 are considered/,al o w load case and a high load case/. In the lo w load case there is astep from /4/0 to /5 mg O/2
/#2Fl/#2Fh/, and in the high load case a step from/6/0 to /8/5 mg O/2
/#2Fl/#2Fh/./#0F h
/#03/#28 t /#29/=
/1A /#28 t /#29
/#28 e
A /#28 t /#29 h/, /1/#29/, A /#28 t /#29/= /, /#28 KL
a /#28 u /#28 t /#29/#29 /+
Q /#28 t /#29V
/#29/#0F The sampling p erio d/, h /=/1 /= /3/6/0 h/#0F The KL
a used for generating the data and the KL
a used in the non/-linear con troller design are iden tical/.T o get a fair comparison b et w een the linear and nonlinear con troller/, b othcon trollers should be tuned for equal p erformance at a giv en op eratingp oin t/. This can b e ac hiev ed b y adjusting the gain of the con trollers appro/-priately /.F or the linear PI/-con troller/, the con troller gain is constan t at all op/-erating p oin ts/. This gain is denoted b y K
li nPI
/. The gain of the nonlinear/1/3/2 Con trol of the DOPI/-con troller can b e considered to consist of t w o parts/. A linear part fromthe PI/-con troller/, denoted K
nonl inPI
and the gain from the in v erse of the es/-timated KL
a function/. The latter gain is denoted b y K
nonl ininv
/. A t a giv enop erating p oin t/#28 u/0
/#29/, it is determined b yK
nonl ininv
/=
/1dKL
a /#28 u /#29du
/#28 ysat
/, y /#28 t /#29/#29
ju /= u/0
/#28/5/./2/0/#29The linear and the nonlinear con troller b ecomes equal at a giv en op eratingp oin ti fK
li nPI
/= K
nonl ininv
K
nonl inPI
/#28/5/./2/1/#29This relation will b e used in the comparisons/.R emark/: The sim ulations here corresp ond to v alues of the pilot plan ta tKungs/#7F angsv erk et/, where the air/#0Do w rate cannot b e measured/. The air/#0Do wrate u /#28 t /#29 is instead replaced b y the v alv e op ening in the sim ulations/./5/./3/./2 ExamplesThe follo wing sim ulation examples are giv en here/:/#0F F ast con trol of the DO/, corresp onding to p ole placemen t in /0/./5/./#0F Slo w er con trol of the DO/, corresp onding to p ole placemen t in /0/./9/./#0F LQ con trol with and without feedforw ard/.All examples are sim ulated b oth for a step c hange at lo w load where therespiration rate decreases from /4/0 to /5 mg O/2
/#2Fl/#2Fh/, and at a high load wherethe respiration rate increases from /6/0 to /8/5 mg O/2
/#2Fl/#2Fh/.The parameters of the nonlinear PI/-con troller are determined b y /#28/5/./1/1/#29and /#28/5/./1/2/#29/, and the gain of the linear con troller is giv en b y /#28/5/./2/1/#29/.The fast con trol case is sho wn in Figure /5/./3/. The /#0Cgure illustratesthat a linear con troller whic hw orks w ell for lo w loads b ecomes quite slo wduring high loads/. If the linear con troller instead is tuned for a high loadit b ecomes oscillativ e for a lo w load/. The nonlinear con troller on the otherhand k eeps the system w ell damp ed at all loads/. The reason is that thenonlinear con troller c hange its gain to comp ensate for the gain c hanges inthe system/.In the next example/, a case is illustrated where the con trollers are tunedto be slo w er than in Figure /5/./3/. What can be seen in Figure /5/./4 is that/5/./3 Sim ulations /1/3/3
0 1 2 35060708090100
time [min]%Valve opening (airflow rate)0 1 2 31.861.881.91.921.941.961.9822.022.04
time [min]mg/lDissolved oxygen concentration
0 1 2 31.9822.022.042.062.082.1
time [min]mg/lDissolved oxygen concentration
0 1 2 3−50510152025
time [min]%Valve opening (airflow rate)Figure /5/./3/: F ast con trol of the DO/. The DO and v alv e op eningsare sho wn for a step disturbance in the respiration rate during a highload /#28left column/#29 and a lo w load /#28righ t column/#29/. The reference v alue/#28dash/-dotted/#29 is /2 mg/#2Fl/. Tw o linear PI con trollers are used/, one tunedat a high load /#28solid/#29 and another tuned at a lo w load /#28dotted/#29/. Thenonlinear PI/-con troller is also sho wn /#28dashed/#29/.the disturbance at a high load is rejected considerably slo w er b y the linearcon troller compared to the nonlinear/, when they are tuned for equal p er/-formance at a lo w load/. A linear con troller tuned at a high load b ecomesinstead faster at the load load/, while the nonlinear con troller main tain thesame sp eed at all op erating p oin ts/.F eedforw ard ma y be included to reject measurable disturbances/. Anexample in Figure /5/./5 sho ws the result of a nonlinear LQ con troller withfeedforw ard from the respiration rate/. The same con troller/, but withoutfeedforw ard/, is for comparison also illustrated in the same /#0Cgure/. Zeromean white noise with standard deviation /0/./0/2 has b een added to the DO
measuremen ts/, to illustrate the noise sensivit y of the con troller/. As canbe seen in Figure /5/./5/, the feedforw ard con troller completely rejects the/1/3/4 Con trol of the DO
0 5 10 151.61.82
time [min]mg/lDissolved oxygen concentration
0 5 10 15405060708090100
time [min]%Valve opening (airflow rate)0 5 10 1522.12.22.3
time [min]mg/lDissolved oxygen concentration
0 5 10 15051015202530
time [min]%Valve opening (airflow rate)Figure /5/./4/: Slo w er con trol of the DO/. The DO and v alv e op eningsare sho wn for a step disturbance in the respiration rate during a highload /#28left column/#29 and a lo w load /#28righ t column/#29/. The reference v alue/#28dash/-dotted/#29 is /2 mg/#2Fl/. Tw o linear PI con trollers are used/, one tunedat a high load /#28dotted/#29 and another tuned at a lo w load /#28solid/#29/. Thenonlinear PI/-con troller is also sho wn /#28dashed/#29/.disturbance/, while the output is disturb ed quite m uc h for the con trollerwithout feedforw ard/.The LQ con troller in Figure /5/./5 uses separate p enalties on the mea/-surable and unmeasurable disturbances/, /#1Ae
/= /1/0
/, /3and /#1Av
/= /1/0
/, /4/. TheC /-p olynomial is set to C /#28 q
/, /1/#29/= /1 /, /0 /: /9 q
/, /1/. If the zero of the C /-p olynomialis c hosen close to /1/, the con troller b ecomes less sensitiv e to measuremen tnoise since the high frequency gain in the feedbac k lo op then is reduced/./5/./3 Sim ulations /1/3/5
0 5 10405060708090100
time [min]%Valve opening (airflow rate)
0 5 10010203040
time [min]%Valve opening (airflow rate)0 5 101.922.12.22.32.4
time [min]mg/lDissolved oxygen concentration
0 5 101.71.81.922.1
time [min]mg/lDissolved oxygen concentrationFigure /5/./5/: Nonlinear LQ con trol with /#28dashed/#29 and without /#28solid/#29feedforw ard/. The DO and v alv e op enings are sho wn for a step distur/-bance in the respiration rate during a high load /#28left plots/#29 and a lo wload /#28righ t plots/#29/. The reference v alue /#28dash/-dotted/#29 is /2 mg/#2Fl/./1/3/6 Con trol of the DO/5/./4 Practical exp erimen tThe suggested nonlinear PI/-con troller w as tested at the pilot plan t in Up/-psala and compared to a linear PI/-con troller/.The exp erimen t w as p erformed in the /#0Crst aerobic zone in the pilotplan t/, where the load v ariations are exp ected to b e largest and the nonlinearcon troller migh t b e most useful/.The exp erimen tw as started b y estimating the nonlinear KL
a function/.In the estimation sc heme w e used the estimation algorithm presen ted inChapter /4 with an exp onen tial KL
a mo del/. The estimated respirationrate w as also compared with lab measuremen ts to assess if the estimatedrespiration rate w as reasonable/. If the estimated and measured respirationrates do not di/#0Ber to o m uc h/, the estimated KL
a is regarded as reasonable/.The estimated KL
a function is sho wn in Figure /5/./6/.
0 50 1000246810
Valve opening [%][1/h]Figure /5/./6/: The estimated KL
a to b e used in the con troller design/.In the exp erimen t/, c hanges in DO set/-p oin tw as made instead of c hangesin respiration rate whic h is more di/#0Ecult generate/. T o sim ulate a decreasein the respiration rate the DO set/-p oin t is lo w ered from appro ximately /4mg/#2Fl to /1 mg/#2Fl at t /= /7 min /#28the time t and initial DO set/-p oin t is sligh tlydi/#0Beren t in the t w o /#0Cgures/#29/. First the p erformance of the linear con troller isstudied/, this is sho wn in Figure /5/./7/. As seen the p erformance is acceptableat a high air/#0Do w rate/, but at the lo w DO set/-p oin t/, where the air/#0Do w rateis lo w the p erformance deteriorates signi/#0Ccan tly /. The con trolled pro cessstarts to oscillate for lo w air/#0Do w rates as predicted b y the sim ulations/. Inparticular this t yp e of oscillations ma y deteriorate the con trol v alv e/.Next/, the nonlinear con troller whic h uses the estimated KL
a w as ap/-plied/. Figure /5/./8 illustrates the p erformance of the nonlinear con troller/.This con troller giv es a m uc h b etter result for the lo w DO set/-p oin t/, since/5/./4 Practical exp erimen t /1/3/7
0 5 10 15 20 2501234
time [min]mg/lDissolved oxygen concentration
0 5 10 15 20 25020406080100
time [min]%Valve openingFigure /5/./7/: Linear con trol of the dissolv ed o xygen concen tration/.The DO set/-p oin t is dashed/.the nonlinear con troller reduces its gain at the lo w air/#0Do w rate/. The os/-cillations in the con trol signal for the high DO set/-p oin t probably dep endson the large con troller gain in com bination with the neglected dynamics inthe sensor/.The nonlinear con troller hence has acceptable p erformance for all w ork/-ing conditions/, while the linear con troller starts to oscillate for lo w air/#0Do wrates/. This result illustrates that the DO pro cess actually is nonlinear/, anda nonlinear con troller/, also in practice/, can outp erform a linear con troller/./1/3/8 Con trol of the DO
0 5 10 15 20 25012345
time [min]mg/lDissolved oxygen concentration
0 5 10 15 20 25020406080100
time [min]%Valve openingFigure /5/./8/: Nonlinear con trol of the dissolv ed o xygen concen tration/.The DO set/-p oin t is dashed/./5/./5 Con trol of the dissolv ed o xygen set/-p oin t /1/3/9/5/./5 Con trol of the dissolv ed o xygen set/-p oin tIn the aerobic part of an activ ated sludge pro cess/, ammonium is con v ertedto nitrate b y nitri/#0Ccation/, see also Section /1/./3/. The nitri/#0Ccation pro cessrequires o xygen/, whic h is obtained b y blo wing air in to the tank/. Normallya constan t DO/, con trolled b yv arying the air/#0Do w rate guaran tees that suf/-/#0Ccien to xygen is supplied to the pro cess/. An alternativ e to a constan t DOset/-p oin t is to use a time/-varying DO set/-p oin t/, whic h is determined b ythe ammonium concen tration in the last aerobic zone/, see also e/.g/. Nielsenand Lynggaard /#28/1/9/9/3/#29/, and Sorensen et al/. /#28/1/9/9/4/#29 for con trol of the DOset/-p oin t in a Bio/-denitro
TMpro cess/.The DO set/-p oin t con trol giv es or ma y giv e the follo wing adv an tages/,dep ending on the existing plan t p erformance/:/#0F Better con trol of e/#0Fuen t ammonium/./#0F Lo w er a v erage DO set/-p oin t whic h sa v es energy /#28due to a lo w er airconsumption/#29/./#0F Lo w er nitrate concen tration in the e/#0Fuen t/, b ecause of impro v ed den/-itri/#0Ccation due to a lo w er DO/./#0F Lo w er dosage of external carb on /#28if it is added/#29/.P ossible disadv an tages ma y be that the sludge prop erties deteriorate dueto the lo w DO/, and that nitrous o xide /#28N/2
O/#29 can be formed when theDO is lo w/. These problems should/, ho w ev er/, b e compared to the ac hiev edimpro v emen ts/. Another v arian t of DO set/-p oin t con trol ma y reduce theseproblems/. When there are sev eral aerated zones/, whic h often is the case/,spatial DO con trol is p ossible/. The idea is to switc h on or o/#0B aeration inthe /#0Crst or last zone/#28s/#29 when the DO set/-p oin t b ecomes to o high or to olo w/. This latter strategy a v oids that the DO set/-p oin t b ecomes to o lo w/,and it is probably b etter than using the same DO set/-p oin t in all aeratedzones/. This strategy has/, ho w ev er/, not b een ev aluated/.The basic idea is to con trol the DO set/-p oin t from on/-line measure/-men ts of the ammonium concen tration/, this is illustrated in Figure /5/./9/.This structure is referred to as cascade con trol/, where the inner DO lo opis m uc h faster than outer the ammonium lo op/. The con troller tries tomain tain a presp eci/#0Ced ammonium concen tration b y v arying the DO set/-p oin t/. T o a v oid the DO set/-p oin t b ecomes to o high or to o lo w/, it shouldonly be allo w ed to v ary in an in terv al e/.g/. /0/./5/#7B/4 mg O/2
/#2Fl/, whic h is easilyimplemen ted/./1/4/0 Con trol of the DO/-/-/- /-
/- /-/-Pro cess
Activ atedSludgeCon troller
DO
Set/-p oin tCon trollerDO
DOre fAir
NH
/+/4NH
/+/4 /;r efFigure /5/./9/: Blo c k diagram of the DO set/-p oin t con trollerThe ammonium set/-p oin t should usually be c hosen lo w/, but if thereare problems to main tain this lo w concen tration one could increase theammonium set/-p oin t/, to reduce the DO set/-p oin t/./5/./5/./1 A practical exp erimen tA practical exp erimen t with the DO set/-p oin t con troller has b een made inthe pilot plan t/.The same DO set/-p oin t w as used in all three aerated zones/. The am/-monium concen tration w as measured in the last aerated zone where thehighest ammonium concen tration is exp ected to b e found/, see also Figure/5/./1/0/. The ammonium sensor giv es a new v alue ev ery /2/0th min ute/. The
DO DO DO NH44, refDOrefV1
V3V2ControllerSet-Point
ControllerDO
NH
V1 V2 V3Figure /5/./1/0/: La y out of the plan t with the sensor placemen t togetherwith the con troller/./#0Do ws w ere k ept constan t during the whole exp erimen t/, and they w ere/: in/-/#0Duen t/=/2/2/0 l/#2Fh/, in ternal rec/./=/6/6/0 l/#2Fh/, return sludge/=/2/6/0 l/#2Fh and excess/5/./5 Con trol of the dissolv ed o xygen set/-p oin t /1/4/1sludge/=/0 l/#2Fh/. The mean susp ended solids concen tration w as /1/./5 g/#2Fl /#28andincreasing/#29/, and the w ater temp erature w as /7
oC/.The exp erimen t is illustrated in Figure /5/./1/1/. The set/-p oin t con troller
0 1 2 3 4 5 6 7 802468101214161820Effluent nitrate in line 1 & 2, ammonium and DO set−point in line 1 mg/l
time [days]DO set−point
AmmoniumNitrate 1Nitrate 2Figure /5/./1/1/: Con trol of the DO set/-p oin t/. The con trol w as startedafter /1/./5 da ys with an ammonium set/-p oin t of /1 mg/#2Fl/. The exp erimen tsw ere made in line /1/, line /2 w as used as a reference/.w as started after appro ximately /1/./5 da ys with a set/-p oin t of the ammoniumconcen tration at /1 mg/#2Fl/. Since the ammonium lev el w as lo w er than theammonium set/-p oin t/, the DO set/-p oin tw as decreased from /2 mg/#2Fl to b elo w/1 mg/#2Fl/. The exp erimen ts w ere made in line /1 while line /2 w as used asreference/. The large abrupt c hanges in the nitrate concen trations at t /=/1 /: /5and t /=/5 /: /5 in Figure /5/./1/1 are caused b y calibrations of the nitrate sensor/.A p ositiv e e/#0Bect of the lo w er DO lev el w as that the e/#0Fuen t nitrate lev elw as signi/#0Ccan tly decreased/. Note that the total e/#0Fuen t nitrate lev el forthe con trolled line /#28/1/#29 is reduced to less than half/. E/#0Fuen t ammoniumw as increased from ab out zero to the set/-p oin t of /1 mg/#2Fl/, but this minorincrease should b e compared with the large reduction in e/#0Fuen t nitrate/./1/4/2 Con trol of the DOThe signi/#0Ccan t reduction in nitrate whic hw as found in the pilot plan texp erimen t is probably not p ossible to reac h in a more optimized plan t/.In for example plan ts with a large ano xic zone/, the nitrate reduction willprobably not be that large/. Also/, the comp osition of the in/#0Duen t carb onma y a/#0Bect the results/. The large p oten tial in terms of energy sa vings andnitrogen reduction of this con trol strategy should ho w ev er still b e consid/-ered/./5/./5/./2 T uning of the DO set/-p oin t con trollerThe con troller used in Figure /5/./1/1 w as not accurately tuned/. Both the DOset/-p oin t and ammonium concen tration sometimes oscillated/. A w a y totune the con troller could b e to estimate a mo del b et w een the DO set/-p oin tand the ammonium concen tration/, and use it for con troller design/.Only v ery lo wD O lev els /#28around /0/./5 mg/#2Fl/#29 w ere needed to remo v e allammonium in this con/#0Cguration of the pilot plan t/. These lev els w ere hardto obtain/, since a v alv e op ening smaller than /1/0/#25 is not suitable if themixing in the zone should b e su/#0Ecien t/. A mo del b et w een actual DO /#28notset/-p oin t/#29 and ammonium w as hence estimated instead/.An excitation exp erimen t of the DO set/-p oin ti ss h o wn in Figure /5/./1/2/.As can b e seen/, the v alv e saturated in its lo w er p osition during long p erio ds/.When this happ en and the DO is high /#28higher than the set/-p oin t/#29/, theammonium concen tration did not increase/. Therefore it is not suitable touse all the data in Figure /5/./1/2 to iden tify a mo del/. Instead/, only the databe t w een appro ximately /8 /#7B /3/8 h is used/.After remo ving the mean v alue of the DO and ammonium/, an estimationalgorithm w as applied to the data/. Sim ulating the iden ti/#0Ced mo del giv esthe result sho wn in Figure /5/./1/3/, where the mean v alues ha v e b een addedagain after the sim ulation/. As can b e seen/, the output error /#28OE/#29 metho dgiv es a sligh tly b etter result than the LS metho d with an ARX mo del/.The ARX structure isy /#28 t /#29/=
B /#28 q
/, /1/#29A /#28 q
/, /1/#29
q
/, /1u /#28 t /#29/+
/1A /#28 q
/, /1/#29
e /#28 t /#29 /#28/5/./2/2/#29where y /#28 t /#29 is the ammonium concen tration and u /#28 t /#29 is the dissolv ed o xygenconcen tration/. The LS metho d ga v e A /#28 q
/, /1/#29/=/1 /, /0 /: /9/5/3/8 q
/, /1and B /#28 q
/, /1/#29/=/, /0 /: /2/2/1/7/./5/./5 Con trol of the dissolv ed o xygen set/-p oin t /1/4/3
0 10 20 30 40 50 60 70 8000.511.5DO, DO set−point and valve opening/100
time [h]
0 10 20 30 40 50 60 70 80012Ammonium concentrationmg/l
time [h]Figure /5/./1/2/: Excitation of the DO set/-p oin ti n the pilot plan t/, forgenerating data to estimate the dynamics b et w een DO set/-p oin t andammonium concen tration/. In the upp er plot are DO /#28solid/#29 DO set/-p oin t /#28dotted/#29 and v alv e op ening/#2F/1/0/0 /#28dashed/#29 sho wn/. In the lo w erplot/, the ammonium concen tration is sho wn/.The output error structure isy /#28 t /#29/=
B /#28 q
/, /1/#29A /#28 q
/, /1/#29
q
/, /1u /#28 t /#29/+ e /#28 t /#29 /#28/5/./2/3/#29Applying the OE metho d ga v e A /#28 q
/, /1/#29 /= /1 /, /0 /: /9/6/7/5 q
/, /1and B /#28 q
/, /1/#29 /=/, /0 /: /2/1/1/5/.Some adv an tages with the OE metho d are giv en in S/#7F oderstr/#7F om /#28/1/9/9/6/#29/.They are/:/#0F The estimates ma y b e consisten te v en if the noise is colored/./#0F The n um b er of parameters could b e c hosen lo w/, b ecause the noise isnot mo deled/./1/4/4 Con trol of the DO
5 10 15 20 25 30 35 40012Measured and simulated ammonium concentration
time [h]mg/l5 10 15 20 25 30 35 4011.52Dissolved oxygen concentration
time [h]mg/lFigure /5/./1/3/: A suitable part of the data from Figure /5/./1/2/, usedto iden tify a mo del b et w een DO and ammonium/. In the lo w er plot/,measured NH/4
/#28solid blac k line/#29/, sim ulated NH/4
with OE/-est/. mo del/#28grey line/#29/, and sim ulated NH/4
with LS/-est/. mo del /#28dashed line/#29/./#0F The OE mo del will b e g ood in the frequency range where the inputsignal is strong/. The LS metho d often emphasize the mo deling in to ohigh frequencies/.The iden ti/#0Ced mo del b et w een DO and ammonium concen tration has thesame degrees of p olynomials and time dela y as the previous linearized DOmo del /#28/5/./5/#29/. The same approac h for determining the con troller parameterscan hence b e used in this con troller design as w as used for the DO linearizedcon troller/.R emark/: In this exp erimen t all /#0Do ws w ere k ept constan t/. That is p er/-haps not the most common case for a normal WWTP /. Since the /#0Do w ratesw ere not considered in the previous outlined design/, a p ossible solutioncould b e to mak e the iden ti/#0Ccation during /`normal /#0Do ws/, and then designa con troller whic h is only sligh tly faster than the op en lo op system/. The/5/./6 Pressure con trol /1/4/5biomass and other factors whic h a/#0Bect the nitri/#0Ccation rate are not consid/-ered either/. T o main tain a high p erformance during the y ear a couple oftuning ev en ts ma y b e necessary /, or an adaptiv e con troller could b e imple/-men ted/./5/./6 Pressure con trolF or completeness/, a con troller whic h con trols the pressure in the air blo w/-ing system is also describ ed/. This strategy has b een giv en b efore b y /, forexample Rundqwist /#28/1/9/8/6/#29 and Robinson /#28/1/9/9/0/#29/. The reasons for con trol/-ling the air pressure are to guaran tee that su/#0Ecien t air is generated/, andto sa v e energy /.The air/#0Do w rate in an activ ated sludge pro cess is often con trolled b ythrottle v alv es/. T o minimize the loss of energy /, the most op ened v alv eshould be k ept completely op en/. The standard solution to this problemis illustrated in the blo c k diagram in Figure /5/./1/4/. The idea is to measurethe v alv e op enings and feed bac k the most op en v alv e/#28 /'max
/#29 to the pres/-sure con troller/. The con troller increases the pressure if /'max
/#3E /'re f
anddecreases it if /'max
/#3C/'re f
/. Note the signs at the summation p oin t/.One w ould lik et o k eep the most op en v alv e /1/0/0/#25 op en/, but there w ouldthen b e no con trol authorit y in the p ositiv e direction/, due to the pressurecon troller is tuned to be slo w/. The pressure con troller should be madeslo w due the coupling e/#0Bects be t w een the v alv es and a complicated highfrequency dynamics/, see Rundqwist /#28/1/9/8/6/#29/.In order to illustrate the approac h/, a practical exp erimen t in the pilotplan t has b een p erformed/. This is illustrated in Figure /5/./1/5/. The previouscon troller is implemen ted in line /1 and line /2 is used as a reference/.The pressure is con trolled to mak e the most op en v alv e equal to theset/-p oin t /#28/9/0/#25/#29/. The con troller manage to do this v ery w ell/. The v alv eop ening for the /#0Crst zone la ys almost p erfect at /9/0/#25/. The DO is also k eptv ery close to its set/-p oin t at /2mg/#2Fl in zone /1/. F or the other zones the DOsometimes is ab o v e the set/-p oin t due to the v alv es are not allo w ed to ha v ea smaller op ening than /1/0/#25/. In Figure /5/./1/5 the pressure v ariation is alsosho wn/. It v aries due to the c hanging load/. In the other line /#28/2/#29 the pressureis hold constan t during the exp erimen t/. T o mak e sure the pro cess alw a ysget su/#0Ecien t o xygen the constan t pressure has to be selected high/. Thelargest v alv e op ening in line /2 is most of the time around /3/0/#25 op en whic hmeans that an unnecessary high pressure is used whic h costs more energythan the time v arying pressure/./1/4/6 Con trol of the DO/#1A/#19
/#1B/#18PI/-regAir pro d/.
/- /- /-
AAA /#01
/#01
/#01
A
A
A /#01/#01/#01
/-/- /-
/-
/- /-/-MAX/#1B
/#1B
/#1B
/#01/#01/#01 A
A
A/6
/'re f
Pre f
P
u/1u/2u/3un
/,/+/'maxFigure /5/./1/4/: A pressure con troller/, whose goal is to k eep the mostop en v alv e /'max
equal to the reference v alv e op ening /'re f
/.The tuning of the pressure con troller could either b e done man ually orb e based on an estimated mo del/./5/./6 Pressure con trol /1/4/7
0 50 1000.511.52DO in line 1
time [h]mg/l
0 50 1000.511.52DO in line 2
time [h]mg/l
0 50 100020406080100Valve openings in line 1
time [h]%
0 50 100020406080100Valve openings in line 2%
time [h]
0 50 100606570758085Air pressure (control signal)
time [h]%Figure /5/./1/5/: Exp erimen t in the pilot plan t with the pressure con/-troller/. The DO set/-p oin ts for the three zones in b oth lines ha v e b eenset to /2 mg/#2Fl/, but the DO in zone /2 and /3 are shifted in the plotwith /0/./5 mg/#2Fl resp ectiv ely /1/./0 mg/#2Fl/. The v alv e op enings in the zonesin b oth lines are also sho wn/. The minim um allo w ed v alv e op ening is/1/0 /#25 to obtain su/#0Ecien t mixing/. This causes the con trolled DO tob ecome higher than the set/-p oin t in some zones/./1/4/8 Con trol of the DO/5/./7 ConclusionsThe con trol of the DO in an activ ated sludge pro cess is an imp ortan t prob/-lem b oth for economical and pro cess reasons/. The basic idea has b een toexplicitly tak e the nonlinear o xygen transfer function KL
a in to accoun ti nthe con trol design/. The o xygen transfer function w as found from an estima/-tion exp erimen t where a Kalman /#0Clter w as used/. Tw o design approac hesw ere applied on the linearized pro cess/: p ole/-placemen t with a PI/-regulatorand linear quadratic con trol with feedforw ard/.In a sim ulation study /, the p erformance of the con trollers w ere illus/-trated/. It w as sho wn that the nonlinear DO con troller outp erforms a stan/-dard linear PI con troller/. The nonlinear con troller has also b een tested in apilot plan t/. The tests con/#0Crmed the p ositiv e results from the sim ulations/.A set/-p oin t con troller for the DO pro cess w as presen ted/. The basicidea w as to con trol the DO set/-p oin t so that the ammonium concen trationin the last aerobic zone w as k ept lo w/. An exp erimen t in the pilot plan tsho w ed that/, b y using this con troller not only energy could b e sa v ed due toa lo w er DO set/-p oin t/, but also the e/#0Fuen t nitrate concen tration b ecomessigni/#0Ccan tly lo w er/. Ho w the set/-p oin t con troller could be tuned w as alsodiscussed/.Finally an exp erimen t with a pressure con troller in the pilot plan tw asmade/. It illustrated that it w as p ossible to con trol the air pressure so thatthe most op en v alv ew as almost completely op en/.Chapter /6Multiv ariable mo deling andcon trolThe activ ated sludge pro cess is a quite complex pro cess where man y statesand nonlinear relations are in v olv ed/. The pro cess is m ultiv ariable/, i/.e/. ithas sev eral inputs and outputs/. This means among other things that oneinput a/#0Bects sev eral outputs/. F or example/, a c hange in the air/#0Do w ratea/#0Bect b oth the ammonium and nitrate concen trations/. Another problemis that the activ ated sludge pro cess is nonlinear/, for example the dynamicsdep ends on actual /#0Do w rates and concen trations/.In this c hapter/, a linear time/-in v arian tm ultiv ariable mo del is estimatedaround an op erating p oin t/. The mo del uses the external carb on /#0Do w rate/,the in ternal recirculation rate/, and the DO set/-p oin t as inputs /#28the DOset/-p oin t can be used as input instead of the air/#0Do w rate when cascadecon trol is applied/#29/. Ammonium and nitrate in the last aerated zone areused as outputs/. The mo del also includes in/#0Duen t /#0Do w rate/, in/#0Duen t am/-monium and in/#0Duen t carb on /#28substrate/#29 as measurable disturbances/. Theestimated mo del is then used for con troller design/. Tw o di/#0Beren ti n tegrat/-ing LQ con trollers are designed whic h uses feedforw ard from the measurabledisturbances/.The main adv an tage of suc h a con troller is that it tak es the in terac/-tions in the pro cess mo del in to accoun t and an optimal /#28in an LQ sense/#29trade/-o/#0B be t w een the di/#0Beren t inputs and outputs can be utilized/. In thepast/, mostly SISO /#28single input single output/#29 con trol strategies ha v e b eensuggested for con trol of the nitrate and ammonium concen tration/. F orexample/, Londong /#28/1/9/9/2/#29 con trolled the nitrate lev el b yv arying the in ter/-/1/5/0 Multiv ariable mo deling and con trolnal recirculation rate and Lindb erg and Carlsson /#28/1/9/9/6 a /#29 b y v arying thedosage of an external carb on source/. The ammonium concen tration can b econ trolled b y the DO/. This has b een demonstrated in e/.g/. Lindb erg andCarlsson /#28/1/9/9/6 d /#29 and Sorensen et al/. /#28/1/9/9/4/#29/. F ew examples of m ultiv ari/-able con trol applied to w astew ater treatmen t is found in the literature/, andthose who are found ha v e not con trolled the ammonium and nitrate lev el/.F or examples/, Do c hain and P errier /#28/1/9/9/3/#29/, Bastin and Do c hain /#28/1/9/9/0/#29/,and Y oussef et al/. /#28/1/9/9/5/#29 ha v e designed m ultiv ariable con trollers/, but onlyv alidated their con trol strategy on simpli/#0Ced mo dels/./6/./1 Mo delingAs men tioned previously /, the activ ated sludge pro cess is a complex pro cesswhere man y comp onen ts and nonlinear relations are in v olv ed/. It is hencea delicate problem to /#0Cnd a mo del whic h su/#0Ecien tly w ell describ e thispro cess/. One w a y to /#0Cnd suc h a mo del is to use ph ysical kno wledge of thepro cess/. Sev eral suc h mo dels ha v e b een suggested/, and the most widely usedone is probably the IA W Q mo del/, presen ted b y Henze et al/. /#28/1/9/8/7/#29/, see alsoChapter /2/. This mo del con tains /1/3 coupled nonlinear di/#0Beren tial equationsand around /2/0 more or less unkno wn parameters/. An activ ated sludgepro cess also consists of sev eral zones and a settler/. The IA W Q mo del onlydescrib es one zone/. Sev eral IA W Q mo dels therefore ha v e to b e connected toeac h other in order to mo del a bioreactor/. Finally a settler mo del/, ab out ascomplex as the IA W Q mo del/, also has to b e included/. It is not easy to tunesuc h a mo del or use it for con troller design/. Another approac h to mo delingis to use a blac k/-b o x mo del/, whic h is linear and time in v arian t/. A systemiden ti/#0Ccation metho d can then b e applied to estimate its parameters frominput/-output data/. Suc h a mo del is suitable for con troller design/, whic his the main purp ose here/. It will also be sho wn /#28b y sim ulations/#29 that theiden ti/#0Ced blac k/-b o x mo del/, describ es the activ ated sludge pro cess w ell/, atleast around an op erating p oin t/. A dra wbac k with this t yp e of mo del isthat the ph ysical insigh t of the pro cess is lost/. F or example/, the states arearti/#0Ccial and it is not p ossible to understand ho w a pro cess v ariable/, whic hnot is directly included in the mo del/, a/#0Bects the pro cess/. An adv an tage isthat this mo del only needs input/#2Foutput data to b e estimated/.Since the activ ated sludge pro cess is nonlinear w e ma y need di/#0Beren tsets of linear mo dels to be able to appro ximate the pro cess at di/#0Beren top erating p oin ts/. When the activ ated sludge pro cess is con trolled w e tryto sta y around an op erating p oin t/. This reduces the nonlinear e/#0Bects/, andit ma y be su/#0Ecien t with only one linear mo del/. It will also be sho wn /#28b y/6/./1 Mo deling /1/5/1sim ulations/#29 that the estimated mo del w orks w ell for large c hanges in b othin/#0Duen t /#0Do ws and in/#0Duen t concen trations/. If/, ho w ev er/, one linear mo delcan not appro ximate the real pro cess/, a couple of mo dels ma y be used atdi/#0Beren t op erating p oin ts/.Grey/-b o x mo deling/, where parts of the ph ysical mo del structure is in/-cluded/, could b e an alternativ e to blac k/-b o x mo deling/. Since the structureis v ery complex in the connected IA W Q mo dels and the settler mo del/, suc han approac h has b een abandoned/./6/./1/./1 What to mo del/?What to mo del is an in teresting question/. Often one kno ws what to mo delsince the inputs and outputs are kno wn/, and the mo del establishes a relationbe t w een these signals/. F or an activ ated sludge pro cess it is/, ho w ev er/, notclear what should be considered as an input or an output/. This dep endsamong other things on the purp ose of the mo del/. Wher e to measure is notob vious either/.The purp ose of the mo deling is/, as men tioned b efore/, to use the deriv edmo del for con troller design/. In an activ ated sludge pro cess it is desired tok eep the e/#0Fuen t ammonium concen tration and the e/#0Fuen t nitrate concen/-tration at lo w lev els/. Our aim will therefore b e to con trol these concen tra/-tions/, and k eep them close to the desired set/-p oin ts/.The activ ated sludge pro cess con tains dynamics with time constan tswhic h range from seconds /#28e/.g/. pressure in air pip es/#29 to w eeks /#28e/.g/. sludgereten tion time/#29/. T o co v er all dynamics in one mo del is not suitable/. Ab etter solution is to divide the mo del in to a couple of smaller mo dels whic happro ximately ha v e the same time constan ts/. The set/-p oin t of a fast pro cesscan then b e con trolled b ya slo w er pro cess /#28cascade con trol/#29/. In that w a ythe fast dynamics ma y be neglected when considering the slo w er mo dels/.An example is a mo del of the dissolv ed o xygen concen tration /#28DO/#29/, whereonly the relation be t w een DO and air/#0Do w rate is included/, the relationbe t w een v alv e p osition and the air/#0Do w rate is excluded/. Here/, the set/-p oin tof the DO is considered as an input instead of e/.g/. air/#0Do w rate/.F rom e/.g/. Olsson and Jeppson /#28/1/9/9/4/#29 w e /#0Cnd that the follo wing con trolhandles/: external carb on dosage/, in ternal recirculation rate/, and DO set/-p oin t a/#0Bect the ammonium and nitrate concen trations/, and they also do itin appro ximately the same time scale /#28hours/#29/. Hence/, these three con trolv ariables will therefore b e used as inputs/. As outputs w e consider ammo/-nium and nitrate/. T o impro v e the mo del/, in/#0Duen t /#0Do w/, in/#0Duen t carb on/1/5/2 Multiv ariable mo deling and con troland in/#0Duen t ammonium will b e used as measurable disturbances/. Duringiden ti/#0Ccation the disturbances are/, ho w ev er/, considered as normal inputs/.In/#0Duen t carb on can be appro ximated b y measuremen ts of/, for example/,TOC /#28T otal Organic Carb on/#29/. TOC has usually not the same e/#0Bect onthe activ ated sludge pro cess as the soluble substrate/, but if the di/#0Berencein e/#0Bect only di/#0Bers b y a scaling factor/, TOC will w ork equally w ell inthe mo del/. In Figure /6/./1 all inputs and outputs used in the mo del aresummarized/.Mo del
/-
/-/-
/-/-/6 /6 /6
DO set/-p oin tExternal carb onIn ternalrecirculationIn/#0Duen t/#0Do wIn/#0Duen tcarb on
In/#0Duen tammonium
Nitrate inlast aerated zone
Ammonium inlast aerated zoneFigure /6/./1/: Input signals /#28DO set/-p oin t/, external carb on and in ternalrecirculation/#29/, measurable disturbances /#28in/#0Duen t/#0D o w/, in/#0Duen t carb onand in/#0Duen t ammonium/#29 and outputs /#28nitrate and ammonium in lastaerated zone/#29 whic h the mo del is based onIt w ould p erhaps be natural to use e/#0Fuent ammonium and e/#0Fuentnitrate as mo del outputs/, but if the mo del as in this case is aimed forcon troller design it is b etter to use measuremen ts further upstream/. This toreduce the time dela y in the mo del/. A shorter time dela y mak es it p ossibleto design a faster con troller with b etter disturbance rejection/. Both theammonium concen tration and the nitrate concen tration will therefore bemeasured in the last aerated zone/. After this zone no more ammoniumis con v erted to nitrate /#28assuming that no biological reactions o ccur in thesettler/#29/, whic h means that the lo w est ammonium concen tration and highestnitrate concen tration in the activ ated sludge pro cess is measured /#28in a pre/-denitrifying plan t/#29/.R emark/: In Chapter /3 the nitrate concen tration w as measured in theano xic zone/. This w as suitable in that situation b ecause the in ternal recir/-culation /#0Do ww as constan t and the mo del should only describ e the relationbe t w een external carb on dosage and nitrate concen tration/. Here/, sim ula/-tions ha v e sho wn that a m ultiv ariable con troller based on a mo del where/6/./1 Mo deling /1/5/3the nitrate concen tration in the ano xic zone is an output will fail/. Suc ha con troller switc h o/#0B the in ternal recirculation/, probably due to the factthat the nitri/#0Ccation pro cess is badly mo deled/. By switc hing o/#0B the in ter/-nal recirculation/, it is easy to main tain a lo w nitrate concen tration in theano xic zone for a pre/-denitrifying activ ated sludge pro cess/, but the e/#0Fuen tnitrate concen tration will b e rather high/./6/./1/./2 Subspace iden ti/#0CcationF or SISO /#28Single Input Single Output/#29 systems p olynomial mo dels lik e AR/-MAX mo dels are con v enien t b oth for iden ti/#0Ccation and con troller designpurp oses/. F or MIMO /#28Multiple Input Multiple Output/#29 systems/, p oly/-nomial mo dels are complex/, since they b ecome matrix fraction decomp o/-sitions/. In these mo dels it is not ob vious ho w to c ho ose the p olynomialdegrees and the time dela ys/. An alternativ e to p olynomial mo dels/, is touse Subspace State Space System Iden ti/#0Ccation /#28/4SID/#29/. The adv an tages arethat the user has relativ ely few design v ariables/, the metho ds ha v e robustn umerical prop erties/, and relativ ely lo w computational complexit y /#28Vib erget al/. /1/9/9/5/#29/.A short in tro duction to subspace iden ti/#0CcationThe problem form ulation in subspace iden ti/#0Ccation is as follo ws/: Giv eninput and output measuremen ts/, /#0Cnd an appropriate order n and systemmatrices /#28V an Ov ersc hee and De Mo or /1/9/9/6/#29/. This is a v ery general form u/-lation and in system iden ti/#0Ccation whic h could /#0Ct to man y iden ti/#0Ccationmetho ds/. The solution to the problem in the subspace based tec hniques is/,ho w ev er/, quite di/#0Beren t compared to the tec hniques based on an iterativ esearc h/. The subspace metho ds uses pro jections and singular v alue decom/-p ositions to /#0Cnd the mo del/. The follo wing deriv ation is mostly tak en fromVib erg /#28/1/9/9/4/#29 who giv es an o v erview of existing subspace based tec hniques/.Assume that the true system can b e describ ed b yx /#28 t /+/1 /#29 /= Ax /#28 t /#29/+ Bu /#28 t /#29 /#28/6/./1/#29y /#28 t /#29 /= Cx /#28 t /#29/+ Du /#28 t /#29 /#28/6/./2/#29/1/5/4 Multiv ariable mo deling and con troland de/#0CneU /=
/2/6/6
/6/6/6
/6
/6
/6/6/6
/6/4
u /#28/0/#29 u /#28/1/#29 u /#28/2/#29 /:/:/: u /#28 j /, /1/#29u /#28/1/#29 u /#28/2/#29 u /#28/3/#29 /:/:/: u /#28 j /#29/././.
/././.
/././.
/././.u /#28 i /, /1/#29 u /#28 i /#29 u /#28 i /+/1 /#29 /:/:/: u /#28 i /+ j /, /2/#29u /#28 i /#29 u /#28 i /+/1 /#29 u /#28 i /+/2 /#29 /:/:/: u /#28 i /+ j /, /1/#29/./.
/.
/./.
/.
/./.
/.
/./.
/.u /#28/2 i /, /1/#29 u /#28/2 i /#29 u /#28/2 i /+/1 /#29 /:/:/: u /#28/2 i /+ j /, /2/#29
/3/7/7
/7/7/7
/7
/7
/7/7/7
/7/5
/#28/6/./3/#29where the n um b er of columns j t ypically is c hosen to j /= N /, /2 i /+ /1 so thatall data are used/. Matrices for the output Y and the state X are generatedin the same w a y as for the input U /, replace all u with y resp ectiv ely x /.The parameter i is a user parameter/, similar to the n um be r o f blo c kr o wsin some algorithms/, e/.g/. N/4SID
/1/.In tro duce the extended observ abilit y matrix /, and the lo w er blo c kT o eplitz matrix H/,/=
/2/6/6
/6
/6/4
CCA/./.
/.CA
/2 i /, /1
/3/7/7
/7
/7/5
H /=
/2/6/6
/6
/6/4
D /0 /:/:/: /0CB D /:/:/: /0/./.
/.
/./.
/.
/././.
/./.
/.CA
/2 i /, /2B CA
/2 i /, /3B /:/:/: D
/3/7/7
/7
/7/5
/#28/6/./4/#29The follo wing matrix equation can then b e deriv edY /=/, X /+ HU /#28/6/./5/#29and the orthogonal pro jection on to the n ull space of U /,i n tro duced as/#05
/?U
T
/= I /, U
T/#28 UU
T/#29
/, /1U /#28/6/./6/#29Multiplying /#28/6/./5/#29 b y/#05
/?U
T
giv esY /#05
/?U
T
/=/, X /#05
/?U
T
/#28/6/./7/#29since U /#05
/?U
T
/= /0/. No w/, mak e a singular v alue comp osition of Y /#05
/?U
T
andpartition it asY /#05
/?U
T
/= Qs
Ss
V
Ts
/+ Qn
Sn
V
Tn
/#28/6/./8/#29where the Q matrices con tains the left singular v ectors/, the S matrices arediagonal matrices with the corresp onding singular v alues/, and the V ma/-trices con tains the righ t singular v ectors/. The pro duct of the matrices with/1Numerical algorithms for Subspace State Space System Iden ti/#0Ccation /#28V an Ov ersc heeand De Mo or /1/9/9/6/#29/./6/./1 Mo deling /1/5/5the indexs
con tains the signal subspace/, and the pro duct of the matriceswith the indexn
con tains the noise subspace/. In absence of noise Sn
/=/0 /.Data from a real pro cess alw a ys con tains noise/, hence Sn
/6/= /0/. One thenha v e to /#0Cnd the b order be t w een Ss
and Sn
/. A common approac h is thento set the b order where the singular v alues drop to small v alues/.The observ abilit y matrix /, is then estimated b y/,/= Qs
/#28/6/./9/#29In fact/, /, should b e c hosen so that R /#28/,/#29 /= R /#28 Qs
/#29/. The particular c hoice/#28/6/./9/#29 is simple and corresp onds to a sp eci/#0Cc realization dep enden t c hoiceof co ordinates/. The system matrix A is found from /, through the relation/,/2/: n
/=/,/1/: n /, /1
A /#28/6/./1/0/#29where /,/2/: n
is /, with the /#0Crst blo c k ro w deleted and /,/1/: n /, /1
is /, with thelast blo c kr o w deleted/. The system of equations /#28/6/./1/0/#29 is o v er/-determinedin the unkno wn matrix A /, and can b e solv ed in sev eral w a ys/. The C matrixis giv en b y the /#0Crst ro w/#28s/#29 of /,/, according to /#28/6/./4/#29/.Multiplying /#28/6/./5/#29 with Q
Tn
yieldsQ
Tn
Y /= Q
Tn
HU /#28/6/./1/1/#29whic h giv es an o v er/-determined system of equations that can b e solv ed ina least squares sense with resp ect to B and D /. Note that Q
Tn
/,/=/0 since/,/= Qs
/, whic h is orthogonal to Qn
/.The presen ted algorithm is just one of man y v arian ts/. There existsmetho ds whic h are more e/#0Ecien t and tak e care of pro cess and measuremen tnoise/, see e/.g/. V an Ov ersc hee and De Mo or /#28/1/9/9/6/#29/./6/./1/./3 Application of subspace iden ti/#0Ccation to the activ atedsludge pro cessIn Section /6/./1/./1 it w as concluded that a mo del should b e found whic hm o d /-els the t w o outputs/, nitrate and ammonium in the last aerated zone/, basedon the three inputs DO set/-p oin t/, external carb on/, in ternal recirculation/,and the three measurable disturbances in/#0Duen t /#0Do w/, in/#0Duen t carb on andin/#0Duen t ammonium/.A discrete/-time mo del is estimated from the input/-output data usingsubspace iden ti/#0Ccation/:x /#28 t /+/1 /#29 /= Fx /#28 t /#29/+ Gu /#28 t /#29/+ Gd
d /#28 t /#29 /#28/6/./1/2/#29y /#28 t /#29 /= Cx /#28 t /#29 /#28/6/./1/3/#29/1/5/6 Multiv ariable mo deling and con trolwhere y /#28 t /#29 is the outputs/, u /#28 t /#29 the inputs/, d /#28 t /#29 the measurable disturbances/,and x /#28 t /#29 is a state v ector/. The state v ector x /#28 t /#29 is /#5Carti/#0Ccial/"/, created b ythe subspace algorithm/, and it do es usually not con tain an y measurablestates/. The other parameters in /#28/6/./1/2/#29 and /#28/6/./1/3/#29/, i/.e/. F /, G /, Gd
/, and C arematrices/.The structure of /#28/6/./1/2/#29 is not directly suitable for iden ti/#0Ccation/. It canb e rewritten suc h that the measurable disturbances d /#28 t /#29 are considered asinputs and included in the input v ector asx /#28 t /+/1 /#29 /= Fx /#28 t /#29/+/#5B G Gd
/#5D
/"u /#28 t /#29d /#28 t /#29
/#23/#28/6/./1/4/#29Generation of dataIt is very imp ortan t to excite the input signals in a sensible w a y to beable to estimate a linear blac k/-b o x mo del from input/-output data/. Theinput signals should ha v e a su/#0Ecien t excitation in b oth amplitude andfrequency /. The output concen trations should not deviate to o m uc h fromnormal op erating lev els/.The activ ated sludge pro cess is sim ulated b y the mo del presen ted inSection /2/./3 with the input signals giv en in Figure /6/./2 and measurabledisturbances in Figure /6/./3/. The return sludge /#0Do w in Figure /6/./4 is alsov aried/, but not included in the mo del/. The in ternal recirculation/, and re/-turn sludge/, w ere generated b yl o w pass /#0Cltering white noise/. V alues ab o v ethe maxim um limit or b elo w the minim um limit ha v e b een set to the limitfor eac h con trol signal/. The gain and bandwidth of the lo w pass /#0Clters isdi/#0Beren t for the di/#0Beren t signals/, as w ell as the mean v alues/. The exci/-tation of the DO set/-p oin t w as the most critical signal to generate/. Theactiv ated sludge pro cess is v ery nonlinear for DO v alues close to zero/. T oa v oid that the ammonium concen tration/, whic h also dep ends on the DO/,b ecomes large/, a PID con troller for the DO set/-p oin t is used/, as outlinedin Section /5/./5/. The DO set/-p oin t is hence generated b y a PID con trollerduring the sim ulation/. The PID con troller tries to follo w a reference signalin the ammonium concen tration b yv arying the DO set/-p oin t/. The ammo/-nium reference signal is excited b y PRBS /#28Pseudo Random Binary Signals/#29/.This /#28usually/#29 giv es a con trol signal with reasonable excitation in b oth am/-plitude and frequency /. The reason for that the ammonium concen tration inFigure /6/./5 do es not lo ok lik e a PRBS is that the PID con troller constrainsthe DO set/-p oin t be t w een /0/./2 /#7B /4 mg/#2Fl/. The carb on /#0Do w rate w as gener/-ated in a similar w a y as the DO set/-p oin t/. The nitrate concen tration in theanxoic zone w as con trolled b y the con troller outlined in Section /3/./4/. The/6/./1 Mo deling /1/5/7
012345678905001000l/hInternal recirculation rate
0123456789024mg/lDO set−point in all aerated zones
0123456789024
time [days]l/hExternal carbon flow rateFigure /6/./2/: Input signals to the activ ated sludge pro cess/.nitrate reference signal w as v aried as a PRBS be t w een /0/./5 and /2/./5 mg/#2Fl/.It is not necessary to generate this /#0Do w rate b y a con troller/, but it ma yimpro v e the estimated mo del/, b ecause the pro cess app ear less nonlinear ifthe carb on dosage do es not saturate the nitrate concen tration at v ery lo wlev els/.The measurable disturbances could normally not b e manipulated/. Herethey are generated b yl o w pass /#0Cltering white noise/.Including the return sludge /#0Do w as a measurable disturbance in themo del did not impro v e the estimated mo del/. Therefore it is not includedand only considered as an unmeasurable disturbance/.Applying the signals in Figure /6/./2/, /6/./3 and /6/./4 as inputs to the sim u/-lation mo del/, giv es the outputs in Figure /6/./5/. T o mak e the output signalsmore realistic/, noise has b een added to the outputs/. The noise w as zeromean with standard deviation /0/./1 on the ammonium output and /0/./1 on the
nitrate output/. The sampling in terv al w as c hosen to /0/./2 hours/./1/5/8 Multiv ariable mo deling and con trol
01234567890100200300l/hInfluent flow rate
0123456789102030
time [days]mg/lInfluent ammonium0123456789204060mg/lInfluent soluble substrateFigure /6/./3/: Measurable disturbances in the activ ated sludge pro cess/.Using the dataNo w w e ha v e all data for estimating a mo del/. The N/4SID /#28Numericalalgorithms for Subspace State Space System Iden ti/#0Ccation/#29 algorithm inV an Ov ersc hee and De Mo or /#28/1/9/9/6/#29 is used to iden tify a mo del/.There are t w o design v ariables in N/4SID/, the or der of the mo del /#28di/-mension of state v ector/#29 and an auxiliary or der /#28/= i blo c k ro ws/#29/, used forthe selection of state v ariables/. F or con troller design purp oses it is/, forexample/, b est to c ho ose as lo w mo del order as p ossible/, whic h still mimicsthe outputs reasonably w ell/. That is/, the outputs generated b y the esti/-mated mo del should only di/#0Ber sligh tly from the true pro cess outputs/. Theauxiliary order i is c hosen to obtain minim um prediction error/. A suitabledefault v alue is according to Matlab /#28MathW orks /1/9/9/2/#29 /1/./2/*ORDER/+/3/.In system iden ti/#0Ccation a direct term/, as in /#28/6/./2/#29/, is sometimes included/6/./1 Mo deling /1/5/9
0123456789250300350
time [days]l/hReturn sludge flow rateFigure /6/./4/: Return sludge /#0Do w/.in the mo del/, i/.e/. /#28/6/./1/3/#29 is mo di/#0Ced toy /#28 t /#29/= Cx /#28 t /#29/+ D
/"u /#28 t /#29d /#28 t /#29
/#23/#28/6/./1/5/#29This direct term is/, ho w ev er/, not suitable for con troller design/, b ecause anadditional time dela y then has to be in tro duced in the con troller to mak ethe design p ossible /#28otherwise y /#28 t /#29 dep ends on u /#28 t /#29/, whic h dep ends on y /#28 t /#29/#29/.T oa v oid the problem with a direct term/, w e try to estimate the b est mo delwithout it/, whic h is easily done in the N/4SID algorithm in Matlab/.T o obtain an accurate mo del/, the mean v alues of all signals should b eremo v ed b efore the data is applied to the iden ti/#0Ccation algorithm/. Thisis common in system iden ti/#0Ccation/, see e/.g/. S/#7F oderstr/#7F om and Stoica /#28/1/9/8/9/#29/.The signals ha v e also b een sligh tly scaled/. All /#0Do ws are in the unit m
/3/#2Fh/,except for the external carb on /#0Do w rate whic h has the unit l/#2Fh/.The mo del is cross/-v alidated on data whic hw ere not used for iden ti/#0C/-cation/. Outputs/, generated b y the iden ti/#0Ced mo del are compared with theoutputs from the true pro cess/. This is sho wn in Figure /6/./6/, where the /#0Crst/3/#2F/4 of the data has b een used to iden tify the mo del and the last /1/#2F/4 tov alidate the mo del/. As seen the mo del sim ulates the outputs w ell/. A sim/-ulation has also b een done where all data w as used for iden ti/#0Ccation/. Thisga v e/, ho w ev er/, no visible impro v emen t when making the same comparisonas in Figure /6/./6/.The resulting mo del has order /4 and the auxiliary order in N/4SID w asc hosen to /5/.F /=
/2/6/6/6/4
/1 /: /0/3/5/6 /, /0 /: /0/6/6/8 /, /0 /: /4/4/5/4 /, /0 /: /0/3/0/1/, /0 /: /0/0/1/3 /0 /: /9/6/6/7 /, /0 /: /1/0/6/6 /0 /: /5/2/8/3/0 /: /0/8/0/2 /, /0 /: /0/3/8/6 /0 /: /6/1/2/0 /, /0 /: /0/4/7/3/0 /: /0/1/1/0 /, /0 /: /0/6/2/9 /0 /: /0/0/6/9 /0 /: /5/4/0/2
/3/7/7/7/5
/#28/6/./1/6/#29/1/6/0 Multiv ariable mo deling and con trol
0123456789024681012
time [days]mg/lNitrate in last aerated zone
012345678901234
time [days]mg/lAmmonium in last aerated zoneFigure /6/./5/: Nitrate and ammonium concen tration in the last aeratedzone/. Generated with the input signals in Figure /6/./2/, /6/./3 and /6/./4/.G /=
/2/6/4
/, /0 /: /2/9/2/0 /0 /: /2/9/8/5 /, /0 /: /1/9/2/2/, /0 /: /2/3/7/7 /0 /: /1/6/8/2 /0 /: /1/0/7/7/, /0 /: /1/1/5/5 /0 /: /1/1/1/9 /0 /: /0/7/0/5
/3/7/5
/#28/6/./1/7/#29Gd
/=
/2/6/4
/, /0 /: /4/5/3/1 /, /0 /: /0/0/2/7 /, /0 /: /0/0/6/6/, /1 /: /7/5/1/5 /0 /: /0/0/5/1 /, /0 /: /0/2/3/6/, /1 /: /4/9/4/9 /0 /: /0/0/3/2 /, /0 /: /0/3/5/2
/3/7/5
/#28/6/./1/8/#29C /=
/"/0 /: /3/0/8/1 /0 /: /1/0/6/2 /0 /: /7/7/1/2 /0 /: /1/0/9/8/, /0 /: /0/2/2/2 /, /0 /: /3/9/6/2 /, /0 /: /0/5/0/8 /0 /: /8/3/0/9
/#23/#28/6/./1/9/#29The p oles /#28eigen v alues of F /#29 of the estimated system are/: /0/./9/2/9/1/, /0/./8/7/2/8/,/0/./7/1/2/8/, and /0/./6/3/9/7/. The slo w est p ole has a time constan t around /4/./5 hwhic h seems reasonable/, see e/.g/. Olsson and Jeppson /#28/1/9/9/4/#29/.This mo del order /4 ga v e the b est result/. A higher mo del order didnot reduce the di/#0Berence be t w een the outputs from the sim ulation andthe outputs from true pro cess/, when using cross/-v alidation/. A linear time/-in v arian t fourth order state/-space mo del can hence mo del the activ ated/6/./2 Con trol /1/6/1
0123456789−2−101234
time [days]mg/lAmmonium in last aerated zone0123456789024681012
time [days]mg/lNitrate in last aerated zoneFigure /6/./6/: Sim ulated /#28blac k line/#29 and /#5Creal/" /#28grey line/#29 nitrate andammonium concen tration/. The last /2/5 /#25 of the data /#28the v ertical lineindicates that p oin t/#29 w as not used for iden ti/#0Ccation/.sludge pro cess reasonably w ell despite the rather large v ariations in in/#0Duen t/#0Do w/, in/#0Duen t concen trations/, in ternal recirculation/, sludge recirculation/,DO set/-p oin t and external carb on dosage/.The mo del used to generate the data /#28/5 IA W Q mo dels and the settlermo del/#29 consists of around /1/0/0 coupled nonlinear di/#0Beren tial equations/. Theiden ti/#0Ced fourth order mo del is hence a v ery m uc h reduced order mo delwhic h still manages to describ e the activ ated sludge pro cess w ell/./6/./2 Con trolThe previously iden ti/#0Ced mo del is no w used for con troller design/. The aimof the con troller is to k eep the ammonium and nitrate concen tration in thelast aerated zone as close as p ossible to the desired set/-p oin ts b y using thecon trol signals /#28DO set/-p oin t/, external carb on/, and in ternal recirculation/#29/./1/6/2 Multiv ariable mo deling and con trolF eedforw ard from in/#0Duen t /#0Do w/, in/#0Duen t carb on and in/#0Duen t ammoniumis also applied/. T o mak e the con troller able to remo v e stationary errors/,in tegration is included/.It should b e stressed that the most critical part in the con troller designis to obtain a go o d mo del/. A su/#0Ecien tly go o d mo del ma y b e estimated ifthe input signals are designed with care/, lik e in the previous section/./6/./2/./1 Con troller designIn Section /6/./1/./3 a state/-space mo del /#28/6/./1/2/#29 of the pro cess w as iden ti/#0Cedx /#28 t /+/1 /#29 /= Fx /#28 t /#29/+ Gu /#28 t /#29/+ Gd
d /#28 t /#29 /#28/6/./2/0/#29y /#28 t /#29 /= Cx /#28 t /#29 /#28/6/./2/1/#29The state v ector can b e augmen ted with the measurable disturbances d /#28 t /#29as/"x /#28 t /+/1 /#29d /#28 t /+/1 /#29
/#23/=
/"F Gd/0 Fd
/#23/"x /#28 t /#29d /#28 t /#29
/#23/+
/"G/0
/#23u /#28 t /#29/+
/"vx
/#28 t /#29vd
/#28 t /#29
/#23/#28/6/./2/2/#29y /#28 t /#29 /= /#5B C /0 /#5D
/"x /#28 t /#29d /#28 t /#29
/#23/+ e /#28 t /#29 /#28/6/./2/3/#29where the zeros are matrices of suitable size /#0Clled with zeros/. By includingd /#28 t /#29 in the state v ector/, the feedforw ard design in the LQ con troller willbe con v enien t/, see also Kw ak ernaak and Siv an /#28/1/9/7/2/#29/. T o include d /#28 t /#29 inthe state v ector/, its dynamic has to b e mo deled/, and therefore the matrixparameter Fd
is included/. It could e/.g/. be selected as Fd
/= /0 /: /9/9 I /, whic halmost mak es d /#28 t /#29 a random w alk pro cess/. T o mak e the measurable dis/-turbance d /#28 t /#29 not be completely deterministic /#28whic h it of course is not/#29/,the noise vd
/#28 t /#29 has b een added/. The noises vx
/#28 t /#29/, vd
/#28 t /#29 and e /#28 t /#29 are notused in the con troller design/, they are only included for completeness/. Inan observ er design their v ariances could b e used as design v ariables/.There exists di/#0Beren t strategies to design an in tegrating con troller/. Tw oapproac hes will be studied/. The /#0Crst one is based on di/#0Beren tiating thesystem and deriving an incremen tal con troller/, see e/.g/. Garc /#13 /#10a et al/. /#28/1/9/8/9/#29/.This approac h is commonly used in Mo del Predictiv e Con trol /#28MPC/#29/. Thesecond approac h is to include additional in tegration states for eac h output/,see e/.g/.
/#17Astr/#7F om and Wittenmark /#28/1/9/9/0/#29/./6/./2 Con trol /1/6/3/6/./2/./2 Con troller design on di/#0Beren tial formThe system is no w di/#0Beren tiated and an incremen tal con trol signal is de/-riv ed/, see also e/.g/. Garc /#13 /#10a et al/. /#28/1/9/8/9/#29/. W e start b y rewriting /#28/6/./2/2/#29 and/#28/6/./2/3/#29 toxn
/#28 t /+/1 /#29 /= Fn
xn
/#28 t /#29/+ Gn
u /#28 t /#29 /#28/6/./2/4/#29y /#28 t /#29 /= Cn
xn
/#28 t /#29 /#28/6/./2/5/#29where the noise v ectors ha v e b een excluded for simplicit y /. Besides that/,/#28/6/./2/4/#29 and /#28/6/./2/5/#29 are iden tical to /#28/6/./2/2/#29 and /#28/6/./2/3/#29/. Multiplying /#28/6/./2/4/#29 and/#28/6/./2/5/#29 with /#01 giv es/#01 xn
/#28 t /+/1 /#29 /= Fn
/#01 xn
/#28 t /#29/+ Gn
/#01 u /#28 t /#29 /#28/6/./2/6/#29/#01 y /#28 t /#29 /= Cn
/#01 xn
/#28 t /#29 /#28/6/./2/7/#29/#01 y /#28 t /+/1 /#29 /= Cn
/#01 xn
/#28 t /+/1 /#29 /= Cn
/#28 Fn
/#01 xn
/#28 t /#29/+ Gn
/#01 u /#28 t /#29/#29 /#28/6/./2/8/#29y /#28 t /+/1 /#29 /= y /#28 t /#29/+/#01 y /#28 t /+/1 /#29 /#28/6/./2/9/#29/#01 /= /1 /, q
/, /1/#28/6/./3/0/#29W ritten in a new state/-space form this b ecomes/"/#01 xn
/#28 t /+/1 /#29y /#28 t /+/1 /#29
/#23/=
/"Fn
/0Cn
Fn
I
/#23/"/#01 xn
/#28 t /#29y /#28 t /#29
/#23/+
/"GnCn
Gn
/#23/#01 u /#28 t /#29 /#28/6/./3/1/#29y /#28 t /#29 /= /#5B /0 I /#5D
/"/#01 xn
/#28 t /#29y /#28 t /#29
/#23/#28/6/./3/2/#29The system /#28/6/./3/1/#29 and /#28/6/./3/2/#29 will b e used to deriv e a steady/-state feedfor/-w ard feedbac ki n tegrating LQ con troller/. The con troller will con tain feed/-forw ard since the state xn
/#28 t /#29 con tains the measurable disturbances d /#28 t /#29/,and in tegration since the system is di/#0Beren tiated/. The con trol signal isdetermined b yu /#28 t /#29/=
/8/#3E/#3C/#3E/:
umin
u /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 /#14 uminu /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 umin
/#3Cu /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 /#3Cumaxumax
u /#28 t /, /1/#29 /+ /#01 u /#28 t /#29 /#15 umax
/#28/6/./3/3/#29where /#01 u /#28 t /#29 is computed b y/#01 u /#28 t /#29/= /, L
/"/#01 xn
/#28 t /#29y /#28 t /#29
/#23/+ Lr
r /#28 t /#29/= /, /#5B Lx
Ld
Ly
/#5D
/2/6/4
/#01 x /#28 t /#29/#01 d /#28 t /#29y /#28 t /#29
/3/7/5
/+ Lr
r /#28 t /#29/#28/6/./3/4/#29/1/6/4 Multiv ariable mo deling and con trolA suitable c hoice of Lr
isLr
/= Ly
/#28/6/./3/5/#29b ecause the set/-p oin ts r /#28 t /#29 and outputs y /#28 t /#29 are then ampli/#0Ced equally /.Inserting /#28/6/./3/5/#29 in /#28/6/./3/4/#29 giv es/#01 u /#28 t /#29/= /, /#5B Lx
Ld
/#5D
/"/#01 x /#28 t /#29/#01 d /#28 t /#29
/#23/+ Ly
/#28 r /#28 t /#29 /, y /#28 t /#29/#29 /#28/6/./3/6/#29The c hoice /#28/6/./3/5/#29 giv es in steady state /#28/#01 u /#28 t /#29/=/#01 x /#28 t /#29/=/#01 d /#28 t /#29/= /0 /#29 thatr /#28 t /#29/= y /#28 t /#29/, whic h is natural/.The state feedbac k /#28and feedforw ard/#29 L is found b y minimizingJ /= limN /!/1
N /, /1Xt /=/0
f
/"/#01 xn
/#28 t /#29y /#28 t /#29
/#23TQ
/"/#01 xn
/#28 t /#29y /#28 t /#29
/#23/+/#01 u /#28 t /#29
TR /#01 u /#28 t /#29 g /#28/6/./3/7/#29The stationary solution /#28 N /!/1 /#29 is found b y solving the Riccati equationS /=/#08
TS /#08/+ Q /, /#08
TS /,/#5B/,
TS /,/+ R /#5D
/, /1/,
TS /#08 /#28/6/./3/8/#29where /#08 and /, are giv en b y/#08/=
/"Fn
/0Cn
Fn
I
/#23/,/=
/"GnCn
Gn
/#23/#28/6/./3/9/#29whic h are the system matrices in /#28/6/./3/1/#29/. The state feedbac k L is giv en b yL /=/#5B /,
TS /,/+ R /#5D
/, /1/,
TS /#08 /#28/6/./4/0/#29F or solution of the algebraic Riccati equation/, see P appas et al/. /#28/1/9/8/0/#29/.R emark/: The selected pro cess has three inputs and t w o outputs whic hmeans that the con troller has an additional degree of freedom/. F or the LQdesign metho d/, whic h is based on minimizing a criteria this ma y not be aproblem/. F or design metho ds without a criterion it has to b e decided whatto do with the additional degree of freedom/.Observ er designAs the state v ector /#5B /#01 x /#28 t /#29 /#01 d /#28 t /#29 y /#28 t /#29 /#5D
Tis not completely measurable/,an observ er is in tro duced/:/"/#01/^ x /#28 t /+/1 /#29/^ y /#28 t /+/1 /#29
/#23/=
/"F /0CF I
/#23/"/#01/^ x /#28 t /#29/^ y /#28 t /#29
/#23/+
/"GCG
/#23/#01 u /#28 t /#29/+
/"GdCGd
/#23/#01 d /#28 t /#29/+
/"kxky
/#23/#20y /#28 t /#29 /, /#5B /0 I /#5D
/"/#01/^ x /#28 t /#29/^ y /#28 t /#29
/#23/!/#28/6/./4/1/#29/6/./2 Con trol /1/6/5The gain of the observ er /#5B kx
ky
/#5D
Tis c hosen b y placing the observ erp oles sligh tly closer to the origin than the closed lo op p oles /#28/0/./9 times theclosed lo op p oles/#29/. The solution whic h giv es /#5B kx
ky
/#5D
Tis not unique/, it isunder/-determined/. The additional degrees of freedom are used to mak e thesolution more robust/. The sensitivit y of the observ er p oles to p erturbationsin the system matrices is minimized/, and the magnitude of the transien tresp onse is also minimized/, see Kautsky et al/. /#28/1/9/8/5/#29 /#28the command plac ein Matlab/'s Con trol System T o olb o x has this algorithm implemen ted/#29/.An alternativ e to the observ er p ole placemen t design is the Kalman/#0Clter/, but to deriv e that /#0Clter/, the v ariances of the pro cess noise and mea/-suremen t noise are needed/. Since these v ariances are unkno wn/, w e migh tas w ell use p ole placemen t/.A problem when the state v ector is not measurable is that the niceprop erties of the LQ con troller /#28/6/0
ophase margin and gain margin /#5D/0 /: /5 /; /1 /#5B/#29ma y be lost when the states ha v e to be reconstructed/. A solution to thisproblem ma y b e to use Lo op T ransfer Reco v ery /#28L TR/#29/, see Do yle and Stein/#28/1/9/7/9/#29/, but this usually giv es a v ery noise sensitiv e observ er/. This is anotherreason for using p ole placemen t/.The /#0Cnal con troller structure with observ er/, feedbac k and feedforw ardis illustrated in Figure /6/./7/.Con troller exp erimen tThe con troller will no w be tried on the large mo del/, presen ted in Section/2/./3/. In the con troller design w ec hose the p enalt y matrix Q asQ /= H
THH /= /#5B /0 I /#5DThe con trol v ector u /#28 t /#29 consists of the follo wing signalsu /=/#5B /#01 Qint
/#01 DOre f
/#01 QC ar bon
/#5D
T/#28/6/./4/2/#29and is p enalized b y the R /-matrix whic h here is c hosen to R /=/2 I /. The c hoiceof R ma y appro ximately b e determined b y the size of the con trol signals/. Asuitable c hoice ma y b e obtained b y using the follo wing appro ximate relationrii
/=/1 /= /~ u
/2i
/#28/6/./4/3/#29where rii
is the ii /:th elemen t in the R matrix for the i /:th con trol signal/,and /~ ui
is the maximally allo w ed v alue of ui
/./1/6/6 Multiv ariable mo deling and con trol/#0E/#0D
/#0F/#0CP/#0E/#0D
/#0F/#0CP/#0E/#0D
/#0F/#0CP/#0E/#0D
/#0F /#0CP/#0E/#0D
/#0F/#0CP
/#0E/#0D
/#0F /#0CP
/- /- /-
/?/?
/#1B/- /- /- /- /- /-
/?/#1B
/6
G
GdLr
Ldq
/, /1F
C
q
/, /1G
Gdq
/, /1F
C
q
/, /1LxLy
kxky/- /- /- /- /- /-
/?/#1B
/6
/?/#1B
/,
/,
/,/#12/,
/,
/,/#12/#1B
/?
/#13/#13/#13/#13/#2F
/#1BH
H
H
H
H
HY
/?/-/. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /.
/. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /. /./.
/.
/.
/./././././.
/.
/./././././.
/.
/./././././.
/.
/./././././.
/.
/./././././.
/.
/./././././.
/.
/.
/./././././.
/.
/./././././.
/.
/./././././.
/.
/./././././.
/.
/./././././.
/.
/././././.
/#13/#13/#13/#2F
/+
/,/, /,
/+/+/+
/+
/+/+/,/+
/+ /+/+
/+/+
r /#28 t /#29y /#28 t /#29y /#28 t /, /1/#29/^ y /#28 t /, /1/#29
/#01 d /#28 t /#29/^ y /#28 t /#29
/#01 x /#28 t /#29 /#01 u /#28 t /#29/#01/^ x /#28 t /#29 /#01/^ y /#28 t /#29
Observ erFigure /6/./7/: The con troller structure with observ er/, feedbac k andfeedforw ard/.A sim ulation using these matrices in the con troller design and Fd
/=/0 /: /9/9 I giv es the result illustrated in Figure /6/./8 where the con trol signalsare also sho wn/. As seen/, the con troller manage to reject the di/#0Beren t dis/-turbances w ell/. In Figure /6/./9 the disturbances in the in/#0Duen t w ater arepresen ted/.A problem with this design is that there is not a unique com binationof the con trol signals whic h can generate the outputs/. This can mak ethe con trol signals to drift/. Since only the incremen tal con trol signal isp enalized in the LQ criterion one con trol signal can tak e high v alues whileanother b ecomes almost zero/. A p ossible solution could be to extend thestate v ector with the absolute v alue of the con trol signal to be able top enalize these to o/./6/./2 Con trol /1/6/7
0102030405060708090012345
time [h]Internal rec. (−), DO set−point (−−), and ext. carbon flow (:)01020304050607080900123456
time [h]mg/lNitrate (−) and ammonium (−−) in last aerated zoneFigure /6/./8/: Upp er plot/: The outputs/, nitrate and ammonium/. TheNO/3
set/-p oin ti sc hanged from /6 to /5 after /1/0 hours/. L ower plot/: Thecon trol signals/, DO set/-p oin t /#28mg/#2Fl/#29/, in ternal recirculation /#28m
/3/#2Fh/#29/,and external carb on /#0Do w rate /#28l/#2Fh/#29/, with concen tration /2/0/0/0/0 mg/#2FlCOD/.
010203040506070809010203040506070
time [h]Influent flow/10 (−), influent ammonium (−−), and influent substrate (:)Figure /6/./9/: The measurable disturbances in the in/#0Duen t/, /#0Do w/#2F/1/0/#28l/#2Fh/#29/, ammonium /#28mg/#2Fl/#29 and substrate /#28mg/#2Fl/#29/. The return sludge/#0Do w is /2/5/0 l/#2Fh/, but at t /=/7/5h it is set to /4/0/0 l/#2Fh/./1/6/8 Multiv ariable mo deling and con trol/6/./2/./3 Con troller design with in tegration statesAn LQ con troller where in tegration is included b y using additional in tegra/-tion states xi
/#28 t /#29 is deriv ed in this section/. The in tegration states are giv enb yxi
/#28 t /+/1 /#29 /= xi
/#28 t /#29/+ r /#28 t /#29 /, y /#28 t /#29 /#28/6/./4/4/#29see also
/#17Astr/#7F om and Wittenmark /#28/1/9/9/0/#29/. In Figure /6/./1/0 this is illustratedtogether with the feedbac k and the feedforw ard path/./#12/#11
/#13/#10P/#12/#11
/#13/#10Pq
/, /1LiLr
Lx
Ld/- /- /- /- /-
/?/6/-
/#1A
/#1A/#3E/#1B
/6
/?
/#1Br /#28 t /#29
y /#28 t /#29x /#28 t /#29
u /#28 t /#29
d /#28 t /#29xi
/#28 t /#29/+
/,/+
/,/,
/,/,Figure /6/./1/0/: The LQ/-con troller with in tegration/, feedforw ard andfeedbac k/.The con trol signals are calculated b yu /#28 t /#29/= /, /#5B Lx
Li
Ld
Lr
/#5D
/2/6/6/6/4
x /#28 t /#29xi
/#28 t /#29d /#28 t /#29r /#28 t /#29
/3/7/7/7/5
/= /, LX /#28 t /#29 /#28/6/./4/5/#29T o determine the L /-v ector the state v ector in /#28/6/./2/2/#29 has to be extendedwith t w o new t yp es of states/, the in tegration states xi
/#28 t /#29 and the referencesignals r /#28 t /#29/, as in /#28/6/./4/5/#29/./2/6/6
/6/4
x /#28 t /+/1 /#29xi
/#28 t /+/1 /#29d /#28 t /+/1 /#29r /#28 t /+/1 /#29
/3/7/7
/7/5
/=
/2/6/6
/6/4
F /0 Gd
/0/, C I /0 I/0 /0 Fd
/0/0 /0 /0 Fr
/3/7/7
/7/5
/2/6/6
/6/4
x /#28 t /#29xi
/#28 t /#29d /#28 t /#29r /#28 t /#29
/3/7/7
/7/5
/+
/2/6/6
/6/4
G/0
/0
/0
/3/7/7
/7/5
u /#28 t /#29/+
/2/6/6
/6/4
vx
/#28 t /#29/0vd
/#28 t /#29vr
/#28 t /#29
/3/7/7
/7/5y /#28 t /#29 /= /#5B C /0 /0 /0 /#5D
/2/6/6
/6/4
x /#28 t /#29xi
/#28 t /#29d /#28 t /#29r /#28 t /#29
/3/7/7
/7/5
/+ e /#28 t /#29where Fd
and Fr
mo del the dynamics of the disturbances and the referencesignals/. At ypical c hoice is Fd
/= Fr
/=/0 /: /9/9 I /#28the size of the iden tit y matrix/6/./2 Con trol /1/6/9I is/, ho w ev er/, di/#0Beren t for Fd
and Fr
/#29/. The new system is no w used forcalculating the L /-v ector whic h is found b y minimizing the LQ criterionJ /=
/1Xt /=/0
X /#28 t /#29
TQX /#28 t /#29/+ u /#28 t /#29
TRu /#28 t /#29 /#28/6/./4/6/#29The minim um is found b y solving the Riccati equation/, see /#28/6/./3/8/#29/. Notethat /#08 and /, are di/#0Beren t here than in /#28/6/./3/8/#29/.In /#28/6/./4/6/#29/, the Q and R matrices ha v e to b e selected/. A suitable quan tit yto p enalize with the Q matrix can b er /#28 t /#29 /, y /#28 t /#29/+ /#0Bxi
/#28 t /#29 /#28/6/./4/7/#29whic h means that the con trol error /#28 r /, y /#29 and a scaled part of the in tegra/-tion state xi
is p enalized/. The parameter /#0B is a user parameter/. Setting/#0B /= /0 lea v es out xi
whic h giv es a con troller without in tegration/. P enalizingonly xi
usually giv es a con troller with bad p erformance/.This particular p enalt yc hoice in /#28/6/./4/7/#29 giv es with /#0B /=/0 /: /2Q /= H
THH /= /#5B /, C /0 /: /2 I /0 I /#5DThe con trol v ector u /#28 t /#29 whic h in this case consists ofu /=/#5B Qint
DOre f
QC ar bon
/#5D
T/#28/6/./4/8/#29is p enalized in the LQ criterion b y the R /-matrix/, whic hi s c hosen toR /=
/2/6/4
/0 /: /5 /0 /0/0 /0 /: /5 /0/0 /0 /2
/3/7/5
/#28/6/./4/9/#29R emark/: Another idea to select the Q and R matrices could be to letthese matrices in some w a y represen t economical fees for e/#0Fuen t concen/-trations and prices of running pumps/, external carb on dosing/, etc/. TheLQ con troller could then b e based on the criterion J /=
P/1t /=/0
/#5B y /#28 t /#29
TQy /#28 t /#29/+u /#28 t /#29
TRu /#28 t /#29/#5D/, where no in tegration is included/. One could then hop e thatthe LQ con troller should /#0Cnd the optimal op erating p oin t/. This did/, ho w/-ev er/, not w ork w ell /#28the pro cess w as drifting around a lot/#29 probably due tothe criterion con tains squared signals instead of linear signals/./1/7/0 Multiv ariable mo deling and con trolObserv er designIn this observ er design it is only necessary to estimate x /#28 t /#29/. In the incremen/-tal design/, outlined in Section /6/./2/./2/, b oth /#01 x /#28 t /#29 and y /#28 t /#29 w ere estimated/.Here x /#28 t /#29 is estimated b y/^ x /#28 t /+/1 /#29 /= F /^ x /#28 t /#29/+ Gu /#28 t /#29/+ Gd
d /#28 t /#29/+ K /#28 y /#28 t /#29 /, C /^ x /#28 t /#29/#29 /#28/6/./5/0/#29The gain of the observ er K is c hosen b y placing the observ er p oles sligh tlyfaster than closed lo op p oles /#28/0/./9 times the closed lo op p oles F /, GLx
/#29/. Thesolution is under/-determined and the additional degrees of freedom is usedto mak e the observ er more robust to p erturbations in the system matrices/,similar to the observ er design in Section /6/./2/./2/.An tiwindupT oa v oid in tegrator windup/, where the in tegration states gro w when a con/-trol signal has saturated/, the in tegration states are not up dated if a con trolsignal has saturated/. Hencexi
/#28 t /+/1 /#29 /=
/#28xi
/#28 t /#29/+ r /#28 t /#29 /, y /#28 t /#29 if no con trol signal has saturatedxi
/#28 t /#29 when an y con trol signal has saturated/#28/6/./5/1/#29The con trol signal whic h saturates can no w b e limited without ac hieving anunacceptable p erformance/. Note that the observ er has to use the saturatedcon trol signals/.Con troller exp erimen tIn Figure /6/./1/1 an application with the con troller is illustrated/. The distur/-bances are the same as in Figure /6/./9/. It is in teresting to study ho w thecon troller trades o/#0B the di/#0Beren t signals/. Changing the NO/3
reference sig/-nal from /6 to /5/, at t /= /1/0h/, causes the external carb on dosage and in ternalrecirculation to increase/, the DO set/-p oin t decrease and the ammonium b e/-comes temp orarily higher/. An almost doubled return sludge /#0Do w at t/=/7/5hdo es hardly not a/#0Bect the con trol/, whic h is in agreemen t with the iden ti/#0C/-cation exp erimen t/, where it w as found that using the return sludge /#0Do wa san input did not impro v e the estimated mo del/.The previous sim ulation w as noise/-free/. The same sim ulation is no wrep eated/, but with noise added on the output with standard deviation /0/./1
on the ammonium sensor and /0/./1 on the nitrate sensor/. This is illustratedin Figure /6/./1/2/. As seen/, the con trol signals b ecomes a bit noisy /. A less/6/./2 Con trol /1/7/1
01020304050607080900123456
time [h]mg/lNitrate (−) and ammonium (−−) in last aerated zone
0102030405060708090012345
time [h]Internal rec. (−), DO set−point (−−), and ext. carbon flow (:)Figure /6/./1/1/: Upp er plot/: The outputs/, nitrate and ammonium/. TheNO/3
set/-p oin ti sc hanged from /6 to /5 after /1/0 hours/. L ower plot/: Thecon trol signals/, DO set/-p oin t /#28mg/#2Fl/#29/, in ternal recirculation /#28m
/3/#2Fh/#29/,and external carb on /#0Do w rate /#28l/#2Fh/#29/, with concen tration /2/0/0/0/0 mg/#2FlCOD/.noise sensitiv e con troller can be ac hiev ed b y designing a slo w er con trollerand a slo w er observ er/. A slo w er con troller can b e obtained b ym ultiplyingthe previously used Q matrix with /0/./5/. The observ er p oles can b e set equalto the closed lo op p oles/, instead of scaling them b y /0/./9 as b efore/./6/./2/./4 Comparison b et w een the t w om ultiv ariable con trollersThe t w o con trollers ga v e similar p erformance despite the di/#0Beren t designmetho ds/. The ma jor di/#0Berences are that the the con troller on di/#0Beren tialform p enalize incremen tal states whic h mak es it easier to obtain smo othcon trol signals/. A dra wbac k with this metho d is that the size of the con trolsignals are not p enalized whic h mak es it p ossible for the con trol signals todrift/. This ma y happ en if the con trol signals do not ha v e a unique solution/1/7/2 Multiv ariable mo deling and con trol
01020304050607080900123456
time [h]mg/lNitrate (−) and ammonium (−−) in last aerated zone
0102030405060708090012345
time [h]Internal rec. (−), DO set−point (−−), and ext. carbon flow (:)Figure /6/./1/2/: Application of the con troller with noisy output sensors/.Upp er plot/: The outputs/, nitrate and ammonium/. The NO/3
set/-p oin tis c hanged from /6 to /5 after /1/0 hours/. L ower plot/: The con trol signals/,DO set/-p oin t /#28mg/#2Fl/#29 and in ternal recirculation /#28m
/3/#2Fh/#29/, and externalcarb on dosage /#28l/#2Fh/, with concen tration /2/0/0/0/0 mg/#2Fl/.for a particular output/, whic h is the case here/. The con troller with theadditional in tegration states/, on the other hand/, p enalizes the size of thecon trol signals and it is then easier to reduce the drift/, but the problemwith the drift is not completely solv ed b y this metho d either/./6/./2/./5 Comparison be t w een SISO and MIMO con trolSev eral single input single output /#28SISO/#29 con trollers could be used as analternativ e to a m ultiv ariable con troller/. An approac h consisting of threeSISO con trollers is presen ted here/:/#0F Con trol of the ammonium concen tration/, as outlined in Section /5/./5/./6/./2 Con trol /1/7/3/#0F Con trol of the nitrate concen tration in the ano xic zone/, as presen tedin Chapter /3/./#0F Con trol of the nitrate concen tration in the last aerobic zone b y usingthe in ternal recirculation /#0Do w rate as the con trol signal/.In this sim ulation/, the adaptiv e mo del/-based PI con troller is used for con trolof the nitrate concen tration in the ano xic zone/. The other t w o con trollersare PI con trollers whic h are man ually tuned/. Since there are cross couplingsin the pro cess it is di/#0Ecult to design fast SISO con trollers/. It is v ery easyto obtain an oscillating closed lo op system/.In the comparison b et w een the con trollers/, the reference signal for thenitrate concen tration is c hanged from /6 to /5 mg/#2Fl/. There are also v ariationsin the in/#0Duen t w astew ater/, as illustrated in Figure /6/./9/, where b oth thein/#0Duen t/#0D o w rate/, and in/#0Duen tw astew ater comp osition are v aried/.A sim ulation with the SISO con trollers is illustrated in Figure /6/./1/3/.The SISO con trollers manages reasonably w ell to reject the di/#0Beren t dis/-turbances/. The nitrate concen tration in the ano xic zone whic hi sc o n trolledb y the external carb on /#0Do w rate is sho wn in Figure /6/./1/4/. This con trol w orksalso w ell/, the nitrate concen tration in the ano xic zone is k ept close to itsset/-p oin t/. An in teresting question is/, ho w ev er/, ho w to select the nitrate set/-p oin t in the ano xic zone/. In the suggested MIMO con trollers this c hoicedo es not exist/.The sim ulation with the MIMO con trollers w ere sho wn in Figure /6/./8 and/6/./1/1/. These con trollers w orks ev en b etter than the SISO con troller/. Theoutputs w are k ept v ery close to the desired set/-p oin ts/. It w as also easier totune these con troller faster than the SISO con troller/, since the m ultiv ariablecon trollers are based on a m ultiv ariable mo del where all cross/-couplings arekno wn/. A p ossible problem with this con troller is that the con troller signalsare drifting/, but on the other hand they are also drifting in the SISO case/,
so this ma y not b e a particular problem for MIMO con trollers/./1/7/4 Multiv ariable mo deling and con trol
010203040506070809001234
time [h]Internal rec. (−), DO set−point (−−), and ext. carbon flow (:)01020304050607080900123456
time [h]mg/lNitrate (−) and ammonium (−−) in last aerated zoneFigure /6/./1/3/: SISI con trol of nitrate /#28solid/#29 and ammonium /#28dashed/#29concen trations /#28upp er part/#29/, the reference v alues /#28dotted/#29 are alsosho wn/. In the lo w er part/, the con trol signals are sho wn/, i/.e/. DOset/-p oin t /#28dashed/#29/, in ternal recirculation /#28solid/#29/, and external carb ondosage /#28dotted/#29/.
0102030405060708090123
time [h]Nitrate in anoxic zone (−−) and external carbon flow (−)Figure /6/./1/4/: The nitrate concen tration /#28dashed/#29 in the ano xic zone/,and the carb on /#0Do w rate /#28solid/#29/. The reference signal /#28dotted/#29/, is alsosho wn/./6/./3 Some remarks /1/7/5/6/./3 Some remarksT uning the LQ/-con trollers are relativ ely simple /#28easier than tuning a PIDcon troller/#29/. The elemen ts in the R matrix /#28the Q matrix could also b e used/#29are v aried un til the desired p erformance is obtained/. T o mak e the DO set/-p oin t/, for example/, smaller and less high frequen t/, the middle elemen t inthe R /-matrix is increased/.The presen ted con trollers do not use measuremen ts of the nitrate con/-cen tration in the ano xic zone/, and the air v alv e p ositions/. It ma y hence b ea g ood idea to extend the con troller with these measuremen ts/, b ecause ofthe follo wing/:/#0F If the nitrate concen tration in the ano xic zone is close to zero/, anincreased dosage of external carb on is not v ery useful/./#0F If an air v alv e has saturated/, it is no p oin t increasing /#28decreasing/#29 theDO set/-p oin t/.One ma y argue if it is a g ood strategy or not to main tain a set/-p oin ton the ammonium and nitrate concen tration in the last aerated zone/. It islik ely that time/-v arying set/-p oin ts are more optimal than constan t ones/. Ifa strategy for c ho osing the ammonium and nitrate set/-p oin ts are deriv ed/,suc h a strategy ma y b e applied to the m ultiv ariable con troller/.A problem with the MIMO con trollers is to /#0Cnd a g ood mo del of thepro cess/. Quite often a mo del is obtained whic h lo oks go o d in the v alidationfrom the iden ti/#0Ccation/, but when it is used in the con troller design/, thecon troller do es not w ork w ell/. The deriv ed con troller tries to use a negativ ein ternal recirculation rate/. Before MIMO con trol can be applied reliablyone has to /#0Cnd a metho d whic h can decide if an estimated mo del will w orkor not in a con trol design/. One idea to solv e this problem ma y b e to studythe step resp onses for the di/#0Beren t input signals/, and from this informationdecide if the mo del is suitable or not for con troller design/. Another problemis ho w to obtain a g ood mo del when y ou kno w the a v ailable mo del is notsuitable/. A p ossible solution could b e to discard data used in the subspaceiden ti/#0Ccation/, since this a/#0Bects the estimated mo del/. These problems are/,ho w ev er/, topics for future researc h/./6/./4 ConclusionsIt has/, b y sim ulations/, b een sho wn that it is p ossible to estimate a lineartime/-in v arian t state/-space mo del/, whic h w ell can predict the ammonium/1/7/6 Multiv ariable mo deling and con troland nitrate concen tration in the last aerated zone in a pre/-denitrifyingactiv ated sludge pro cess/. The mo del uses the follo wing six input signals/:DO set/-p oin t/, external carb on/, in ternal recirculation/, in/#0Duen t/#0D o w/, in/#0Duen tcarb on and in/#0Duen t ammonium/.Based on the estimated linear mo del/, t w om ultiv ariable linear quadratic/#28LQ/#29 con troller ha v e b een designed/. The con trol strategy is based on main/-taining the ammonium and the nitrate concen tration in the last aeratedzone close to sp eci/#0Ced set/-p oin ts/. The con trollers use feedforw ard frommeasurable disturbances/: in/#0Duen t /#0Do w/, in/#0Duen t carb on and in/#0Duen t am/-monium/. The con trollers w ere ev aluated in a sim ulation study /. The /#0Crstone w as based on di/#0Beren tiating the system and deriving an incremen talcon troller/. The second approac hw as to include additional in tegration statesfor eac h output/. Both con trollers sho w ed high p erformance/. It w as/, ho w/-ev er/, found that the mo deling part is crucial for the con trol p erformance/.A further study of this asp ect is an imp ortan t topic for future researc h/.Chapter /7Conclusions and topics forfuture researc h/7/./1 ConclusionsIn this thesis some strategies to impro v e the con trol of w astew ater treat/-men t plan ts ha v e b een outlined/. In particular con trol and estimation prob/-lems in a pre/-denitrifying activ ated sludge pro cess ha v e b een studied/. Byin tro ducing more adv anced con trol/, the e/#0Fuen t concen trations of nitrate/,ammonium/, and o xygen consuming matter can b e reduced/. Less c hemicalsand energy are also needed/, whic h giv e a signi/#0Ccan t economic incen tiv et ouse more adv anced con trol strategies/. The plan t e/#0Eciency and capacit y canhence b e impro v ed/.By adding an external carb on dosage/, the e/#0Fuen t concen tration of ni/-trate can be reduced/. F our t yp es of con trollers for the external carb ondosage ha v e b een ev aluated in a sim ulation study in Chapter /3/. The con trolstrategy w as based on k eeping the nitrate concen tration in the ano xic zoneat a constan t lo w lev el/. The four con trollers w ere a PI/-con troller/, a gen/-eralized minim um/-v ariance adaptiv e con troller/, an adaptiv e LQ/-con troller/,and a mo del/-based adaptiv e PI con troller/. All con trollers utilized feedfor/-w ard/. The PID/-con troller ma y b e hard to tune and its con trol p erformancedeteriorates when the pro cess dynamic c hanges/. The adaptiv e con trollersw ere easier to tune/, and they also w ork ed w ell/. A safet y net w as/, ho w ev er/,required to a v oid n umerical problems with the adaptiv e con trollers/. Themo del/-based adaptiv e PI con troller sho w ed high p erformance/, and it usesph ysical kno wledge of the pro cess/. The adaptiv e LQ/-con troller had alsohigh p erformance/. The direct adaptiv e con troller adapted fast to c hanges/1/7/8 Conclusions and topics for future researc hin the pro cess and w as easy to implemen t/. A practical exp erimen t withthe direct adaptiv e con troller has also b een p erformed/. It sho w ed that thedirect adaptiv e con troller could k eep the nitrate concen tration in the ano xiczone tigh t to a desired set/-p oin t/.In Chapter /4/, on/-line metho ds for estimating the time/-v arying respira/-tion rate and the nonlinear o xygen transfer function w ere presen ted/. Theestimator w as based on a Kalman /#0Clter approac h where measuremen ts ofthe dissolv ed o xygen concen tration and the air/#0Do w rate w ere used/. Tw odi/#0Beren t mo dels of the nonlinear KL
a function w ere suggested/: an exp o/-nen tial mo del and a cubic spline mo del/. Tw o mo dels for mo deling thetime/-v arying respiration rate w ere also considered/: a random w alk mo deland an in tegrated random w alk mo del/. An approac h to estimate the o xy/-gen transfer function b y di/#0Beren tiating the data w as also brie/#0Dy outlined/.The estimation pro cedures w ere illustrated b oth in a sim ulation study andon real data from a pilot plan t/. The results w ere successful b oth in the sim/-ulation study and when applied to real data/. In the practical exp erimen t/,the estimated respiration rate follo w ed the measured respiration rate w ell/.The con trol of the dissolv ed o xygen in an activ ated sludge pro cess w asdiscussed in Chapter /5/. The basic idea w as to explicitly tak e the nonlinearo xygen transfer function in to accoun t in the con trol design/. Tw o designapproac hes w ere then applied on the linearized pro cess/, p ole/-placemen twith a PI/-regulator and linear quadratic con trol with feedforw ard/. In asim ulation study /, the p erformance of a linear and a nonlinear con troller w asillustrated/. It w as sho wn that the nonlinear DO con troller outp erformed thelinear con troller/. The results from the sim ulation study w ere also con/#0Crmedb y exp erimen ts in a pilot plan t/. A set/-p oin t con troller for the DO pro cessw as outlined/. The basic idea w as to con trol the DO set/-p oin t so thatthe ammonium concen tration in the last aerobic zone w as k ept lo w/. Anexp erimen t in the pilot plan t sho w ed that/, b y using this con troller not onlyenergy could be sa v ed due to a lo w er DO set/-p oin t/, but also the e/#0Fuen tnitrate concen tration b ecame signi/#0Ccan tly lo w er/. A pressure con troller w asalso ev aluated in the pilot plan t/. The air pressure w as con trolled so thatthe most op en v alv ew as almost completely op en/.In Chapter /6 it w as sho wn/, in sim ulations/, that it w as p ossible to esti/-mate a linear time/-in v arian tm ultiv ariable state/-space mo del/, whic h couldpredict the ammonium and nitrate concen tration in the last aerated zonew ell/. This mo del w as then used for design of m ultiv ariable LQ con trollerswith feedforw ard/. F or the con trol/, external carb on/, in ternal recirculationrate/, and DO set/-p oin tw ere considered as inputs/. Ammonium and nitratein the last aerated zone w ere outputs/. The con trollers used feedforw ard/7/./2 T opics for future researc h /1/7/9from the measurable disturbances/: in/#0Duen t /#0Do w rate/, in/#0Duen t ammoniumconcen tration and in/#0Duen t substrate/. Tw o di/#0Beren t con trollers w ere ev alu/-ated in a sim ulation study /. The /#0Crst one w as based on di/#0Beren tiating thesystem and deriving an incremen tal con troller/. The second approac h w asto include additional in tegration states for eac h output/. Both con trollerssho w ed high p erformance/. It w as/, ho w ev er/, found that the mo deling partw as crucial for the con trol p erformance/./7/./2 T opics for future researc h/7/./2/./1 Spatial DO con trolIt is p ossible to extend the set/-p oin t con troller presen ted in Chapter /5in v arious resp ects/, for example/, to con trol the n um be r of aerated zones/.The order in whic h the aerated zones are switc hed o/#0B ma y be imp ortan t/.Changing the aerobic/#2Fano xic ratio also a/#0Bects the dynamic in the nitri/#0C/-cation/#2Fdenitri/#0Ccation pro cesses/. Ammonium and nitrate con trollers ma yhence need di/#0Beren t tuning for di/#0Beren t n um be r of aerated zones/. Place/-men t of sensors ma y b e another practical problem when c hanging an aerobiczone to an ano xic/./7/./2/./2 F urther studies of the e/#0Bect of surfactan tsThe surfactan ts ha v e large impact on some WWTP /.F or example/, it reducesthe KL
a /. When this happ ens the air/#0Do w rate ha v e to be increased tomain tain the o xygen concen tration/, whic h consumes energy /. If it is p ossibleto precipitate the surfactan ts this problem could be reduced/. A con trolstrategy for the surfactan t could then b e based on an estimated KL
a /.F urther studies are needed to determine if the surfactan ts deterioratethe sludge settling prop erties and sludge loss is obtained/. If they do/, it isanother reason to either try to /#0Cnd a precipitation c hemical or mak e thep olluter reduce their use of surfactan ts/./7/./2/./3 Analyzing the information of the carb on dosageAnother topic for further researc h could b e to analyze the additional infor/-mation/, as the v ariations in carb on /#0Do w rate ma y giv e/. F or example/, theair/#0Do w rate giv es some information ab out the organic load to the plan t/.The carb on /#0Do w rate could p erhaps in a similar w a y be used to ac hiev einformation ab out the in/#0Duen tw astew ater comp osition/, the denitri/#0Ccation/1/8/0 Conclusions and topics for future researc hrate/, and/#2For to detect problems in the pro cess/./7/./2/./4 Con trol of the sludge blank et and the biomassSev eral con trol strategies ha v e b een suggested in this thesis/, but ho w thesludge recirculation rate and excess sludge /#0Do w rate should be con trolledha v e not b een discussed/. It w ould hence b e in teresting to design a con trollerwhere these imp ortan t /#0Do w rates are con trolled/. Should the strategy bebased on k eeping the sludge blank et constan t/, or the fo o d to biomass ratioconstan t/. Is it p ossible to tak e the e/#0Eciency of the microorganisms in toaccoun t and v ary the di/#0Beren t concen trations after the temp erature forexample/. Ho w this should b e solv ed are c hallenging questions for a futureresearc h/./7/./2/./5 Plan t/-wide optimizationT o optimize a whole plan t/, whic h is v ery complex/, it is helpful to dividethe plan ti n to sev eral smaller sub/-pro cesses/, whic h are easier to con trol andoptimize/. The global optim um of the plan tm a y then not b e reac hed/, butw e ma y get close/. The k ey idea is illustrated in Figure /7/./1/. In the lo w est
optimizationProcessPlant-wide optimization
optimizationProcess Process
optimization
Supervision
controlSupervision
control
controlLocal
controlLocalFigure /7/./1/: Di/#0Beren t lev els of con trol and optimizationla y er there are simple con trol lo ops with relativ ely short time constan ts/,lik e the DO con troller/, and the pressure con troller whic h optimizes the/7/./2 T opics for future researc h /1/8/1v alv e op enings/. In the next la y er there are sup ervision con trollers whic hcon trols the set/-p oin ts of the con trollers in the lo w er la y er /#28cascade con trol/#29/.An example of this t yp e of con troller is the DO set/-p oin t con troller/. Them ultiv ariable con troller could also /#0Ct in to this category /. In the secondhighest la y er/, set/-p oin ts for the set/-p oin t con trollers are deriv ed in order tooptimize the complete activ ated sludge pro cess/. Here cost functions ma yb ea useful to ol to /#0Cnd the most optimal op eration of the pro cess/, see Section
/7/./2/./6/. The di/#0Beren t disturbances in the in/#0Duen t are also considered/. Inthe highest lev el/, the complete w astew ater treatmen t plan t is optimized/.That is/, all pro cesses at the WWTP are considered/, i/.e/. sludge treatmen t/,pre/-sedimen tation/, the activ ated sludge pro cess/, etc/. Also construction ofnew tanks could b e considered/. The long time planning is hence made atthis lev el/. Ho w the optimization of the upp er la y ers should be done is atopic for future researc h/.In the thesis/, con trol algorithms whic h aims to optimize the completeWWTP ha v e b een started to b e dev elop ed/./7/./2/./6 Cost functionsT o /#0Cnd the optimal op eration p oin t for an activ ated sludge pro cess a costfunction ma y b e used/. By de/#0Cning costs for e/#0Fuen t disc harges and pricesfor running pumps/, blo wing air/, dosing external carb on etc/./, the total costfor a sp eci/#0Cc op erating condition can b e calculated/. Studies with these ideasha v e b een made b y Carstensen /#28/1/9/9/4/#29 and V anrolleghem et al/. /#28/1/9/9/6/#29/.Steady/-state v alues for the outputs can b e ac hiev ed for di/#0Beren t com bi/-nations of the inputs b y sim ulations/. Using costs for the e/#0Fuen t disc hargesand prices of the inputs/, the total cost can be determined at the di/#0Ber/-en t op erating p oin ts/. The minim um v alue of the cost function then giv esthe optimal op erating p oin t for that particular plan t and in/#0Duen t/. If thein/#0Duen ti s c hanged /#28/#0Do w or comp osition/#29 new sim ulations ha v e to b e made/.The cost function can not only be used to /#0Cnd the optimal op eratingp oin t/, the sensitivit y for c hanges in the di/#0Beren t con trol signals can alsobe studied/. Plotting the cost function with resp ect to a con trol signal/, acurv e will app ear/. A narro w p eak or a steep slop e in the curv e indicatesthat the pro cess is sensitiv et o v ariations in the con trol signal/. By applyinga con troller/, m uc h can be gained/. A /#0Dat minim um on the other hand/,means that not so m uc h can b e gained b y con trolling that signal/. Runningsim ulations for di/#0Beren t in/#0Duen t comp ositions and /#0Do w rates/, and then/#0Cnding the optimal op erating p oin t for eac h in/#0Do w/, giv es an idea ho w theset/-p oin ts should b e v aried when the in/#0Do wv aries/./1/8/2 Conclusions and topics for future researc hThere are/, ho w ev er/, some problems with this approac h/./#0F T o b e able to apply the strategy to a real w astew ater treatmen t plan t/,aw ell calibrated mo del of the activ ated sludge pro cess is needed/. Thisma y b e hard to obtain/./#0F The metho d is based on steady/-state v alues/, exactly ho w the metho dcould be extended to be v alid for a dynamic system is not clear/. Asimple idea could b e to calculate the optimal steady/-state op eratingp oin ts for the c hanging in/#0Do w/, and then lo w pass /#0Clter these op eratingp oin ts/./#0F The w a y to compute the optimal con troller signal is v ery computa/-tionally in tense/, if steady/-state sim ulations should b e used/. P erhapsit is p ossible to /#0Cnd a less computationally in tense metho d/./7/./2/./7 Extrem um con trolAn alternativ e or mo di/#0Ccation of the previous outlined metho d could beto use extrem um con trol/. The extrem um con troller has similarities withthe previous cost function approac h/, since it is also based on minimizinga cost function/, but here real inputs and outputs will be used instead ofsim ulated/.The idea is to de/#0Cne a cost function J/1
whic h is based on real costs ofrunning the plan t/. Assume then that J/1
has an extrem um p oin t whic h/, forexample/, can b e mo deled b yJ/2
/= U
TAU /+ B
TU /+ cwhere U is the input v ector whic hm a y consist of set/-p oin ts/, A is a co e/#0Ecien tmatrix/, B is a co e/#0Ecien t v ector/, and c a scalar/. A /, B /, and c could beestimated b y an iden ti/#0Ccation metho d/. The optimal con trol signal is thenfound b y setting dJ/2
/=dU /= /0/, whic h giv esu /= /,
/1/2
A
/, /1BExactly ho w this should w ork is a topic for future researc h/, and there aresome op en issues/, e/.g/./#0F The con ten ts of U is not ob vious/. Whic h inputs should b e included/#28ma yb e the cost function in Section /7/./2/./6 could answ er that/#29 shouldtime/-lagged inputs b e stored in the U v ector/./7/./2 T opics for future researc h /1/8/3/#0F Could J/2
mo del the extrem um p oin t/?/#0F Do es there exist an extrem um p oin t/./?/#0F Ho wm uc h excitation is needed to estimate A and B /?/1/8/4 Conclusions and topics for future researc hApp endix AThe generalizedminim um/-v ariance con trollerwith feedforw ardA/./1 Deriv ation of the con trollerThe generalized minim um/-v ariance con troller/, used to con trol the externalcarb on source in Chapter /3/, is deriv ed here/.Assume that the pro cess to be con trolled is describ ed b y the lineardiscrete/-time mo delA /#28 q
/, /1/#29 y /#28 t /#29/= B /#28 q
/, /1/#29 u /#28 t /, k /#29/+ D /#28 q
/, /1/#29 w /#28 t /, d /#29/+ C /#28 q
/, /1/#29
/1/#01/#28 q
/, /1/#29
e /#28 t /#29 /#28A/./1/#29where A /#28 q
/, /1/#29/, B /#28 q
/, /1/#29/, C /#28 q
/, /1/#29 and D /#28 q
/, /1/#29 are p olynomials in the bac kw ardshift op erator q
/, /1/, with degrees na /, nb /, nc /, and nd /. The p olynomialsA /#28 q
/, /1/#29 and C /#28 q
/, /1/#29 are monic/, y /#28 t /#29 is the output and u /#28 t /#29 is the input/.F urthermore/, the time dela ys are denoted b y k and d /, and/#01/#28 q
/, /1/#29/= /1 /, q
/, /1/#28A/./2/#29The disturbance w /#28 t /#29 is measurable and the disturbance e /#28 t /#29 is unmeasur/-able zero mean white noise/.The con troller has the follo wing stucture/#28 R /#28 q
/, /1/#29/+
/#1Ar/0
C /#28 q
/, /1/#29/#29/#01 u /#28 t /#29/= /, S /#28 q
/, /1/#29 y /#28 t /#29 /, Q /#28 q
/, /1/#29/#01 w /#28 t /+ k /, d /#29 /#28A/./3/#29/1/8/6 The generalized minim um/-v ariance con trollerT o determine the con troller p olynomials/, a predictor for the system/#28A/./1/#29 has to be determined/. First y /#28 t /+ k /#29 is calculated from /#28A/./1/#29/, itb ecomesy /#28 t /+ k /#29/= q
k /, k
BA
u /#28 t /#29/+ q
k /, d
DA
w /#28 t /#29/+
CA /#01
e /#28 t /+ k /#29 /#28A/./4/#29The k /-step predictor /^ y /#28 t /+ k j t /#29 is found b y predicting the future noise sam/-ples with their mean v alue/, i/.e/. e /#28 t /+ i /#29 /=/0 /, i /#3E /0/. It is hence desired topartition
CA /#01
e /#28 t /+ k /#29 in to t w o parts/. One part whic h con tains the futurenoise and one whic h con tains the old noise/. This can b e done b yCA /#01
/= F /+ q
/, k
GA /#01
/#28A/./5/#29where F and G are p olynomials determined b y /#28A/./5/#29 with the degreesdeg/#28 F /#29/= k /, /1 and deg/#28 G /#29/=max/#28deg/#28/#01 A /#29/,deg/#28 C /#29/#29 /, /1/. F and G are deter/-mined b y carrying out the p olynomial division
CA /#01
/.Using /#28A/./5/#29 in /#28A/./4/#29 with the future noise equal to zero giv es the pre/-dictor/^ y /#28 t /+ k j t /#29/=
BA
u /#28 t /#29/+ q
k /, d
DA
w /#28 t /#29/+
GA /#01
e /#28 t /#29 /#28A/./6/#29This predictor con tains e /#28 t /#29/, whic h can b e expressed in terms of y /#28 t /#29/, u /#28 t /#29/,and w /#28 t /#29b y using /#28A/./1/#29/. Inserting the expression of e /#28 t /#29 in /#28A/./6/#29 giv es the/#0Cnal predictor/^ y /#28 t /+ k j t /#29/= q
k /, k
BFC
/#01 u /#28 t /#29/+ q
k /, d
DFC
/#01 w /#28 t /#29/+
GC
y /#28 t /#29 /#28A/./7/#29The k /-step predictor /#28A/./7/#29 can b e found in e/.g/.
/#17Astr/#7F om and Wittenmark/#28/1/9/9/0/#29 except for the extra term q
k /, dDF /= C /#01 w /#28 t /#29 whic h has b een includedto accoun t for the measurable disturbance/.T o /#0Cnd the con trol la w whic h minimizes the criterion /#28see also Clark eand Ga wthrop /#28/1/9/7/5/#29/#29J /=
/1/2
E/#5B y
/2/#28 t /+ k /#29/+ /#1A /#28/#01 u /#28 t /#29/#29
/2j Yt
/#5D /#28A/./8/#29w e /#0Crst notice thaty /#28 t /+ k /#29/= /^ y /#28 t /+ k j t /#29/+ Fe /#28 t /+ k /#29 /#28A/./9/#29The incremen tal con trol signal /#01 u /#28 t /#29/, whic h giv es the minim um v alue of Jis found b y setting the deriv ativ eo f J with resp ect to /#01 u /#28 t /#29 to zero/.A/./1 Deriv ation of the con troller /1/8/7Com bining /#28A/./9/#29 and /#28A/./8/#29 w e obtainJ /=
/1/2
E/#5B/#28 /^ y /#28 t /+ k j t /#29/+ Fe /#28 t /+ k /#29/#29
/2/+ /#1A /#28/#01 u /#28 t /#29/#29
/2/#5D /#28A/./1/0/#29and th us/0 /=
/@J/@ /#01 u /#28 t /#29
/=/^ y /#28 t /+ k j t /#29
/@ /^ y /#28 t /+ k j t /#29/@ /#01 u /#28 t /#29
/+ /#1A /#01 u /#28 t /#29/= /#28
BFC
/#01 u /#28 t /#29/+ q
k /, d
DFC
/#01 w /#28 t /#29/+
GC
y /#28 t /#29/#29 b/0
/+ /#1A /#01 u /#28 t /#29 /#28A/./1/1/#29The deriv ativ e of /^ y /#28 t /+ k j t /#29 with resp ect to /#01 u /#28 t /#29 is equal to b/0
/, since Fand C are monic p olynomials/, and w e only consider /#01 u /#28 t /#29 terms with thetime index t /.The con troller is found b y rearranging /#28A/./1/1/#29 to/#28 BF /+
/#1Ab/0
C /#29/#01 u /#28 t /#29/= /, Gy /#28 t /#29 /, DF /#01 w /#28 t /+ k /, d /#29 /#28A/./1/2/#29The generalized minim um/-v ariance con troller /#28A/./3/#29 is then obtained b yiden tifying the p olynomials in /#28A/./3/#29 and /#28A/./1/2/#29/.S /= G /#28A/./1/3/#29R /= BF /#28A/./1/4/#29Q /= DF /#28A/./1/5/#29r/0
/= b/0
/#28A/./1/6/#29Note that the F p olynomial is monic/. Using /#28A/./1/4/#29/, this implies thatr/0
/= b/0
/.This completes the deriv ation of the generalized minim um/-v ariance con/-troller with feedforw ard/./1/8/8 The generalized minim um/-v ariance con trollerApp endix BLQ/-con trol with feedforw ardThe aim of linear quadratic /#28LQ/#29 con troller design is to /#0Cnd a con trollerwhic h minimizes the sum of the v ariance of the output and the w eigh tedv ariance of the input/, see
/#17Astr/#7F om and Wittenmark /#28/1/9/9/0/#29/.When a measurable disturbance exists/, a feedbac k con troller can becomplemen ted with disturbance measuremen t feedforw ard/, see e/.g/. Ster/-nad and S/#7F oderstr/#7F om /#28/1/9/8/8/#29 and Grim ble /#28/1/9/8/8/#29/. F or a giv en degree ofdisturbance rejection/, the high frequency gain of the feedbac k con trollercan then b e reduced/, whic hm a y increase the stabilit y robustness/, see Ster/-nad /#28/1/9/9/1/#29/.The LQ/-con troller deriv ed here mak es it p ossible to use separate p enal/-ties on the con tributions to the con trol signal from measurable and unmea/-surable disturbances/. This mak es it for example p ossible to use a con trollerwith deadb eat feedforw ard in com bination with a cautious feedbac k/. Thefeedforw ard do es not a/#0Bect the closed/-lo op stabilit y /. It ma y therefore beuseful to apply a smaller p enalt y on the con trol signal generated b y thefeedforw ard than on the feedbac k/. Separate con trol p enalties ma y also b efruitful/, when the v ariance of the measuremen t noise on the feedforw ardsensor is di/#0Beren t compared to the feedbac k sensor/, see also e/.g/. Grim ble/#28/1/9/8/8/#29/./1/9/0 LQ/-con trol with feedforw ardB/./1 The LQ problemAssume that the pro cess to b e con trolled is describ ed b y the linear discrete/-time mo delA /#28 q
/, /1/#29 y /#28 t /#29/= B /#28 q
/, /1/#29 u /#28 t /, k /#29/+ D /#28 q
/, /1/#29 w /#28 t /, d /#29/+ C /#28 q
/, /1/#29
/1/#01/#28 q
/, /1/#29
e /#28 t /#29 /#28B/./1/#29where A /#28 q
/, /1/#29/, B /#28 q
/, /1/#29/, C /#28 q
/, /1/#29 and D /#28 q
/, /1/#29 are p olynomials in the bac kw ardshift op erator q
/, /1/, with degrees na /, nb /, nc /, nd /. The p olynomials A /#28 q
/, /1/#29and C /#28 q
/, /1/#29 are monic/, y /#28 t /#29 is the output and u /#28 t /#29 is the input/. F urthermore/,the time dela ys are denoted b y k and d /, and/#01/#28 q
/, /1/#29/= /1 /, q
/, /1/#28B/./2/#29The disturbance w /#28 t /#29 is measurable and the disturbance e /#28 t /#29 is unmeasur/-able zero mean white noise/. The measurable disturbance w /#28 t /#29 is mo delledb y an ARMA pro cessw /#28 t /#29/=
G /#28 q
/, /1/#29H /#28 q
/, /1/#29
v /#28 t /#29 /#28B/./3/#29where v /#28 t /#29 is zero mean white noise/. The p olynomials G /#28 q
/, /1/#29 and C /#28 q
/, /1/#29are required to b e stable p olynomials
/1/. A stable p olynomial is de/#0Cned as ap olynomial whic h has all its zeros inside the the unit circle/.A frequen tly used criterion in LQ/-design/, see e/.g/.
/#17Astr/#7F om and Witten/-mark /#28/1/9/9/0/#29 isJ /= limN /!/1
/1N
NXt /=/0
/#5BE y /#28 t /#29
/2/+ /#1A E u /#28 t /#29
/2/#5D /#28B/./4/#29It is also common that/, instead of p enalizing the v ariance of the con trolsignal u /#28 t /#29 as in the criterion /#28B/./4/#29/, the v ariance of/#01 u /#28 t /#29/= u /#28 t /#29 /, u /#28 t /, /1/#29 /#28B/./5/#29is p enalized instead/. This allo ws the con trol signal to drift while the v ari/-ations of the con trol signal are reduced/. The c hoice of p enalizing /#01 u /#28 t /#29instead of u /#28 t /#29/, is reasonable when there are drifting disturbances/, sincesuc h disturbances require a drifting con trol signal/, whic h forces the con/-troller to con tain in tegration
/2/. The LQ con troller to be deriv ed here will/1If G or C are estimated/, and zeros in j z j/#15 /1 are obtained/, these zeros then ha v eto b e pro jected in to the stable region/. Suc h a pro jection do es not c hange the sp ectraldensit yo f Gv /#28 t /#29o r Ce /#28 t /#29/./2If the con trol signal is drifting/, the problem of minimizing the criterion /#28B/./4/#29 w ouldb e unsolv able when p enalizing u /#28 t /#29 since the criterion gro ws to in/#0Cnit y for drifting signals/.B/./1 The LQ problem /1/9/1therefore use /#01 u in the criterion/. The obtained in tegrating con troller is alsoadv an tageous for other reasons/, e/.g/. it mak es the con troller less sensitiv et olo w/-frequency mo delling errors/.T o deriv e a LQ/-con troller where it is p ossible to use separate p enaltieson comp onen ts of the con trol signal whic h originate from di/#0Beren t distur/-bances/, the con trol signal incremen t is partitioned as/#01 u /#28 t /#29/= /#01 ue
/#28 t /#29/+ /#01 uv
/#28 t /#29 /#28B/./6/#29where ue
/#28 t /#29 is the part of the con trol signal whic h is generated b y the un/-measurable noise e /#28 t /#29/, and uv
/#28 t /#29 is the part originating from the inno v ationsequence of the measurable disturbance v /#28 t /#29/. The new criterion with t w op enalt y parameters isJ /= limN /!/1
/1N
NXt /=/0
/#5BE y /#28 t /#29
/2/+E /#28
p/#1Ae
/#01 ue
/#28 t /#29/+
p/#1Av
/#01 uv
/#28 t /#29/#29
/2/#5D /#28B/./7/#29The q
/, /1argumen t is for simplicit y skipp ed in most of the follo wing p olyno/-mial equations/. The p olynomial A /#28 q
/, /1/#29/, for example will only b e denotedb y A /, and so on/. Conjugated p olynomials are also used/. They are denotedb ya
/#03and de/#0Cned as follo ws/. IfB /#28 q
/, /1/#29/= b/0
/+ b/1
q
/, /1/+ b/2
q
/, /2/+ /:/:/: /#28B/./8/#29thenB
/#03/#28 q /#29/= b/0
/+ b/1
q /+ b/2
q
/2/+ /:/:/: /#28B/./9/#29If B /#28 q
/, /1/#29 is a stable p olynomial/, then B
/#03/#28 q /#29 is unstable/.The con troller minimizing the criterion /#28B/./7/#29 is presen ted in the follo w/-ing Theorem/.Theorem B/./1 Consider the system /#28B/./1/#29/, and assume A /#01 and B to haveno c ommon unstable factors/. The c ontr ol ler which minimizes the criterion/#28B/./7/#29/, wher e v /#28 t /#29 and e /#28 t /#29 ar e assume d to b e unc orr elate d/, is then given byR /#28 q
/, /1/#29/#01 u /#28 t /#29/= /, S /#28 q
/, /1/#29 y /#28 t /#29 /,
Q /#28 q
/, /1/#29P /#28 q
/, /1/#29
w /#28 t /#29 /#28B/./1/0/#29wher e R /#28 q
/, /1/#29 /, S /#28 q
/, /1/#29 /, P /#28 q
/, /1/#29 and Q /#28 q
/, /1/#29 ar e c ontr ol ler p olynomials/.The fe e db ack p olynomials R /#28 q
/, /1/#29 and S /#28 q
/, /1/#29 ar e determine d by theunique solution of the p ole plac ement e quation/#0B
/#01/= AR /#01/+ q
/, kBS /= /#0Ce
C /#28B/./1/1/#29/1/9/2 LQ/-con trol with feedforw ardwhen A /#01 and B have no c ommon factors/. If they have c ommon factors/,then se e r emark /2/. In /#28B/./1/1/#29 re
is a sc alar and /#0Ce
/#28 q
/, /1/#29 is a stable monicp olynomial derive d fr om the sp e ctr al factorizationre
/#0Ce
/#0C
/#03e
/= BB
/#03/+ /#1Ae
A /#01/#01
/#03A
/#03/#28B/./1/2/#29The fe e dforwar d /#0Clter denominator P /#28 q
/, /1/#29 is determine d byP /= G/#0Cv
/#28B/./1/3/#29wher e /#0Cv
/#28 q
/, /1/#29 is a stable monic p olynomial derive d fr om the sp e ctr al fac/-torizationrv
/#0Cv
/#0C
/#03v
/= BB
/#03/+ /#1Av
A /#01/#01
/#03A
/#03/#28B/./1/4/#29The fe e dforwar d p olynomial Q /#28 q
/, /1/#29 is found as the unique solution of theline ar p olynomial e quation/#28 RB
/#03/, /#1Av
/#01
/#03A
/#03Sq
/, k/#29 q
/, d /+ kDG /#01/= rv
/#0C
/#03v
Q /+ qL
/#03/#0BH /#28B/./1/5/#29with r esp e ct to Q /#28 q
/, /1/#29 and L
/#03/#28 q
/, /1/#29 /.Pro of/: The pro of is giv en in Lindb erg /#28/1/9/9/5/#29/.R emark /1/: As men tioned b efore/, the con trol signal has b een separatedin to t w o parts ue
/#28 t /#29 and uv
/#28 t /#29 whic h can be p enalized separately /. Oneshould/, ho w ev er/, b e a w are of the follo wing prop ert y /. Since uv
/#28 t /#29 is deriv edfrom the measurable disturbance v /#28 t /#29/, a large v alue of /#1Av
implies that v /#28 t /#29will not b e rejected/, not ev en b y the feedbac k lo op/. The e/#0Bect of the mea/-surable disturbance v /#28 t /#29 on the feedbac k signal will in suc h a case insteadbe /#28partly/#29 cancelled b y the feedforw ard con trol signal/. In general onew ould lik e a slo w feedbac k for stabilit y reasons and a fast feedforw ard toreject measurable disturbances fast/, then /#1Ae
/#3E /#1Av
and this prop ert y do esnot o ccur/.R emark /2/: When A /#01 and B ha v e common factors/, the feedbac k p oly/-nomials R /#28 q
/, /1/#29 and S /#28 q
/, /1/#29 are determined b y the unique solution to thecoupled linear p olynomial equations/#1Ae
/#01
/#03A
/#03C /+ q
/, k /+/1BX
/#03/= re
/#0C
/#03e
R /#28B/./1/6/#29q
kCB
/#03/, qA /#01 X
/#03/= re
/#0C
/#03e
S /#28B/./1/7/#29with resp ect to R /#28 q
/, /1/#29/, S /#28 q
/, /1/#29 and X
/#03/#28 q /#29/.R emark /3/: When /#1A /= /#1Ae
/= /#1Av
/, a sp ecial and simpli/#0Ced case is ob/-tained/, where the feedforw ard p olynomials P /#28 q
/, /1/#29 and Q /#28 q
/, /1/#29 instead areB/./1 The LQ problem /1/9/3determined b y the follo wing equations/:P /= G /#28B/./1/8/#29q
/, d /+/1DG /#01 X
/#03/= r/#0C
/#03Q /+ qL
/#03CH /#28B/./1/9/#29where the X
/#03/#28 q
/, /1/#29 p olynomial is obtained from either /#28B/./1/6/#29 or /#28B/./1/7/#29/.The degrees of the Q and L p olynomials should here b e c hosen asnQ
/= max/#28 nd
/+ ng
/+ d /+/1 /;nc
/+ nh
/#29 /, /1 /#28B/./2/0/#29nL
/= max/#28/0 /;k /, d /#29/+ n/#0C
/, /1 /#28B/./2/1/#29The feedbac k p olynomials are not a/#0Bected/. When /#1Ae
/6/= /#1Av
the degrees ofthe p olynomials are deriv ed as in Section B/./1/./1/.R emark /4/: T ypical selection of /#1Ae
and /#1Av
/. The most useful applicationof this con troller is to design the feedforw ard lo op faster than the feedbac k/.Since the feedforw ard do es not a/#0Bect the closed/-lo op stabilit y it is useful toapply a smaller p enalt y on the con trol signal generated b y the feedforw ard/#28 /#1Av
/#29 than on the feedbac k/#28 /#1Ae
/#29/.R emark /5/: When the measurable disturbance w /#28 t /#29 is drifting/, i/.e/. whena factor /#01 exists in the denominator of the mo del /#28B/./3/#29 of w /#28 t /#29w /#28 t /#29 /=
G/#01 H/1
v /#28 t /#29H /= /#01 H/1then /#28B/./1/5/#29 has to b e sligh tly mo di/#0Ced/. Otherwise /#01 b ecomes a commonfactor of b oth sides of the equation/. T o see this/, w e notice that /#01 is a factorof the left/-hand side of /#28B/./1/5/#29 and in one of the righ t/-hand side terms /#28 H /#29/.Then /#01 m ust also be a factor of Q /, if the equation is to ha v e a solution/.T oa v oid this problem/, w e explicitly in tro duce /#01 as a factor in Q /,a sQ /=/#01 Q/1
/#28B/./2/2/#29and cancel this factor ev erywhere in /#28B/./1/5/#29/. Equation /#28B/./1/5/#29 is then re/-duced to/#28 RB
/#03/, /#1Av
/#01
/#03A
/#03Sz
/, k/#29 z
/, d /+ kDG /= rv
/#0C
/#03v
Q/1
/+ zL
/#03/#0BH/1
/#28B/./2/3/#29and can no w b e solv ed with resp ect to Q/1
/, de/#0Cned in /#28B/./2/2/#29/. As noted inSternad /#28/1/9/9/1/#29/, the same t yp e of mo di/#0Ccation m ust b e applied to /#28B/./1/9/#29/.In Figure B/./1 the pro cess with the con troller is illustrated/. Note that/1 /= /#28 R /#28 q
/, /1/#29/#01/#28 q
/, /1/#29/#29 is presen t in b oth the feedbac k and the feedforw ard lo op/./1/9/4 LQ/-con trol with feedforw ardm m
QP/1R /#01
q
/, k
BA
/?/-/6
/- /- /- /-/#1BS
q
/, d
DA
CA
/1/#01
GH/#08/#08/#08/#19
HHHj
/?
/#1B/?
/? /?/,
/,/+
n /#28 t /#29
e /#28 t /#29 v /#28 t /#29y /#28 t /#29u /#28 t /#29
w /#28 t /#29Tyre f
/#28 t /#29Figure B/./1/: The pro cess with the con trollerB/./1/./1 Choice of the degrees of the con troller p olynomialsT o /#0Cnd the unique solution of the con troller p olynomials/, their degrees ha v eto b e c hosen prop erly /. The degrees are de/#0Cned so that the p olynomials co v erthe maximal p o w ers of q
/, /1and q in the equations/.Studying equation /#28B/./1/6/#29 giv es/, deg C /#15/, deg R /#28B/./2/4/#29/, k /+/1 /, deg B /#15/, deg R /#28B/./2/5/#29The min us signs app ear b ecause the p olynomial argumen t is q
/, /1/. Notethat the
/#03p olynomials do not a/#0Bect the maximal p o w er of q
/, /1/, since theirleading co e/#0Ecien t is indep enden to f q /#28e/.g/. X
/#03/= x/0
/+ x/1
q /+ /:/:/: /#29/. Equation/#28B/./2/4/#29 and /#28B/./2/5/#29 can b e simpli/#0Ced todeg R /= max/#28deg B /+ k /, /1 /; deg C /#29In the same w a y /, the degrees of the other p olynomials are determined/#28where the notation nx
/= deg X is used/#29n/#0Ce
/=
/#28max /#28 na
/+/1 /; nb
/#29 if /#1Ae
/6/=/0nb
if /#1Ae
/=/0B/./1 The LQ problem /1/9/5n/#0Cv
/=
/#28max /#28 na
/+/1 /; nb
/#29 if /#1Av
/6/=/0nb
if /#1Av
/=/0nx
/= n/#0Ce
/+ k /, /1nr
/=
/#28max /#28 nb
/+ k /, /1 /; nc
/#29 if /#1Ae
/6/=/0nb
/+ k /, /1 if /#1Ae
/=/0ns
/= max/#28 na
/; nc
/, k /#29nq
/=
/#28max /#28 n/#0B
/+ nh
/, /1 /; d /, k /+ nd
/+ ng
/+ /1 /+ max/#28 nr
/; ns
/+ k /#29/#29 if /#1Av
/6/=/0max /#28 n/#0B
/+ nh
/, /1 /; d /, k /+ nd
/+ ng
/+/1 /+ nr
/#29 if /#1Av
/=/0nl
/=
/#28max /#28 n/#0Cv
/; k /, d /+ max/#28 nb
/; /1 /, d /+ na
/#29/#29 /, /1 if /#1Av
/6/=/0max /#28 n/#0Cv
/; k /, d /+ nb
/#29 /, /1 if /#1Av
/=/0/1/9/6 LQ/-con trol with feedforw ardApp endix CCubic splineA cubic spline p olynomial ma y giv e a go o d appro ximation of man yt yp es ofstatic nonlinearities/. The spline function is /#28here/#29 a piecewise third orderp olynomial with con tin uous /#0Crst and second deriv ativ es in its /#28grid/#29 p oin ts/,whic h do not need to b e placed equidistan t/. It has an inheren t smo othnesswhic h is natural from a ph ysical p oin t of view/. In Figure C/./1 a cubic splineis sho wn/, together with some of the parameter de/#0Cnitions/.
uu u1 2 3u13
2
xxx12 3L
u0K  a
θ
θ
θFigure C/./1/: A cubic spline function/.The common use of a cubic spline is for interp olation /, see e/.g/. Dahlquistet al/. /#28/1/9/7/4/#29/. F or suc h a case /#12 /, see Figure C/./1/, is kno wn/. Here the /#12 v ectoris unkno wn and will b e estimated/./1/9/8 Cubic splineF rom Dahlquist et al/. /#28/1/9/7/4/#29 w eh a v e that a cubic spline p olynomial canb e written in the follo wing form where u is in the in terv al ui /, /1
/#14 u/#3CuiKL
a /#28 u /#29i
/= mi
/#12i
/+/#28 /1 /, mi
/#29 /#12i /, /1/+ xi
mi
/#28/1 /, mi
/#29/#5B/#28 ki /, /1
/, di
/#29/#28/1 /, mi
/#29 /, /#28 ki
/, di
/#29 mi
/#5D /#28C/./1/#29wherexi
/= ui
/, ui /, /1
/#28C/./2/#29di
/=
/#12i
/, /#12i /, /1xi
/#28C/./3/#29mi
/=
u /, ui /, /1xi
/; u /2 /#5B ui /, /1
/;ui
/#5D /#28C/./4/#29i /= /1 /; /2 /;/:/:/: /;n n /=n um be r o f grid p oin ts /#28C/./5/#29The v ariables k/0
/;k/1
/; /:/:/:/; kn
are the deriv ativ es of the spline at the grid p oin ts/.Note that KL
a /#28 ui
/#29i
/= /#12i
/.The form /#28C/./1/#29 is not con v enien t for parameter estimation/. Belo w alinear regression form for the mo del /#28C/./1/#29 will b e outlined/.C/./1 Deriv ation of the linear regression formThe purpuse of this deriv ation is to /#0Cnd an expression of KL
a /#28 u /#29 in thefollo wing form/.KL
a /#28 u /#29i
/= /#20
TKL
a
/#12KL
a
/#28C/./6/#29T o /#0Cnd this expression w e start b y deriving the deriv ativ es of the spline atthe grid p oin ts/, i/.e/. k/0
/;k/1
/; /:/:/:/; kn
/. The deriv ativ es are determined from thecondition that the second order deriv ativ e of the cubic spline/, should beequal in the grid p oin ts/, that isKL
a
/0/0/#28 u /#29i /+/1
/= KL
a
/0/0/#28 u /#29i
/#28C/./7/#29This giv es the linear system of equationsxi /+/1
ki /, /1
/+/2 /#28 xi
/+ xi /+/1
/#29 ki
/+ xi
ki /+/1
/=/3 /#28 xi
di /+/1
/+ xi /+/1
di
/#29 /#28C/./8/#29i /=/1 /; /2 /;/:/:/: /;n /, /1Since /#28C/./8/#29 has n /+ /1 unkno wns/, but only n /, /1 equations/, t w o additionalequations are needed to uniquely determine the spline function/. Theseequations can b e obtained b y assuming that the spline function is a straigh tline outside the in terv al /#28Dahlquist et al/. /1/9/7/4/#29/. HenceKL
a
/0/0/#28 u/0
/#29/1
/= KL
a
/0/0/#28 un
/#29n
/=/0 /#28C/./9/#29C/./1 Deriv ation of the linear regression form /1/9/9whic h giv es/2 k/0
/+ k/1
/= /3 d/1
/#28C/./1/0/#29kn /, /1
/+/2 kn
/= /3 dn
/#28C/./1/1/#29The equations /#28C/./8/#29/, /#28C/./1/0/#29 and /#28C/./1/1/#29 can b e written in matrix form asLK /=/3 D /#28C/./1/2/#29whereK /= /#5B k/0
/:/:/: kn
/#5D
TL /=
/2/6/6
/6/6/6
/6
/6
/6
/6/6/6
/6
/6/4
/2 /1x/2
/2/#28 x/1
/+ x/2
/#29 x/1x/3
/2/#28 x/2
/+ x/3
/#29 x/2/././.
/././.
/././.xn /, /1
/2/#28 xn /, /2
/+ xn /, /1
/#29 xn /, /2/1 /2
/3/7/7
/7/7/7
/7
/7
/7
/7/7/7
/7
/7/5D /=
/2/6/6
/6/6/6
/6
/6
/6/4
d/1x/1
d/2
/+ x/2
d/1x/2
d/3
/+ x/3
d/2/././.xn /, /1
dn
/+ xn
dn /, /1dn
/3/7/7
/7/7/7
/7
/7
/7/5The K /-v ector is th us obtained b y solvingK /=/3 L
/, /1D /#28C/./1/3/#29The L
/, /1consists only of terms in v olving the grid p oin ts /#28 L
/, /1do es notdep ends on the measuremen ts/#29 and can b e expressed asL
/, /1/=
/2/6/6
/6/6/4
r/0/0
r/0/1
/:/:/: r/0 nr/1/0
r/1/1
/:/:/: r/1 n/./.
/.
/./.
/.
/./.
/.rn /0
rn /1
/:/:/: rnn
/3/7/7
/7/7/5
/#28C/./1/4/#29Using /#28C/./1/3/#29/, the i /:th comp onen t can b e written aski
/=/3 /#28 ri /0
D/0
/+ ri /1
D/1
/+ /:/:/: /+ rin
Dn
/#29 /#28C/./1/5/#29/2/0/0 Cubic splinewhere D/0
/:/:/: Dn
are the elemen ts in the D /-v ector/. Replacing the dielemen ts in the D v ector with the /#12 parameters as de/#0Cned in /#28C/./3/#29/, andwriting ki
as a scalar pro duct giv eski
/= /3 /#1E
Ti
/#12KL
a
/#28C/./1/6/#29/#12KL
a
/= /#5B /#12/0
/:/:/: /#12n
/#5D
T/#28C/./1/7/#29/#1Ei
/=
/2/6/6/6
/6
/6
/6/6/6
/6
/6
/6
/6/4
/, ri /0
/1x/1
/, ri /1
x/2x/1ri /0
/1x/1
/+ ri /1
/#28
x/2x/1
/,
x/1x/2
/#29 /, ri /2
x/3x/2/./.
/.ri/;m /, /1
xm /, /1xm
/+ rim
/#28
xm /+/1xm
/,
xmxm /+/1
/#29 /, ri/;m /+/1
xm /+/2xm /+/1/././.ri/;n /, /2
xn /, /2xn /, /1
/+ ri/;n /, /1
/#28
xnxn /, /1
/,
xn /, /1xn
/#29 /, rin
/1xnrin
/1xn
/+ ri/;n /, /1
xn /, /1xn
/3/7/7/7
/7
/7
/7/7/7
/7
/7
/7
/7/5
/#28C/./1/8/#29m /= /2 /:/:/: n /, /2 /#28C/./1/9/#29After straigh tforw ard algebraic manipulations/, utilizing /#28C/./1/#29 and /#28C/./1/6/#29 /#7B/#28C/./1/8/#29/, w e /#0Cnally getKL
a /#28 u /#29i
/= /#20
TKL
a
/#12KL
a
/#28C/./2/0/#29/#20
TKL
a
/= xi
mi
/#28/1 /, mi
/#29/#5B/#28/1 /, mi
/#29/3 /#1E
Ti /, /1
/, mi
/3 /#1E
Ti
/#5D/+ G /#28C/./2/1/#29G /= /#5B/0 /:/:/: /0 f /1/+ m
/2i
/#28/2 mi
/, /3/#29 gi /, /1
f m
/2i
/#28/3 /, /2 mi
/#29 gi
/0 /:/:/: /0/#5D /#28C/./2/2/#29where f /:/:/: gi
stands for the i /:th elemen t in the arra y /.App endix DEstimation using anextended Kalman /#0ClterAn algorithm for estimating KL
a and the respiration rate using an extendedKalman /#0Clter has b een dev elop ed/. The algorithm whic h also comp ensatesfor the sensor dynamics w as deriv ed in a Masters pro ject /#28Nak a jima /1/9/9/6/#29/.It is as follo ws/:Consider a general nonlinear systemx /#28 t /+/1 /#29 /= f /#28 t/; x /#28 t /#29/#29 /+ g /#28 t/; x /#28 t /#29/#29 v /#28 t /#29 /#28D/./1/#29ys
/#28 t /#29 /= h /#28 t/; x /#28 t /#29/#29 /+ e /#28 t /#29 /#28D/./2/#29where v /#28 t /#29 and e /#28 t /#29 are indep enden t white noise sequences/. The extendedKalman /#0Clter /#28EKF/#29 for the system /#28D/./1/#29 and /#28D/./2/#29/, can for example/, befound in S/#7F oderstr/#7F om /#28/1/9/9/4/#29/. The algorithm is as follo ws/:H /#28 t /#29 /=
/@h /#28 t/; x /#29/@x
/#0C/#0C/#0C/#0Cx /=/^ x /#28 t j t /, /1/#29
/#28D/./3/#29K /#28 t /#29 /= P /#28 t j t /, /1/#29 H
T/#28 t /#29/#5B H /#28 t /#29 P /#28 t j t /, /1/#29 H
T/#28 t /#29/+ R/2
/#28 t /#29/#5D
/, /1/#28D/./4/#29/^ x /#28 t j t /#29 /= /^ x /#28 t j t /, /1/#29 /+ K /#28 t /#29/#5B ys
/#28 t /#29 /, h /#28 t/; /^ x /#28 t j t /, /1/#29/#29/#5D /#28D/./5/#29P /#28 t j t /#29 /= P /#28 t j t /, /1/#29 /, K /#28 t /#29 H /#28 t /#29 P /#28 t j t /, /1/#29 /#28D/./6/#29/^ x /#28 t /+/1 j t /#29 /= f /#28 t/; /^ x /#28 t j t /#29/#29 /#28D/./7/#29FE
/#28 t /#29 /=
/@f /#28 t/; x /#29/@x
/#0C/#0C/#0C
/#0Cx /=/^ x /#28 t j t /#29
/#28D/./8/#29G /#28 t /#29 /= g /#28 t/; x /#29 jx /=/^ x /#28 t j t /#29
/#28D/./9/#29P /#28 t /+/1 j t /#29 /= FE
/#28 t /#29 P /#28 t j t /#29 F
TE
/#28 t /#29/+ G /#28 t /#29 R/1
G
T/#28 t /#29 /#28D/./1/0/#29/2/0/2 Estimation using an extended Kalman /#0ClterThe EKF is no w applied to estimate the respiration rate and KL
a functionutilizing a slo w DO sensor/. Let the linear DO sensor dynamics b e giv en b ythe follo wing systemxs
/#28 t /+/1 /#29 /= As
xs
/#28 t /#29/+ Bs
y /#28 t /#29 /#28D/./1/1/#29ys
/#28 t /#29 /= Cs
xs
/#28 t /#29/+ es
/#28 t /#29 /#28D/./1/2/#29where As
/, Bs
/, and Cs
are found b y con v erting the transfer function mo del inSection /4/./4/./3 to a state/-space mo del/. The noise es
/#28 t /#29 is white measuremen tnoise/. Note/, ho w ev er/, that the time dela ys should be remo v ed b y timeshifting the signal/, this is imp ortan t to impro v e the estimates/.The DO dynamics and the sensor dynamics can then be set togetherand describ ed b yx /#28 t /#29 /= /#5B y /#28 t /#29 /#12
T/#28 t /#29 xs
/#28 t /#29 /#5D
T/#28D/./1/3/#29f /#28 t/; x /#28 t /#29/#29 /=
/2/6/4
f/1
/#28 x /#29F/#12 /#28 t /#29As
xs
/+ Bs
y /#28 t /#29
/3/7/5
/#28D/./1/4/#29g /#28 t/; x /#28 t /#29/#29 /= /1 /#28D/./1/5/#29h /#28 t/; x /#28 t /#29/#29 /= Cs
xs
/#28 t /#29 /#28D/./1/6/#29f/1
/#28 x /#29 /= y /#28 t /#29/+ h
/#03/#5B
Q /#28 t /#29V
/#28 yin
/#28 t /#29 /, y /#28 t /#29/#29/+ KL
a /#28 u /#28 t /#29/#29/#28 ysat
/, y /#28 t /#29/#29 /, R /#28 t /#29/#5D /#28D/./1/7/#29v /#28 t /#29 /= /#5B w /#28 t /#29 e
T/#12
/#28 t /#29 /0 /#5D
T/#28D/./1/8/#29e /#28 t /#29 /= es
/#28 t /#29 /#28D/./1/9/#29where w /#28 t /#29 w as giv en in /#28/4/./9/#29 and e/#12
/#28 t /#29 in /#28/4/./2/7/#29/. The deriv ativ es used inthe EKF b ecomeFE
/#28 t /#29 /=
/@f /#28 t/; x /#29/@x
/#0C/#0C/#0C
/#0Cx /=/^ x /#28 t j t /#29
/=
/2/6/4
/@f/1/@y
/@f/1/@/#12
/0/0 F /0Bs
/0 As
/3/7/5
/#28D/./2/0/#29G /#28 t /#29 /= g /#28 t/; x /#29 jx /=/^ x /#28 t j t /#29
/=/1 /#28D/./2/1/#29H /#28 t /#29 /=
/@h /#28 t/; x /#29/@x
/#0C/#0C
/#0C/#0Cx /=/^ x /#28 t j t /, /1/#29
/=/#5B /0 /0 Cs
/#5D /#28D/./2/2/#29Bibliograph yAhl /#13 en/, A/. and M/. Sternad /#28/1/9/8/8/#29/. Intr o duction to Adaptive c ontr ol /. Systemsand Con trol Group/, Uppsala Univ ersit y /. /#28In Sw edish/#29/.Ahl /#13 en/, A/. and M/. Sternad /#28/1/9/8/9/#29/. Optimal decon v olution based on p oly/-nomial metho ds/. IEEE T r ans/. on A c oustics/, Sp e e ch/, and Signal Pr o/-c essing /3/7 /#28/2/#29/, /2/1/7 /#7B /2/2/6/.Ak aik e/, H/. /#28/1/9/8/1/#29/. Mo dern dev elopmen t of statistical metho ds/. In/: T r endsand Pr o gr ess in System Identi/#0Cc ation /#28P /. Eykho/#0B/, Ed/./#29/. P ergamonPress/.Andersson/, B/./, U/. Nyb erg and H/. Asp egren /#28/1/9/9/5/#29/. Methanol and ethanolas external carb on sources for denitri/#0Ccation/. Nordic Seminar/: E s poo /,Finland/.Andersson/, C/. and Y/. Lundb erg /#28/1/9/9/5/#29/. Addition of w eigh ting agen ts fore/#0Bectivisation of the activ ated sludge pro cess/. Master/'s thesis/. Dep/. ofW ater Resources Engineering/, Ro y al Institute of T ec hnology /,S w eden/./#28In Sw edish/#29/.Andrews/, J/. F/. /#28/1/9/9/4/#29/. Dynamic con trol of w astew ater treatmen t plan ts/.Envir on/. Sci/. T e chnol/. /2/8 /#28/9/#29/, /4/3/4 /#7B /4/4/0/.Asp egren/, H/./, B/. Andersson/, U/. Nyb erg and J/. la Cour Jansen/#28/1/9/9/2/#29/. Mo del and sensor based optimization of nitrogen remo v al atKlagshamn w astew ater treatmen t plan t/. Wat/. Sci/. T e ch/. /2/6 /#28/5/#7B/6/#29/, /1/3/1/5/#7B /1/3/2/3/./#17Astr/#7F om/, K/. J/. and B/. Wittenmark /#28/1/9/8/9/#29/. A daptive Contr ol /. Addison/-W esley /, Reading/, Massac h usetts/./#17Astr/#7F om/, K/. J/. and B/. Wittenmark /#28/1/9/9/0/#29/. Computer/-Contr ol le d Systems /.Pren tice/-Hall In ternational Editions/, Inc/. Englew o o d Cli/#0Bs/./2/0/4 BIBLIOGRAPHY/#17Astr/#7F om/, K/. J/. and J/. Nilsson /#28/1/9/9/4/#29/. Analysis of a sc heme for iteratediden ti/#0Ccation and con trol/. SYSID /1/9/9/4 Cop enhagen/, Denmark/./#17Astr/#7F om/, K/. J/. and T/. H/#7F agglund /#28/1/9/8/4/#29/. Automatic tuning of simple regula/-tors with sp eci/#0Ccations on phase and amplitude margins/. A utomatic a/2/0 /#28/5/#29/, /6/4/5/#7B/6/5/1/.Balm /#13 er/, P /. and B/. Hultman /#28/1/9/8/8/#29/. Con trol of phosphorus disc harges/:presen t situation and trends/. Hydr obiolo gia /1/7/0 /, /3/0/5/#7B/3/1/9/.Barnes/, D/. and P /. J/. Bliss /#28/1/9/8/3/#29/. Biolo gic al Contr ol of Nitr o gen in Wastew/-ater T r e atment /. E/. /& F/. N/. Sp on/, London /& New Y ork/.Bastin/, G/. and D/. Do c hain /#28/1/9/9/0/#29/. On/-line Estimation and A daptive Con/-tr ol of Bior e actors /. Elsevier/, Amsterdam/.Behse/, W/. /#28/1/9/9/5/#29/. Nitrogen remo v al/, pro cess ev aluation of the wtp in upp/-sala/. T ec hnical Rep ort Mat/.nr/: /2/4/4/7/. Dept/. of W ater Resources Eng/./,Ro y al Institute of T ec hnology /. Sto c kholm/, Sw eden/.Bennett/, G/. F/. /#28/1/9/8/0/#29/. Oxygen transfer rates/, mec hanisms/, and applica/-tions in biological w astew ater treatmen t/. Critic al R ev/. in Env/. Contr olpp/. /3/0/1/#7B/3/9/1/.Bergh/, S/-G/. /#28/1/9/9/6/#29/. Diagnosis problems in w astew ater settling/. Licen tiatethesis/. Lund Institute of T ec hnology /. Dept/. of Industrial Electrical Eng/.and Automation/. CODEN/:LUTED X/#2F/#28TEIE/-/1/0/1/1/#29/#2F/1/-/1/1/8/#2F /#28/1 /9/9/6 /#29/.Bo c k en/, S/. M/./, M/. Braae and P /. L/. Dold /#28/1/9/8/9/#29/. Dissolv ed o xygen con/-trol and o xygen utilization rate estimation/: Extension of the holm/-b erg/#2Folsson metho d/. Wat/. Sci/. T e ch/. /2/1 /, /1/1/9/7/#7B/1/2/0/8/.Bradley /, J/. W/./, S/. Ky osai/, P /. Matthews/, K/. Sato and M W ebb er /#28/1/9/9/2/#29/.W orldwide sludge managemen t practices/. In/: Municip al Sewage SludgeManagement/: Pr o c essing/, Utilization and Disp osal /#28C/. Lue/-Hing/, D/. R/.Zenz and R/. Kuc henrither/, Eds/./#29/. T ec hnomic publishing compan y /, Inc/./,Lancaster/, USA/.Brenner/, A/. /#28/1/9/9/1/#29/. External carb on/, additional reactor /#7B To add or not toadd/?/. In teractions of w astew ater biomass and reactor con/#0Cgurationsin biological treatmen t plan ts /2/1/#7B/2/3 August/, Cop enhagen/, Denmark/.Carlsson/, B/. /#28/1/9/9/3/#29/. On/-line estimation of the respiration rate in an acti/-v ated sludge pro cess/. Wat/. Sci/. T e ch/. /2/8 /#28/1/1/#7B/1/2/#29/, /4/2/7/#7B/4/3/4/.Carlsson/, B/. /#28/1/9/9/5/#29/. Automatic con trol in w astew ater treatmen t plan ts/.Cirkulation /#28/6/#29/, /#7B/. /#28In Sw edish/#29/.BIBLIOGRAPHY /2/0/5Carlsson/, B/. /#28/1/9/9/7/#29/. The use of automatic con trol in w astew ater treamen tplan ts/. Nordisk k onferens/, kv/#7F av erening oc h biologisk fosfor rening/,Sto c kholm /2/0/-/3/0 Jan/.Carlsson/, B/. and C/-F/. Lindb erg /#28/1/9/9/5/#29/. A con trol and sup ervision systemfor an activ ated sludge pilot plan t/. Nin th F orum for Applied Biotec h/-nology /, /2/7/#7B/2/9 Sept/. pp /2/4/9/1/#7B/2/4/9/4/.Carlsson/, B/. and S/. Hasselblad /#28/1/9/9/6/#29/. A pro cess sim ulator for the activ atedsludge pro cess/. Cirkulation /#28/5/#29/, /#7B/. /#28In Sw edish/#29/.Carlsson/, B/. and T/. Wigren /#28/1/9/9/3/#29/. On/-line iden ti/#0Ccation of the dissolv edo xygen dynamic in an activ ated sludge pro cess/. /1/2th W orld Congressof IF A C/, Sydney /, Australia/, July /1/9/-/2/3/.Carlsson/, B/./, C/-F/. Lindb erg/, S/. Hasselblad and S/. Xu /#28/1/9/9/4 a /#29/. On/-lineestimation of the respiration rate and the o xygen transfer rate atKungs/#7F angen w astew ater plan t in Uppsala/. Wat/. Sci/. T e ch/. /3/0 /#28/4/#29/, /2/5/5/#7B/2/6/3/.Carlsson/, B/./, J/. Latomaa and C/-F/. Lindb erg /#28/1/9/9/4 b /#29/. A con trol andsup ervision system for an activ ated sludge pro cess /#28ett st yr/- oc h/#7Fov erv akningssytem f/#7F or en aktivslampro cess/. Reglerm/#7F ote /'/9/4/, /2/5/#7B/2/6Oct/. V/#7F aster /#17 as/, Sw eden/.Carlsson/, B/./, S/. Hasselblad/, E/. Plaza/, S/. M /#17 artensson and C/-F/. Lindb erg/#28/1/9/9/7/#29/. Design and op eration of a pilot/-scale activ ated sludge plan t/.V atten /5/3 /#28/1/#29/, /2/7/#7B/3/2/.Carstensen/, J/. /#28/1/9/9/4/#29/. Iden ti/#0Ccation of w astew ater pro cesses/. PhD thesis/.IMSOR /& I/. Kr /#7F uger Systems AS/, Lyngb y /, Denmark/.Clark e/, D/. W/. and P /.J /. G a wthrop /#28/1/9/7/5/#29/. Self/-tuning con troller/. Pr o c/. IEE/1/2/2 /, /9/2/9/#7B/9/3/4/.Co ok/, S/. C/. and P /.W /.J o witt /#28/1/9/8/5/#29/. In v estigation of dissolv ed o xygen dy/-namics in the activ ated sludge pro cess/. IF A C Identi/#0Cc ation and SystemPar ameter Estimation pp/. /2/4/1/#7B/2/4/8/. Y ork/, UK/.Coury /, B/. G/. /#28/1/9/9/6/#29/. W ater lev el con trol for the toilet tank/: A historicalp ersp ectiv e/. In/: The Contr ol Handb o ok /#28W/. S/. Levine/, Ed/./#29/. CR CPress/, Inc/./, Bo ca Raton/, USA/.Dahlquist/, G/./,
/#17A Bj/#7F orc k and N/. Andersson /#28/1/9/7/4/#29/. Numeric al Metho ds /.Pren tice/-Hall/./2/0/6 BIBLIOGRAPHYDo c hain/, D/. and M/. P errier /#28/1/9/9/3/#29/. Con trol design for nonlinear w astew atertreatmen t pro cesses/. Wat/. Sci/. T e ch/. /2/8 /#28/1/1/#7B/1/2/#29/, /2/8/3/.Do yle/, J/. C/. and G/. Stein /#28/1/9/7/9/#29/. Robustness with observ ers/. IEEE T r ans/.on A utomatic Contr ol A C/#7B/2/4 /#28/4/#29/, /6/0/7/#7B/6/1/1/.Elmqvist/, H/./, K/. J/.
/#17Astr/#7F om and T/. Sc h/#7F on thal /#28/1/9/8/6/#29/. Simnon/-User/'s Guidefor MS/-DOS Computers /. Dept/. of Automatic Con trol/, Lund Inst/. ofT ec hn/./, Sw eden/.EP A /#28/1/9/8/9/#29/. Fine Por e A er ation Systems /. United States En vironmen talProtection Agency /,E P A/#2F/6/2/5/#2F/1/-/8/9/#2F/0/2/3/.Finnson/, A/. /#28/1/9/9/4/#29/. Computer sim ulations of full/-scale activ ated sludgepro cesses/. Licen tiate thesis/. Ro y al Institute of T ec hnology /. Departmen tof W ater Resources Eng/. TRIT A/-V A T /1/9/4/1/, Sto c kholm Sw eden/.Flanagan/, M/.J/./, B/.D/. Brac k en and J/.F/. Ro esler /#28/1/9/7/7/#29/. Automatic dissolv edo xygen con trol/. Journal of the Envir onmental Engine ering DivisionEE/4 /, /7/0/7/#7B/7/2/2/.Garc /#13 /#10a/, C/. E/./, D/. M/. Prett and M/. Morari /#28/1/9/8/9/#29/. Mo del predictiv e con trol/:Theory and practice /#7B a surv ey /. A utomatic a /2/5 /#28/3/#29/, /3/3/5/#7B/3/4/8/.Grijsp eerdt/, K/./, P /. V anrolleghem and W/. V erstraete /#28/1/9/9/5/#29/. Selection ofone/-dimensional sedimen tation mo dels for on/-line use/. Wat/. Sci/. T e ch/./3/1 /#28/2/#29/, /1/9/3/#7B/2/0/4/.Grim ble/, M/. J/. /#28/1/9/8/8/#29/. Tw o/-degrees of freedom feedbac k and feedfor/-w ard optimal con trol of m ultiv ariable sto c hastic systems/. A utomatic a/2/4 /#28/6/#29/, /8/0/9/#7B/8/1/7/.Gustafsson/, L/-G/./, D/. Lumley /, C/. Lindeb org and J/. Haraldsson /#28/1/9/9/3/#29/. In/-tegrating a catc hmen t sim ulator in to w ast w ater treatmen t plan t op er/-ation/. Wat/. Sci/. T e ch/. /2/8 /#28/1/1/#7B/1/2/#29/, /4/5/#7B/5/4/.Gustafsson/, T/. /#28/1/9/8/8/#29/. R e gsim /. LUG Elektronik HB/, Lule /#17 a/, Sw eden/.Hallin/, S/. and M/. P ell /#28/1/9/9/6/#29/. Denitri/#0Ccation in activ ated sludge withexternal carb on sources /#7B p ersp ectiv es and consequences/. V atten/5/2 /#28/3/#29/, /2/1/3/#7B/2/1/6/. /#28In Sw edish/#29/.Hallin/, S/./, C/-F/. Lindb erg/, M/. P ell/, E/. Plaza and B/. Carlsson /#28/1/9/9/6/#29/. Micro/-bial adaptation/, pro cess p erformance and a suggested con trol strategyin a pre/-den trifying system with ethanol dosage/. Wat/. Sci/. T e ch/. /3/4 /#28/1/#7B/2/#29/, /9/1/#7B/9/9/.BIBLIOGRAPHY /2/0/7Harremo /#7F es/, P /./, M/. Henze/, E/. Arvin and E/. Dahi /#28/1/9/9/4/#29/. T e or etisk V andhy/-giejne /.P olyteknisk F orlag/, Lyngb y /, Denmark/.Hasselblad/, S/. and S/. Hallin /#28/1/9/9/6/#29/. In termitten t dosage of ethanol in a pre/-denitrifying activ ated sludge pro cess/. Wat/. Sci/. T e ch/. /3/4 /#28/1/#7B/2/#29/, /3/8/7/#7B/3/8/9/.Hellstr/#7F om/, B/. G/. and J/. Bosander /#28/1/9/9/0/#29/. St yrstrategier a v tillsats a v externk olk/#7F alla vid f/#7F ordenitri/#0Ck ation/. SYV AB/, Himmerfj/#7F ardsv erk et/, Sw eden/.Henze/, M/./, C/. P /. L/. Grady Jr/./, W/. Gujer/, G/. v/. R/. Marais and T/. Matsuo/#28/1/9/8/7/#29/. Activ ated sludge mo del no/. /1/. Scienti/#0Cc and T e chnic al R ep ortNo/. /1 /. IA W Q/, London/, Great Britain/.Henze/, M/./, P /. Harremo /#7F es/, J/. la Cour Jansen and E/. Arvin /#28/1/9/9/5 a /#29/.Wastewater tr e atment/, biolo gic al and chemic al pr o c esses /. Springer/-V erlag Berlin Heidelb erg/, German y /.Henze/, M/./, W/. Gujer/, T/. Mino/, T/. Matsuo/, M/. C/. W en tzel and G/. v/. R/.Marais /#28/1/9/9/5 b /#29/. Activ ated sludge mo del no/. /2/. Scienti/#0Cc and T e chnic alR ep ort No/. /3 /. IA W Q/, London/, Great Britain/.Holm b erg/, A/. /#28/1/9/8/1/#29/. Micropro cessor/-based estimation of o xygen utilizationin the activ ated sludge w astew ater treatmen t pro cess/. Int/. J/. SystemsSci/. /1/2 /#28/6/#29/, /7/0/3/#7B/7/1/8/.Holm b erg/, U/. /#28/1/9/9/0/#29/. On the iden ti/#0Cabilit y of dissolv ed o xygen concen tra/-tion dynamics/. IA WPR C/'s /2/5th Anniv ersary Conference and Exhibi/-tion/, Ky oto/, Japan/.Holm b erg/, U/. and G/. Olsson /#28/1/9/8/5/#29/. Sim ultaneous on/-line estimation of theo xygen transfer rate and respiration rate/. In/: Mo del ling and Contr ol ofBiote chnolo gic al Pr o c esses /#28A/. Johnson/, Ed/./#29/. pp/. /1/8/5/#7B/1/8/9/. P ergamonPress/, Oxford/.Holm b erg/, U/./, G/. Olsson and B/. Andersson /#28/1/9/8/9/#29/. Sim ultaneous DO con/-trol and respiration estimation/. Wat/. Sci/. T e ch/. /2/1 /, /1/1/8/5/#7B/1/1/9/5/.Hultman/, B/. /#28/1/9/9/2/#29/. The Baltic sea en vironmen t/, session /9/, w ater andw astew ater managemen t in the Baltic region/. Ro y al Institute of T ec h/-nology /, Sto c kholm/. ISBN /9/1/-/5/0/6/-/0/9/0/5/-X/.Hultman/, B/./, B/. Levin/, P /. Li/, E/. Plaza/, J/. T rela and S/. Xu /#28/1/9/9/7/#29/. Ev al/-uation of the e/#0Bects of seeding of nitri/#0Ccation bacteria/, addition ofw eigh ting agen ts and addition of organic material on the activ atedsludge pro cess/. In preparation/./2/0/8 BIBLIOGRAPHYHultman/, B/./, K/. J/#7F onsson and E/. Plaza /#28/1/9/9/4/#29/. Com bined nitrogen andphosphorus remo v al in a full/-scale con tiuous up/-/#0Do w sand /#0Clter/.Wat/. Sci/. T e ch/. /2/9 /#28/1/0/#7B/1/1/#29/, /1/2/7/#7B/1/3/4/.Isaacs/, S/. H/. and M/. Henze /#28/1/9/9/5/#29/. Con trolled carb on source addition to analternating nitri/#0Ccation/-denitri/#0Ccation w astew ater treatmen t pro cessincluding biological P remo v al/. Wat/. R es/. /2/9 /#28/1/#29/, /7/7/#7B/8/9/.Isaacs/, S/. H/./, M/. Henze/, H/. S/#1Ceb erg and M/. K/#7F ummel /#28/1/9/9/3/#29/. Activ atedsludge n utrien t remo v al pro cess con trol b y carb on source addition/./1/2th IF A C Sydney /.Jeppsson/, U/. /#28/1/9/9/3/#29/. On the v eri/#0Cabilit y of the activ ated sludge systemdynamics/. Licen tiate thesis/. Lund Institute of T ec hnology /. Dept/. ofIndustrial Electrical Eng/. and Automation/, Lund/, Sw eden/.Jeppsson/, U/. /#28/1/9/9/6/#29/. Mo delling asp ects of w astew ater treatmen t pro cesses/.PhD thesis/. Lund Institute of T ec hnology /. Dept/. of Industrial ElectricalEng/. and Automation/, Lund/, Sw eden/.Je /#14 zek/, J/. and V/. Ku /#14 cera /#28/1/9/8/5/#29/. E/#0Ecien t algorithm for matrix sp ectralfactorization/. A utomatic a /2/1 /#28/6/#29/, /6/6/3/#7B/6/6/9/.Kautsky /, J/./, N/. K/. Nic hols and P /.V an Do oren /#28/1/9/8/5/#29/. Robust p ole assign/-men t in linear state feedbac k/. Int/. J/. Contr ol /4/1 /#28/5/#29/, /1/1/2/9/#7B/1/1/5/5/.Khalil/, H/. K/. /#28/1/9/9/6/#29/. Nonline ar systems /. Pren tice Hall/, Upp er Saddle Riv er/,USA/.Klap wijk/, A/./, H/. Spanjers and H/. T emmink /#28/1/9/9/3/#29/. Con trol of activ atedsludge plan ts based on measuremen ts of respiration rates/. Journal A/3/3 /, /3/3/#7B/4/2/.Ko/, K/. Y/./, B/. C/. McInnis and G/. C/. Go o dwin /#28/1/9/8/2/#29/. Adaptiv e con trol andiden ti/#0Ccation of the dissolv ed o xygen pro cess/. A utomatic a /1/8 /#28/6/#29/, /7/2/7/#7B/7/3/0/.Komm unf/#7F orbundet /#28/1/9/8/8/#29/. A vloppsteknik /. T ryc k eri Balder AB/. /#28InSw edish/#29/.Kw ak ernaak/, H/. and R/. Siv an /#28/1/9/7/2/#29/. Line ar Optimal Contr ol Systems /.Wiley/-In terscience/.Latomaa/, J/. /#28/1/9/9/4/#29/. A con trol and sup ervision system for an activ atedsludge pilot plan t/. Master/'s thesis/. Systems and Con trol Group/, Upp/-sala Univ ersit y /. UPTEC /9/4/0/7/7E/.BIBLIOGRAPHY /2/0/9Lindb erg/, C/-F/. /#28/1/9/9/5/#29/. Con trol of w astew ater treatmen t plan ts/. Licen ti/-ate thesis/. Uppsala Univ ersit y /. Systems and Con trol Group/. UPTEC/9/5/0/7/1R/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/3/#29/. Ev aluation of some metho ds foriden tifying the o xygen transfer rate and the respiration rate in anactiv ated sludge pro cess/. T ec hnical Rep ort UPTEC /9/3/0/3/2R/. Systemsand Con trol Group/, Uppsala Univ ersit y /. Uppsala/, Sw eden/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 a /#29/. Adaptiv e con trol of external car/-bo n /#0Do w rate in an activ ated sludge pro cess/. Wat/. Sci/. T e ch/. /3/4 /#28/3/#7B/4/#29/, /1/7/3/#7B/1/8/0/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 b /#29/. E/#0Ecien t con trol of the DO in anactiv ated sludge pro cess/. V atten /5/2 /#28/3/#29/, /2/0/9/#7B/2/1/2/. /#28In Sw edish/#29/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 c /#29/. Estimation of the respira/-tion rate and o xygen transfer function utilizing a slo w DO sensor/.Wat/. Sci/. T e ch/. /3/3 /#28/1/#29/, /3/2/5/#7B/3/3/3/.Lindb erg/, C/-F/. and B/. Carlsson /#28/1/9/9/6 d /#29/. Nonlinear and set/-p oin t con/-trol of the dissolv ed o xygen dynamic in an activ ated sludge pro cess/.Wat/. Sci/. T e ch/. /3/4 /#28/3/#7B/4/#29/, /1/3/5/#7B/1/4/2/.Lindb om/, L/. /#28/1/9/9/5/#29/. A Wiener /#0Cltering approac h to the design of trac kingalgorithms/. PhD thesis/. Signal Pro cessing Group/, Uppsala Univ ersit y /.Linde/, M/. /#28/1/9/9/3/#29/. An approac h to methanol dosage con trol in p ost/-denitri/#0Ccation pro cesses/. T ec hnical rep ort/. Dept/. of Industrial Electri/-cal Eng/. and Automation/, Lund Institute of T ec hnology /. Lund/, Sw e/-den/.Ljung/, L/. and S/. Gunnarsson /#28/1/9/9/0/#29/. Adaptation and trac king in systemiden ti/#0Ccation /#7B A surv ey /. A utomatic a /2/6 /#28/1/#29/, /7/#7B/2/1/.Ljung/, L/. and T/. S/#7F oderstr/#7F om /#28/1/9/8/3/#29/. The ory and Pr actic e of Re cursiveIdenti/#0Cc ation /. MIT Press/, Cam bridge/, Mass/.Londong/, J/. /#28/1/9/9/2/#29/. Strategies for optimized nitrate reduction with primarydenitri/#0Ccation/. Wat/. Sci/. T e ch/. /2/6 /#28/5/#7B/6/#29/, /1/0/8/7/#7B/1/0/9/6/.Lue/-Hing/, C/./, D/. R/. Zenz and R/. Kuc henrither /#28/1/9/9/2/#29/. Municip al SewageSludge Management/: Pr o c essing/, Utilization and Disp osal /.T ec hnomicpublishing compan y /, Inc/./, Lancaster/, USA/./2/1/0 BIBLIOGRAPHYLuk asse/, L/.J/.S/./, K/.J/. Keesman and G/. v an Straten /#28/1/9/9/6/#29/. Grey/-b o x iden/-ti/#0Ccation of dissolv ed o xygen dynamics in activ ated sludge pro cesses/./1/3th W orld Congress of IF A C/, San F rancisco/, USA/, July /.Lundgren/, L/. J/. /#28/1/9/9/4/#29/. D /#17 a torrdasset sp olades/. In/: T ankar om vat/-ten /#28A/. Finnson/, Ed/./#29/. F/#7F oreningen V atten/. Sto c kholm/, Sw eden /#28InSw edish/#29/.Luttmer/, J/. /#28/1/9/9/5/#29/. Design of a sim ulator for an activ ated sludge pro cess/.Master/'s thesis/. Systems and Con trol Group/, Uppsala Univ ersit y /. UP/-TEC /9/5/1/4/9E/.Lynggaard/-Jensen/, A/./, N/. H/. Eisum/, I/. Rasm ussen/, H/. Sv anj/#1Ar Jacobsenand T Stenstr/#1Cm /#28/1/9/9/6/#29/. Description and test of a new generation ofn utrien t sensors/. Wat/. Sci/. T e ch/. /3/3 /#28/1/#29/, /2/5/#7B/3/5/.MathW orks /#28/1/9/9/2/#29/. Simulink/, A pr o gr am for simulating dynamic systems /.The Math W orks/, Inc/./, Natic k/, MA/.Mosca/, E/./, G/. Zappa and C/. Manfredi /#28/1/9/8/4/#29/. Multistep horizon self/-tuningcon trollers/: the MUSMAR approac h/. IF A C /9th W orld Congress/, Bu/-dap est/, Hungary /.Nak a jima/, S/. /#28/1/9/9/6/#29/. On/-line estimation of the respiration rate and theo xygen transfer function using an extended k alman /#0Clter/. Master/'sthesis/. Departmen t of Signals/, Sensors and Systems/: Ro y al Instituteof T ec hnology /,S w eden/.Nielsen/, M/. K/. and A/. Lynggaard /#28/1/9/9/3/#29/. Sup erior tuning a rep orting/#28ST AR/#29 /#7B a new concept for on/-line pro cess con trol of w astew atertreatmen t plan ts/. Wat/. Sci/. T e ch/. /2/8 /#28/1/1/#7B/1/2/#29/, /5/6/1/#7B/5/7/8/.Nielsen/, M/. K/. and T/. B/.
/#7FOnnerth /#28/1/9/9/5/#29/. Impro v emen t of a recirculatingplan tb yi n tro ducing ST AR con trol/. Wat/. Sci/. T e ch/. /3/1 /#28/2/#29/, /1/7/1/#7B/1/8/0/.Nielsen/, M/. K/./, J/. Carstensen and P /. Harremo /#7F es /#28/1/9/9/6/#29/. Com bined con trolof sew er and treatmen t plan t during rainstorm/. Wat/. Sci/. T e ch/. /3/4 /#28/3/#7B/4/#29/, /1/8/1/#7B/1/8/7/.Nyb erg/, U/./, B/. Andersson and H/. Asp egren /#28/1/9/9/6/#29/. Real time con trolfor minimizing e/#0Fuen t concen trations during storm w ater ev en ts/.Wat/. Sci/. T e ch/. /3/4 /#28/3/#7B/4/#29/, /1/2/7/#7B/1/3/4/.Nyb erg/, U/./, H/. Asp egren and B/. Andersson /#28/1/9/9/3/#29/. In tegration of on/-lineinstrumen ts in the practical op eration of the Klagshamn w astew atertreatmen t plan t/. V atten /4/9 /#28/4/#29/, /2/3/5/#7B/2/4/4/.BIBLIOGRAPHY /2/1/1Olsson/, G/. /#28/1/9/9/3 a /#29/. Adv ancing ICA tec hnology b y eliminating the con/-strain ts/. Wat/. Sci/. T e ch/. /2/8 /#28/1/1/#7B/1/2/#29/, /1/#7B/7/.Olsson/, G/. /#28/1/9/9/3 b /#29/. Op erator/-Pro cess In teractions is more than HCI/.HCI/'/9/3/, /5th In ternational Conference on Human/-Computer In terac/-tion/.Olsson/, G/. and G/. Piani /#28/1/9/9/2/#29/. Computer Systems for A utomation andContr ol /. Pren tice Hall In ternational/, Hemel Hempstead/, UK/.Olsson/, G/. and J/. F/. Andrews /#28/1/9/7/8/#29/. The dissolv ed o xygen pro/#0Cle /#7B a v alu/-able to ol for con trol of the activ ated sludge pro cess/. Water R ese ar ch/1/2 /, /9/8/5/#7B/1/0/0/4/.Olsson/, G/. and U/. Jeppson /#28/1/9/9/4/#29/. Establishing cause/-e/#0Bect relationshipsin activ ated sludge plan ts /- What can be con trolled/?/. In/: WorkshopMo del ling/, Monitoring and Contr ol of Wastewater T r e atment Plants /.pp/. /2/0/5/7/#7B/2/0/7/0/. Med/. F ac/. Landb ou ww/. Univ/. Gen t/.P appas/, T/./, A/. J/. Laub and N/. R/. Sandell /#28/1/9/8/0/#29/. On the n umerical solu/-tion of the discrete/-time algebraic Riccati equation/. IEEE T r ans/. onA utomatic Contr ol A C/#7B/2/5 /#28/4/#29/, /6/3/1/#7B/6/4/1/.P eterk a/, V/. /#28/1/9/8/4/#29/. Predictor/-based self/-tuning con trol/. A utomatic a/2/0 /#28/1/#29/, /3/9/#7B/5/0/.Robinson/, M/. S/. /#28/1/9/9/0/#29/. Op eration exp erience of instrumen tation/, con troland automation at Holdenh urst st w/, Bournemouth/. J/. Instn/. Wat/. andEnvir/. Mangt/.Rundqwist/, L/. /#28/1/9/8/6/#29/. Self/-tuning Con trol of the Dissolv ed Oxygen Concen/-tration in an Activ ated Sludge Pro cess/. Licen tiate thesis/. Lund Insti/-tute of T ec hnology /. Departmen t of Automatic Con trol/, Lund/, Sw eden/.Ryc k aert/, V/.G/./, J/.E/. Claes/, C/. Herremans/, J/.F/. V an Imp e/, R/. Gerards andL/. V riens /#28/1/9/9/5/#29/. Observ er based estimation of o xygen uptak e ratein cyclically op erated biological w astew ater treamen t plan ts/. Nin thforum for applied biotec hnology /, Med/. F ac/. Landb ou ww/. Univ/. Gen t/,/6/0/#2F/4b/, pp /2/3/7/7/#7B/2/3/8/4/.S/#7F oderstr/#7F om/, T/. /#28/1/9/9/4/#29/. Discr ete/-Time Sto chastic Systems /. Pren tice HallIn ternational/, Hemel Hempstead/, UK/.S/#7F oderstr/#7F om/, T/. /#28/1/9/9/6/#29/. The system iden ti/#0Ccation comp etition of thermalp erformance in buildings /#7B what happ ened/? Reglerm/#7F ote /'/9/6/, /6/#7B/7June/, Lule /#17 a/, Sw eden /#28In Sw edish/#29/./2/1/2 BIBLIOGRAPHYS/#7F oderstr/#7F om/, T/. and P /. Stoica /#28/1/9/8/9/#29/. System Identi/#0Cc ation /. Pren tice HallIn ternational/, Hemel Hempstead/, UK/.Sorensen/, J/./, D/. E/. Thorn b erg and M/. K/. Nielsen /#28/1/9/9/4/#29/. Optimization of anitrogen/-remo ving biological w astew ater treatmen t plan t using on/-linemeasuremen ts/. Water Envir onment R ese ar ch /6/6 /#28/3/#29/, /2/3/6/#7B/2/4/2/.Spanjers/, H/. /#28/1/9/9/3/#29/. Respirometry in activ ated sludge/. PhD thesis/. W a/-geningen Agricultural Univ ersit y /.W ageningen/, the Netherlands/.Spanjers/, H/. and G/. Olsson /#28/1/9/9/2/#29/. Mo delling of the dissolv ed o xygen prob eresp onse in the impro v emen t of the p erformance of a con tin uous res/-piration meter/. Wat/. R es/. /2/6 /, /9/4/5/#7B/9/5/4/.Spanjers/, H/./, P /.V anrolleghem/, G/. Olsson and P /. Dold /#28/1/9/9/6/#29/. Respirometryin con trol of the activ ated sludge pro cess/. Wat/. Sci/. T e ch/. /3/4 /#28/3/-/4/#29/, /1/1/7/#7B/1/2/6/.Sternad/, M/. /#28/1/9/8/9/#29/. LQG feedforw ard regulator design for deterministic andsto c hastic disturbances/. T ec hnical Rep ort UPTEC /8/9/0/5/8R/. Systemsand Con trol Group/, Uppsala Univ ersit y /. Uppsala/, Sw eden/.Sternad/, M/. /#28/1/9/9/1/#29/. Use of disturbance measuremen t feedforw ard in LQGself/-tuners/. Int/. J/. Contr ol /5/3 /#28/3/#29/, /5/7/9/#7B/5/9/6/.Sternad/, M/. and T/. S/#7F oderstr/#7F om /#28/1/9/8/8/#29/. LQG/-optimal feedforw ard regula/-tors/. A utomatic a /2/4 /#28/4/#29/, /5/5/7/#7B/5/6/1/.T ak/#13 acs/, I/./, G/. G/. P atry and D/. Nolasco /#28/1/9/9/1/#29/. A dynamic mo del of theclari/#0Ccation/-thic k ening pro cess/. Water R ese ar ch /2/5 /#28/1/0/#29/, /1/2/6/3/#7B/1/2/7/1/.Tc hobanoglous/, G/. and E/. D/. Sc hro eder /#28/1/9/8/5/#29/. Water Quality /. Addison/-W esley Publishing Compan y /.V an Imp e/, J/. F/./, J/. V andew alle/, P /. A/. V anrolleghem and W/. V erstraete/#28/1/9/9/2/#29/. New trends in mo del/-based monitoring and con trol of the ac/-tiv ated sludge w astew ater treatmen t pro cess/. Journal A /3/3 /#28/3/#29/, /1/9/#7B/2/9/.V an Ov ersc hee/, P /. and B/. De Mo or /#28/1/9/9/6/#29/. Subsp ac e Identi/#0Cc ation for Lin/-e ar Systems/, The ory/, Implementation/, Applic ations /. Klu w er AcademicPublishers/.V anrolleghem/, P /. A/. /#28/1/9/9/4/#29/. On/-line mo delling of activ ated sludge pro cesses/:Dev elopmen t of an adaptiv e sensor/. PhD thesis/. Univ ersit y of Gen t/.Gen t/, Belgium/.BIBLIOGRAPHY /2/1/3V anrolleghem/, P /. A/. and W/. V erstraete /#28/1/9/9/3/#29/. On/-line monitoring equip/-men t for w astew ater treatmen t pro cesses/: State of the art/. In/: Pr o/-c e e dings TI/-KVIV Studie dag Optimalisatie van Waterzuiveringsinstal/-laties do or Pr o c eskontr ole en /-sturing /. Gen t/, Belgium/.V anrolleghem/, P /. A/./, L/. K/. V ermeersc h/, D/. Do c hain and G/. C/. V ansteenkiste/#28/1/9/9/3/#29/. Mo delling of a nonlinear distributed parameter bioreactor/: Op/-timisation of a n utrien t remo v al pro cess/. In/: Mo del ling and Simulation/#28A/. P a v /#13 e/, Ed/./#29/. pp/. /5/6/3/#7B/5/6/7/. SCS/, San Diego/.V anrolleghem/, P /. A/./, U/. Jeppsson/, J/. Carstensen/, B/. Carlsson and G/. Olsson/#28/1/9/9/6/#29/. In tegration of w astew ater treatmen t plan t design and op eration/#7B A systematic approac h using cost functions/./. Wat/. Sci/. T e ch/. /3/4 /#28/3/#7B/4/#29/, /1/5/9/#7B/1/7/1/.Vib erg/, M/. /#28/1/9/9/4/#29/. Subspace metho ds in system iden ti/#0Ccation/. In/: Pr o c e e d/-ings IF A C SYSID /'/9/4 /. Cop enhagen/, Denmark/.Vib erg/, M/./, B/. W ahlb erg and B/. Ottersten /#28/1/9/9/5/#29/. Ana ysis of State SpaceSystem Iden ti/#0Ccation metho ds based on instrumen tal v ariables andsubspace /#0Ctting/. T ec hnical Rep ort CTH/-TE/-/3/4/. Dept/. of Applied Elec/-tronics/, Chalmers Univ ersit yo f T ec hnology /,S w eden/.W agner/, M/. and H/. J/. P/#7F op el /#28/1/9/9/6/#29/. Surface activ e agen ts and their in/#0Du/-ence on o xygen transfer/. Wat/. Sci/. T e ch/. /3/4 /#28/3/#7B/4/#29/, /2/4/9/#7B/2/5/6/.W ells/, C/. H/. /#28/1/9/7/9/#29/. Computer con trol of fully nitrifying activ ated sludgepro cesses/. Instrumentation T e chnolo gy /4 /, /3/2/#7B/3/6/.Wikstr/#7F om/, A/. /#28/1/9/9/3/#29/. Simnon mo dels for activ ated sludge systems/. T ec hni/-cal rep ort/. Dept/. of Industrial Electrical Eng/. and Automation/, LundInstitute of T ec hnology /.Wikstr/#7F om/, A/. /#28/1/9/9/4/#29/. Sim ulink mo dels for activ ated sludge systems/. T ec h/-nical rep ort/. Dept/. of Industrial Electrical Eng/. and Automation/, Lund
Institute of T ec hnology /.Y oussef/, C/. B/./, G/. Roux and B/. Dahhou /#28/1/9/9/5/#29/. Multiv ariable adaptiv epredictiv e con trol of nonlinear systems/: Application to a m ultistagew astew ater treatmen t pro cess/. In/: Pr o c/. of /3r d Eur op e an Contr ol Con/-fer enc e /. pp/. /3/5/8/5/#7B/3/5/9/0/. Rome/, Italy /.Y uan/, Z/./, H/. Bogaert/, P /. V anrolleghem/, C/. Tho ey e/, G/. V ansteenkiste andW/. V erstraete /#28/1/9/9/6/#29/. Carb on dosage con trol for predenitri/#0Ccation pro/-cesses/. In/: Pr o c e e dings Workshop Mo del ling/, Monitoring and Contr ol/2/1/4 BIBLIOGRAPHYof Wastewater T r e atment Plants /. pp/. /1/7/3/3/#7B/1/7/4/3/. Med/. F ac/. Land/-bo u ww/. Univ/. Gen t/, /6/1/#2F/4a/.